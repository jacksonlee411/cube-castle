ğŸ§ª è¿è¡Œ Docker é›†æˆæµ‹è¯•ï¼ˆå ç”¨ 5432ï¼Œç¡®ä¿å®¿ä¸»æœºæ—  PostgreSQL æœåŠ¡ï¼‰...
[0;32m[INFO][0m å¯åŠ¨æµ‹è¯•æ•°æ®åº“ (5432) ...
time="2025-11-15T18:24:11+08:00" level=warning msg="/home/shangmeilin/cube-castle/docker-compose.test.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 Network cube-castle_testing  Creating
 Network cube-castle_testing  Created
 Volume "cube-castle_postgres-test-data"  Creating
 Volume "cube-castle_postgres-test-data"  Created
time="2025-11-15T18:24:11+08:00" level=warning msg="Found orphan containers ([cubecastle-rest cubecastle-redis cubecastle-postgres cube_castle_pgadmin]) for this project. If you removed or renamed this service in your compose file, you can run this command with the --remove-orphans flag to clean it up."
 Container cube-castle-test-db  Creating
 Container cube-castle-test-db  Created
 Container cube-castle-test-db  Starting
 Container cube-castle-test-db  Started
[0;32m[INFO][0m ç­‰å¾… PostgreSQL å°±ç»ª...
[0;32m[INFO][0m PostgreSQL å·²å°±ç»ª
[0;32m[INFO][0m æ‰§è¡Œ Goose è¿ç§» (up)...
2025/11/15 18:24:16 OK   20251106000000_base_schema.sql (301.79ms)
2025/11/15 18:24:16 OK   20251107090000_create_outbox_events.sql (25.43ms)
2025/11/15 18:24:16 OK   20251107123000_230_job_catalog_oper_fix.sql (8.39ms)
2025/11/15 18:24:16 OK   20251110110000_234_remove_org_unit_triggers.sql (13.93ms)
2025/11/15 18:24:16 goose: successfully migrated database to version: 20251110110000
[0;32m[INFO][0m è¿è¡Œ Go é›†æˆæµ‹è¯• (-tags=integration)...
?   	cube-castle/cmd/hrms-server/command	[no test files]
?   	cube-castle/cmd/hrms-server/command/cmd/organization-command-service/internal/services	[no test files]
?   	cube-castle/cmd/hrms-server/command/internal/authbff	[no test files]
=== RUN   TestLoadConfigDefaults
--- PASS: TestLoadConfigDefaults (0.00s)
=== RUN   TestLoadConfigOverrides
--- PASS: TestLoadConfigOverrides (0.00s)
=== RUN   TestLoadConfigInvalid
--- PASS: TestLoadConfigInvalid (0.00s)
=== RUN   TestDispatcherSuccess
--- PASS: TestDispatcherSuccess (0.02s)
=== RUN   TestDispatcherRetry
--- PASS: TestDispatcherRetry (0.02s)
=== RUN   TestDispatcherIntegration
=== RUN   TestDispatcherIntegration/Success_Path:_Publish_and_Mark
=== RUN   TestDispatcherIntegration/Failure_Path:_Retry_and_Backoff
=== RUN   TestDispatcherIntegration/Graceful_Shutdown_with_Context
=== RUN   TestDispatcherIntegration/Idempotency:_Skip_Already_Published
--- PASS: TestDispatcherIntegration (1.23s)
    --- PASS: TestDispatcherIntegration/Success_Path:_Publish_and_Mark (0.24s)
    --- PASS: TestDispatcherIntegration/Failure_Path:_Retry_and_Backoff (0.44s)
    --- PASS: TestDispatcherIntegration/Graceful_Shutdown_with_Context (0.30s)
    --- PASS: TestDispatcherIntegration/Idempotency:_Skip_Already_Published (0.22s)
PASS
ok  	cube-castle/cmd/hrms-server/command/internal/outbox	(cached)
?   	cube-castle/cmd/hrms-server/query/internal/app	[no test files]
=== RUN   TestRS256JWTValidationWithJWKS_Success
--- PASS: TestRS256JWTValidationWithJWKS_Success (0.48s)
=== RUN   TestRS256JWTValidationWithJWKS_InvalidAudience
--- PASS: TestRS256JWTValidationWithJWKS_InvalidAudience (0.19s)
PASS
ok  	cube-castle/cmd/hrms-server/query/internal/auth	(cached)
?   	cube-castle/cmd/hrms-server/query/internal/graphql	[no test files]
?   	cube-castle/cmd/hrms-server/query/internal/graphql/model	[no test files]
?   	cube-castle/cmd/hrms-server/query/internal/graphql/resolver	[no test files]
?   	cube-castle/cmd/hrms-server/query/internal/middleware	[no test files]
?   	cube-castle/cmd/hrms-server/query/internal/types	[no test files]
?   	cube-castle/cmd/hrms-server/query/publicgraphql	[no test files]
?   	cube-castle/cmd/hrms-server/query/tools/dump-schema	[no test files]
=== RUN   TestNewJWTMiddlewareWithOptionsDefaults
--- PASS: TestNewJWTMiddlewareWithOptionsDefaults (0.00s)
=== RUN   TestJWTValidateTokenHS256
--- PASS: TestJWTValidateTokenHS256 (0.00s)
=== RUN   TestJWTValidateTokenExpired
--- PASS: TestJWTValidateTokenExpired (0.00s)
=== RUN   TestJWTValidateTokenRS256WithJWKS
--- PASS: TestJWTValidateTokenRS256WithJWKS (0.53s)
=== RUN   TestParseRSAPublicKeyFromPEM
--- PASS: TestParseRSAPublicKeyFromPEM (0.82s)
=== RUN   TestRSAFromModExp
--- PASS: TestRSAFromModExp (0.84s)
=== RUN   TestJWKSManagerRefresh
--- PASS: TestJWKSManagerRefresh (0.43s)
=== RUN   TestSetUserContextHelpers
--- PASS: TestSetUserContextHelpers (0.00s)
=== RUN   TestPBACPermissionChecker
--- PASS: TestPBACPermissionChecker (0.00s)
=== RUN   TestGraphQLPermissionMiddlewareModes
--- PASS: TestGraphQLPermissionMiddlewareModes (0.00s)
=== RUN   TestGraphQLPermissionMiddlewareProduction
--- PASS: TestGraphQLPermissionMiddlewareProduction (0.00s)
=== RUN   TestCheckQueryPermissionDelegation
--- PASS: TestCheckQueryPermissionDelegation (0.00s)
=== RUN   TestGinJWTMiddleware
--- PASS: TestGinJWTMiddleware (0.11s)
=== RUN   TestGenerateTestTokenRS256
--- PASS: TestGenerateTestTokenRS256 (0.15s)
=== RUN   TestGenerateTestTokenMissingPrivateKey
--- PASS: TestGenerateTestTokenMissingPrivateKey (0.00s)
=== RUN   TestCheckRESTPermission
--- PASS: TestCheckRESTPermission (0.00s)
=== RUN   TestMockRESTPermissionCheck
--- PASS: TestMockRESTPermissionCheck (0.00s)
PASS
ok  	cube-castle/internal/auth	(cached)
=== RUN   TestCacheEventBusPublishAndClose
--- PASS: TestCacheEventBusPublishAndClose (0.00s)
=== RUN   TestCacheEventToOrganization
--- PASS: TestCacheEventToOrganization (0.00s)
=== RUN   TestSmartCacheUpdaterOperations
--- PASS: TestSmartCacheUpdaterOperations (0.00s)
=== RUN   TestSmartCacheUpdaterSearchFiltering
--- PASS: TestSmartCacheUpdaterSearchFiltering (0.00s)
=== RUN   TestL1CacheBasicOperations
--- PASS: TestL1CacheBasicOperations (0.03s)
=== RUN   TestL1CacheStatsAndEviction
--- PASS: TestL1CacheStatsAndEviction (0.00s)
=== RUN   TestConsistencyChecker
--- PASS: TestConsistencyChecker (0.00s)
=== RUN   TestCacheKeyManager
--- PASS: TestCacheKeyManager (0.00s)
=== RUN   TestUnifiedCacheManagerQueryFlows
--- PASS: TestUnifiedCacheManagerQueryFlows (0.06s)
=== RUN   TestUnifiedCacheManagerCDCAndInvalidation
--- PASS: TestUnifiedCacheManagerCDCAndInvalidation (0.10s)
=== RUN   TestUnifiedCacheManagerCacheManagement
--- PASS: TestUnifiedCacheManagerCacheManagement (0.01s)
PASS
ok  	cube-castle/internal/cache	(cached)
=== RUN   TestValidateSchedulerConfigValid
--- PASS: TestValidateSchedulerConfigValid (0.00s)
=== RUN   TestValidateSchedulerConfigInvalidCron
--- PASS: TestValidateSchedulerConfigInvalidCron (0.00s)
=== RUN   TestGetSchedulerConfigEnvOverride
--- PASS: TestGetSchedulerConfigEnvOverride (0.00s)
PASS
ok  	cube-castle/internal/config	(cached)
=== RUN   TestSchemaLoaderLoadAndCache
--- PASS: TestSchemaLoaderLoadAndCache (0.00s)
=== RUN   TestSchemaLoaderMissingFile
--- PASS: TestSchemaLoaderMissingFile (0.00s)
=== RUN   TestMustLoadSchema
--- PASS: TestMustLoadSchema (0.00s)
=== RUN   TestValidateSchemaConsistency
--- PASS: TestValidateSchemaConsistency (0.00s)
=== RUN   TestGetDefaultSchemaPath
--- PASS: TestGetDefaultSchemaPath (0.00s)
PASS
ok  	cube-castle/internal/graphql	(cached)
=== RUN   TestGraphQLEnvelopeTreatsNilErrorsAsSuccess
--- PASS: TestGraphQLEnvelopeTreatsNilErrorsAsSuccess (0.00s)
=== RUN   TestGraphQLEnvelopeTreatsEmptyErrorsAsSuccess
--- PASS: TestGraphQLEnvelopeTreatsEmptyErrorsAsSuccess (0.00s)
PASS
ok  	cube-castle/internal/middleware	(cached)
?   	cube-castle/internal/monitoring/health	[no test files]
=== RUN   TestNewCommandMiddlewares
--- PASS: TestNewCommandMiddlewares (0.00s)
=== RUN   TestRequestIDMiddlewareWrapper
--- PASS: TestRequestIDMiddlewareWrapper (0.00s)
=== RUN   TestDefaultAuditHistoryConfig
--- PASS: TestDefaultAuditHistoryConfig (0.00s)
=== RUN   TestNewCommandModule_Minimal
--- PASS: TestNewCommandModule_Minimal (0.00s)
=== RUN   Test_GetAssignments_RepoNil
--- PASS: Test_GetAssignments_RepoNil (0.00s)
=== RUN   Test_GetAssignments_DelegatesAndTrims
--- PASS: Test_GetAssignments_DelegatesAndTrims (0.00s)
=== RUN   Test_GetAssignmentHistory_DelegatesAndTrims
--- PASS: Test_GetAssignmentHistory_DelegatesAndTrims (0.00s)
=== RUN   Test_GetAssignmentStats_NoCacheAndNilFromRepoReturnsEmpty
--- PASS: Test_GetAssignmentStats_NoCacheAndNilFromRepoReturnsEmpty (0.00s)
=== RUN   Test_RefreshPositionCache_NilRedisIsNoop
--- PASS: Test_RefreshPositionCache_NilRedisIsNoop (0.00s)
=== RUN   Test_RefreshPositionCache_DeletesKeys
--- PASS: Test_RefreshPositionCache_DeletesKeys (0.05s)
=== RUN   Test_statsCacheKey_UppercasesCode
--- PASS: Test_statsCacheKey_UppercasesCode (0.00s)
=== RUN   TestAssignmentQueryFacade_UsesCache
--- PASS: TestAssignmentQueryFacade_UsesCache (0.02s)
PASS
ok  	cube-castle/internal/organization	(cached)
=== RUN   TestLogEvent_FallbackResourceID
--- PASS: TestLogEvent_FallbackResourceID (0.00s)
=== RUN   TestLogEventInTransaction
--- PASS: TestLogEventInTransaction (0.00s)
=== RUN   TestLogErrorSetsPayload
--- PASS: TestLogErrorSetsPayload (0.00s)
=== RUN   TestLogOrganizationDeleteUsesRecordId
--- PASS: TestLogOrganizationDeleteUsesRecordId (0.00s)
=== RUN   TestLogOrganizationDeleteRequiresSnapshot
--- PASS: TestLogOrganizationDeleteRequiresSnapshot (0.00s)
=== RUN   TestLogOrganizationCreateCapturesNewValues
--- PASS: TestLogOrganizationCreateCapturesNewValues (0.00s)
PASS
ok  	cube-castle/internal/organization/audit	(cached)
=== RUN   TestPositionAssignmentHistoryEmptyWhenNil
--- PASS: TestPositionAssignmentHistoryEmptyWhenNil (0.00s)
=== RUN   TestPositionAssignmentHistoryReturnsData
--- PASS: TestPositionAssignmentHistoryReturnsData (0.00s)
=== RUN   TestPositionCurrentAssignment
--- PASS: TestPositionCurrentAssignment (0.00s)
PASS
ok  	cube-castle/internal/organization/dto	(cached)
?   	cube-castle/internal/organization/events	[no test files]
=== RUN   TestGetTenantIDFromRequest_DefaultAndHeader
--- PASS: TestGetTenantIDFromRequest_DefaultAndHeader (0.00s)
=== RUN   TestGetOperatorFromRequest_Priorities
--- PASS: TestGetOperatorFromRequest_Priorities (0.00s)
=== RUN   TestGetIfMatchHeader_Parsing
--- PASS: TestGetIfMatchHeader_Parsing (0.00s)
=== RUN   TestJobCatalogHandlePreconditionFailed
--- PASS: TestJobCatalogHandlePreconditionFailed (0.00s)
=== RUN   TestValidateCreateJobLevelRequest
=== RUN   TestValidateCreateJobLevelRequest/Valid_request
=== RUN   TestValidateCreateJobLevelRequest/Missing_Code
=== RUN   TestValidateCreateJobLevelRequest/Missing_JobRoleCode
=== RUN   TestValidateCreateJobLevelRequest/Missing_Name
=== RUN   TestValidateCreateJobLevelRequest/Missing_Status
=== RUN   TestValidateCreateJobLevelRequest/Missing_LevelRank
=== RUN   TestValidateCreateJobLevelRequest/Missing_EffectiveDate
=== RUN   TestValidateCreateJobLevelRequest/Whitespace-only_Code
--- PASS: TestValidateCreateJobLevelRequest (0.00s)
    --- PASS: TestValidateCreateJobLevelRequest/Valid_request (0.00s)
    --- PASS: TestValidateCreateJobLevelRequest/Missing_Code (0.00s)
    --- PASS: TestValidateCreateJobLevelRequest/Missing_JobRoleCode (0.00s)
    --- PASS: TestValidateCreateJobLevelRequest/Missing_Name (0.00s)
    --- PASS: TestValidateCreateJobLevelRequest/Missing_Status (0.00s)
    --- PASS: TestValidateCreateJobLevelRequest/Missing_LevelRank (0.00s)
    --- PASS: TestValidateCreateJobLevelRequest/Missing_EffectiveDate (0.00s)
    --- PASS: TestValidateCreateJobLevelRequest/Whitespace-only_Code (0.00s)
=== RUN   TestValidateUpdateJobLevelRequest
=== RUN   TestValidateUpdateJobLevelRequest/Valid_request
=== RUN   TestValidateUpdateJobLevelRequest/Missing_Name
=== RUN   TestValidateUpdateJobLevelRequest/Missing_Status
=== RUN   TestValidateUpdateJobLevelRequest/Missing_EffectiveDate
=== RUN   TestValidateUpdateJobLevelRequest/Whitespace-only_Name
--- PASS: TestValidateUpdateJobLevelRequest (0.00s)
    --- PASS: TestValidateUpdateJobLevelRequest/Valid_request (0.00s)
    --- PASS: TestValidateUpdateJobLevelRequest/Missing_Name (0.00s)
    --- PASS: TestValidateUpdateJobLevelRequest/Missing_Status (0.00s)
    --- PASS: TestValidateUpdateJobLevelRequest/Missing_EffectiveDate (0.00s)
    --- PASS: TestValidateUpdateJobLevelRequest/Whitespace-only_Name (0.00s)
=== RUN   TestValidateJobCatalogVersionRequest
=== RUN   TestValidateJobCatalogVersionRequest/Valid_request
=== RUN   TestValidateJobCatalogVersionRequest/Missing_Name
=== RUN   TestValidateJobCatalogVersionRequest/Missing_Status
=== RUN   TestValidateJobCatalogVersionRequest/Missing_EffectiveDate
=== RUN   TestValidateJobCatalogVersionRequest/Whitespace-only_Name
--- PASS: TestValidateJobCatalogVersionRequest (0.00s)
    --- PASS: TestValidateJobCatalogVersionRequest/Valid_request (0.00s)
    --- PASS: TestValidateJobCatalogVersionRequest/Missing_Name (0.00s)
    --- PASS: TestValidateJobCatalogVersionRequest/Missing_Status (0.00s)
    --- PASS: TestValidateJobCatalogVersionRequest/Missing_EffectiveDate (0.00s)
    --- PASS: TestValidateJobCatalogVersionRequest/Whitespace-only_Name (0.00s)
=== RUN   TestGetIfMatchValue
--- PASS: TestGetIfMatchValue (0.00s)
=== RUN   TestGetIfMatchValueWeak
--- PASS: TestGetIfMatchValueWeak (0.00s)
=== RUN   TestGetIfMatchValueMissing
--- PASS: TestGetIfMatchValueMissing (0.00s)
=== RUN   TestPositionHandler_CreatePosition_Success
--- PASS: TestPositionHandler_CreatePosition_Success (0.00s)
=== RUN   TestPositionHandler_ReplacePosition_VersionConflict
--- PASS: TestPositionHandler_ReplacePosition_VersionConflict (0.00s)
=== RUN   TestPositionHandler_CreatePositionVersion_Success
--- PASS: TestPositionHandler_CreatePositionVersion_Success (0.00s)
=== RUN   TestPositionHandler_CreatePositionVersion_Conflict
--- PASS: TestPositionHandler_CreatePositionVersion_Conflict (0.00s)
=== RUN   TestPositionHandler_FillPosition_Success
--- PASS: TestPositionHandler_FillPosition_Success (0.00s)
=== RUN   TestPositionHandler_ListAssignments_Success
--- PASS: TestPositionHandler_ListAssignments_Success (0.00s)
=== RUN   TestPositionHandler_CreateAssignment_Success
--- PASS: TestPositionHandler_CreateAssignment_Success (0.00s)
=== RUN   TestPositionHandler_ApplyPositionEvent_NotFound
--- PASS: TestPositionHandler_ApplyPositionEvent_NotFound (0.00s)
=== RUN   TestPositionHandler_VacatePosition_MissingCode
--- PASS: TestPositionHandler_VacatePosition_MissingCode (0.00s)
=== RUN   TestPositionHandler_TransferPosition_Error
--- PASS: TestPositionHandler_TransferPosition_Error (0.00s)
PASS
ok  	cube-castle/internal/organization/handler	(cached)
=== RUN   TestRateLimitMiddleware_AllowsThenBlocks
--- PASS: TestRateLimitMiddleware_AllowsThenBlocks (0.00s)
=== RUN   TestRequestIDMiddleware_GeneratesAndPropagatesIDs
--- PASS: TestRequestIDMiddleware_GeneratesAndPropagatesIDs (0.00s)
=== RUN   TestRequestIDMiddleware_UsesHeadersWhenProvided
--- PASS: TestRequestIDMiddleware_UsesHeadersWhenProvided (0.00s)
=== RUN   TestPerformanceMiddleware_SetsHeadersAndCallsNext
--- PASS: TestPerformanceMiddleware_SetsHeadersAndCallsNext (0.00s)
PASS
ok  	cube-castle/internal/organization/middleware	(cached)
=== RUN   TestGetAuditHistoryReturnsStructuredRecords
--- PASS: TestGetAuditHistoryReturnsStructuredRecords (0.00s)
=== RUN   TestSanitizeModifiedFields
=== RUN   TestSanitizeModifiedFields/empty_string_returns_empty_slice
=== RUN   TestSanitizeModifiedFields/null_replaced_with_empty_slice_and_issue
=== RUN   TestSanitizeModifiedFields/valid_array_preserved
=== RUN   TestSanitizeModifiedFields/non_string_coerced
=== RUN   TestSanitizeModifiedFields/invalid_json
--- PASS: TestSanitizeModifiedFields (0.00s)
    --- PASS: TestSanitizeModifiedFields/empty_string_returns_empty_slice (0.00s)
    --- PASS: TestSanitizeModifiedFields/null_replaced_with_empty_slice_and_issue (0.00s)
    --- PASS: TestSanitizeModifiedFields/valid_array_preserved (0.00s)
    --- PASS: TestSanitizeModifiedFields/non_string_coerced (0.00s)
    --- PASS: TestSanitizeModifiedFields/invalid_json (0.00s)
=== RUN   TestSanitizeChanges
=== RUN   TestSanitizeChanges/empty_array
=== RUN   TestSanitizeChanges/missing_dataType_produces_unknown
=== RUN   TestSanitizeChanges/invalid_json
--- PASS: TestSanitizeChanges (0.00s)
    --- PASS: TestSanitizeChanges/empty_array (0.00s)
    --- PASS: TestSanitizeChanges/missing_dataType_produces_unknown (0.00s)
    --- PASS: TestSanitizeChanges/invalid_json (0.00s)
=== RUN   TestNormalizeChangeValue
=== RUN   TestNormalizeChangeValue/nil
=== RUN   TestNormalizeChangeValue/string
=== RUN   TestNormalizeChangeValue/bool
=== RUN   TestNormalizeChangeValue/float
=== RUN   TestNormalizeChangeValue/map
--- PASS: TestNormalizeChangeValue (0.00s)
    --- PASS: TestNormalizeChangeValue/nil (0.00s)
    --- PASS: TestNormalizeChangeValue/string (0.00s)
    --- PASS: TestNormalizeChangeValue/bool (0.00s)
    --- PASS: TestNormalizeChangeValue/float (0.00s)
    --- PASS: TestNormalizeChangeValue/map (0.00s)
=== RUN   TestRegisterValidationFailure
--- PASS: TestRegisterValidationFailure (0.00s)
=== RUN   TestInsertJobLevelVersionCopiesParentMetadata
--- PASS: TestInsertJobLevelVersionCopiesParentMetadata (0.00s)
=== RUN   TestInsertJobLevelVersionDetectsParentMismatch
--- PASS: TestInsertJobLevelVersionDetectsParentMismatch (0.00s)
=== RUN   TestOrganizationRepository_CountNonDeletedChildren
--- PASS: TestOrganizationRepository_CountNonDeletedChildren (0.00s)
=== RUN   TestOrganizationRepository_CountNonDeletedChildren_Error
--- PASS: TestOrganizationRepository_CountNonDeletedChildren_Error (0.00s)
=== RUN   TestShouldMarkOrganizationCurrent_SameDayDifferentTimezones
--- PASS: TestShouldMarkOrganizationCurrent_SameDayDifferentTimezones (0.00s)
=== RUN   TestShouldMarkOrganizationCurrent_FutureDate
--- PASS: TestShouldMarkOrganizationCurrent_FutureDate (0.00s)
=== RUN   TestShouldMarkOrganizationCurrent_NilDate
--- PASS: TestShouldMarkOrganizationCurrent_NilDate (0.00s)
=== RUN   TestSoftDeleteOrganization
--- PASS: TestSoftDeleteOrganization (0.00s)
=== RUN   TestSoftDeleteOrganization_NoRows
--- PASS: TestSoftDeleteOrganization_NoRows (0.00s)
=== RUN   TestHasOtherNonDeletedVersions
--- PASS: TestHasOtherNonDeletedVersions (0.00s)
=== RUN   TestComputeHierarchyForNew_Root
--- PASS: TestComputeHierarchyForNew_Root (0.00s)
=== RUN   TestComputeHierarchyForNew_DepthExceeded
--- PASS: TestComputeHierarchyForNew_DepthExceeded (0.00s)
=== RUN   TestComputeHierarchyForNew_ParentNotFound
--- PASS: TestComputeHierarchyForNew_ParentNotFound (0.00s)
=== RUN   TestOrganizationRepository_GetByCode_Success
--- PASS: TestOrganizationRepository_GetByCode_Success (0.00s)
=== RUN   TestOrganizationRepository_GetByCode_NotFound
--- PASS: TestOrganizationRepository_GetByCode_NotFound (0.00s)
=== RUN   TestOrganizationRepository_GetByRecordId_Success
--- PASS: TestOrganizationRepository_GetByRecordId_Success (0.00s)
=== RUN   TestOrganizationRepository_GetByRecordId_NotFound
--- PASS: TestOrganizationRepository_GetByRecordId_NotFound (0.00s)
=== RUN   TestGetAssignmentHistoryRequiresPositionCode
--- PASS: TestGetAssignmentHistoryRequiresPositionCode (0.02s)
=== RUN   TestGetAssignmentStatsEmptyDataset
--- PASS: TestGetAssignmentStatsEmptyDataset (0.00s)
=== RUN   TestGetOrganizationStats_Minimal
--- PASS: TestGetOrganizationStats_Minimal (0.00s)
=== RUN   TestGetOrganizationSubtree_BuildsHierarchy
--- PASS: TestGetOrganizationSubtree_BuildsHierarchy (0.00s)
=== RUN   TestPostgreSQLRepository_GetOrganizations_Minimal
--- PASS: TestPostgreSQLRepository_GetOrganizations_Minimal (0.00s)
=== RUN   TestGetPositions_MinimalSuccess
--- PASS: TestGetPositions_MinimalSuccess (0.00s)
=== RUN   TestGetPositionTimelineUsesChangeReasonAlias
--- PASS: TestGetPositionTimelineUsesChangeReasonAlias (0.00s)
=== RUN   TestTemporalTimelineManager_ComplexScenarios
=== RUN   TestTemporalTimelineManager_ComplexScenarios/å¤æ‚æ—¶é—´è½´åœºæ™¯æµ‹è¯•
    temporal_timeline_test.go:82: æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ
    temporal_timeline_test.go:87: åˆ›å»º5ä¸ªç‰ˆæœ¬çš„å¤æ‚æ—¶é—´è½´...
{"timestamp":"2025-11-15T09:30:51.391260285Z","level":"INFO","message":"æ’å…¥ç‰ˆæœ¬: TEST001, ç”Ÿæ•ˆæ—¥æœŸ: 2024-01-01","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:27"}
{"timestamp":"2025-11-15T09:30:51.421264746Z","level":"INFO","message":"ç‰ˆæœ¬æ’å…¥æˆåŠŸ: RecordID=13f1dd16-8fca-4ccd-87ec-9cc3598908ab","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:86"}
    temporal_timeline_test.go:133: âœ… ç‰ˆæœ¬ 1 æ’å…¥æˆåŠŸ: æµ‹è¯•éƒ¨é—¨ v1.0 (RecordID: 13f1dd16-8fca-4ccd-87ec-9cc3598908ab)
{"timestamp":"2025-11-15T09:30:51.42223754Z","level":"INFO","message":"æ’å…¥ç‰ˆæœ¬: TEST001, ç”Ÿæ•ˆæ—¥æœŸ: 2024-03-01","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:27"}
{"timestamp":"2025-11-15T09:30:51.447899787Z","level":"INFO","message":"ç‰ˆæœ¬æ’å…¥æˆåŠŸ: RecordID=c72c8d21-b3d6-4bf1-941d-ab2c4b39b63b","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:86"}
    temporal_timeline_test.go:133: âœ… ç‰ˆæœ¬ 2 æ’å…¥æˆåŠŸ: æµ‹è¯•éƒ¨é—¨ v2.0 (RecordID: c72c8d21-b3d6-4bf1-941d-ab2c4b39b63b)
{"timestamp":"2025-11-15T09:30:51.448956743Z","level":"INFO","message":"æ’å…¥ç‰ˆæœ¬: TEST001, ç”Ÿæ•ˆæ—¥æœŸ: 2024-06-01","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:27"}
{"timestamp":"2025-11-15T09:30:51.479774389Z","level":"INFO","message":"ç‰ˆæœ¬æ’å…¥æˆåŠŸ: RecordID=8493477e-baf9-48cc-9105-14dac0fa76a5","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:86"}
    temporal_timeline_test.go:133: âœ… ç‰ˆæœ¬ 3 æ’å…¥æˆåŠŸ: æµ‹è¯•éƒ¨é—¨ v3.0 (RecordID: 8493477e-baf9-48cc-9105-14dac0fa76a5)
{"timestamp":"2025-11-15T09:30:51.480818544Z","level":"INFO","message":"æ’å…¥ç‰ˆæœ¬: TEST001, ç”Ÿæ•ˆæ—¥æœŸ: 2024-09-01","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:27"}
{"timestamp":"2025-11-15T09:30:51.520931263Z","level":"INFO","message":"ç‰ˆæœ¬æ’å…¥æˆåŠŸ: RecordID=ab672412-6667-48a5-b3db-da0a3f62c93a","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:86"}
    temporal_timeline_test.go:133: âœ… ç‰ˆæœ¬ 4 æ’å…¥æˆåŠŸ: æµ‹è¯•éƒ¨é—¨ v4.0 (RecordID: ab672412-6667-48a5-b3db-da0a3f62c93a)
{"timestamp":"2025-11-15T09:30:51.522069155Z","level":"INFO","message":"æ’å…¥ç‰ˆæœ¬: TEST001, ç”Ÿæ•ˆæ—¥æœŸ: 2024-12-01","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:27"}
{"timestamp":"2025-11-15T09:30:51.569126358Z","level":"INFO","message":"ç‰ˆæœ¬æ’å…¥æˆåŠŸ: RecordID=77d616f2-d628-481d-b04e-36e65cb48d80","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:86"}
    temporal_timeline_test.go:133: âœ… ç‰ˆæœ¬ 5 æ’å…¥æˆåŠŸ: æµ‹è¯•éƒ¨é—¨ v5.0 (RecordID: 77d616f2-d628-481d-b04e-36e65cb48d80)
    temporal_timeline_test.go:136: âœ… 5ä¸ªç‰ˆæœ¬çš„å¤æ‚æ—¶é—´è½´åˆ›å»ºå®Œæˆ
    temporal_timeline_test.go:141: ğŸ§ª æµ‹è¯•1: ä¸­é—´æ’å…¥è®°å½• (2024-04-15)
{"timestamp":"2025-11-15T09:30:51.570946539Z","level":"INFO","message":"æ’å…¥ç‰ˆæœ¬: TEST001, ç”Ÿæ•ˆæ—¥æœŸ: 2024-04-15","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:27"}
{"timestamp":"2025-11-15T09:30:51.619094427Z","level":"INFO","message":"ç‰ˆæœ¬æ’å…¥æˆåŠŸ: RecordID=4b21bddc-6f1f-4e24-9c6a-8e7f59e1f59c","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_insert.go:86"}
    temporal_timeline_test.go:172: âœ… ä¸­é—´ç‰ˆæœ¬æ’å…¥æˆåŠŸ: æµ‹è¯•éƒ¨é—¨ v2.5 (ä¸­é—´æ’å…¥) (RecordID: 4b21bddc-6f1f-4e24-9c6a-8e7f59e1f59c)
{"timestamp":"2025-11-15T09:30:51.620251375Z","level":"INFO","message":"å¼€å§‹å…¨é“¾é‡ç®—: tenant=ef4e9866-5f5d-497b-a661-55c1aa4b9123, code=TEST001","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_manager.go:51"}
{"timestamp":"2025-11-15T09:30:51.658790677Z","level":"INFO","message":"å…¨é“¾é‡ç®—å®Œæˆ: TEST001, ç‰ˆæœ¬æ•°=6","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_manager.go:62"}
    temporal_timeline_test.go:180: å½“å‰æ—¶é—´è½´åŒ…å« 6 ä¸ªç‰ˆæœ¬:
    temporal_timeline_test.go:182:   ç‰ˆæœ¬ 1: 2024-01-01 â†’ 2024-02-29 | æµ‹è¯•éƒ¨é—¨ v1.0
    temporal_timeline_test.go:182:   ç‰ˆæœ¬ 2: 2024-03-01 â†’ 2024-04-14 | æµ‹è¯•éƒ¨é—¨ v2.0
    temporal_timeline_test.go:182:   ç‰ˆæœ¬ 3: 2024-04-15 â†’ 2024-05-31 | æµ‹è¯•éƒ¨é—¨ v2.5 (ä¸­é—´æ’å…¥)
    temporal_timeline_test.go:182:   ç‰ˆæœ¬ 4: 2024-06-01 â†’ 2024-08-31 | æµ‹è¯•éƒ¨é—¨ v3.0
    temporal_timeline_test.go:182:   ç‰ˆæœ¬ 5: 2024-09-01 â†’ 2024-11-30 | æµ‹è¯•éƒ¨é—¨ v4.0
    temporal_timeline_test.go:182:   ç‰ˆæœ¬ 6: 2024-12-01 â†’ âˆ | æµ‹è¯•éƒ¨é—¨ v5.0
    temporal_timeline_test.go:196: ğŸ§ª æµ‹è¯•2: åˆ é™¤ä¸­é—´è®°å½• (2024-04-15ç‰ˆæœ¬)
{"timestamp":"2025-11-15T09:30:51.662675609Z","level":"INFO","message":"åˆ é™¤ç‰ˆæœ¬: RecordID=4b21bddc-6f1f-4e24-9c6a-8e7f59e1f59c","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_delete.go:18"}
{"timestamp":"2025-11-15T09:30:51.69903116Z","level":"INFO","message":"ç‰ˆæœ¬åˆ é™¤æˆåŠŸï¼Œå‰©ä½™ç‰ˆæœ¬: 5","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_delete.go:48"}
    temporal_timeline_test.go:217: âœ… ä¸­é—´ç‰ˆæœ¬åˆ é™¤æˆåŠŸï¼Œå½“å‰æ—¶é—´è½´åŒ…å« 5 ä¸ªç‰ˆæœ¬
    temporal_timeline_test.go:221:   ç‰ˆæœ¬ 1: 2024-01-01 â†’ 2024-02-29 | æµ‹è¯•éƒ¨é—¨ v1.0
    temporal_timeline_test.go:221:   ç‰ˆæœ¬ 2: 2024-03-01 â†’ 2024-05-31 | æµ‹è¯•éƒ¨é—¨ v2.0
    temporal_timeline_test.go:221:   ç‰ˆæœ¬ 3: 2024-06-01 â†’ 2024-08-31 | æµ‹è¯•éƒ¨é—¨ v3.0
    temporal_timeline_test.go:221:   ç‰ˆæœ¬ 4: 2024-09-01 â†’ 2024-11-30 | æµ‹è¯•éƒ¨é—¨ v4.0
    temporal_timeline_test.go:221:   ç‰ˆæœ¬ 5: 2024-12-01 â†’ âˆ | æµ‹è¯•éƒ¨é—¨ v5.0
    temporal_timeline_test.go:235: ğŸ§ª æµ‹è¯•3: åˆ é™¤ç¬¬ä¸€æ¡è®°å½•
{"timestamp":"2025-11-15T09:30:51.704386024Z","level":"INFO","message":"åˆ é™¤ç‰ˆæœ¬: RecordID=13f1dd16-8fca-4ccd-87ec-9cc3598908ab","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_delete.go:18"}
{"timestamp":"2025-11-15T09:30:51.747142187Z","level":"INFO","message":"ç‰ˆæœ¬åˆ é™¤æˆåŠŸï¼Œå‰©ä½™ç‰ˆæœ¬: 4","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_delete.go:48"}
    temporal_timeline_test.go:258: âœ… ç¬¬ä¸€ä¸ªç‰ˆæœ¬åˆ é™¤æˆåŠŸï¼Œå½“å‰æ—¶é—´è½´åŒ…å« 4 ä¸ªç‰ˆæœ¬
    temporal_timeline_test.go:263:   æ–°çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬: 2024-03-01 (æµ‹è¯•éƒ¨é—¨ v2.0)
    temporal_timeline_test.go:269: ğŸ§ª æµ‹è¯•4: åˆ é™¤æœ€åä¸€æ¡è®°å½•
{"timestamp":"2025-11-15T09:30:51.752695421Z","level":"INFO","message":"åˆ é™¤ç‰ˆæœ¬: RecordID=77d616f2-d628-481d-b04e-36e65cb48d80","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_delete.go:18"}
{"timestamp":"2025-11-15T09:30:51.790545962Z","level":"INFO","message":"ç‰ˆæœ¬åˆ é™¤æˆåŠŸï¼Œå‰©ä½™ç‰ˆæœ¬: 3","fields":{"component":"repository","module":"organization","repository":"TemporalTimelineManager","test":"temporalTimeline"},"caller":"temporal_timeline_delete.go:48"}
    temporal_timeline_test.go:292: âœ… æœ€åä¸€ä¸ªç‰ˆæœ¬åˆ é™¤æˆåŠŸï¼Œå½“å‰æ—¶é—´è½´åŒ…å« 3 ä¸ªç‰ˆæœ¬
    temporal_timeline_test.go:300:   æ–°çš„æœ€åç‰ˆæœ¬: 2024-09-01 â†’ âˆ (æµ‹è¯•éƒ¨é—¨ v4.0)
    temporal_timeline_test.go:307: ğŸ” éªŒè¯æ—¶é—´è½´è¿ç»­æ€§
    temporal_timeline_test.go:334: âœ… æ—¶é—´æ–­æ¡£æ£€æŸ¥é€šè¿‡
    temporal_timeline_test.go:352: âœ… å½“å‰ç‰ˆæœ¬å”¯ä¸€æ€§æ£€æŸ¥é€šè¿‡
    temporal_timeline_test.go:375: âœ… å°¾éƒ¨å¼€æ”¾æ£€æŸ¥é€šè¿‡
    temporal_timeline_test.go:394: âœ… å±‚çº§å­—æ®µä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡
    temporal_timeline_test.go:397: ğŸ¯ æ—¶é—´è½´è¿ç»­æ€§éªŒè¯å®Œæˆ
--- PASS: TestTemporalTimelineManager_ComplexScenarios (0.44s)
    --- PASS: TestTemporalTimelineManager_ComplexScenarios/å¤æ‚æ—¶é—´è½´åœºæ™¯æµ‹è¯• (0.42s)
=== RUN   TestEnsureJoinedPath
--- PASS: TestEnsureJoinedPath (0.00s)
PASS
ok  	cube-castle/internal/organization/repository	(cached)
=== RUN   TestResolver_Assignments_ForwardsParameters
--- PASS: TestResolver_Assignments_ForwardsParameters (0.00s)
=== RUN   TestResolver_AssignmentHistory_UsesFacade
--- PASS: TestResolver_AssignmentHistory_UsesFacade (0.00s)
=== RUN   TestResolver_AssignmentStats_RequiresIdentifiers
--- PASS: TestResolver_AssignmentStats_RequiresIdentifiers (0.00s)
=== RUN   TestResolver_AssignmentStats_ForwardsParameters
--- PASS: TestResolver_AssignmentStats_ForwardsParameters (0.00s)
=== RUN   TestResolver_Positions_ForwardsParameters
--- PASS: TestResolver_Positions_ForwardsParameters (0.00s)
=== RUN   TestResolver_Positions_PermissionDenied
--- PASS: TestResolver_Positions_PermissionDenied (0.00s)
=== RUN   TestResolver_PositionAssignments_ForwardsParameters
--- PASS: TestResolver_PositionAssignments_ForwardsParameters (0.00s)
=== RUN   TestResolver_PositionAssignmentAudit_ForwardsParameters
--- PASS: TestResolver_PositionAssignmentAudit_ForwardsParameters (0.00s)
=== RUN   TestResolver_VacantPositions_ForwardsParameters
--- PASS: TestResolver_VacantPositions_ForwardsParameters (0.00s)
=== RUN   TestResolver_VacantPositions_ForwardsAsOfDate
--- PASS: TestResolver_VacantPositions_ForwardsAsOfDate (0.00s)
=== RUN   TestResolver_PositionTransfers_ForwardsParameters
--- PASS: TestResolver_PositionTransfers_ForwardsParameters (0.00s)
=== RUN   TestResolver_PositionHeadcountStats_CustomIncludeSubordinates
--- PASS: TestResolver_PositionHeadcountStats_CustomIncludeSubordinates (0.00s)
=== RUN   TestResolver_PositionHeadcountStats_UsesTenantFromContext
--- PASS: TestResolver_PositionHeadcountStats_UsesTenantFromContext (0.00s)
=== RUN   TestResolver_Position_ForwardsAsOfDate
--- PASS: TestResolver_Position_ForwardsAsOfDate (0.00s)
=== RUN   TestResolver_PositionTimeline_ForwardsDateRange
--- PASS: TestResolver_PositionTimeline_ForwardsDateRange (0.00s)
=== RUN   TestResolver_PositionVersions_ForwardsParameters
--- PASS: TestResolver_PositionVersions_ForwardsParameters (0.00s)
=== RUN   TestResolver_PositionVersions_IncludeDeletedFlag
--- PASS: TestResolver_PositionVersions_IncludeDeletedFlag (0.00s)
PASS
ok  	cube-castle/internal/organization/resolver	(cached)
=== RUN   TestOperationalScheduler_RunTaskExecutesScript
--- PASS: TestOperationalScheduler_RunTaskExecutesScript (0.00s)
=== RUN   TestOperationalScheduler_RunTaskDisabledScheduler
--- PASS: TestOperationalScheduler_RunTaskDisabledScheduler (0.00s)
=== RUN   TestOperationalScheduler_RunTaskUnknown
--- PASS: TestOperationalScheduler_RunTaskUnknown (0.00s)
=== RUN   TestTemporalMonitorCollectMetricsHealthy
--- PASS: TestTemporalMonitorCollectMetricsHealthy (0.00s)
=== RUN   TestTemporalMonitorCheckAlertsCritical
--- PASS: TestTemporalMonitorCheckAlertsCritical (0.00s)
PASS
ok  	cube-castle/internal/organization/scheduler	(cached)
=== RUN   TestTranslateJobCatalogErrorUsesValidatorResult
--- PASS: TestTranslateJobCatalogErrorUsesValidatorResult (0.00s)
=== RUN   TestTranslateJobCatalogErrorFallbackWhenValidatorMissing
--- PASS: TestTranslateJobCatalogErrorFallbackWhenValidatorMissing (0.00s)
=== RUN   TestTranslateJobCatalogErrorHandlesInvalidEffectiveDate
--- PASS: TestTranslateJobCatalogErrorHandlesInvalidEffectiveDate (0.00s)
=== RUN   TestTranslateJobCatalogErrorHandlesParentGroupMissing
--- PASS: TestTranslateJobCatalogErrorHandlesParentGroupMissing (0.00s)
=== RUN   TestTranslateJobCatalogErrorHandlesParentMismatch
--- PASS: TestTranslateJobCatalogErrorHandlesParentMismatch (0.00s)
=== RUN   TestNewHeadcountExceededError
--- PASS: TestNewHeadcountExceededError (0.00s)
=== RUN   TestNewAssignmentStateError
--- PASS: TestNewAssignmentStateError (0.00s)
=== RUN   TestNewAssignmentFTEError
--- PASS: TestNewAssignmentFTEError (0.00s)
PASS
ok  	cube-castle/internal/organization/service	(cached)
=== RUN   TestNormalizeParentCodePointer
--- PASS: TestNormalizeParentCodePointer (0.00s)
=== RUN   TestIsRootParentCode
--- PASS: TestIsRootParentCode (0.00s)
=== RUN   TestResponseBuilder_SuccessAndError
--- PASS: TestResponseBuilder_SuccessAndError (0.00s)
=== RUN   TestWriteHelpers
--- PASS: TestWriteHelpers (0.00s)
=== RUN   TestValidationHelpers
--- PASS: TestValidationHelpers (0.00s)
=== RUN   TestWithExecutionTimeAndPagination
--- PASS: TestWithExecutionTimeAndPagination (0.00s)
=== RUN   TestValidateOrganizationCode
--- PASS: TestValidateOrganizationCode (0.00s)
=== RUN   TestValidateCreateVersionRequest_Valid
--- PASS: TestValidateCreateVersionRequest_Valid (0.00s)
=== RUN   TestValidateCreateVersionRequest_Errors
--- PASS: TestValidateCreateVersionRequest_Errors (0.00s)
PASS
ok  	cube-castle/internal/organization/utils	(cached)
=== RUN   TestValidatorCoreSmoke
--- PASS: TestValidatorCoreSmoke (0.00s)
=== RUN   TestSeverityToHTTPStatus
--- PASS: TestSeverityToHTTPStatus (0.00s)
=== RUN   TestValidationChainWithBaseContext
--- PASS: TestValidationChainWithBaseContext (0.00s)
=== RUN   TestValidationChainContextCancelled
--- PASS: TestValidationChainContextCancelled (0.00s)
=== RUN   TestValidationChainTelemetryOnly
--- PASS: TestValidationChainTelemetryOnly (0.00s)
=== RUN   TestValidationChainRegisterNilRule
--- PASS: TestValidationChainRegisterNilRule (0.00s)
=== RUN   TestNewValidationFailedErrorWithoutResult
--- PASS: TestNewValidationFailedErrorWithoutResult (0.00s)
=== RUN   TestValidationFailedErrorWithResultAndDetails
--- PASS: TestValidationFailedErrorWithResultAndDetails (0.00s)
=== RUN   TestValidationFailedErrorWithoutErrorDetails
--- PASS: TestValidationFailedErrorWithoutErrorDetails (0.00s)
=== RUN   TestJobCatalogTemporalAllowsInitialVersion
--- PASS: TestJobCatalogTemporalAllowsInitialVersion (0.00s)
=== RUN   TestJobCatalogTemporalRejectsOverlappingVersion
--- PASS: TestJobCatalogTemporalRejectsOverlappingVersion (0.00s)
=== RUN   TestJobCatalogSequenceRejectsMismatchedParent
--- PASS: TestJobCatalogSequenceRejectsMismatchedParent (0.00s)
=== RUN   TestJobCatalogSequenceAcceptsMatchingParent
--- PASS: TestJobCatalogSequenceAcceptsMatchingParent (0.00s)
=== RUN   TestJobCatalogRequiresValidEffectiveDate
--- PASS: TestJobCatalogRequiresValidEffectiveDate (0.00s)
=== RUN   TestJobCatalogTimelineFailure
--- PASS: TestJobCatalogTimelineFailure (0.00s)
=== RUN   TestJobCatalogSequenceMissingParent
--- PASS: TestJobCatalogSequenceMissingParent (0.00s)
=== RUN   TestJobCatalogSequenceMissingTimeline
--- PASS: TestJobCatalogSequenceMissingTimeline (0.00s)
=== RUN   TestJobCatalogParseEffectiveDateRequiresValue
--- PASS: TestJobCatalogParseEffectiveDateRequiresValue (0.00s)
=== RUN   TestOrganizationCreateDepthViolation
--- PASS: TestOrganizationCreateDepthViolation (0.00s)
=== RUN   TestOrganizationCreateDepthWarning
--- PASS: TestOrganizationCreateDepthWarning (0.00s)
=== RUN   TestOrganizationCreateTemporalInactiveParent
--- PASS: TestOrganizationCreateTemporalInactiveParent (0.00s)
=== RUN   TestOrganizationCreateDuplicateCode
--- PASS: TestOrganizationCreateDuplicateCode (0.00s)
=== RUN   TestOrganizationCreateParentMissing
--- PASS: TestOrganizationCreateParentMissing (0.00s)
=== RUN   TestOrganizationCreateSelfReferentialParent
--- PASS: TestOrganizationCreateSelfReferentialParent (0.00s)
=== RUN   TestOrganizationCreateDepthUnknownReturnsInvalidParent
--- PASS: TestOrganizationCreateDepthUnknownReturnsInvalidParent (0.00s)
=== RUN   TestOrganizationCreateBusinessLogicValidation
--- PASS: TestOrganizationCreateBusinessLogicValidation (0.00s)
=== RUN   TestOrganizationCreateTemporalConflict
--- PASS: TestOrganizationCreateTemporalConflict (0.00s)
=== RUN   TestOrganizationCreateFieldSanitization
--- PASS: TestOrganizationCreateFieldSanitization (0.00s)
=== RUN   TestOrganizationCreateNameAllowsLocalizedParentheses
--- PASS: TestOrganizationCreateNameAllowsLocalizedParentheses (0.00s)
=== RUN   TestOrganizationUpdateCircularReference
--- PASS: TestOrganizationUpdateCircularReference (0.00s)
=== RUN   TestOrganizationUpdateStatusAllowed
--- PASS: TestOrganizationUpdateStatusAllowed (0.00s)
=== RUN   TestOrganizationUpdateAllowsLocalizedParentheses
--- PASS: TestOrganizationUpdateAllowsLocalizedParentheses (0.00s)
=== RUN   TestValidateTemporalParentAvailability
--- PASS: TestValidateTemporalParentAvailability (0.00s)
=== RUN   TestValidateTemporalParentAvailabilitySuccess
--- PASS: TestValidateTemporalParentAvailabilitySuccess (0.00s)
=== RUN   TestOrganizationUpdateStatusGuard
--- PASS: TestOrganizationUpdateStatusGuard (0.00s)
=== RUN   TestOrganizationCreateNameRequired
--- PASS: TestOrganizationCreateNameRequired (0.00s)
=== RUN   TestOrganizationCreateInvalidCodeFormat
--- PASS: TestOrganizationCreateInvalidCodeFormat (0.00s)
=== RUN   TestOrganizationCreateInvalidParentFormat
--- PASS: TestOrganizationCreateInvalidParentFormat (0.00s)
=== RUN   TestOrganizationUpdateInvalidStatus
--- PASS: TestOrganizationUpdateInvalidStatus (0.00s)
=== RUN   TestOrganizationUpdateInvalidParentFormat
--- PASS: TestOrganizationUpdateInvalidParentFormat (0.00s)
=== RUN   TestOrganizationUpdateSortOrderOutOfRange
--- PASS: TestOrganizationUpdateSortOrderOutOfRange (0.00s)
=== RUN   TestOrganizationCreateDescriptionTooLong
--- PASS: TestOrganizationCreateDescriptionTooLong (0.00s)
=== RUN   TestOrganizationUpdateNameEmpty
--- PASS: TestOrganizationUpdateNameEmpty (0.00s)
=== RUN   TestOrganizationUpdateUnitTypeEmpty
--- PASS: TestOrganizationUpdateUnitTypeEmpty (0.00s)
=== RUN   TestOrganizationUpdateDescriptionTooLong
--- PASS: TestOrganizationUpdateDescriptionTooLong (0.00s)
=== RUN   TestOrganizationUpdateStatusEmpty
--- PASS: TestOrganizationUpdateStatusEmpty (0.00s)
=== RUN   TestOrganizationUpdateNegativeSortOrder
--- PASS: TestOrganizationUpdateNegativeSortOrder (0.00s)
=== RUN   TestOrganizationUpdateTargetNotFound
--- PASS: TestOrganizationUpdateTargetNotFound (0.00s)
=== RUN   TestNewBusinessRuleValidator
--- PASS: TestNewBusinessRuleValidator (0.00s)
=== RUN   TestValidateCreatePosition_PosOrgInactive
--- PASS: TestValidateCreatePosition_PosOrgInactive (0.00s)
=== RUN   TestValidateFillPosition_PosHeadcountExceeded
--- PASS: TestValidateFillPosition_PosHeadcountExceeded (0.00s)
=== RUN   TestValidateCreateAssignment_AssignFTEInvalid
--- PASS: TestValidateCreateAssignment_AssignFTEInvalid (0.00s)
=== RUN   TestValidateCreateAssignment_CrossActiveOrganizationInactive
--- PASS: TestValidateCreateAssignment_CrossActiveOrganizationInactive (0.00s)
=== RUN   TestValidateCloseAssignment_AssignStateGuard
--- PASS: TestValidateCloseAssignment_AssignStateGuard (0.00s)
=== RUN   TestValidateCreatePosition_PosJobCatalogInactive
--- PASS: TestValidateCreatePosition_PosJobCatalogInactive (0.00s)
=== RUN   TestValidateUpdateAssignment_PosHeadcountExceeded
--- PASS: TestValidateUpdateAssignment_PosHeadcountExceeded (0.00s)
=== RUN   TestValidateTransferPosition_TargetOrgMissing
--- PASS: TestValidateTransferPosition_TargetOrgMissing (0.00s)
=== RUN   TestStubValidationServicePassThrough
--- PASS: TestStubValidationServicePassThrough (0.00s)
=== RUN   TestValidationFailedErrorWrapper
--- PASS: TestValidationFailedErrorWrapper (0.00s)
=== RUN   TestValidateVacateAndApplyEventNoOp
--- PASS: TestValidateVacateAndApplyEventNoOp (0.00s)
=== RUN   TestValidateCreateVersion_PosOrgRule
--- PASS: TestValidateCreateVersion_PosOrgRule (0.00s)
=== RUN   TestMergeJobCatalogContext
--- PASS: TestMergeJobCatalogContext (0.00s)
=== RUN   TestResolveOrgContext
--- PASS: TestResolveOrgContext (0.00s)
=== RUN   TestExtractHelpers
--- PASS: TestExtractHelpers (0.00s)
=== RUN   TestResolveRequestedFTEAndInactiveStatusHelpers
--- PASS: TestResolveRequestedFTEAndInactiveStatusHelpers (0.00s)
=== RUN   TestStubHierarchyRepositoryDefaults
--- PASS: TestStubHierarchyRepositoryDefaults (0.00s)
=== RUN   TestStubHierarchyRepositoryDelegates
--- PASS: TestStubHierarchyRepositoryDelegates (0.00s)
=== RUN   TestStubJobCatalogRepository
--- PASS: TestStubJobCatalogRepository (0.00s)
=== RUN   TestStubJobCatalogRepositoryDefaults
--- PASS: TestStubJobCatalogRepositoryDefaults (0.00s)
=== RUN   TestStubJobCatalogTimelineRepositoryDefaults
--- PASS: TestStubJobCatalogTimelineRepositoryDefaults (0.00s)
=== RUN   TestStubOrganizationRepository
--- PASS: TestStubOrganizationRepository (0.00s)
=== RUN   TestStubAssignmentRepository
--- PASS: TestStubAssignmentRepository (0.00s)
=== RUN   TestStubPositionRepository
--- PASS: TestStubPositionRepository (0.00s)
PASS
ok  	cube-castle/internal/organization/validator	(cached)
?   	cube-castle/internal/types	[no test files]
=== RUN   TestNewDatabaseAppliesDefaults
--- PASS: TestNewDatabaseAppliesDefaults (0.00s)
=== RUN   TestNewDatabaseWithCustomConfig
--- PASS: TestNewDatabaseWithCustomConfig (0.00s)
=== RUN   TestNewDatabaseWithEmptyDSN
--- PASS: TestNewDatabaseWithEmptyDSN (0.00s)
=== RUN   TestNewDatabaseShortcut
--- PASS: TestNewDatabaseShortcut (0.00s)
=== RUN   TestExecAndQueryWrappers
--- PASS: TestExecAndQueryWrappers (0.00s)
=== RUN   TestRecordConnectionStats
--- PASS: TestRecordConnectionStats (0.00s)
=== RUN   TestRecordQueryDuration
--- PASS: TestRecordQueryDuration (0.00s)
=== RUN   TestConnectionConfigNormalize
--- PASS: TestConnectionConfigNormalize (0.00s)
=== RUN   TestDatabaseNilReceivers
--- PASS: TestDatabaseNilReceivers (0.00s)
=== RUN   TestOutboxMigrationUpDown
--- PASS: TestOutboxMigrationUpDown (0.00s)
=== RUN   TestOutboxRepositorySave
--- PASS: TestOutboxRepositorySave (0.00s)
=== RUN   TestOutboxRepositorySaveValidation
--- PASS: TestOutboxRepositorySaveValidation (0.00s)
=== RUN   TestNewOutboxEventDefaults
--- PASS: TestNewOutboxEventDefaults (0.00s)
=== RUN   TestOutboxRepositoryGetUnpublished
--- PASS: TestOutboxRepositoryGetUnpublished (0.00s)
=== RUN   TestOutboxRepositoryMarkPublished
--- PASS: TestOutboxRepositoryMarkPublished (0.00s)
=== RUN   TestOutboxRepositoryIncrementRetry
--- PASS: TestOutboxRepositoryIncrementRetry (0.00s)
=== RUN   TestOutboxRepositoryErrors
--- PASS: TestOutboxRepositoryErrors (0.00s)
=== RUN   TestWithTxCommit
--- PASS: TestWithTxCommit (0.00s)
=== RUN   TestWithTxRollbackOnError
--- PASS: TestWithTxRollbackOnError (0.00s)
=== RUN   TestWithTxRollbackFailureReported
--- PASS: TestWithTxRollbackFailureReported (0.00s)
=== RUN   TestWithTxNilDatabase
--- PASS: TestWithTxNilDatabase (0.00s)
PASS
ok  	cube-castle/pkg/database	(cached)
=== RUN   TestPublishWithSingleSubscriber
--- PASS: TestPublishWithSingleSubscriber (0.00s)
=== RUN   TestPublishWithMultipleSubscribers
--- PASS: TestPublishWithMultipleSubscribers (0.00s)
=== RUN   TestPublishWithHandlerError
--- PASS: TestPublishWithHandlerError (0.00s)
=== RUN   TestConcurrentPublishAndSubscribe
--- PASS: TestConcurrentPublishAndSubscribe (0.00s)
=== RUN   TestPublishWithNoSubscribers
--- PASS: TestPublishWithNoSubscribers (0.00s)
=== RUN   TestErrorHandling
--- PASS: TestErrorHandling (0.00s)
=== RUN   TestReset
--- PASS: TestReset (0.00s)
=== RUN   TestLatencyMetricRecorded
--- PASS: TestLatencyMetricRecorded (0.01s)
=== RUN   TestGenericJSONEvent
--- PASS: TestGenericJSONEvent (0.00s)
PASS
ok  	cube-castle/pkg/eventbus	(cached)
=== RUN   TestLoggerWithFields
--- PASS: TestLoggerWithFields (0.00s)
=== RUN   TestLoggerLevelFiltering
--- PASS: TestLoggerLevelFiltering (0.00s)
=== RUN   TestStdLoggerBridge
--- PASS: TestStdLoggerBridge (0.00s)
=== RUN   TestParseLevel
--- PASS: TestParseLevel (0.00s)
PASS
ok  	cube-castle/pkg/logger	(cached)
?   	cube-castle/scripts/cmd/generate-dev-jwt	[no test files]
?   	cube-castle/shared/config	[no test files]
=== RUN   TestAuthFlow_RealHTTP_RS256_JWKS_and_TenantChecks
    auth_flow_e2e_test.go:73: set E2E_RUN=1 to enable end-to-end HTTP test
--- SKIP: TestAuthFlow_RealHTTP_RS256_JWKS_and_TenantChecks (0.00s)
PASS
ok  	cube-castle/tests/e2e	(cached)
=== RUN   TestMigrationRoundtrip
=== PAUSE TestMigrationRoundtrip
=== CONT  TestMigrationRoundtrip
2025/11/15 17:30:53 OK   20251106000000_base_schema.sql (496.74ms)
2025/11/15 17:30:53 OK   20251107090000_create_outbox_events.sql (41.56ms)
2025/11/15 17:30:53 OK   20251107123000_230_job_catalog_oper_fix.sql (11.55ms)
2025/11/15 17:30:53 OK   20251110110000_234_remove_org_unit_triggers.sql (25.56ms)
2025/11/15 17:30:53 goose: successfully migrated database to version: 20251110110000
2025/11/15 17:30:53 EMPTY 20251110110000_234_remove_org_unit_triggers.sql (7.29ms)
2025/11/15 17:30:53 OK   20251110110000_234_remove_org_unit_triggers.sql (26.04ms)
2025/11/15 17:30:53 goose: successfully migrated database to version: 20251110110000
--- PASS: TestMigrationRoundtrip (0.83s)
PASS
ok  	cube-castle/tests/integration	(cached)
[0;32m[INFO][0m æ‰§è¡Œ Goose å›æ»š (down)...
2025/11/15 18:24:18 EMPTY 20251110110000_234_remove_org_unit_triggers.sql (14.06ms)
[0;32m[INFO][0m é›†æˆæµ‹è¯•å®Œæˆ
[0;32m[INFO][0m æ¸…ç† Docker æµ‹è¯•ç¯å¢ƒ...
