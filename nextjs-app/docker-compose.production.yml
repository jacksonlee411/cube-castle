# Production Docker Compose for Cube Castle Frontend
version: '3.8'

services:
  cube-castle-frontend:
    build:
      context: .
      dockerfile: Dockerfile
    image: cube-castle-frontend:latest
    container_name: cube-castle-frontend-prod
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_TELEMETRY_DISABLED=1
      - CUBE_CASTLE_API_URL=${CUBE_CASTLE_API_URL:-http://localhost:8080}
      - CUBE_CASTLE_WS_URL=${CUBE_CASTLE_WS_URL:-ws://localhost:8080}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    networks:
      - cube-castle-network
    depends_on:
      - cube-castle-backend
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.frontend.rule=Host(`cube-castle.local`)"
      - "traefik.http.routers.frontend.entrypoints=web"
      - "traefik.http.services.frontend.loadbalancer.server.port=3000"

  # Backend service (assuming it exists)
  cube-castle-backend:
    image: cube-castle-backend:latest
    container_name: cube-castle-backend-prod
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    networks:
      - cube-castle-network

networks:
  cube-castle-network:
    driver: bridge

volumes:
  frontend_data:
    driver: local