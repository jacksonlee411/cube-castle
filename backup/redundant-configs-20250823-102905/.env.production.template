# Cube Castle 时态管理服务 - 生产环境配置
# 生成时间: 2025-08-12

# ===== 服务端口配置 =====
TEMPORAL_REST_PORT=9093
TEMPORAL_QUERY_PORT=8091  
TEMPORAL_SYNC_PORT=8092

# ===== 生产数据库配置 =====
# PostgreSQL (命令端)
DB_HOST=postgres
DB_PORT=5432
DB_USER=${PROD_DB_USER}
DB_PASSWORD=${PROD_DB_PASSWORD}
DB_NAME=${PROD_DB_NAME}
DB_SSL_MODE=require

# Neo4j (查询端)
NEO4J_URI=bolt://neo4j:7687
NEO4J_USERNAME=${PROD_NEO4J_USERNAME}
NEO4J_PASSWORD=${PROD_NEO4J_PASSWORD}
NEO4J_DATABASE=neo4j

# ===== 生产消息队列配置 =====
# Kafka + Debezium CDC
KAFKA_BOOTSTRAP_SERVERS=kafka:9092
KAFKA_TOPIC=organization_db.public.organization_units
KAFKA_GROUP_ID=temporal-sync-service-prod
KAFKA_AUTO_OFFSET_RESET=earliest
KAFKA_ENABLE_AUTO_COMMIT=false
KAFKA_SESSION_TIMEOUT_MS=30000
KAFKA_HEARTBEAT_INTERVAL_MS=10000

# ===== 生产缓存配置 =====
# Redis
REDIS_ADDR=redis:6379
REDIS_PASSWORD=${PROD_REDIS_PASSWORD}
REDIS_DB=0
REDIS_MAX_RETRIES=5
REDIS_DIAL_TIMEOUT=10s
REDIS_READ_TIMEOUT=5s
REDIS_WRITE_TIMEOUT=5s
REDIS_POOL_SIZE=20
REDIS_MIN_IDLE_CONNS=5

# ===== 租户配置 =====
DEFAULT_TENANT_ID=${PROD_TENANT_ID}
TENANT_NAME=${PROD_TENANT_NAME}

# ===== 生产日志配置 =====
LOG_LEVEL=WARN
LOG_FORMAT=json
LOG_FILE_PATH=/var/log/cube-castle
LOG_ROTATION=daily
LOG_MAX_SIZE=100MB
LOG_MAX_BACKUPS=7
LOG_COMPRESS=true

# ===== 生产性能配置 =====
# 连接池
DB_MAX_OPEN_CONNS=50
DB_MAX_IDLE_CONNS=10
DB_CONN_MAX_LIFETIME=30m

# Neo4j连接池  
NEO4J_MAX_CONNECTION_POOL_SIZE=200
NEO4J_CONNECTION_ACQUISITION_TIMEOUT=120s
NEO4J_MAX_TRANSACTION_RETRY_TIME=15s

# HTTP服务器
HTTP_READ_TIMEOUT=30s
HTTP_WRITE_TIMEOUT=30s
HTTP_IDLE_TIMEOUT=120s
HTTP_MAX_HEADER_BYTES=1MB

# ===== 生产健康检查配置 =====
HEALTH_CHECK_INTERVAL=15s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_RETRIES=5
HEALTH_CHECK_FAIL_THRESHOLD=3


# ===== 生产安全配置 =====
# API认证 (必须配置)
API_KEY=${PROD_API_KEY}
JWT_SECRET=${PROD_JWT_SECRET}
JWT_EXPIRY=1h
CORS_ALLOWED_ORIGINS=${PROD_CORS_ORIGINS}

# TLS配置 (强制启用)
TLS_ENABLED=true
TLS_CERT_FILE=/etc/ssl/certs/cube-castle.crt
TLS_KEY_FILE=/etc/ssl/private/cube-castle.key
TLS_MIN_VERSION=1.2

# 安全头
SECURITY_HEADERS_ENABLED=true
RATE_LIMITING_ENABLED=true
RATE_LIMIT_RPS=100
RATE_LIMIT_BURST=200

# ===== 生产业务配置 =====
# 时态管理
TEMPORAL_RETENTION_DAYS=2555  # 7年保留期
TEMPORAL_DEFAULT_EFFECTIVE_DATE=today
TEMPORAL_AUTO_VERSION=true
TEMPORAL_BATCH_PROCESSING=true
TEMPORAL_ASYNC_PROCESSING=true

# CDC同步
CDC_BATCH_SIZE=500
CDC_FLUSH_INTERVAL=5s
CDC_MAX_RETRIES=5
CDC_RETRY_BACKOFF=2s
CDC_DEAD_LETTER_QUEUE=true

# 缓存策略
CACHE_TTL=1800s
CACHE_INVALIDATION_STRATEGY=precise
CACHE_WARMING_ENABLED=true
CACHE_COMPRESSION=true
CACHE_DISTRIBUTED=true

# ===== 生产环境特定配置 =====
# 调试和性能分析
DEBUG_ENABLED=false
PROFILE_ENABLED=false
PPROF_ENABLED=false

# 优雅关闭
GRACEFUL_SHUTDOWN_TIMEOUT=30s
SIGNAL_HANDLING=true

# 备份和恢复
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"  # 每日凌晨2点
BACKUP_RETENTION_DAYS=30

# ===== Docker生产配置 =====
# 容器运行时配置
CONTAINER_TIMEZONE=Asia/Shanghai
CONTAINER_USER=appuser
CONTAINER_UID=1000
CONTAINER_GID=1000

# Docker网络
DOCKER_NETWORK=cube_castle_production
DOCKER_BRIDGE_IP=172.20.0.0/16

# 资源限制
MEMORY_LIMIT=2g
CPU_LIMIT=2
MEMORY_RESERVATION=1g
CPU_RESERVATION=1

# 重启策略
RESTART_POLICY=unless-stopped
MAX_RESTARTS=5
RESTART_DELAY=10s