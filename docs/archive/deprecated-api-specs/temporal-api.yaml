openapi: 3.0.3
info:
  title: Cube Castle æ—¶æ€ç»„ç»‡ç®¡ç†API
  version: 1.0.0
  description: |
    ## æ—¶æ€ç»„ç»‡ç®¡ç†API
    
    è¿™æ˜¯Cube Castleç³»ç»Ÿçš„æ—¶æ€ç»„ç»‡ç®¡ç†APIï¼Œæ”¯æŒåŸºäºæ—¶é—´çš„ç»„ç»‡æ¶æ„æŸ¥è¯¢å’Œäº‹ä»¶é©±åŠ¨çš„å˜æ›´ç®¡ç†ã€‚
    
    ### æ ¸å¿ƒç‰¹æ€§
    - ğŸ•’ **æ—¶æ€æŸ¥è¯¢**: æ”¯æŒas_of_dateã€æ—¶é—´èŒƒå›´ã€ç‰ˆæœ¬æŸ¥è¯¢
    - ğŸš€ **é«˜æ€§èƒ½ç¼“å­˜**: Redisç¼“å­˜æ”¯æŒï¼Œ94%æ€§èƒ½æå‡
    - âš¡ **äº‹ä»¶é©±åŠ¨**: æ”¯æŒCREATEã€UPDATEã€RESTRUCTUREã€DISSOLVEäº‹ä»¶
    - ğŸ“Š **ç‰ˆæœ¬ç®¡ç†**: å®Œæ•´çš„ç»„ç»‡æ¶æ„å†å²ç‰ˆæœ¬ç®¡ç†
    - ğŸ”„ **CQRSæ¶æ„**: å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»æ¶æ„
    
    ### ç¼“å­˜æ€§èƒ½
    - **ç¼“å­˜å‘½ä¸­**: ~0.97ms å“åº”æ—¶é—´
    - **ç¼“å­˜å¤±æ•ˆ**: ~16.7ms å“åº”æ—¶é—´  
    - **æ€§èƒ½æå‡**: 94% å“åº”æ—¶é—´æ”¹å–„
    - **ç¼“å­˜TTL**: 5åˆ†é’Ÿ (å¯é…ç½®)
    
  contact:
    name: Cube Castle API Support
    email: support@cubecastle.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:9091
    description: æœ¬åœ°å¼€å‘ç¯å¢ƒ
  - url: https://api.cubecastle.com
    description: ç”Ÿäº§ç¯å¢ƒ

security:
  - ApiKeyAuth: []
  - TenantAuth: []

paths:
  /health:
    get:
      tags:
        - Health Check
      summary: æœåŠ¡å¥åº·æ£€æŸ¥
      description: æ£€æŸ¥æ—¶æ€APIæœåŠ¡çš„å¥åº·çŠ¶æ€
      responses:
        '200':
          description: æœåŠ¡å¥åº·
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "healthy"
                service: "integrated-temporal-service"
                timestamp: "2025-08-10T15:06:04+08:00"
                features: ["temporal-queries", "event-driven-changes", "timeline-management"]

  /metrics:
    get:
      tags:
        - Monitoring
      summary: Prometheusç›‘æ§æŒ‡æ ‡
      description: è·å–æœåŠ¡çš„Prometheusæ ¼å¼ç›‘æ§æŒ‡æ ‡
      responses:
        '200':
          description: PrometheusæŒ‡æ ‡æ•°æ®
          content:
            text/plain:
              schema:
                type: string
              example: |
                # HELP http_requests_total Total HTTP requests
                # TYPE http_requests_total counter
                http_requests_total{method="GET",service="temporal-api",status="200"} 1324

  /api/v1/organization-units/{code}/temporal:
    get:
      tags:
        - Temporal Queries
      summary: æ—¶æ€ç»„ç»‡æŸ¥è¯¢
      description: |
        ## æ—¶æ€æŸ¥è¯¢åŠŸèƒ½
        
        æ ¹æ®ç»„ç»‡ä»£ç å’Œæ—¶æ€å‚æ•°æŸ¥è¯¢ç»„ç»‡çš„å†å²ç‰ˆæœ¬ä¿¡æ¯ã€‚æ”¯æŒå¤šç§æŸ¥è¯¢æ¨¡å¼ï¼š
        
        ### æŸ¥è¯¢æ¨¡å¼
        - **æ—¶é—´ç‚¹æŸ¥è¯¢**: ä½¿ç”¨`as_of_date`æŸ¥è¯¢ç‰¹å®šæ—¶é—´ç‚¹çš„ç‰ˆæœ¬
        - **æ—¶é—´èŒƒå›´æŸ¥è¯¢**: ä½¿ç”¨`effective_from`å’Œ`effective_to`æŸ¥è¯¢æ—¶é—´èŒƒå›´å†…çš„ç‰ˆæœ¬
        - **ç‰ˆæœ¬æŸ¥è¯¢**: ä½¿ç”¨`version`æŸ¥è¯¢ç‰¹å®šç‰ˆæœ¬
        - **å†å²æŸ¥è¯¢**: ä½¿ç”¨`include_history=true`åŒ…å«å†å²ç‰ˆæœ¬
        
        ### ç¼“å­˜æœºåˆ¶
        - **æ™ºèƒ½ç¼“å­˜é”®**: åŸºäºæŸ¥è¯¢å‚æ•°ç”ŸæˆMD5å“ˆå¸Œç¼“å­˜é”®
        - **TTLç­–ç•¥**: é»˜è®¤5åˆ†é’Ÿç¼“å­˜æ—¶é—´
        - **ç¼“å­˜å‘½ä¸­**: å¹³å‡0.97mså“åº”æ—¶é—´
        - **ç¼“å­˜å¤±æ•ˆ**: å¹³å‡16.7mså“åº”æ—¶é—´
        
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[0-9]{7}$'
          description: 7ä½æ•°å­—ç»„ç»‡ä»£ç 
          example: "1000001"
        
        - name: as_of_date
          in: query
          schema:
            type: string
            format: date
          description: æ—¶é—´ç‚¹æŸ¥è¯¢ - æŸ¥è¯¢æŒ‡å®šæ—¥æœŸæœ‰æ•ˆçš„ç»„ç»‡ç‰ˆæœ¬
          example: "2025-08-09"
        
        - name: effective_from
          in: query
          schema:
            type: string
            format: date
          description: ç”Ÿæ•ˆèµ·å§‹æ—¶é—´ - æŸ¥è¯¢ä»æ­¤æ—¥æœŸå¼€å§‹ç”Ÿæ•ˆçš„ç‰ˆæœ¬
          example: "2025-08-01"
        
        - name: effective_to
          in: query
          schema:
            type: string
            format: date
          description: ç”Ÿæ•ˆç»“æŸæ—¶é—´ - æŸ¥è¯¢åˆ°æ­¤æ—¥æœŸç»“æŸçš„ç‰ˆæœ¬
          example: "2025-08-31"
        
        - name: include_history
          in: query
          schema:
            type: boolean
            default: false
          description: æ˜¯å¦åŒ…å«å†å²ç‰ˆæœ¬
        
        - name: include_future
          in: query
          schema:
            type: boolean
            default: false
          description: æ˜¯å¦åŒ…å«æœªæ¥ç‰ˆæœ¬
        
        - name: include_dissolved
          in: query
          schema:
            type: boolean
            default: false
          description: æ˜¯å¦åŒ…å«å·²è§£æ•£ç»„ç»‡
        
        - name: version
          in: query
          schema:
            type: integer
            minimum: 1
          description: æŸ¥è¯¢ç‰¹å®šç‰ˆæœ¬å·
          example: 2
        
        - name: max_versions
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: æœ€å¤§è¿”å›ç‰ˆæœ¬æ•°é‡
          example: 5
        
        - name: X-Tenant-ID
          in: header
          schema:
            type: string
            format: uuid
          description: ç§Ÿæˆ·ID (å¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨ç³»ç»Ÿç§Ÿæˆ·)
          example: "3b99930c-4dc6-4cc9-8e4d-7d960a931cb9"
      
      responses:
        '200':
          description: æ—¶æ€æŸ¥è¯¢æˆåŠŸ
          headers:
            X-Cache-Status:
              description: ç¼“å­˜çŠ¶æ€ (HIT/MISS)
              schema:
                type: string
                enum: [HIT, MISS]
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemporalQueryResponse'
              examples:
                current_version:
                  summary: å½“å‰ç‰ˆæœ¬æŸ¥è¯¢
                  description: æŸ¥è¯¢ç»„ç»‡å½“å‰ç‰ˆæœ¬
                  value:
                    organizations:
                      - tenant_id: "3b99930c-4dc6-4cc9-8e4d-7d960a931cb9"
                        code: "1000001"
                        parent_code: "1000000"
                        name: "AIæ²»ç†åŠå…¬å®¤"
                        unit_type: "DEPARTMENT"
                        status: "ACTIVE"
                        level: 2
                        path: "/1000000/1000001"
                        sort_order: 0
                        description: "æŠ€æœ¯ç ”å‘éƒ¨é—¨"
                        created_at: "2025-08-05T11:23:01.426455Z"
                        updated_at: "2025-08-09T12:07:15.838099Z"
                        effective_date: "2025-08-10T00:00:00Z"
                        version: 1
                        is_current: true
                    query_options:
                      include_history: false
                      include_future: false
                      include_dissolved: false
                    result_count: 1
                    queried_at: "2025-08-10T15:06:16+08:00"
                
                historical_query:
                  summary: å†å²ç‰ˆæœ¬æŸ¥è¯¢
                  description: æŸ¥è¯¢ç‰¹å®šæ—¶é—´ç‚¹çš„å†å²ç‰ˆæœ¬
                  value:
                    organizations:
                      - tenant_id: "3b99930c-4dc6-4cc9-8e4d-7d960a931cb9"
                        code: "1000001"
                        name: "æŠ€æœ¯éƒ¨"
                        unit_type: "DEPARTMENT"
                        status: "ACTIVE"
                        version: 1
                        effective_date: "2025-08-01T00:00:00Z"
                        end_date: "2025-08-08T23:59:59Z"
                        is_current: false
                      - tenant_id: "3b99930c-4dc6-4cc9-8e4d-7d960a931cb9"
                        code: "1000001"
                        name: "AIæ²»ç†åŠå…¬å®¤"
                        unit_type: "DEPARTMENT"
                        status: "ACTIVE"
                        version: 2
                        effective_date: "2025-08-09T00:00:00Z"
                        is_current: true
                    query_options:
                      as_of_date: "2025-08-09"
                      include_history: true
                    result_count: 2
                    queried_at: "2025-08-10T15:06:16+08:00"
        
        '400':
          description: è¯·æ±‚å‚æ•°æ— æ•ˆ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_date_format:
                  summary: æ— æ•ˆæ—¥æœŸæ ¼å¼
                  value:
                    error_code: "INVALID_TEMPORAL_PARAMS"
                    message: "æ—¶æ€æŸ¥è¯¢å‚æ•°æ— æ•ˆ"
                    details: "æ— æ•ˆçš„as_of_dateæ ¼å¼ï¼ŒæœŸæœ›ï¼šYYYY-MM-DD"
                
                missing_code:
                  summary: ç¼ºå°‘ç»„ç»‡ä»£ç 
                  value:
                    error_code: "MISSING_CODE"
                    message: "ç¼ºå°‘ç»„ç»‡ä»£ç "
        
        '404':
          description: ç»„ç»‡ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error_code: "NOT_FOUND"
                message: "æœªæ‰¾åˆ°åŒ¹é…çš„ç»„ç»‡ç‰ˆæœ¬"
        
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error_code: "TEMPORAL_QUERY_ERROR"
                message: "æ—¶æ€æŸ¥è¯¢å¤±è´¥"
                details: "æ•°æ®åº“è¿æ¥å¤±è´¥"

  /api/v1/organization-units/{code}/events:
    post:
      tags:
        - Event Management
      summary: åˆ›å»ºç»„ç»‡äº‹ä»¶
      description: |
        ## äº‹ä»¶é©±åŠ¨å˜æ›´ç®¡ç†
        
        åˆ›å»ºç»„ç»‡å˜æ›´äº‹ä»¶ï¼Œæ”¯æŒå¤šç§äº‹ä»¶ç±»å‹çš„å¤„ç†ã€‚æ‰€æœ‰å˜æ›´é€šè¿‡äº‹ä»¶é©±åŠ¨æ¨¡å¼å¤„ç†ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œå®¡è®¡è·Ÿè¸ªã€‚
        
        ### æ”¯æŒçš„äº‹ä»¶ç±»å‹
        - **CREATE**: åˆ›å»ºæ–°ç»„ç»‡ 
        - **UPDATE**: æ›´æ–°ç»„ç»‡ä¿¡æ¯
        - **RESTRUCTURE**: ç»„ç»‡æ¶æ„é‡ç»„
        - **DISSOLVE**: è§£æ•£ç»„ç»‡
        - **ACTIVATE**: æ¿€æ´»ç»„ç»‡
        - **DEACTIVATE**: åœç”¨ç»„ç»‡
        
        ### äº‹ä»¶å¤„ç†æµç¨‹
        1. éªŒè¯äº‹ä»¶ç±»å‹å’Œå‚æ•°
        2. è®°å½•äº‹ä»¶åˆ°äº‹ä»¶å­˜å‚¨
        3. æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘
        4. åˆ›å»ºæ–°ç‰ˆæœ¬æˆ–æ›´æ–°çŠ¶æ€
        5. è§¦å‘ç¼“å­˜å¤±æ•ˆ
        
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[0-9]{7}$'
          description: 7ä½æ•°å­—ç»„ç»‡ä»£ç 
          example: "1000001"
      
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrganizationChangeEvent'
            examples:
              update_event:
                summary: æ›´æ–°ç»„ç»‡ä¿¡æ¯
                description: æ›´æ–°ç»„ç»‡åç§°å’Œæè¿°
                value:
                  event_type: "UPDATE"
                  effective_date: "2025-08-10T00:00:00Z"
                  change_reason: "ç»„ç»‡åç§°æ ‡å‡†åŒ–"
                  change_data:
                    name: "AIæ²»ç†ä¸åˆ›æ–°ä¸­å¿ƒ"
                    description: "è´Ÿè´£AIæŠ€æœ¯æ²»ç†å’Œåˆ›æ–°æ¨è¿›"
              
              restructure_event:
                summary: ç»„ç»‡æ¶æ„é‡ç»„
                description: è°ƒæ•´ç»„ç»‡å±‚çº§å’Œéš¶å±å…³ç³»
                value:
                  event_type: "RESTRUCTURE"
                  effective_date: "2025-08-15T00:00:00Z"
                  change_reason: "é›†å›¢æ¶æ„è°ƒæ•´"
                  change_data:
                    parent_code: "1000010"
                    level: 3
                    path: "/1000000/1000010/1000001"
              
              dissolve_event:
                summary: è§£æ•£ç»„ç»‡
                description: è§£æ•£ç»„ç»‡å¹¶è®¾ç½®ç»“æŸæ—¥æœŸ
                value:
                  event_type: "DISSOLVE"
                  effective_date: "2025-08-20T00:00:00Z"
                  end_date: "2025-08-31T23:59:59Z"
                  change_reason: "ä¸šåŠ¡é‡ç»„ï¼Œéƒ¨é—¨åˆå¹¶"
      
      responses:
        '201':
          description: äº‹ä»¶åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventResponse'
              example:
                event_id: "evt_1234567890abcdef"
                event_type: "UPDATE"
                organization: "1000001"
                effective_date: "2025-08-10T00:00:00Z"
                status: "processed"
                processed_at: "2025-08-10T15:06:30+08:00"
        
        '400':
          description: äº‹ä»¶è¯·æ±‚æ— æ•ˆ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_event_type:
                  summary: æ— æ•ˆäº‹ä»¶ç±»å‹
                  value:
                    error_code: "INVALID_EVENT_TYPE"
                    message: "æ— æ•ˆçš„äº‹ä»¶ç±»å‹"
                
                invalid_request_format:
                  summary: è¯·æ±‚æ ¼å¼é”™è¯¯
                  value:
                    error_code: "INVALID_REQUEST"
                    message: "è¯·æ±‚æ ¼å¼æ— æ•ˆ"
                    details: "JSONè§£æå¤±è´¥"
        
        '500':
          description: äº‹ä»¶å¤„ç†å¤±è´¥
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                event_process_error:
                  summary: äº‹ä»¶å¤„ç†é”™è¯¯
                  value:
                    error_code: "EVENT_PROCESS_ERROR"
                    message: "å¤„ç†äº‹ä»¶å¤±è´¥"
                    details: "æ•°æ®åº“äº‹åŠ¡å¤±è´¥"

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: APIå¯†é’¥è®¤è¯
    
    TenantAuth:
      type: apiKey
      in: header
      name: X-Tenant-ID
      description: ç§Ÿæˆ·IDè®¤è¯

  schemas:
    Organization:
      type: object
      required:
        - tenant_id
        - code
        - name
        - unit_type
        - status
        - level
        - created_at
        - updated_at
        - effective_date
        - version
        - is_current
      properties:
        tenant_id:
          type: string
          format: uuid
          description: ç§Ÿæˆ·ID
          example: "3b99930c-4dc6-4cc9-8e4d-7d960a931cb9"
        
        code:
          type: string
          pattern: '^[0-9]{7}$'
          description: 7ä½æ•°å­—ç»„ç»‡ä»£ç 
          example: "1000001"
        
        parent_code:
          type: string
          pattern: '^[0-9]{7}$'
          nullable: true
          description: çˆ¶ç»„ç»‡ä»£ç 
          example: "1000000"
        
        name:
          type: string
          maxLength: 255
          description: ç»„ç»‡åç§°
          example: "AIæ²»ç†åŠå…¬å®¤"
        
        unit_type:
          type: string
          enum: [COMPANY, DEPARTMENT, TEAM, OFFICE, CENTER]
          description: ç»„ç»‡ç±»å‹
          example: "DEPARTMENT"
        
        status:
          type: string
          enum: [ACTIVE, INACTIVE, PLANNED]
          description: ç»„ç»‡çŠ¶æ€
          example: "ACTIVE"
        
        level:
          type: integer
          minimum: 1
          maximum: 10
          description: ç»„ç»‡å±‚çº§
          example: 2
        
        path:
          type: string
          maxLength: 1000
          nullable: true
          description: ç»„ç»‡è·¯å¾„
          example: "/1000000/1000001"
        
        sort_order:
          type: integer
          minimum: 0
          description: æ’åºé¡ºåº
          example: 0
        
        description:
          type: string
          maxLength: 1000
          description: ç»„ç»‡æè¿°
          example: "æŠ€æœ¯ç ”å‘éƒ¨é—¨"
        
        created_at:
          type: string
          format: date-time
          description: åˆ›å»ºæ—¶é—´
          example: "2025-08-05T11:23:01.426455Z"
        
        updated_at:
          type: string
          format: date-time
          description: æ›´æ–°æ—¶é—´
          example: "2025-08-09T12:07:15.838099Z"
        
        effective_date:
          type: string
          format: date-time
          nullable: true
          description: ç”Ÿæ•ˆæ—¥æœŸ
          example: "2025-08-10T00:00:00Z"
        
        end_date:
          type: string
          format: date-time
          nullable: true
          description: ç»“æŸæ—¥æœŸ
          example: "2025-12-31T23:59:59Z"
        
        version:
          type: integer
          minimum: 1
          nullable: true
          description: ç‰ˆæœ¬å·
          example: 1
        
        supersedes_version:
          type: integer
          minimum: 1
          nullable: true
          description: æ›¿ä»£çš„ç‰ˆæœ¬å·
          example: null
        
        change_reason:
          type: string
          maxLength: 500
          nullable: true
          description: å˜æ›´åŸå› 
          example: "ç»„ç»‡æ¶æ„è°ƒæ•´"
        
        is_current:
          type: boolean
          nullable: true
          description: æ˜¯å¦å½“å‰ç‰ˆæœ¬
          example: true

    TemporalQueryOptions:
      type: object
      properties:
        as_of_date:
          type: string
          format: date
          nullable: true
          description: æ—¶é—´ç‚¹æŸ¥è¯¢æ—¥æœŸ
          example: "2025-08-09"
        
        effective_from:
          type: string
          format: date
          nullable: true
          description: ç”Ÿæ•ˆèµ·å§‹æ—¥æœŸ
        
        effective_to:
          type: string
          format: date
          nullable: true
          description: ç”Ÿæ•ˆç»“æŸæ—¥æœŸ
        
        include_history:
          type: boolean
          default: false
          description: åŒ…å«å†å²ç‰ˆæœ¬
        
        include_future:
          type: boolean
          default: false
          description: åŒ…å«æœªæ¥ç‰ˆæœ¬
        
        include_dissolved:
          type: boolean
          default: false
          description: åŒ…å«å·²è§£æ•£ç»„ç»‡
        
        version:
          type: integer
          nullable: true
          description: ç‰¹å®šç‰ˆæœ¬å·
        
        max_versions:
          type: integer
          minimum: 1
          maximum: 100
          default: 10
          description: æœ€å¤§ç‰ˆæœ¬æ•°

    TemporalQueryResponse:
      type: object
      required:
        - organizations
        - query_options
        - result_count
        - queried_at
      properties:
        organizations:
          type: array
          items:
            $ref: '#/components/schemas/Organization'
          description: ç»„ç»‡åˆ—è¡¨
        
        query_options:
          $ref: '#/components/schemas/TemporalQueryOptions'
          description: æŸ¥è¯¢é€‰é¡¹
        
        result_count:
          type: integer
          minimum: 0
          description: ç»“æœæ•°é‡
          example: 1
        
        queried_at:
          type: string
          format: date-time
          description: æŸ¥è¯¢æ—¶é—´
          example: "2025-08-10T15:06:16+08:00"

    OrganizationChangeEvent:
      type: object
      required:
        - event_type
        - effective_date
        - change_reason
      properties:
        event_type:
          type: string
          enum: [CREATE, UPDATE, RESTRUCTURE, DISSOLVE, ACTIVATE, DEACTIVATE]
          description: äº‹ä»¶ç±»å‹
          example: "UPDATE"
        
        effective_date:
          type: string
          format: date-time
          description: ç”Ÿæ•ˆæ—¥æœŸ
          example: "2025-08-10T00:00:00Z"
        
        end_date:
          type: string
          format: date-time
          nullable: true
          description: ç»“æŸæ—¥æœŸ (ä»…ç”¨äºç‰¹æ®Šåœºæ™¯å¦‚è§£æ•£)
          example: null
        
        change_reason:
          type: string
          maxLength: 500
          description: å˜æ›´åŸå› 
          example: "ç»„ç»‡åç§°æ ‡å‡†åŒ–"
        
        change_data:
          type: object
          additionalProperties: true
          description: å˜æ›´æ•°æ® (å…·ä½“å­—æ®µæ ¹æ®äº‹ä»¶ç±»å‹è€Œå®š)
          example:
            name: "AIæ²»ç†ä¸åˆ›æ–°ä¸­å¿ƒ"
            description: "è´Ÿè´£AIæŠ€æœ¯æ²»ç†å’Œåˆ›æ–°æ¨è¿›"

    EventResponse:
      type: object
      required:
        - event_id
        - event_type
        - organization
        - effective_date
        - status
        - processed_at
      properties:
        event_id:
          type: string
          description: äº‹ä»¶ID
          example: "evt_1234567890abcdef"
        
        event_type:
          type: string
          description: äº‹ä»¶ç±»å‹
          example: "UPDATE"
        
        organization:
          type: string
          description: ç»„ç»‡ä»£ç 
          example: "1000001"
        
        effective_date:
          type: string
          format: date-time
          description: ç”Ÿæ•ˆæ—¥æœŸ
          example: "2025-08-10T00:00:00Z"
        
        status:
          type: string
          enum: [processed, failed, pending]
          description: å¤„ç†çŠ¶æ€
          example: "processed"
        
        processed_at:
          type: string
          format: date-time
          description: å¤„ç†æ—¶é—´
          example: "2025-08-10T15:06:30+08:00"

    HealthResponse:
      type: object
      required:
        - status
        - service
        - timestamp
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
          description: å¥åº·çŠ¶æ€
          example: "healthy"
        
        service:
          type: string
          description: æœåŠ¡åç§°
          example: "integrated-temporal-service"
        
        timestamp:
          type: string
          format: date-time
          description: æ£€æŸ¥æ—¶é—´
          example: "2025-08-10T15:06:04+08:00"
        
        features:
          type: array
          items:
            type: string
          description: æ”¯æŒçš„åŠŸèƒ½åˆ—è¡¨
          example: ["temporal-queries", "event-driven-changes", "timeline-management"]

    ErrorResponse:
      type: object
      required:
        - error_code
        - message
      properties:
        error_code:
          type: string
          description: é”™è¯¯ä»£ç 
          example: "INVALID_TEMPORAL_PARAMS"
        
        message:
          type: string
          description: é”™è¯¯æ¶ˆæ¯
          example: "æ—¶æ€æŸ¥è¯¢å‚æ•°æ— æ•ˆ"
        
        details:
          type: string
          nullable: true
          description: é”™è¯¯è¯¦æƒ…
          example: "æ— æ•ˆçš„as_of_dateæ ¼å¼ï¼ŒæœŸæœ›ï¼šYYYY-MM-DD"

tags:
  - name: Health Check
    description: æœåŠ¡å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€ç›‘æ§
  
  - name: Monitoring
    description: æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†
  
  - name: Temporal Queries
    description: |
      æ—¶æ€æŸ¥è¯¢åŠŸèƒ½ - æ”¯æŒåŸºäºæ—¶é—´çš„ç»„ç»‡æ¶æ„æŸ¥è¯¢
      
      ### ç‰¹æ€§
      - ğŸ•’ æ—¶é—´ç‚¹æŸ¥è¯¢ (`as_of_date`)
      - ğŸ“… æ—¶é—´èŒƒå›´æŸ¥è¯¢ (`effective_from`, `effective_to`)
      - ğŸ”¢ ç‰ˆæœ¬æŸ¥è¯¢ (`version`)
      - ğŸ“ˆ å†å²ç‰ˆæœ¬æŸ¥è¯¢ (`include_history`)
      - ğŸš€ Redisç¼“å­˜ä¼˜åŒ– (94%æ€§èƒ½æå‡)
  
  - name: Event Management
    description: |
      äº‹ä»¶é©±åŠ¨å˜æ›´ç®¡ç† - åŸºäºäº‹ä»¶çš„ç»„ç»‡æ¶æ„å˜æ›´å¤„ç†
      
      ### äº‹ä»¶ç±»å‹
      - **CREATE**: åˆ›å»ºæ–°ç»„ç»‡
      - **UPDATE**: æ›´æ–°ç»„ç»‡ä¿¡æ¯  
      - **RESTRUCTURE**: ç»„ç»‡æ¶æ„é‡ç»„
      - **DISSOLVE**: è§£æ•£ç»„ç»‡
      - **ACTIVATE/DEACTIVATE**: çŠ¶æ€å˜æ›´

externalDocs:
  description: Cube Castle APIæ–‡æ¡£ä¸­å¿ƒ
  url: https://docs.cubecastle.com/api