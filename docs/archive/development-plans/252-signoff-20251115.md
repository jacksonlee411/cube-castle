# Plan 252 签字纪要（2025-11-15）

状态：完成（已归档）  
关联文档：docs/development-plans/252-permission-consistency-and-contract-alignment.md（已执行完毕）

## 验收结果（全部通过）
- OpenAPI security scopes 一致性=100%（未注册引用=0）；报告见 `reports/permissions/openapi-scope-usage.json`、`openapi-scope-registry.json`；汇总见 `reports/permissions/summary.txt`。
- GraphQL→PBAC 映射覆盖率=100%（由 schema 注释生成，运行时 go:embed 消费）；制品：`cmd/hrms-server/query/internal/auth/generated/graphql-permissions.json`。
- Resolver 授权覆盖率=100%（未发现绕过，历史查询仅信息提示）
- 生产构建禁用 devMode：默认 `DEV_MODE=false`，CI 守卫通过。
- 临时兼容项：`org:write` 兼容保留，`// TODO-TEMPORARY(2025-12-15)` 限期回收。
- 关键用例（最小集）正/负向验证：职位任职审计、职位任职查询、组织层级统计、职类目录、审计历史（见单测与报告）。
- 证据落盘完整：`logs/plan252/*`。

## 变更摘要
- 新增权限契约校验器（scripts/quality/auth-permission-contract-validator.js）与 CI 守卫，自动化校验契约一致性。
- OpenAPI scopes 补登记：`position:assignments:read/write/audit`。
- PBAC 消费生成的映射，禁止手写；补齐多个 Query 的权限映射。
- DEV_MODE 默认禁用；开发容器显式开启。

## 风险与回滚
- 若发现契约与实现漂移，优先回滚实现或更新契约；校验器与 CI 将阻断合并。
- devMode 误入生产构建：立即回滚构建或强制配置覆盖。
- `org:write` 兼容项按期回收，逾期由 CI 文档检查提示。

## 证据清单
- 运行汇总：`logs/plan252/validator-summary-*.txt`
- 报告快照：`logs/plan252/reports-*/{openapi-scope-usage.json,openapi-scope-registry.json,graphql-query-permissions.json,resolver-permission-calls.json}`

维护者：后端（安全合规协同评审）

