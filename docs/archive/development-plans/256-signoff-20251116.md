# Plan 256 – 契约 SSoT 生成链路（签收）

签收日期: 2025-11-16  
关联计划: 202（主计划）、258（契约漂移门禁）

## 一、范围与目标
- 单一事实来源（SSoT）：`docs/api/openapi.yaml` + `docs/api/schema.graphql`。
- 单向生成：契约 → 中间层 JSON → Go/TS 生成物。
- 门禁职责（256）：生成→工作树 clean→快照一致；漂移对比为“报告模式”。

## 二、交付物与路径
- 生成脚本：`scripts/contract/sync.sh`  
  - Go 产物：`internal/types/contract_gen.go`  
  - TS 产物：`frontend/src/shared/types/contract_gen.ts`  
  - 中间层：`shared/contracts/organization.json`
- 漂移报告（报告模式）：`reports/contracts/drift-report.json`
- Make 目标：`make generate-contracts`、`make verify-contracts`

## 三、CI 与门禁
- 工作流：
  - `api-compliance.yml`（Spectral OpenAPI 校验，阻断）
  - `contract-testing.yml`（生成→工作树 clean→快照；上传 drift-report，非阻断）
- 保护分支建议 Required checks：
  - `api-compliance` + `contract-testing`（已执行）
  - 待 Plan 258 上线后新增 `contract-drift-gate`（阻断）

## 四、证据
- 运行日志：`logs/plan256/`（如：`logs/plan256/sync-*.log`）
- 报告产物：`reports/contracts/drift-report.json`
- 合规校验快照：`tests/contract/inventory.baseline.json`（含生成物；忽略 JSON 中 generatedAt 差异）

## 五、结论
Plan 256 验收通过，状态“已完成”。漂移阻断与白名单策略移交至 Plan 258 承担。  
若后续契约调整，需先更新 `docs/api/*`，再运行 `make generate-contracts` 并提交生成物；CI 保证工作树 clean 与快照一致。 

