# Cube Castle 技术栈信息

**文档版本**: v1.5.1  
**更新时间**: 2025-07-30 16:50  
**维护状态**: ✅ 活跃维护

## 📚 技术栈概览

### 后端技术栈 (Go生态系统)

#### 🏗️ 核心框架
```yaml
语言版本: Go 1.23+
Web框架: Chi Router v5.1.0
ORM框架: Ent v0.14+ (Facebook/Meta)
数据库: PostgreSQL 16+ 
缓存: Redis 7+
消息队列: RabbitMQ 3.13+
```

#### 🔒 安全与中间件
- **认证授权**: JWT + OAuth2.0 + RBAC
- **多租户**: PostgreSQL行级安全(RLS)
- **策略引擎**: Open Policy Agent (OPA)
- **数据分类**: 自动PII检测与分类
- **API安全**: 请求验证 + 速率限制

#### 🛠️ 开发工具
- **元合约编译器**: 自定义CLI (YAML→Go代码生成)
- **构建工具**: Makefile + Go modules
- **代码生成**: Ent Schema + API生成器
- **容器化**: Docker + Docker Compose

### 前端技术栈 (JavaScript/TypeScript生态系统)

#### ⚡ 核心框架 (已优化兼容版本)
```yaml
框架版本: Next.js 14.1.4 (稳定版本)
UI库版本: Ant Design 5.20.6 (LTS兼容)
图标库: "@ant-design/icons": "5.3.7"
语言: TypeScript 5.5+
样式: Tailwind CSS 3.4+
```

> 🔒 **版本锁定说明**: 当前使用经过ES模块兼容性验证的稳定版本组合

#### 🎨 UI与交互
- **组件库**: Ant Design 5.20.6 (企业级组件)
- **辅助组件**: Radix UI (无障碍设计)
- **图标系统**: Ant Design Icons + Lucide React + Heroicons
- **动画**: Framer Motion 11.3+
- **拖拽**: @dnd-kit + React DnD

#### 🔧 状态管理与数据
- **状态管理**: Zustand 4.5+ (轻量级)
- **数据获取**: SWR 2.2+ (缓存优化)
- **表单处理**: React Hook Form + Zod验证
- **HTTP客户端**: Axios 1.7+

#### 🧪 测试与质量
- **单元测试**: Jest 29+ + Testing Library
- **E2E测试**: Playwright 1.45+
- **类型检查**: TypeScript strict模式
- **代码规范**: ESLint + Prettier

### 数据库与存储

#### 🗄️ 主数据库
- **类型**: PostgreSQL 16+
- **特性**: JSON支持, 全文搜索, 时态表
- **安全**: 行级安全(RLS) + 列级加密
- **备份**: 自动备份 + 点时间恢复

#### 📊 缓存与会话
- **Redis**: 会话存储 + 查询缓存
- **内存缓存**: 应用级缓存策略
- **CDN**: 静态资源分发

### DevOps与部署

#### 🚀 容器化部署
```yaml
容器运行时: Docker 24+
编排平台: Docker Compose (开发) / Kubernetes (生产)
镜像仓库: 私有Docker Registry
配置管理: 环境变量 + Secret管理
```

#### 📈 监控与可观测性
- **日志**: 结构化JSON日志
- **指标**: 自定义业务指标
- **追踪**: 分布式请求追踪
- **健康检查**: 自动健康监控

#### 🔄 CI/CD流程
- **版本控制**: Git + GitFlow工作流
- **构建**: 自动化构建管道
- **测试**: 自动化测试执行
- **部署**: 滚动更新 + 零停机部署

## 🔄 版本兼容性矩阵

### 当前稳定版本组合 (2025-07-30)

#### 前端依赖
| 包名 | 当前版本 | 兼容状态 | 备注 |
|------|----------|----------|------|
| next | 14.1.4 | ✅ 稳定 | 降级版本确保兼容性 |
| antd | 5.20.6 | ✅ LTS | 长期支持版本 |
| @ant-design/icons | 5.3.7 | ✅ 匹配 | 与antd版本匹配 |
| rc-util | 5.38.2 | ✅ 稳定 | 核心工具库 |
| @rc-component/util | 1.1.0 | ✅ 稳定 | 组件工具库 |
| typescript | 5.5.0 | ✅ 最新 | 类型系统 |
| tailwindcss | 3.4.0 | ✅ 最新 | CSS框架 |

#### 后端依赖
| 包名 | 版本要求 | 状态 | 说明 |
|------|----------|------|------|
| Go | 1.23+ | ✅ | 语言运行时 |
| Chi | v5.1.0 | ✅ | Web路由框架 |
| Ent | v0.14+ | ✅ | ORM框架 |
| GORM | - | ❌ | 已迁移到Ent |
| PostgreSQL | 16+ | ✅ | 主数据库 |

### 升级路线图

#### 短期计划 (1个月内)
- **前端**: 监控当前版本稳定性
- **后端**: Go 1.24 迁移准备
- **数据库**: PostgreSQL 17 评估

#### 中期计划 (3个月内)
- **前端**: Next.js 15.x 兼容性研究
- **前端**: Ant Design 6.x 迁移评估
- **后端**: Ent v0.15 升级

#### 长期计划 (6个月内)
- **架构**: 微服务拆分评估
- **前端**: React 19 支持
- **数据库**: 分布式数据库方案

## 🚨 已知限制与约束

### 前端限制
1. **版本锁定**: 当前版本组合不可随意升级
2. **ES模块**: 需要特殊Webpack配置处理
3. **构建时间**: 大型项目构建可能较长

### 后端限制
1. **单体架构**: 当前为单体应用，大规模时需要拆分
2. **内存使用**: Go应用内存占用相对较高
3. **并发限制**: 数据库连接池需要合理配置

### 基础设施限制
1. **单机部署**: 当前配置适用于中小规模
2. **存储容量**: 文件存储需要扩展方案
3. **网络带宽**: 大文件处理需要CDN支持

## 📋 技术决策记录

### ADR-001: 前端UI库选择
- **决策**: 选择Ant Design作为主要UI库
- **原因**: 企业级特性丰富，中文支持好
- **影响**: 需要处理ES模块兼容性问题
- **状态**: ✅ 已解决兼容性问题

### ADR-002: ORM框架选择  
- **决策**: 从GORM迁移到Ent
- **原因**: 类型安全，代码生成，Facebook维护
- **影响**: 需要重写数据访问层
- **状态**: ✅ 已完成迁移

### ADR-003: 前端版本策略
- **决策**: 采用稳定版本组合而非最新版本
- **原因**: 确保生产环境稳定性
- **影响**: 部分最新特性不可用
- **状态**: ✅ 当前策略，定期评估

## 🔗 相关文档

- **架构文档**: `/docs/architecture/`
- **开发指南**: `/docs/development/`
- **API文档**: `/docs/api/`
- **部署指南**: `/docs/deployment/`
- **故障排除**: `/docs/troubleshooting/`

---

**维护负责人**: 技术架构团队  
**文档状态**: ✅ 当前有效  
**下次更新**: 2025-08-30 (月度更新)