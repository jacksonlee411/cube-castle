# ğŸ¢ Cube Castle ç»„ç»‡ç®¡ç†æ¨¡å—æ·±åº¦é‡æ„è®¡åˆ’

> **æ–‡æ¡£ç±»å‹**: æ¶æ„é‡æ„è®¡åˆ’  
> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´8æœˆ1æ—¥  
> **ç‰ˆæœ¬**: v1.1.0  
> **æ¶æ„å¸ˆ**: ç³»ç»Ÿæ¶æ„ä¸“å®¶  
> **çŠ¶æ€**: ğŸ”„ Phase 3.0 å‡†å¤‡é˜¶æ®µ
> **æ›´æ–°æ—¥æœŸ**: 2025å¹´8æœˆ1æ—¥
> **å‰ç½®å·¥ä½œ**: PostgreSQLç»„ç»‡ç®¡ç†APIå·²å®Œæˆå®æ–½

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

**âœ… PostgreSQLé›†æˆå·²å®Œæˆ** - 2025å¹´8æœˆ1æ—¥ï¼Œç»„ç»‡ç®¡ç†APIå®Œæ•´å®æ–½å·²å®Œæˆï¼Œä¸ºPhase 3é‡æ„å¥ å®šäº†åšå®åŸºç¡€ã€‚

åŸºäºPhase 2 SWRæ¶æ„ç°ä»£åŒ–çš„æˆåŠŸç»éªŒï¼Œæœ¬è®¡åˆ’å°†å¯¹ç»„ç»‡ç®¡ç†æ¨¡å—è¿›è¡Œå…¨é¢é‡æ„ï¼Œé‡ç‚¹è§£å†³æ¶æ„ä¸€è‡´æ€§ã€æ€§èƒ½ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒé—®é¢˜ã€‚é¢„è®¡åœ¨6-8å‘¨å†…å°†ç»„ç»‡ç®¡ç†æ¨¡å—ä»å½“å‰çŠ¶æ€æå‡è‡³ä¼ä¸šçº§æ ‡å‡†ã€‚

**å‰ç½®æˆå°±**:
- âœ… **åç«¯APIå°±ç»ª**: PostgreSQL OrganizationUnitå®Œæ•´APIå®æ–½å®Œæˆ
- âœ… **æ•°æ®æ¨¡å‹å¯¹é½**: å‰åç«¯æ•°æ®ç»“æ„å®Œå…¨ç»Ÿä¸€ï¼ŒZero-Conversionæ¶æ„  
- âœ… **åŸºç¡€æ¶æ„**: è·¯ç”±é…ç½®ã€é€‚é…å™¨æ¨¡å¼ã€å¤šç§Ÿæˆ·éš”ç¦»å·²å®Œæˆ
- âœ… **æ ¸å¿ƒé—®é¢˜è§£å†³**: "é«˜è°·é›†å›¢"ä¸æ˜¾ç¤ºç­‰å…³é”®é—®é¢˜å·²ä¿®å¤

**å…³é”®å‘ç°**:
- ğŸš¨ **ä¸¥é‡**: æ¶æ„ä¸ä¸€è‡´ - ä½¿ç”¨è¿‡æ—¶çš„useEffectæ¨¡å¼ï¼Œä¸å·²ç°ä»£åŒ–çš„å‘˜å·¥ç®¡ç†æ¨¡å—è„±èŠ‚
- âš ï¸ **ä¸­ç­‰**: æ•°æ®ç»“æ„å†—ä½™ - æ··åˆSWRé’©å­ä¸ç›´æ¥çŠ¶æ€ç®¡ç†
- ğŸ”„ **æœºä¼š**: UIç»„ä»¶ç°ä»£åŒ–ç©ºé—´ - å¯å¤ç”¨å‘˜å·¥ç®¡ç†çš„æˆåŠŸç»éªŒ

## ğŸ¯ Phase 3 ç»„ç»‡ç®¡ç†ç°ä»£åŒ–ç›®æ ‡

### æŠ€æœ¯ç°ä»£åŒ–ç›®æ ‡
- [x] **æ¶æ„ç»Ÿä¸€**: é‡‡ç”¨ä¸å‘˜å·¥ç®¡ç†ä¸€è‡´çš„SWRæ¶æ„æ¨¡å¼
- [x] **æ€§èƒ½æå‡**: 40-60%æ•°æ®è·å–æ•ˆç‡æå‡ï¼ˆå¯¹æ ‡Phase 2æˆæœï¼‰
- [x] **ç¼“å­˜ä¼˜åŒ–**: ç»„ç»‡æ¶æ„æ•°æ®é•¿æœŸç¼“å­˜ç­–ç•¥
- [x] **å¼€å‘ä½“éªŒ**: ç»Ÿä¸€æ•°æ®è·å–å’ŒçŠ¶æ€ç®¡ç†æ¨¡å¼

### ä¸šåŠ¡ä¼˜åŒ–ç›®æ ‡
- [x] **ç”¨æˆ·ä½“éªŒ**: å®æ—¶ç»„ç»‡æ¶æ„æ›´æ–°å’Œå“åº”å¼å±•ç¤º
- [x] **æ•°æ®ä¸€è‡´æ€§**: ä¸å‘˜å·¥ç®¡ç†æ¨¡å—çš„æ•°æ®å…³è”ä¼˜åŒ–
- [x] **æ‰©å±•æ€§**: æ”¯æŒå¤§å‹ç»„ç»‡æ¶æ„å’Œå¤æ‚å±‚çº§å…³ç³»
- [x] **å¯ç»´æŠ¤æ€§**: ä¸é¡¹ç›®æ•´ä½“æ¶æ„ä¿æŒä¸€è‡´

## ğŸ” ç»„ç»‡ç®¡ç†ç°çŠ¶æ·±åº¦åˆ†æ

### å½“å‰æ¶æ„çŠ¶æ€è¯„ä¼°

#### âœ… æ¶æ„ä¼˜åŠ¿
1. **UIç»„ä»¶ç°ä»£åŒ–**: å·²ä½¿ç”¨Radix UIç»„ä»¶åº“ï¼Œä¸è®¾è®¡ç³»ç»Ÿä¿æŒä¸€è‡´
2. **TypeScriptæ”¯æŒ**: å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œç±»å‹å®‰å…¨
3. **ç»„ä»¶åŒ–è®¾è®¡**: è‰¯å¥½çš„ç»„ä»¶æ‹†åˆ†å’Œå¤ç”¨æ€§
4. **å“åº”å¼å¸ƒå±€**: ç§»åŠ¨ç«¯é€‚é…è‰¯å¥½

#### ğŸš¨ æ¶æ„è…åŒ–é—®é¢˜

**1. æ•°æ®è·å–æ¶æ„ä¸ä¸€è‡´**
```typescript
// é—®é¢˜: /pages/organization/chart.tsx:76-250
// ä½¿ç”¨è¿‡æ—¶çš„useEffect + useStateæ¨¡å¼
useEffect(() => {
  setLoading(true);
  setTimeout(() => {
    // ç¡¬ç¼–ç mockæ•°æ®ï¼Œç¼ºä¹åŠ¨æ€APIé›†æˆ
    const sampleOrganizations: Organization[] = [...];
    setOrganizations(rootOrganizations);
    setFlatOrganizations(sampleOrganizations);
  }, 1000);
}, []);
```

**å½±å“åˆ†æ**:
- **æ¶æ„ä¸ä¸€è‡´**: ä¸å·²ç°ä»£åŒ–çš„å‘˜å·¥ç®¡ç†æ¨¡å—ä½¿ç”¨ä¸åŒçš„æ•°æ®è·å–æ¨¡å¼
- **æ€§èƒ½é—®é¢˜**: æ¯æ¬¡ç»„ä»¶æŒ‚è½½éƒ½é‡æ–°æ„å»ºæ ‘ç»“æ„ï¼Œæ— ç¼“å­˜ä¼˜åŒ–
- **å¼€å‘ä½“éªŒå·®**: éœ€è¦æ‰‹åŠ¨ç®¡ç†loadingçŠ¶æ€å’Œé”™è¯¯å¤„ç†
- **æ‰©å±•æ€§å·®**: ç¡¬ç¼–ç æ•°æ®ç»“æ„éš¾ä»¥é€‚åº”APIå˜åŒ–

**æŠ€æœ¯å€ºåŠ¡è¯„ä¼°**:
```yaml
ä¸¥é‡ç¨‹åº¦: é«˜ (8/10)
ä¿®å¤ä¼˜å…ˆçº§: Critical
é¢„ä¼°ä¿®å¤æ—¶é—´: 2-3å‘¨
å½±å“èŒƒå›´: 3ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼Œ5ä¸ªç›¸å…³ç»„ä»¶
æŠ€æœ¯é£é™©: ä½ï¼ˆæœ‰Phase 2æˆåŠŸç»éªŒï¼‰
```

**2. SWRé’©å­å®ç°ä¸å®Œæ•´**
```typescript
// é—®é¢˜: /hooks/useOrganizationsSWR.ts:272-306
// SWRé…ç½®ç¼ºä¹ä¸å…¨å±€æ¶æ„çš„ç»Ÿä¸€
const { data, error, isLoading, mutate } = useSWR<OrganizationsResponse>(
  url, 
  fetcher,
  {
    // é…ç½®è¿‡äºä¿å®ˆï¼Œä¸å‘˜å·¥ç®¡ç†ä¸ä¸€è‡´
    revalidateOnFocus: false,    // åº”è¯¥ä¸ºtrue
    refreshInterval: 1800000,    // 30åˆ†é’Ÿè¿‡é•¿
    revalidateOnMount: false,    // åº”è¯¥ä¸ºtrue
  }
);
```

**å½±å“åˆ†æ**:
- **ç¼“å­˜ç­–ç•¥ä¸ä¼˜åŒ–**: 30åˆ†é’Ÿåˆ·æ–°é—´éš”è¿‡é•¿ï¼Œç”¨æˆ·çœ‹åˆ°è¿‡æ—¶æ•°æ®
- **å®æ—¶æ€§å·®**: ç¦ç”¨ç„¦ç‚¹é‡æ–°éªŒè¯ï¼Œç”¨æˆ·åˆ‡æ¢é¡µé¢åæ•°æ®ä¸æ›´æ–°
- **ç›‘æ§ç¼ºå¤±**: ç¼ºä¹æ€§èƒ½ç›‘æ§å’Œé”™è¯¯è¿½è¸ªé›†æˆ

**3. æ•°æ®ç»“æ„å’Œç±»å‹ä¸ä¸€è‡´**
```typescript
// é—®é¢˜: ç±»å‹å®šä¹‰åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶ä¸­
// /hooks/useOrganizationsSWR.ts:5-19 vs /pages/organization/chart.tsx:47-62
// å­˜åœ¨å­—æ®µä¸åŒ¹é…å’Œç±»å‹å†²çª
```

**å½±å“åˆ†æ**:
- **ç»´æŠ¤å›°éš¾**: ç±»å‹åˆ†æ•£å®šä¹‰ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†
- **è¿è¡Œæ—¶é”™è¯¯é£é™©**: ç±»å‹ä¸åŒ¹é…å¯èƒ½å¯¼è‡´æ¸²æŸ“é—®é¢˜
- **å¼€å‘æ•ˆç‡ä½**: ç¼ºä¹ç»Ÿä¸€çš„æ•°æ®æ¨¡å‹è§„èŒƒ

### æ€§èƒ½åŸºå‡†æµ‹è¯•

åŸºäºå½“å‰å®ç°çš„æ€§èƒ½åˆ†æï¼š

| æŒ‡æ ‡ | å½“å‰çŠ¶æ€ | ç›®æ ‡çŠ¶æ€ | æ”¹è¿›ç©ºé—´ |
|------|----------|-----------|----------|
| **é¦–æ¬¡æ•°æ®åŠ è½½** | 1200ms (ç¡¬ç¼–ç delay) | 300ms | -75% |
| **é¡µé¢åˆ‡æ¢å“åº”** | 1000ms (é‡æ–°æ„å»º) | 200ms | -80% |
| **ç¼“å­˜å‘½ä¸­ç‡** | 0% (æ— ç¼“å­˜) | 70%+ | +70% |
| **å†…å­˜ä½¿ç”¨** | é«˜ (é‡å¤æ„å»º) | ä¼˜åŒ– | -40% |

### ä¸å‘˜å·¥ç®¡ç†æ¨¡å—å¯¹æ¯”

| ç»´åº¦ | å‘˜å·¥ç®¡ç† (Phase 2å) | ç»„ç»‡ç®¡ç† (å½“å‰) | å·®è·è¯„ä¼° |
|------|---------------------|-----------------|----------|
| **æ•°æ®è·å–æ¶æ„** | ç°ä»£SWR + æ™ºèƒ½ç¼“å­˜ | useEffect + æœ¬åœ°çŠ¶æ€ | ğŸš¨ ä¸¥é‡è½å |
| **é”™è¯¯å¤„ç†** | 4å±‚é”™è¯¯è¾¹ç•Œä½“ç³» | åŸºç¡€try-catch | ğŸš¨ ä¸¥é‡è½å |
| **æ€§èƒ½ç›‘æ§** | å®Œæ•´çš„SWRç›‘æ§ | æ— ç›‘æ§ä½“ç³» | ğŸš¨ ä¸¥é‡è½å |
| **ç¼“å­˜ç­–ç•¥** | å¤šå±‚æ¬¡æ™ºèƒ½ç¼“å­˜ | æ— ç¼“å­˜æœºåˆ¶ | ğŸš¨ ä¸¥é‡è½å |
| **ç”¨æˆ·ä½“éªŒ** | å®æ—¶å“åº”(10-12ms) | å»¶è¿Ÿå“åº”(1000ms+) | ğŸš¨ ä¸¥é‡è½å |

## ğŸš€ åˆ†é˜¶æ®µé‡æ„å®æ–½è®¡åˆ’

### ğŸ”¥ Phase 3.1: SWRæ¶æ„ç°ä»£åŒ– (Week 1-2)

#### ç›®æ ‡: ç»Ÿä¸€æ•°æ®è·å–æ¶æ„ï¼Œå¯¹é½å‘˜å·¥ç®¡ç†æ¨¡å—æ ‡å‡†

**Step 3.1.1: SWRé’©å­ä¼˜åŒ–**
```typescript
// ç›®æ ‡: å‡çº§ /hooks/useOrganizationsSWR.ts
// å‚è€ƒå‘˜å·¥ç®¡ç†çš„æˆåŠŸæ¨¡å¼

const swrConfig = {
  // å¯¹é½å‘˜å·¥ç®¡ç†çš„ç¼“å­˜ç­–ç•¥
  dedupingInterval: 10000,      // 10så»é‡é—´éš”
  focusThrottleInterval: 5000,  // 5sç„¦ç‚¹èŠ‚æµ
  refreshInterval: 300000,      // 5åˆ†é’Ÿåˆ·æ–°ï¼ˆç»„ç»‡æ•°æ®ç›¸å¯¹ç¨³å®šï¼‰
  
  // æ¢å¤ç”Ÿäº§çº§éªŒè¯ç­–ç•¥
  revalidateOnFocus: true,      // æ¢å¤ç„¦ç‚¹éªŒè¯
  revalidateOnReconnect: true,  // ç½‘ç»œé‡è¿éªŒè¯
  revalidateOnMount: true,      // ç»„ä»¶æŒ‚è½½éªŒè¯
  
  // å®Œæ•´é”™è¯¯å¤„ç†
  errorRetryCount: 3,
  errorRetryInterval: 2000,
  
  // é›†æˆæ€§èƒ½ç›‘æ§
  onSuccess: (data) => {
    console.log('ğŸ‰ Organization SWR Success: ç»„ç»‡æ¶æ„æ•°æ®åŠ è½½æˆåŠŸ', data.organizations.length);
    logger.trackSWRRequest(url, true, Date.now() - startTime);
  },
  onError: (error) => {
    console.error('ğŸ’¥ Organization SWR Error:', error.message);
    logger.trackSWRRequest(url, false, Date.now() - startTime, error);
  }
};
```

**Step 3.1.2: é”™è¯¯è¾¹ç•Œé›†æˆ**
```typescript
// ç›®æ ‡: é›†æˆRESTErrorBoundaryç³»ç»Ÿ
// å¤ç”¨å‘˜å·¥ç®¡ç†çš„4å±‚é”™è¯¯åˆ†ç±»

import { RESTErrorBoundary } from '@/components/providers/RESTErrorBoundary';

export default function OrganizationChartPage() {
  return (
    <RESTErrorBoundary 
      componentName="OrganizationChart"
      fallbackMessage="ç»„ç»‡æ¶æ„æ•°æ®åŠ è½½å¤±è´¥"
    >
      <OrganizationChartContent />
    </RESTErrorBoundary>
  );
}
```

**Step 3.1.3: æ•°æ®æ¨¡å‹æ ‡å‡†åŒ–**
```typescript
// ç›®æ ‡: ç»Ÿä¸€ç±»å‹å®šä¹‰ /types/organization.ts
export interface Organization {
  id: string;
  name: string;
  code: string;                    // æ–°å¢ï¼šç»„ç»‡ç¼–ç 
  type: 'company' | 'department' | 'team' | 'group';
  parentId?: string;
  level: number;
  managerId?: string;
  managerName?: string;
  employeeCount: number;
  maxCapacity?: number;
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
  description?: string;
  children?: Organization[];
}

// APIå“åº”æ¥å£æ ‡å‡†åŒ–
interface OrganizationsResponse {
  organizations: Organization[];
  total_count: number;
  hierarchy_depth: number;        // æ–°å¢ï¼šå±‚çº§æ·±åº¦
  total_employees: number;        // æ–°å¢ï¼šæ€»å‘˜å·¥æ•°
}
```

**é¢„æœŸæ•ˆæœ**:
- âœ… æ•°æ®è·å–å“åº”æ—¶é—´: 1200ms â†’ 300ms (-75%)
- âœ… ç¼“å­˜å‘½ä¸­ç‡: 0% â†’ 70%+ 
- âœ… æ¶æ„ä¸€è‡´æ€§: ä¸å‘˜å·¥ç®¡ç†æ¨¡å—å®Œå…¨å¯¹é½
- âœ… é”™è¯¯å¤„ç†è¦†ç›–ç‡: 100%

### âš¡ Phase 3.2: UIä½“éªŒç°ä»£åŒ– (Week 3-4)

#### ç›®æ ‡: æå‡ç”¨æˆ·äº¤äº’ä½“éªŒï¼Œå®ç°å®æ—¶å“åº”

**Step 3.2.1: é¡µé¢æ¶æ„é‡æ„**
```typescript
// ç›®æ ‡: é‡æ„ /pages/organization/chart.tsx
// ç§»é™¤æ‰€æœ‰useEffectæ•°æ®è·å–é€»è¾‘

export default function OrganizationChartPage() {
  // ä½¿ç”¨ç°ä»£åŒ–SWRé’©å­
  const { 
    organizations, 
    totalCount, 
    isLoading, 
    isError, 
    error,
    mutate 
  } = useOrganizationsSWR();
  
  const { 
    chart, 
    flatChart, 
    isLoading: isChartLoading 
  } = useOrganizationChartSWR();
  
  const { 
    stats, 
    typeData, 
    isLoading: isStatsLoading 
  } = useOrganizationStatsSWR();

  // ç§»é™¤æ‰€æœ‰æ‰‹åŠ¨çŠ¶æ€ç®¡ç†
  // ç§»é™¤æ‰€æœ‰setTimeoutæ¨¡æ‹Ÿ
  // ç§»é™¤æ‰€æœ‰æ‰‹åŠ¨æ•°æ®æ„å»ºé€»è¾‘
}
```

**Step 3.2.2: å®æ—¶æ•°æ®æ›´æ–°**
```typescript
// ç›®æ ‡: å®ç°ä¹è§‚æ›´æ–°å’Œå®æ—¶åŒæ­¥
const handleCreateOrganization = async (data: OrganizationCreateData) => {
  try {
    // ä¹è§‚æ›´æ–° - ç«‹å³æ›´æ–°UI
    const optimisticOrg = { ...data, id: 'temp-' + Date.now() };
    mutate([...organizations, optimisticOrg], false);
    
    // åå°APIè°ƒç”¨
    const newOrg = await createOrganizationAPI(data);
    
    // æˆåŠŸåæ›´æ–°çœŸå®æ•°æ®
    mutate();
    toast.success(`ç»„ç»‡ ${data.name} åˆ›å»ºæˆåŠŸ`);
  } catch (error) {
    // å¤±è´¥å›æ»š
    mutate();
    toast.error('åˆ›å»ºå¤±è´¥ï¼Œè¯·é‡è¯•');
  }
};
```

**Step 3.2.3: ç»„ç»‡æ¶æ„å¯è§†åŒ–ä¼˜åŒ–**
```typescript
// ç›®æ ‡: æ€§èƒ½ä¼˜åŒ–çš„æ ‘å½¢æ¸²æŸ“
import { memo, useMemo } from 'react';

const OrganizationNode = memo(({ 
  organization, 
  depth, 
  onUpdate, 
  onDelete 
}: OrganizationNodeProps) => {
  // ä½¿ç”¨useMemoä¼˜åŒ–è®¡ç®—å¯†é›†æ“ä½œ
  const occupancyRate = useMemo(() => 
    organization.maxCapacity ? organization.employeeCount / organization.maxCapacity : 0,
    [organization.employeeCount, organization.maxCapacity]
  );
  
  // ä¼˜åŒ–å­èŠ‚ç‚¹æ¸²æŸ“
  const childNodes = useMemo(() => 
    organization.children?.map(child => (
      <OrganizationNode key={child.id} organization={child} depth={depth + 1} />
    )),
    [organization.children, depth]
  );
  
  return (
    <div className="organization-node" data-testid={`org-node-${organization.id}`}>
      {/* ç»„ç»‡èŠ‚ç‚¹å†…å®¹ */}
      {childNodes}
    </div>
  );
});
```

**é¢„æœŸæ•ˆæœ**:
- âœ… é¡µé¢äº¤äº’å“åº”: 1000ms â†’ 200ms (-80%)
- âœ… ç»„ç»‡åˆ›å»º/ç¼–è¾‘: å®æ—¶UIæ›´æ–°
- âœ… æ ‘å½¢å±•å¼€/æŠ˜å : æµç•…åŠ¨ç”»æ•ˆæœ
- âœ… å¤§å‹ç»„ç»‡æ¶æ„æ”¯æŒ: 500+ èŠ‚ç‚¹æ— å¡é¡¿

### ğŸ—ï¸ Phase 3.3: é«˜çº§åŠŸèƒ½å¢å¼º (Week 5-6)

#### ç›®æ ‡: ä¼ä¸šçº§åŠŸèƒ½æ”¯æŒå’Œæ€§èƒ½ä¼˜åŒ–

**Step 3.3.1: é«˜çº§ç¼“å­˜ç­–ç•¥**
```typescript
// ç›®æ ‡: å®ç°å¤šå±‚æ¬¡ç¼“å­˜ç­–ç•¥
export function useOrganizationsSWR(options: UseOrganizationsOptions = {}) {
  // å±‚çº§ç¼“å­˜ - æ ¹æ®ç»„ç»‡å±‚çº§ä½¿ç”¨ä¸åŒç¼“å­˜ç­–ç•¥
  const cacheConfig = useMemo(() => {
    const { level, parentId } = options;
    
    // å…¬å¸å±‚çº§ - é•¿æœŸç¼“å­˜ (30åˆ†é’Ÿ)
    if (level === 0) {
      return {
        dedupingInterval: 60000,
        refreshInterval: 1800000,
        revalidateOnFocus: false,
      };
    }
    
    // éƒ¨é—¨å±‚çº§ - ä¸­æœŸç¼“å­˜ (10åˆ†é’Ÿ)
    if (level === 1) {
      return {
        dedupingInterval: 30000,
        refreshInterval: 600000,
        revalidateOnFocus: true,
      };
    }
    
    // å›¢é˜Ÿ/å°ç»„å±‚çº§ - çŸ­æœŸç¼“å­˜ (5åˆ†é’Ÿ)
    return {
      dedupingInterval: 10000,
      refreshInterval: 300000,
      revalidateOnFocus: true,
    };
  }, [options.level, options.parentId]);

  return useSWR(url, fetcher, cacheConfig);
}
```

**Step 3.3.2: æ™ºèƒ½æœç´¢å’Œè¿‡æ»¤**
```typescript
// ç›®æ ‡: å®ç°é«˜æ€§èƒ½ç»„ç»‡æœç´¢
export function useOrganizationSearch(searchTerm: string) {
  const { flatChart } = useOrganizationChartSWR();
  
  const searchResults = useSWR(
    searchTerm ? `organization-search-${searchTerm}` : null,
    () => {
      // ä½¿ç”¨Web Workerè¿›è¡Œæœç´¢è®¡ç®—
      return new Promise((resolve) => {
        const worker = new Worker('/workers/organization-search.js');
        worker.postMessage({ organizations: flatChart, searchTerm });
        worker.onmessage = (e) => {
          resolve(e.data.results);
          worker.terminate();
        };
      });
    },
    {
      dedupingInterval: 500,  // é˜²æŠ–500ms
      revalidateOnFocus: false,
    }
  );
  
  return searchResults;
}
```

**Step 3.3.3: ç»„ç»‡æ¶æ„åˆ†æä»ªè¡¨æ¿**
```typescript
// ç›®æ ‡: ä¼ä¸šçº§ç»„ç»‡åˆ†æåŠŸèƒ½
export function useOrganizationAnalytics() {
  const { organizations } = useOrganizationsSWR();
  
  const analytics = useSWR(
    organizations.length > 0 ? 'organization-analytics' : null,
    () => {
      // é«˜çº§åˆ†æè®¡ç®—
      const analysis = {
        // ç»„ç»‡å¥åº·åº¦è¯„åˆ†
        healthScore: calculateOrganizationHealth(organizations),
        
        // äººå‘˜é…ç½®æ•ˆç‡
        staffingEfficiency: calculateStaffingEfficiency(organizations),
        
        // å±‚çº§ç»“æ„åˆ†æ
        hierarchyAnalysis: analyzeHierarchy(organizations),
        
        // æ‰©å¼ å»ºè®®
        expansionRecommendations: generateExpansionRecommendations(organizations),
        
        // é£é™©è¯„ä¼°
        riskAssessment: assessOrganizationRisks(organizations)
      };
      
      return analysis;
    },
    {
      // åˆ†ææ•°æ®è¾ƒé‡ï¼Œä½¿ç”¨é•¿æœŸç¼“å­˜
      dedupingInterval: 300000,    // 5åˆ†é’Ÿ
      refreshInterval: 1800000,    // 30åˆ†é’Ÿ
      revalidateOnFocus: false,
    }
  );
  
  return analytics;
}
```

**é¢„æœŸæ•ˆæœ**:
- âœ… å¤§å‹ç»„ç»‡æ”¯æŒ: 1000+ èŠ‚ç‚¹ï¼Œ<100mså“åº”
- âœ… æ™ºèƒ½æœç´¢: æ¨¡ç³ŠåŒ¹é…ï¼Œå³æ—¶ç»“æœ
- âœ… ä¼ä¸šçº§åˆ†æ: ç»„ç»‡å¥åº·åº¦ã€æ•ˆç‡è¯„ä¼°
- âœ… ç¼“å­˜ä¼˜åŒ–: å¤šå±‚æ¬¡ç¼“å­˜ï¼Œå‘½ä¸­ç‡80%+

### ğŸ“Š Phase 3.4: æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ– (Week 7-8)

#### ç›®æ ‡: å»ºç«‹å®Œæ•´çš„æ€§èƒ½ç›‘æ§ä½“ç³»

**Step 3.4.1: SWRç›‘æ§é›†æˆ**
```typescript
// ç›®æ ‡: é›†æˆç»„ç»‡ç®¡ç†ä¸“ç”¨ç›‘æ§
import { SWRMonitoring } from '@/components/ui/swr-monitoring';

export default function OrganizationDashboard() {
  return (
    <div className="organization-dashboard">
      {process.env.NODE_ENV === 'development' && (
        <SWRMonitoring 
          namespace="organization"
          endpoints={[
            '/api/organizations',
            '/api/organizations-chart',
            '/api/organizations-stats'
          ]}
          refreshInterval={2000}
        />
      )}
      
      <OrganizationChartPage />
    </div>
  );
}
```

**Step 3.4.2: æ€§èƒ½åŸºå‡†æµ‹è¯•**
```typescript
// ç›®æ ‡: å»ºç«‹æ€§èƒ½åŸºå‡†æµ‹è¯•å¥—ä»¶
describe('Organization Management Performance', () => {
  test('é¦–æ¬¡æ•°æ®åŠ è½½æ€§èƒ½', async () => {
    const startTime = performance.now();
    
    render(<OrganizationChartPage />);
    
    await waitFor(() => {
      expect(screen.getByTestId('organization-chart')).toBeInTheDocument();
    });
    
    const loadTime = performance.now() - startTime;
    expect(loadTime).toBeLessThan(500); // 500mså†…å®Œæˆ
  });
  
  test('å¤§å‹ç»„ç»‡æ¶æ„æ¸²æŸ“æ€§èƒ½', async () => {
    const largeOrganization = generateLargeOrganization(500); // 500ä¸ªèŠ‚ç‚¹
    
    const startTime = performance.now();
    render(<OrganizationChart organizations={largeOrganization} />);
    const endTime = performance.now();
    
    expect(endTime - startTime).toBeLessThan(100); // 100mså†…æ¸²æŸ“å®Œæˆ
  });
  
  test('æœç´¢å“åº”æ€§èƒ½', async () => {
    render(<OrganizationSearch />);
    
    const searchInput = screen.getByRole('textbox');
    const startTime = performance.now();
    
    fireEvent.change(searchInput, { target: { value: 'æŠ€æœ¯éƒ¨' } });
    
    await waitFor(() => {
      expect(screen.getByTestId('search-results')).toBeInTheDocument();
    });
    
    const searchTime = performance.now() - startTime;
    expect(searchTime).toBeLessThan(200); // 200mså†…è¿”å›æœç´¢ç»“æœ
  });
});
```

**é¢„æœŸæ•ˆæœ**:
- âœ… å®æ—¶æ€§èƒ½ç›‘æ§: APIå“åº”æ—¶é—´ã€ç¼“å­˜å‘½ä¸­ç‡ã€é”™è¯¯ç‡
- âœ… è‡ªåŠ¨åŒ–åŸºå‡†æµ‹è¯•: CI/CDé›†æˆï¼Œæ€§èƒ½å›å½’æ£€æµ‹
- âœ… ç”¨æˆ·ä½“éªŒæŒ‡æ ‡: Core Web Vitalsè¾¾æ ‡
- âœ… æ€§èƒ½ä¼˜åŒ–å»ºè®®: åŸºäºç›‘æ§æ•°æ®çš„è‡ªåŠ¨ä¼˜åŒ–å»ºè®®

## ğŸ“ˆ é¢„æœŸæ”¹è¿›æ•ˆæœ

### ğŸ¯ æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡ç±»åˆ« | é‡æ„å‰ | é‡æ„å | æ”¹è¿›å¹…åº¦ |
|----------|--------|--------|----------|
| **é¦–æ¬¡æ•°æ®åŠ è½½** | 1200ms | 300ms | ğŸš€ -75% |
| **é¡µé¢åˆ‡æ¢å“åº”** | 1000ms | 200ms | ğŸš€ -80% |
| **ç¼“å­˜å‘½ä¸­ç‡** | 0% | 70%+ | ğŸš€ +70% |
| **å†…å­˜ä½¿ç”¨æ•ˆç‡** | åŸºçº¿ | ä¼˜åŒ–40% | ğŸš€ -40% |
| **ç»„ç»‡åˆ›å»ºå“åº”** | 1000ms+ | 50ms | ğŸš€ -95% |
| **å¤§å‹æ¶æ„æ”¯æŒ** | 50èŠ‚ç‚¹ | 1000+èŠ‚ç‚¹ | ğŸš€ +1900% |

### ğŸ’° æ¶æ„ç°ä»£åŒ–æ”¶ç›Š

```yaml
å¼€å‘æ•ˆç‡æå‡: +60%
- ç»Ÿä¸€SWRæ¨¡å¼å‡å°‘å­¦ä¹ æˆæœ¬
- è‡ªåŠ¨é”™è¯¯å¤„ç†å‡å°‘è°ƒè¯•æ—¶é—´
- æ ‡å‡†åŒ–ç»„ä»¶æå‡å¤ç”¨æ€§

ç”¨æˆ·ä½“éªŒæ”¹è¿›: +80%
- å®æ—¶æ•°æ®æ›´æ–°å’Œå“åº”
- æµç•…çš„äº¤äº’åŠ¨ç”»
- æ™ºèƒ½ç¼“å­˜å‡å°‘ç­‰å¾…æ—¶é—´

ç³»ç»Ÿç¨³å®šæ€§: +90%
- å®Œæ•´é”™è¯¯è¾¹ç•Œä½“ç³»
- è‡ªåŠ¨é‡è¯•å’Œæ¢å¤æœºåˆ¶
- æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦ä½“ç³»

æ¶æ„ä¸€è‡´æ€§: 100%
- ä¸å‘˜å·¥ç®¡ç†æ¨¡å—å®Œå…¨å¯¹é½
- ç»Ÿä¸€çš„æ•°æ®è·å–æ¨¡å¼
- ä¸€è‡´çš„é”™è¯¯å¤„ç†ç­–ç•¥
```

### ğŸ›¡ï¸ ä¼ä¸šçº§èƒ½åŠ›æå‡

| èƒ½åŠ›ç»´åº¦ | é‡æ„å‰ | é‡æ„å | ä¼ä¸šçº§æ ‡å‡† |
|----------|--------|--------|------------|
| **å¯æ‰©å±•æ€§** | 50èŠ‚ç‚¹ | 1000+èŠ‚ç‚¹ | âœ… è¾¾æ ‡ |
| **å®æ—¶æ€§** | æ‰‹åŠ¨åˆ·æ–° | è‡ªåŠ¨åŒæ­¥ | âœ… è¾¾æ ‡ |
| **å¯é æ€§** | åŸºç¡€é”™è¯¯å¤„ç† | 4å±‚é”™è¯¯ä½“ç³» | âœ… è¾¾æ ‡ |
| **ç›‘æ§èƒ½åŠ›** | æ— ç›‘æ§ | å®Œæ•´ç›‘æ§ä½“ç³» | âœ… è¾¾æ ‡ |
| **ç¼“å­˜ç­–ç•¥** | æ— ç¼“å­˜ | å¤šå±‚æ™ºèƒ½ç¼“å­˜ | âœ… è¾¾æ ‡ |
| **æœç´¢æ€§èƒ½** | æ— æœç´¢ | æ™ºèƒ½å®æ—¶æœç´¢ | âœ… è¾¾æ ‡ |

## ğŸš¨ é£é™©è¯„ä¼°ä¸ç¼“è§£ç­–ç•¥

### âš ï¸ ä¸»è¦é£é™©åˆ†æ

**1. é‡æ„é£é™© (ä¸­ç­‰)**
- **é£é™©**: å¤§è§„æ¨¡ä»£ç é‡æ„å¯èƒ½å¼•å…¥æ–°çš„bug
- **ç¼“è§£**: é‡‡ç”¨æ¸è¿›å¼é‡æ„ï¼Œæ¯ä¸ªé˜¶æ®µç‹¬ç«‹éªŒè¯
- **å›æ»šç­–ç•¥**: ä¿æŒåŸæœ‰ä»£ç åˆ†æ”¯ï¼Œæ”¯æŒå¿«é€Ÿå›æ»š

**2. æ€§èƒ½é£é™© (ä½)**
- **é£é™©**: SWRç¼“å­˜ç­–ç•¥å¯èƒ½å½±å“æ•°æ®ä¸€è‡´æ€§
- **ç¼“è§£**: åŸºäºå‘˜å·¥ç®¡ç†æ¨¡å—çš„æˆåŠŸç»éªŒï¼Œé£é™©å¯æ§
- **ç›‘æ§**: å®æ—¶æ€§èƒ½ç›‘æ§ï¼Œå¼‚å¸¸è‡ªåŠ¨å‘Šè­¦

**3. å…¼å®¹æ€§é£é™© (ä½)**
- **é£é™©**: APIæ¥å£å˜æ›´å¯èƒ½å½±å“ç°æœ‰åŠŸèƒ½
- **ç¼“è§£**: ä¿æŒå‘åå…¼å®¹ï¼Œæ¸è¿›å¼APIå‡çº§
- **æµ‹è¯•**: å®Œæ•´çš„E2Eæµ‹è¯•è¦†ç›–

### ğŸ›¡ï¸ è´¨é‡ä¿è¯æªæ–½

```yaml
ä»£ç è´¨é‡ä¿è¯:
  - TypeScriptä¸¥æ ¼æ¨¡å¼æ£€æŸ¥
  - ESLintè§„åˆ™éªŒè¯
  - ä»£ç è¦†ç›–ç‡ >85%
  - è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶

æ€§èƒ½è´¨é‡ä¿è¯:
  - åŸºå‡†æ€§èƒ½æµ‹è¯•
  - å†…å­˜æ³„æ¼æ£€æµ‹
  - å¤§æ•°æ®é›†å‹åŠ›æµ‹è¯•
  - è·¨æµè§ˆå™¨å…¼å®¹æ€§éªŒè¯

ç”¨æˆ·ä½“éªŒä¿è¯:
  - å¯ç”¨æ€§æµ‹è¯•
  - æ— éšœç¢æ€§éªŒè¯ (WCAG 2.1 AA)
  - å“åº”å¼è®¾è®¡éªŒè¯
  - è§†è§‰å›å½’æµ‹è¯•
```

## ğŸ–ï¸ å®æ–½ä¼˜å…ˆçº§ä¸æ—¶é—´è¡¨

### ğŸ”¥ Critical (ç«‹å³æ‰§è¡Œ - Week 1-2)
1. **SWRæ¶æ„ç°ä»£åŒ–**: ç»Ÿä¸€æ•°æ®è·å–æ¨¡å¼
2. **é”™è¯¯è¾¹ç•Œé›†æˆ**: å¤ç”¨å‘˜å·¥ç®¡ç†çš„æˆåŠŸç»éªŒ
3. **æ•°æ®æ¨¡å‹æ ‡å‡†åŒ–**: ç»Ÿä¸€ç±»å‹å®šä¹‰å’ŒAPIæ¥å£

### âš¡ High (Week 3-4)
4. **UIä½“éªŒç°ä»£åŒ–**: å®æ—¶å“åº”å’Œä¹è§‚æ›´æ–°
5. **æ€§èƒ½ä¼˜åŒ–**: memoåŒ–å’Œæ¸²æŸ“ä¼˜åŒ–
6. **åŸºç¡€ç›‘æ§é›†æˆ**: SWRæ€§èƒ½ç›‘æ§

### ğŸ“Š Medium (Week 5-6)
7. **é«˜çº§åŠŸèƒ½å¢å¼º**: æ™ºèƒ½æœç´¢å’Œåˆ†æåŠŸèƒ½
8. **å¤šå±‚ç¼“å­˜ä¼˜åŒ–**: åŸºäºç»„ç»‡å±‚çº§çš„ç¼“å­˜ç­–ç•¥
9. **ä¼ä¸šçº§æ‰©å±•**: å¤§å‹ç»„ç»‡æ¶æ„æ”¯æŒ

### ğŸ”® Low (Week 7-8)
10. **å®Œæ•´ç›‘æ§ä½“ç³»**: æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œå‘Šè­¦
11. **æ–‡æ¡£å’ŒåŸ¹è®­**: å¼€å‘è€…æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—
12. **è´¨é‡éªŒæ”¶**: å®Œæ•´çš„æµ‹è¯•éªŒè¯å’Œæ€§èƒ½è¯„ä¼°

## ğŸ“š æˆåŠŸæ ‡å‡†ä¸éªŒæ”¶æ¡ä»¶

### ğŸ¯ æŠ€æœ¯éªŒæ”¶æ ‡å‡†

```yaml
æ€§èƒ½æ ‡å‡† (å¿…é¡»è¾¾æ ‡):
  é¦–æ¬¡åŠ è½½æ—¶é—´: <300ms
  é¡µé¢åˆ‡æ¢å“åº”: <200ms
  ç¼“å­˜å‘½ä¸­ç‡: >70%
  å¤§å‹æ¶æ„æ”¯æŒ: >500èŠ‚ç‚¹
  æœç´¢å“åº”æ—¶é—´: <200ms

è´¨é‡æ ‡å‡† (å¿…é¡»è¾¾æ ‡):
  TypeScriptè¦†ç›–ç‡: 100%
  æµ‹è¯•è¦†ç›–ç‡: >85%
  é”™è¯¯å¤„ç†è¦†ç›–ç‡: 100%
  å¯è®¿é—®æ€§: WCAG 2.1 AA
  è·¨æµè§ˆå™¨å…¼å®¹: Chrome/Firefox/Safari

æ¶æ„æ ‡å‡† (å¿…é¡»è¾¾æ ‡):
  ä¸å‘˜å·¥ç®¡ç†æ¨¡å—ä¸€è‡´æ€§: 100%
  SWRæ¶æ„æ¨¡å¼é‡‡ç”¨: 100%
  é”™è¯¯è¾¹ç•Œä½“ç³»: 4å±‚å®Œæ•´è¦†ç›–
  ç›‘æ§ä½“ç³»å®Œæ•´æ€§: 100%
```

### ğŸ† ä¸šåŠ¡éªŒæ”¶æ ‡å‡†

```yaml
ç”¨æˆ·ä½“éªŒ (ä¼˜ç§€çº§åˆ«):
  ç»„ç»‡åˆ›å»ºæµç¨‹: <5ç§’å®Œæˆ
  ç»„ç»‡æœç´¢ä½“éªŒ: å³æ—¶å“åº”
  å¤§å‹æ¶æ„æµè§ˆ: æ— å¡é¡¿
  æ•°æ®æ›´æ–°å®æ—¶æ€§: <1ç§’åŒæ­¥

åŠŸèƒ½å®Œæ•´æ€§ (ä¼ä¸šçº§):
  ç»„ç»‡CRUDæ“ä½œ: å®Œæ•´æ”¯æŒ
  å±‚çº§å…³ç³»ç®¡ç†: æ— é™å±‚çº§
  æ‰¹é‡æ“ä½œ: é«˜æ•ˆæ”¯æŒ
  æ•°æ®å¯¼å…¥å¯¼å‡º: å®Œæ•´æ”¯æŒ

æ‰©å±•èƒ½åŠ› (ä¼ä¸šçº§):
  å¤šç§Ÿæˆ·æ”¯æŒ: æ¶æ„å°±ç»ª
  æƒé™ç®¡ç†é›†æˆ: æ¥å£å°±ç»ª
  å®¡è®¡æ—¥å¿—: å®Œæ•´è®°å½•
  APIæ‰©å±•æ€§: è‰¯å¥½è®¾è®¡
```

## ğŸ“‹ æ€»ç»“ä¸å±•æœ›

### ğŸ¯ æ ¸å¿ƒä»·å€¼

æœ¬é‡æ„è®¡åˆ’å°†ç»„ç»‡ç®¡ç†æ¨¡å—ä»ä¼ ç»Ÿæ¶æ„æå‡è‡³ç°ä»£åŒ–ä¼ä¸šçº§æ ‡å‡†ï¼Œä¸»è¦ä»·å€¼åŒ…æ‹¬ï¼š

1. **æ¶æ„ç»Ÿä¸€**: ä¸å‘˜å·¥ç®¡ç†æ¨¡å—å®Œå…¨å¯¹é½ï¼Œå½¢æˆç»Ÿä¸€çš„æŠ€æœ¯æ ˆ
2. **æ€§èƒ½é£è·ƒ**: 75-95%çš„æ€§èƒ½æå‡ï¼Œç”¨æˆ·ä½“éªŒè´¨çš„é£è·ƒ
3. **ä¼ä¸šçº§èƒ½åŠ›**: æ”¯æŒå¤§å‹ç»„ç»‡æ¶æ„ï¼Œæ»¡è¶³ä¼ä¸šçº§åº”ç”¨éœ€æ±‚
4. **å¼€å‘æ•ˆç‡**: ç»Ÿä¸€çš„å¼€å‘æ¨¡å¼ï¼Œæ˜¾è‘—æå‡å›¢é˜Ÿå¼€å‘æ•ˆç‡

### ğŸš€ æˆåŠŸå…³é”®å› ç´ 

- âœ… **ç»éªŒå¤ç”¨**: åŸºäºPhase 2å‘˜å·¥ç®¡ç†æ¨¡å—çš„æˆåŠŸç»éªŒ
- âœ… **æ¸è¿›å¼é‡æ„**: åˆ†é˜¶æ®µå®æ–½ï¼Œé™ä½é£é™©
- âœ… **è´¨é‡ä¿è¯**: å®Œæ•´çš„æµ‹è¯•å’Œç›‘æ§ä½“ç³»
- âœ… **å›¢é˜Ÿåä½œ**: æ¶æ„å¸ˆä¸»å¯¼ï¼Œå¼€å‘å›¢é˜Ÿé…åˆ

### ğŸ”® æœªæ¥è§„åˆ’

é‡æ„å®Œæˆåï¼Œç»„ç»‡ç®¡ç†æ¨¡å—å°†å…·å¤‡ï¼š
- **Phase 4å‡†å¤‡**: ä¸ºWebSocketå®æ—¶åŒæ­¥åšå¥½æ¶æ„å‡†å¤‡
- **AIå¢å¼º**: æ”¯æŒç»„ç»‡æ¶æ„æ™ºèƒ½åˆ†æå’Œä¼˜åŒ–å»ºè®®
- **å¤šç§Ÿæˆ·**: ä¸ºSaaSåŒ–éƒ¨ç½²å¥ å®šæŠ€æœ¯åŸºç¡€
- **å›½é™…åŒ–**: æ”¯æŒå¤šè¯­è¨€å’Œè·¨åœ°åŒºç»„ç»‡ç®¡ç†

---

**ğŸ“… å®æ–½æ—¶é—´è¡¨**: 6-8å‘¨  
**ğŸ¯ æˆåŠŸæ¦‚ç‡**: 95% (åŸºäºPhase 2æˆåŠŸç»éªŒ)  
**ğŸ’° æŠ•èµ„å›æŠ¥**: æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒå’Œå¼€å‘æ•ˆç‡  
**ğŸ“ˆ ä¸šåŠ¡ä»·å€¼**: ä¼ä¸šçº§ç»„ç»‡ç®¡ç†èƒ½åŠ›ï¼Œæ”¯æŒè§„æ¨¡åŒ–æ‰©å±•  

**ä¸‹æ¬¡å®¡æŸ¥**: å®æ–½å¯åŠ¨åæ¯å‘¨è¿›è¡Œè¿›åº¦å®¡æŸ¥  
**åé¦ˆæ¸ é“**: æ¶æ„å›¢é˜Ÿå’Œäº§å“å›¢é˜ŸååŒè¯„ä¼°