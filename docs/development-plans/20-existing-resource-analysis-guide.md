# 现有资源分析开发指南

**文档编号**: 20  
**创建时间**: 2025-09-09 09:40  
**维护团队**: 全栈开发团队  
**优先级**: P1 - 强制执行原则

## 📋 **指南概述**

本指南规定了开发过程中强制执行的现有资源分析原则，确保开发团队优先使用现有API、函数、组件，避免重复创建相同功能的资源。

## 🎯 **核心原则**

### **优先使用原则**
- ✅ **分析优先**: 开发任何功能前，必须深度分析提供的上下文文件和现有代码库
- ✅ **优先使用**: 如果存在可用的API、接口、函数、组件，必须直接使用
- ✅ **创建条件**: 只有在确认不存在可用资源后，才能提出创建新函数/组件的建议

### **禁止重复创建**
- ❌ **严格禁止**: 在存在可用资源时重复创建相同功能
- ❌ **忽视现有**: 不分析上下文文件就直接提出创建新函数/组件
- ❌ **无效劳动**: 跳过资源分析步骤

## 🔍 **资源分析检查清单**

### **第一步: 上下文文件分析**
```yaml
检查项目:
  - 用户提供的上下文文件中的API端点
  - 现有函数和方法定义
  - 组件和Hook的可用性
  - 类型定义和接口
  - 工具函数和配置
```

### **第二步: API端点存在性验证**
```yaml
REST API检查:
  - docs/api/openapi.yaml 中的端点定义
  - 现有CRUD操作的可用性
  - 权限和认证要求

GraphQL API检查:
  - docs/api/schema.graphql 中的查询定义  
  - 现有查询和变更操作
  - 字段和类型的匹配度
```

### **第三步: 代码库搜索**
```yaml
搜索范围:
  后端 (Go):
    - cmd/ 目录下的服务实现
    - internal/ 目录下的通用包
    - 数据库操作和业务逻辑

  前端 (TypeScript/React):
    - src/shared/ 目录下的通用组件和Hook
    - src/features/ 目录下的特性组件
    - API客户端和类型定义

搜索工具:
  - Grep: 搜索函数名、类名、接口名
  - Glob: 查找相关文件和模块
  - Read: 分析具体实现和接口
```

### **第四步: 组件复用检查**
```yaml
前端资源:
  Hook:
    - useOrganizations: 组织数据获取
    - useEnterpriseOrganizations: 企业级组织Hook
    - useOrganizationMutations: CRUD操作Hook
    - useTemporalAPI: 时态数据操作

  组件:
    - shared/components/ 下的通用组件
    - OrganizationActions: 操作按钮组件
    - StatusBadge: 状态显示组件
    - MessageDisplay: 消息显示组件

  工具函数:
    - shared/utils/ 下的工具函数
    - temporal-converter: 时态数据转换
    - organization-helpers: 组织数据处理
    - statusUtils: 状态处理工具

  类型定义:
    - shared/types/ 下的TypeScript接口
    - organization.ts: 组织数据类型
    - temporal.ts: 时态数据类型
    - api.ts: API响应类型
```

### **第五步: 配置和常量分析**
```yaml
配置文件:
  - shared/config/ports.ts: 统一端口配置
  - shared/config/environment.ts: 环境配置
  - shared/config/tenant.ts: 租户配置

常量定义:
  - shared/utils/colorTokens.ts: 颜色常量
  - 枚举类型和状态常量
  - API端点URL常量
```

## 📋 **实际操作流程**

### **开发前必执行步骤**

#### **Step 1: 深度分析上下文**
1. **仔细阅读**用户提供的所有上下文文件
2. **识别关键需求**和功能范围
3. **列出所需**的API、函数、组件

#### **Step 2: 现有资源搜索**
1. **使用Grep工具**搜索相关关键词
2. **使用Glob工具**查找相关文件
3. **使用Read工具**分析具体实现

#### **Step 3: 匹配度评估**
1. **完全匹配**: 直接使用现有资源
2. **部分匹配**: 扩展现有功能
3. **无匹配**: 才考虑创建新资源

#### **Step 4: 使用决策**
```yaml
决策树:
  完全可用?
    是 → 直接使用
    否 → 检查是否可扩展
      可扩展?
        是 → 扩展现有功能
        否 → 创建新资源 (最后选择)
```

## 🚨 **常见违规案例**

### **❌ 错误做法**
```yaml
场景: 需要组织数据获取功能
错误行为:
  - 直接提出创建新的useOrganizationData Hook
  - 不检查现有的useOrganizations Hook
  - 重复实现相同的API调用逻辑

正确行为:
  - 分析现有useOrganizations Hook的功能
  - 检查useEnterpriseOrganizations的适用性
  - 使用现有Hook或基于现有Hook扩展
```

### **❌ 忽视现有API**
```yaml
场景: 需要创建组织操作
错误行为:  
  - 不检查REST API规范文档
  - 直接提出设计新的API端点
  - 忽视GraphQL查询的可用性

正确行为:
  - 查阅docs/api/openapi.yaml确认现有端点
  - 分析现有CRUD操作的完整性
  - 基于现有API契约进行开发
```

## 🎯 **成功实践指南**

### **✅ 最佳实践**

#### **1. 系统性分析**
- 从API契约文档开始分析
- 系统性检查shared目录下的资源
- 完整评估现有Hook和组件的功能覆盖

#### **2. 渐进式复用**
- 优先使用完全匹配的资源
- 其次考虑扩展现有功能
- 最后才创建全新资源

#### **3. 文档化决策**
- 记录资源分析过程
- 说明选择现有资源的原因
- 或解释为什么需要创建新资源

## 📊 **质量检查标准**

### **Code Review检查点**
- [ ] 是否分析了现有API端点的可用性?
- [ ] 是否检查了shared目录下的相关资源?
- [ ] 是否评估了现有Hook和组件的复用性?
- [ ] 如果创建新资源，是否有充分的理由?
- [ ] 新资源是否与现有架构保持一致?

### **自动化验证**
- P3防控系统会检测重复代码和功能
- CI/CD流程会验证API契约一致性
- Pre-commit Hook会提醒检查现有资源

## 🔧 **工具支持**

### **开发工具**
- **VSCode插件**: 支持快速搜索和导航
- **Grep工具**: 高效的代码搜索
- **API文档**: OpenAPI和GraphQL规范文档

### **自动化工具**
- **重复代码检测**: jscpd工具识别重复实现
- **架构守护**: 验证设计一致性
- **质量门禁**: 阻止违规代码合并

---

## 📋 **总结**

现有资源分析是提高开发效率、避免重复劳动、保持代码库一致性的关键实践。通过强制执行这一原则，我们确保：

- ✅ **提高开发效率**: 复用现有成果，减少重复开发
- ✅ **保持代码一致性**: 统一的API使用和组件复用
- ✅ **降低维护成本**: 减少重复代码，简化维护工作
- ✅ **提升代码质量**: 基于经过验证的现有实现

**记住**: 在Cube Castle项目中，优先使用现有资源不是建议，而是强制要求。

---

**文档维护**: 全栈开发团队  
**执行监督**: P3企业级防控系统  
**相关文档**: 
- `CLAUDE.md` - 项目开发指导原则
- `docs/development-plans/06-integrated-teams-progress-log.md` - 团队进展日志