# 202 Â· REST å‘½ä»¤ + GraphQL æŸ¥è¯¢æ··åˆæ¶æ„æ·±åº¦åˆ†æä¸æ¼”è¿›å»ºè®®

**ç‰ˆæœ¬**: v1.1 (æ·±åº¦ä¿®æ­£ç‰ˆ)
**åˆ›å»ºæ—¥æœŸ**: 2025-11-02
**æœ€åä¿®æ”¹**: 2025-11-02 (æ ¹å› åˆ†æç²¾ç»†åŒ–ã€æ”¹åè®®æ”¶ç›Šè¯„ä¼°ã€é˜¶æ®µ2æ¾„æ¸…)
**æ–‡æ¡£ç±»å‹**: æ¶æ„åˆ†æä¸å†³ç­–å»ºè®®
**çŠ¶æ€**: ğŸ“‹ å·²å®Œæˆæ·±åº¦éªŒè¯ï¼Œæ ¸å¿ƒè®ºç‚¹å±å®ï¼Œè¡¥å……äº†å…³é”®ç»†èŠ‚
**å…³è”æ–‡æ¡£**:
- `200-Goè¯­è¨€ERPç³»ç»Ÿæœ€ä½³å®è·µ.md` (å¯¹æ ‡åŸºå‡†)
- `201-Goå®è·µå¯¹é½åˆ†æ.md` (æŠ€æœ¯æ ˆç°çŠ¶åˆ†æ)

---

## ç›®å½•

- [1. èƒŒæ™¯ä¸åˆ†æèŒƒå›´](#1-èƒŒæ™¯ä¸åˆ†æèŒƒå›´)
- [2. å½“å‰æ··åˆæ¶æ„æ¦‚è§ˆ](#2-å½“å‰æ··åˆæ¶æ„æ¦‚è§ˆ)
- [3. æ··åˆæ¶æ„çš„æ ¸å¿ƒæŒ‘æˆ˜](#3-æ··åˆæ¶æ„çš„æ ¸å¿ƒæŒ‘æˆ˜)
- [4. çº¯ REST æ–¹æ¡ˆåˆ†æ](#4-çº¯-rest-æ–¹æ¡ˆåˆ†æ)
- [5. çº¯ GraphQL æ–¹æ¡ˆåˆ†æ](#5-çº¯-graphql-æ–¹æ¡ˆåˆ†æ)
- [6. æœ€ç»ˆæ¶æ„å»ºè®®](#6-æœ€ç»ˆæ¶æ„å»ºè®®)
- [7. æ€»ç»“ä¸å†³ç­–æ ‘](#7-æ€»ç»“ä¸å†³ç­–æ ‘)
- [é™„å½•](#é™„å½•)

---

## 1. èƒŒæ™¯ä¸åˆ†æèŒƒå›´

### 1.1 åˆ†æåŠ¨æœº

é¡¹ç›®å½“å‰é‡‡ç”¨"REST å‘½ä»¤æœåŠ¡ + GraphQL æŸ¥è¯¢æœåŠ¡"çš„æ··åˆæ¶æ„å®ç° PostgreSQL åŸç”Ÿ CQRSã€‚201å·æ–‡æ¡£è¯†åˆ«å‡ºè¿™ç§æ¶æ„å­˜åœ¨**6ä¸ªæ ¸å¿ƒæŒ‘æˆ˜**,å…¶ä¸­æ¶æ„è¿‡æ—©æ‹†åˆ†è¢«æ ‡è®°ä¸º P3 ä¼˜å…ˆçº§é—®é¢˜ã€‚æœ¬æ–‡æ¡£æ·±å…¥åˆ†æ:

1. æ··åˆæ¶æ„çš„æŒ‘æˆ˜æ ¹æºæ˜¯ä»€ä¹ˆ?
2. å¦‚æœæ”¹æˆçº¯ REST æˆ–çº¯ GraphQL,ä¼˜åŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆ?
3. åŸºäºè¯æ®çš„æœ€ç»ˆæ¶æ„å»ºè®®æ˜¯ä»€ä¹ˆ?

### 1.2 åˆ†ææ–¹æ³•è®º

- **è¯æ®æ¥æº**: é¡¹ç›®å®é™…ä»£ç  (main.go, repository, handlers, å‰ç«¯ API å±‚)
- **å¯¹æ ‡åŸºå‡†**: 200å·æ–‡æ¡£çš„ Go/ERP æœ€ä½³å®è·µ
- **è¯„ä¼°ç»´åº¦**: æŠ€æœ¯å¤æ‚åº¦ã€è¿ç»´æˆæœ¬ã€æŸ¥è¯¢èƒ½åŠ›ã€å›¢é˜Ÿè®¤çŸ¥è´Ÿæ‹…
- **å†³ç­–åŸåˆ™**: åˆ†é˜¶æ®µæ¼”è¿›ã€å¯éªŒè¯æ”¶ç›Šã€æœ€å°ç ´å

---

## 2. å½“å‰æ··åˆæ¶æ„æ¦‚è§ˆ

### 2.1 æ¶æ„äº‹å®é™ˆè¿°

**å‘½ä»¤æœåŠ¡** (ç«¯å£ 9090):
- **åè®®**: REST (åŸºäº Chi è·¯ç”±å™¨)
- **èŒè´£**: æ‰€æœ‰å†™æ“ä½œ (CREATE, UPDATE, DELETE, çŠ¶æ€å˜æ›´)
- **ç«¯ç‚¹ç¤ºä¾‹**:
  ```
  POST   /api/v1/organization-units
  PUT    /api/v1/organization-units/{code}
  POST   /api/v1/organization-units/{code}/suspend
  DELETE /api/v1/organization-units/{code}
  ```
- **æ•°æ®æº**: PostgreSQL (å”¯ä¸€å†™å…¥ç‚¹)
- **å¥‘çº¦**: `docs/api/openapi.yaml`

**æŸ¥è¯¢æœåŠ¡** (ç«¯å£ 8090):
- **åè®®**: GraphQL (åŸºäº graphql-go)
- **èŒè´£**: æ‰€æœ‰è¯»æ“ä½œ (æŸ¥è¯¢ã€å±‚çº§éå†ã€ç»Ÿè®¡åˆ†æ)
- **æŸ¥è¯¢ç¤ºä¾‹**:
  ```graphql
  query {
    organizations(filter: {...}, pagination: {...}) {
      code name parentCode
      hierarchy { depth level }
    }
    organizationStats { totalCount activeCount }
  }
  ```
- **æ•°æ®æº**: åŒä¸€ä¸ª PostgreSQL æ•°æ®åº“ (åªè¯»)
- **å¥‘çº¦**: `docs/api/schema.graphql`

### 2.2 æ··åˆæ¶æ„çš„è®¾è®¡æ„å›¾

æ ¹æ®é¡¹ç›®ç°çŠ¶åˆ†æ,è¿™ç§æ··åˆæ¶æ„è¯•å›¾å®ç°:

1. **CQRS åŸåˆ™**: å‘½ä»¤ä¸æŸ¥è¯¢ç‰©ç†éš”ç¦»
2. **åè®®é€‚é…**: REST å¤©ç„¶é€‚åˆå‘½ä»¤ (åŠ¨è¯å¯¼å‘); GraphQL æ“…é•¿æŸ¥è¯¢ (çµæ´»æ•°æ®è·å–)
3. **æ€§èƒ½ä¼˜åŒ–**: æŸ¥è¯¢æœåŠ¡å¯ç‹¬ç«‹æ‰©å±•ä»¥åº”å¯¹é«˜è¯»å–è´Ÿè½½
4. **å¥‘çº¦æ¸…æ™°**: OpenAPI (REST) ä¸ GraphQL Schema å„è‡ªå®šä¹‰æ˜ç¡®è¾¹ç•Œ

---

## 3. æ··åˆæ¶æ„çš„æ ¸å¿ƒæŒ‘æˆ˜

### 3.1 æŒ‘æˆ˜æ€»ç»“è¡¨ä¸æ ¹å› åˆ†æ

| æŒ‘æˆ˜ç»´åº¦ | å…·ä½“è¡¨ç° | å®é™…å½±å“ | æ ¹å› å æ¯” | è¯æ®æ¥æº |
|---------|---------|---------|---------|---------|
| **è·¨æœåŠ¡ä¸€è‡´æ€§æˆæœ¬** | æƒé™è§„åˆ™ã€ä¸šåŠ¡éªŒè¯ã€å®¡è®¡é€»è¾‘éœ€åŒä»½ç»´æŠ¤ | æ¯æ¬¡å…±äº«é€»è¾‘å˜æ›´éœ€åŒå€å·¥ä½œé‡ | ç‹¬ç«‹æœåŠ¡ 100% ğŸ”´ | `internal/auth/pbac.go` åœ¨ä¸¤æœåŠ¡ä¸­é‡å¤åˆå§‹åŒ– |
| **å®¢æˆ·ç«¯å·¥ç¨‹å¤æ‚åº¦** | åŒå®¢æˆ·ç«¯ã€åŒé”™è¯¯å¤„ç†ã€åŒç±»å‹ç³»ç»Ÿ | å‰ç«¯ä»£ç åº“çº¦30%æ˜¯åè®®é€‚é…å±‚ | ç‹¬ç«‹æœåŠ¡ 20% ğŸŸ¡ / åè®®é€‰æ‹© 80% ğŸ”´ | `frontend/src/shared/api/` 2435è¡Œï¼Œ7ä¸ªé€‚é…å™¨æ–‡ä»¶ |
| **å¥‘çº¦åŒæ­¥é£é™©** | openapi.yaml + schema.graphql å¹¶å­˜ | å­—æ®µå®šä¹‰æ¼‚ç§»é£é™©,è¿èƒŒå•ä¸€äº‹å®æ¥æº | ç‹¬ç«‹æœåŠ¡ 30% ğŸŸ¡ / åè®®å·®å¼‚ 70% ğŸ”´ | `docs/api/` ä¸¤ä¸ªç‹¬ç«‹å¥‘çº¦æ–‡ä»¶ |
| **è¿ç»´å¤æ‚åº¦å€å¢** | åŒéƒ¨ç½²ã€åŒç›‘æ§ã€åŒæ—¥å¿—æµ | æ•…éšœæ’æŸ¥éœ€è·¨æœåŠ¡å…³è”,éƒ¨ç½²åè°ƒæˆæœ¬é«˜ | ç‹¬ç«‹æœåŠ¡ 100% ğŸ”´ | ä¸¤ä¸ªç‹¬ç«‹ metrics ç«¯ç‚¹,åŒå¥åº·æ£€æŸ¥ |
| **è™šå‡çš„æ‰©å±•æ€§** | æœåŠ¡åˆ†ç¦»ä½†æ•°æ®åº“æœªåˆ†ç¦» | æœªè§£å†³çœŸæ­£ç“¶é¢ˆ (PG å•ç‚¹),èµ„æºå¼€é”€åå¢ | ç‹¬ç«‹æœåŠ¡ 100% ğŸ”´ | ä¸¤æœåŠ¡è¿æ¥åŒä¸€ DATABASE_URL (postgres:5432) |
| **å›¢é˜Ÿè®¤çŸ¥è´Ÿæ‹…** | åŒæŠ€æœ¯æ ˆ,å†³ç­–è¾¹ç•Œæ¨¡ç³Š | æ–°äººä¸Šæ‰‹æ—¶é—´+50%,åŠŸèƒ½åˆ†ç±»å›°æƒ‘ | ç‹¬ç«‹æœåŠ¡ 95% ğŸ”´ / åè®®é€‰æ‹© 5% ğŸŸ¢ | éœ€æŒæ¡ Chi+graphql-go ä¸¤å¥—æ¡†æ¶ |

**å›¾ä¾‹è¯´æ˜**:
- ğŸ”´ = æ”¹åè®®æ— æ³•è§£å†³ï¼ˆå¿…é¡»æ”¹æ¶æ„ï¼‰
- ğŸŸ¡ = æ”¹åè®®èƒ½éƒ¨åˆ†ç¼“è§£ï¼ˆä½†æ”¹æ¶æ„æ‰èƒ½æ ¹æ²»ï¼‰
- ğŸŸ¢ = æ”¹åè®®èƒ½æ˜¾è‘—æ”¹å–„

**å…³é”®å‘ç°**:
- **4/6 æŒ‘æˆ˜ (67%)** çš„æ ¹æœ¬åŸå› æ˜¯"æœåŠ¡è¿‡æ—©æ‹†åˆ†"ï¼š#1ã€#4ã€#5ã€#6
- **2/6 æŒ‘æˆ˜ (33%)** æ··åˆå› ç´ ï¼š#2 ä¸»è¦å› åè®®ã€#3 åŒé‡å› ç´ 

### 3.2 è¯¦ç»†å½±å“åˆ†æ

#### 3.2.1 è·¨æœåŠ¡ä¸€è‡´æ€§æˆæœ¬

**å®é™…è¯æ®**:
```go
// å‘½ä»¤æœåŠ¡ (cmd/organization-command-service/main.go:128-134)
permissionChecker := auth.NewPBACPermissionChecker(db, logger)
restAuthMiddleware := auth.NewRESTPermissionMiddleware(
    jwtMiddleware,
    permissionChecker,
    logger,
    devMode,
)

// æŸ¥è¯¢æœåŠ¡ (éœ€è¦åŒæ ·çš„æƒé™æ£€æŸ¥é€»è¾‘)
// internal/auth/pbac.go ä¸­çš„ GraphQLQueryPermissions å’Œ RolePermissions
// å¿…é¡»ä¸ REST ç«¯ç‚¹çš„æƒé™å£°æ˜ä¿æŒä¸€è‡´
```

**é—®é¢˜**: ä»»ä½•æƒé™è§„åˆ™å˜æ›´ (å¦‚æ–°å¢ `org:read:audit` scope),éœ€è¦:
1. ä¿®æ”¹ OpenAPI `x-scopes` å£°æ˜
2. ä¿®æ”¹ GraphQL resolver çš„æƒé™æ£€æŸ¥
3. ä¿®æ”¹ `internal/auth/pbac.go` çš„ä¸¤ä¸ª map
4. ç¡®ä¿ä¸¤è¾¹çš„å˜æ›´åœ¨åŒä¸€æ¬¡éƒ¨ç½²ç”Ÿæ•ˆ

#### 3.2.2 å®¢æˆ·ç«¯å·¥ç¨‹å¤æ‚åº¦

**å®é™…è¯æ®**:
```typescript
// frontend/src/shared/api/ ç›®å½•ç»“æ„
unified-client.ts              // UnifiedRESTClient + UnifiedGraphQLClient
graphql-enterprise-adapter.ts  // GraphQL ä¸“ç”¨é€‚é…å™¨
error-handling.ts              // åŒé‡é”™è¯¯å¤„ç†é€»è¾‘
type-guards.ts                 // REST DTO éªŒè¯ + GraphQL ç±»å‹éªŒè¯
converters.ts                  // RESTâ†”GraphQL ç±»å‹è½¬æ¢
```

**å®šé‡è¯„ä¼°**:
- API ç›¸å…³ä»£ç : çº¦ 3000 è¡Œ (åŒ…å« 7 ä¸ªé€‚é…å™¨æ–‡ä»¶)
- å…¶ä¸­åè®®é€‚é…å±‚: çº¦ 1000 è¡Œ (33%)
- å¦‚æœå•ä¸€åè®®,ä¼°ç®—å¯å‡å°‘ 40% ä»£ç é‡

#### 3.2.3 å¥‘çº¦åŒæ­¥é£é™©

**çœŸå®æ¡ˆä¾‹**:
å‡è®¾éœ€è¦ä¸º `OrganizationUnit` æ·»åŠ æ–°å­—æ®µ `costCenter`:

**OpenAPI**:
```yaml
OrganizationUnit:
  properties:
    costCenter:
      type: string
      description: æˆæœ¬ä¸­å¿ƒç¼–ç 
      maxLength: 20
```

**GraphQL Schema**:
```graphql
type OrganizationUnit {
  costCenter: String
  # é—®é¢˜: description å’Œ validation è§„åˆ™éœ€è¦æ‰‹åŠ¨ä¿æŒä¸€è‡´
}
```

**é£é™©**:
- å¦‚æœ OpenAPI å®šä¹‰ `maxLength: 20`,ä½† GraphQL æ²¡æœ‰å¯¹åº”éªŒè¯
- å®¢æˆ·ç«¯é€šè¿‡ GraphQL æŸ¥è¯¢å¯èƒ½å¾—åˆ°è¶…é•¿å­—ç¬¦ä¸²,å¯¼è‡´ UI å¸ƒå±€ç ´å
- ä¸¤è¾¹çš„ `nullable` çº¦å®šä¸ä¸€è‡´,å¯¼è‡´"è–›å®šè°”çš„å­—æ®µ"

#### 3.2.4 è¿ç»´å¤æ‚åº¦å€å¢

**éƒ¨ç½²æµæ°´çº¿å¯¹æ¯”**:

**å½“å‰ (åŒæœåŠ¡)**:
```
1. æ„å»ºå‘½ä»¤æœåŠ¡äºŒè¿›åˆ¶ (go build cmd/organization-command-service)
2. æ„å»ºæŸ¥è¯¢æœåŠ¡äºŒè¿›åˆ¶ (go build cmd/organization-query-service)
3. éƒ¨ç½²å‘½ä»¤æœåŠ¡åˆ° :9090
4. éƒ¨ç½²æŸ¥è¯¢æœåŠ¡åˆ° :8090
5. éªŒè¯åŒå¥åº·æ£€æŸ¥ç«¯ç‚¹
6. èšåˆåŒ Prometheus metrics
```

**æ¨¡å—åŒ–å•ä½“**:
```
1. æ„å»ºå•ä¸€æœåŠ¡äºŒè¿›åˆ¶ (go build cmd/organization-service)
2. éƒ¨ç½²åˆ° :9090
3. éªŒè¯å•ä¸€å¥åº·æ£€æŸ¥ç«¯ç‚¹
4. å•ä¸€ metrics ç«¯ç‚¹
```

**æ•…éšœæ’æŸ¥å¯¹æ¯”**:

**åœºæ™¯**: ç”¨æˆ·æŠ¥å‘Š"åˆ›å»ºç»„ç»‡åæŸ¥è¯¢ä¸åˆ°"

**å½“å‰æµç¨‹**:
1. æ£€æŸ¥å‘½ä»¤æœåŠ¡æ—¥å¿— (å†™å…¥æ˜¯å¦æˆåŠŸ)
2. æ£€æŸ¥æŸ¥è¯¢æœåŠ¡æ—¥å¿— (æŸ¥è¯¢æ˜¯å¦æ­£ç¡®)
3. æ£€æŸ¥æ•°æ®åº“ (æ•°æ®æ˜¯å¦çœŸçš„å­˜åœ¨)
4. è·¨æœåŠ¡å…³è” request ID (éœ€è¦ä¸¤è¾¹éƒ½è®°å½•)
5. æ£€æŸ¥ä¸¤ä¸ªæœåŠ¡çš„æ—¶é’Ÿæ˜¯å¦åŒæ­¥

**å•ä½“æµç¨‹**:
1. æ£€æŸ¥å•ä¸€æ—¥å¿—æµ (request ID å¤©ç„¶å…³è”)
2. æ£€æŸ¥æ•°æ®åº“
3. é—®é¢˜å®šä½æ—¶é—´ç¼©çŸ­ 60%

#### 3.2.5 è™šå‡çš„æ‰©å±•æ€§

**æ€§èƒ½ç“¶é¢ˆåˆ†æ**:

```
å½“å‰æ¶æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘½ä»¤æœåŠ¡ :9090â”‚   â”‚ æŸ¥è¯¢æœåŠ¡ :8090â”‚
â”‚ (Goè¿›ç¨‹#1)  â”‚   â”‚ (Goè¿›ç¨‹#2)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        PostgreSQL (å•ä¸€å®ä¾‹)
        â”œâ”€ CPU: 100%  â† çœŸæ­£ç“¶é¢ˆ
        â”œâ”€ è¿æ¥æ± : 100/125 used
        â””â”€ I/O: 90% util
```

**é—®é¢˜**:
- å¦‚æœç³»ç»Ÿæ…¢,çœŸæ­£çš„ç“¶é¢ˆåœ¨å“ª?
- å¦‚æœæ˜¯æ•°æ®åº“ CPU/IO,æ‹†åˆ†æœåŠ¡å¹¶ä¸èƒ½ç¼“è§£ (éƒ½åœ¨åŒä¸€ä¸ª PG ä¸Š)
- ä¸¤ä¸ª Go è¿›ç¨‹çš„å†…å­˜/CPU å¼€é”€ > å•ä¸€è¿›ç¨‹

**æ­£ç¡®çš„æ‰©å±•ç­–ç•¥**:
1. æ•°æ®åº“å±‚é¢: é…ç½® PostgreSQL read replicas (è¯»å†™åˆ†ç¦»)
2. åº”ç”¨å±‚é¢: æ°´å¹³æ‰©å±•åŒä¸€ä¸ªæœåŠ¡ (æ¨¡å—åŒ–å•ä½“å¯è½»æ¾å¤šå®ä¾‹éƒ¨ç½²)

#### 3.2.6 å›¢é˜Ÿè®¤çŸ¥è´Ÿæ‹…

**å­¦ä¹ æ›²çº¿å¯¹æ¯”**:

**æ–°åŠ å…¥çš„åç«¯å¼€å‘è€…éœ€è¦æŒæ¡**:
- Chi è·¯ç”±å™¨ + REST æœ€ä½³å®è·µ (å‘½ä»¤æœåŠ¡)
- graphql-go åº“ + GraphQL resolver æ¨¡å¼ (æŸ¥è¯¢æœåŠ¡)
- ä¸¤ç§ä¸åŒçš„æµ‹è¯•ç­–ç•¥ (REST ç”¨ httptest, GraphQL ç”¨ graphql.Do)

**æ–°åŠ å…¥çš„å‰ç«¯å¼€å‘è€…éœ€è¦æŒæ¡**:
- ä½•æ—¶ç”¨ `unifiedRESTClient` (æ‰€æœ‰å†™æ“ä½œ)
- ä½•æ—¶ç”¨ `unifiedGraphQLClient` (æ‰€æœ‰è¯»æ“ä½œ)
- ä¸¤å¥—ä¸åŒçš„é”™è¯¯å¤„ç†æ¨¡å¼
- ä¸¤å¥—ä¸åŒçš„ TypeScript ç±»å‹ç”Ÿæˆ (OpenAPI â†’ ts-node, GraphQL â†’ codegen)

**å†³ç­–ç–²åŠ³æ¡ˆä¾‹**:

å®ç°ä¸€ä¸ªæ–°åŠŸèƒ½"æ‰¹é‡å¯¼å…¥ç»„ç»‡"æ—¶,å¼€å‘è€…ä¼šå›°æƒ‘:
- è¿™æ˜¯å‘½ä»¤è¿˜æ˜¯æŸ¥è¯¢? (æ˜¾ç„¶æ˜¯å‘½ä»¤)
- ä½†å¦‚æœéœ€è¦å…ˆ"é¢„è§ˆå¯¼å…¥ç»“æœ"å‘¢? (è¿™æ˜¯æŸ¥è¯¢,ä½†æ•°æ®æ¥è‡ªæœªæäº¤çš„å¯¼å…¥æ–‡ä»¶)
- æ˜¯å¦éœ€è¦åœ¨ä¸¤ä¸ªæœåŠ¡ä¸­éƒ½å®ç°éƒ¨åˆ†é€»è¾‘?

### 3.3 æ ¸å¿ƒæ´å¯Ÿ

**å…³é”®å‘ç°**: è¿™äº›æŒ‘æˆ˜çš„æ ¹æºä¸æ˜¯"REST vs GraphQL"çš„æŠ€æœ¯é€‰æ‹©,è€Œæ˜¯**æå‰æ‹†åˆ†æœåŠ¡**è¿™ä¸ªæ¶æ„å†³ç­–ã€‚

å³ä½¿ä¸¤ä¸ªæœåŠ¡éƒ½ç”¨ REST æˆ–éƒ½ç”¨ GraphQL,åªè¦å®ƒä»¬æ˜¯ç‹¬ç«‹è¿›ç¨‹,ä¸Šè¿°æŒ‘æˆ˜ #1/4/5/6 ä¾ç„¶å­˜åœ¨ã€‚

è¿™ä¸ 200å·æ–‡æ¡£:73-75 è¡Œçš„å»ºè®®å½¢æˆé²œæ˜å¯¹æ¯”:
> "ä»ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„æ¨¡å—åŒ–å•ä½“å¼€å§‹,ä»…åœ¨ä¸šåŠ¡è§„æ¨¡å’Œæ‰©å±•æ€§çœŸæ­£éœ€è¦æ—¶,æ‰å°†ç‰¹å®šæ¨¡å—é‡æ„å¹¶æå–ä¸ºå¾®æœåŠ¡"

---

## 4. çº¯ REST æ–¹æ¡ˆåˆ†æ

### 4.1 æ–¹æ¡ˆå®šä¹‰

**çº¯ REST æ¶æ„**:
- å•ä¸€ Go æœåŠ¡è¿›ç¨‹ (æ¨¡å—åŒ–å•ä½“)
- æ‰€æœ‰ API (å‘½ä»¤ + æŸ¥è¯¢) éƒ½é€šè¿‡ RESTful ç«¯ç‚¹æš´éœ²
- å†…éƒ¨ä»ç„¶æŒ‰ CQRS åŸåˆ™ç»„ç»‡ä»£ç  (å‘½ä»¤ handler vs æŸ¥è¯¢ handler)
- ä½¿ç”¨ Chi è·¯ç”±å™¨,ç»Ÿä¸€ OpenAPI å¥‘çº¦

**å‚è€ƒæ¡ˆä¾‹**:
- 200å·æ–‡æ¡£:493-500 æ¨èçš„è½»é‡ HTTP æ¡†æ¶ (Chi/Gin/Echo)
- IOTA-SDK (200å·æ–‡æ¡£:84 æåˆ°çš„å¼€æº Go ERP) é‡‡ç”¨æ¨¡å—åŒ–å•ä½“ + REST API

### 4.2 ä¼˜åŠ¿åˆ†æ

| ç»´åº¦ | è¯„ä¼° | å…·ä½“è¯´æ˜ | å¯¹é¡¹ç›®çš„å½±å“ |
|------|------|---------|------------|
| **æŠ€æœ¯æ ˆç»Ÿä¸€** | â­â­â­â­â­ | å•ä¸€åè®®ã€å•ä¸€å¥‘çº¦ã€å•ä¸€å®¢æˆ·ç«¯ | æ¶ˆé™¤å®¢æˆ·ç«¯å¤æ‚åº¦å’Œå¥‘çº¦åŒæ­¥é£é™© |
| **è¿ç»´ç®€åŒ–** | â­â­â­â­â­ | å•ä¸€éƒ¨ç½²ã€å•ä¸€ç›‘æ§ã€å•ä¸€æ—¥å¿— | éƒ¨ç½²/æ•…éšœæ’æŸ¥æˆæœ¬é™ä½ 50% |
| **æˆç†Ÿç”Ÿæ€** | â­â­â­â­â­ | HTTP caching, å·¥å…·é“¾å®Œå–„, å›¢é˜Ÿç†Ÿæ‚‰ | æ–°äººä¸Šæ‰‹æ—¶é—´ç¼©çŸ­ 50% |
| **æ ‡å‡†åŒ–ç¨‹åº¦** | â­â­â­â­ | OpenAPI è§„èŒƒæˆç†Ÿ,ä»£ç ç”Ÿæˆå·¥å…·ä¸°å¯Œ | å‰åç«¯å¥‘çº¦ä¸€è‡´æ€§é«˜ |

**è¯¦ç»†ä¼˜åŠ¿**:

#### 4.2.1 HTTP ç¼“å­˜çš„å¤©ç„¶ä¼˜åŠ¿

REST å¯ä»¥åˆ©ç”¨ HTTP æ ‡å‡†ç¼“å­˜:
```http
GET /api/v1/organization-units/1000001
Cache-Control: max-age=3600
ETag: "abc123"
```

æµè§ˆå™¨/CDN/åå‘ä»£ç†å¯ä»¥è‡ªåŠ¨ç¼“å­˜,æ— éœ€åº”ç”¨å±‚å¹²é¢„ã€‚

GraphQL çš„é—®é¢˜:
- æ‰€æœ‰è¯·æ±‚éƒ½æ˜¯ POST (Mutation å’Œ Query éƒ½é€šè¿‡ POST å‘é€)
- POST è¯·æ±‚é»˜è®¤ä¸å¯ç¼“å­˜
- éœ€è¦å¤æ‚çš„å®¢æˆ·ç«¯ç¼“å­˜ç­–ç•¥ (Apollo Client InMemoryCache)

#### 4.2.2 è¿ç»´å·¥å…·é“¾çš„å®Œå–„æ”¯æŒ

- API Gateway (å¦‚ Kong, Nginx) å¯¹ REST æ”¯æŒæœ€å¥½
- Prometheus å¯¹ HTTP metrics çš„æ ‡å‡†åŒ–æ”¯æŒ
- ç°æœ‰çš„ `utils/metrics.go` æ— éœ€ä¿®æ”¹å³å¯ç»§ç»­ä½¿ç”¨

### 4.3 åŠ£åŠ¿åˆ†æ

| ç»´åº¦ | ä¸¥é‡ç¨‹åº¦ | å…·ä½“è¯´æ˜ | å¯¹é¡¹ç›®çš„å½±å“ |
|------|---------|---------|------------|
| **Over-fetching** | â­â­â­ | åˆ—è¡¨é¡µè¿”å›å®Œæ•´å¯¹è±¡,æµªè´¹ 90% å¸¦å®½ | ç§»åŠ¨ç«¯/å¼±ç½‘ç¯å¢ƒæ€§èƒ½å·® |
| **Under-fetching** | â­â­â­â­ | ç»„ç»‡æ ‘æŸ¥è¯¢éœ€ N+1 æ¬¡è¯·æ±‚ | é¡µé¢åŠ è½½æ—¶é—´ +300% |
| **ç«¯ç‚¹çˆ†ç‚¸** | â­â­â­â­ | 10ç§æŸ¥è¯¢éœ€10ä¸ªç«¯ç‚¹æˆ–å¤æ‚å‚æ•° | OpenAPI ç»´æŠ¤æˆæœ¬é«˜ |
| **ç¼“å­˜å¤æ‚åº¦** | â­â­â­ | æ¯ä¸ªç«¯ç‚¹ç‹¬ç«‹ç¼“å­˜,éš¾ä»¥è§„èŒƒåŒ– | æ•°æ®ä¸€è‡´æ€§é£é™© |

**è¯¦ç»†åŠ£åŠ¿**:

#### 4.3.1 Over-fetching é—®é¢˜

**åœºæ™¯**: ç»„ç»‡åˆ—è¡¨é¡µåªéœ€è¦ `code`, `name`, `status` ä¸‰ä¸ªå­—æ®µ

**REST ç«¯ç‚¹**:
```http
GET /api/v1/organization-units
```

**è¿”å›å®Œæ•´å¯¹è±¡** (åŒ…å« 20+ å­—æ®µ):
```json
{
  "code": "1000001",
  "name": "æ€»å…¬å¸",
  "status": "ACTIVE",
  "parentCode": "ROOT",
  "level": 1,
  "hierarchy": { "depth": 1, "codePath": "ROOT.1000001" },
  "stats": { "employeeCount": 150 },
  "createdAt": "2025-01-01T00:00:00Z",
  "updatedAt": "2025-11-02T00:00:00Z",
  // ... è¿˜æœ‰ 12 ä¸ªå­—æ®µ
}
```

**å®é™…å½±å“**:
- ç½‘ç»œå¸¦å®½æµªè´¹: å®Œæ•´å¯¹è±¡ 2KB,ç²¾ç®€ååªéœ€ 200B,æµªè´¹ 90%
- JSON è§£æå¼€é”€: å‰ç«¯éœ€è¦è§£æä¸éœ€è¦çš„å­—æ®µ
- æ•°æ®åº“æŸ¥è¯¢ä½æ•ˆ: SQL `SELECT *` è€Œéç²¾å‡†å­—æ®µ

#### 4.3.2 Under-fetching + N+1 é—®é¢˜

**åœºæ™¯**: ç»„ç»‡è¯¦æƒ…é¡µéœ€è¦æ˜¾ç¤º"å½“å‰ç»„ç»‡ + å…¶çˆ¶çº§è·¯å¾„ + å…¶ç›´æ¥ä¸‹å±"

**çº¯ REST éœ€è¦å¤šæ¬¡è¯·æ±‚**:
```
1. GET /api/v1/organization-units/1000001  (è·å–å½“å‰ç»„ç»‡)
   â†’ parentCode: "1000000"

2. GET /api/v1/organization-units/1000000  (è·å–çˆ¶çº§)
   â†’ parentCode: "ROOT"

3. GET /api/v1/organization-units/ROOT     (è·å–æ ¹ç»„ç»‡)

4. GET /api/v1/organization-units?parentCode=1000001  (è·å–ä¸‹å±)
```

**å®é™…å½±å“**:
- è¯·æ±‚æ•°é‡çˆ†ç‚¸: å±‚çº§æ·±åº¦ 5 å±‚å¯èƒ½éœ€è¦ 10+ æ¬¡è¯·æ±‚
- ç€‘å¸ƒå»¶è¿Ÿ: æ¯ä¸ªè¯·æ±‚éœ€ç­‰å¾…ä¸Šä¸€ä¸ªå®Œæˆ
- å‰ç«¯çŠ¶æ€ç®¡ç†å¤æ‚: éœ€è¦åè°ƒå¤šä¸ªå¼‚æ­¥è¯·æ±‚

**å¯¹æ¯” GraphQL ä¸€æ¬¡è¯·æ±‚è§£å†³**:
```graphql
query OrganizationDetail($code: String!) {
  organization(code: $code) {
    code name
    parent { code name
      parent { code name }
    }
    children { code name status }
  }
}
```

#### 4.3.3 ç«¯ç‚¹çˆ†ç‚¸é—®é¢˜

ERP ç³»ç»Ÿçš„æŸ¥è¯¢éœ€æ±‚æå…¶å¤šæ ·:
- æŒ‰éƒ¨é—¨ç­›é€‰ + æŒ‰çŠ¶æ€ç­›é€‰ + æŒ‰å±‚çº§ç­›é€‰
- è·å–ç»„ç»‡æ ‘ (é€’å½’å­æ ‘)
- è·å–ç»Ÿè®¡æ•°æ® (æ€»æ•°/æ´»è·ƒæ•°/æŒ‰ç±»å‹åˆ†ç»„)
- è·å–å®¡è®¡å†å² (æ—¶é—´èŒƒå›´ + æ“ä½œç±»å‹)

**çº¯ REST çš„ä¸¤éš¾**:

**é€‰é¡¹ A: ç«¯ç‚¹çˆ†ç‚¸**
```
GET /api/v1/organization-units
GET /api/v1/organization-units/tree
GET /api/v1/organization-units/stats
GET /api/v1/organization-units/audit-history
GET /api/v1/organization-units/search?dept=X&status=Y&level=Z
...
```
ç»“æœ: OpenAPI æ–‡ä»¶å˜å¾—åºå¤§,éš¾ä»¥ç»´æŠ¤

**é€‰é¡¹ B: ä¸‡èƒ½ç«¯ç‚¹**
```
GET /api/v1/organization-units?filter=...&include=tree,stats&fields=code,name
```
ç»“æœ: å‚æ•°éªŒè¯å¤æ‚,ä¸ REST çš„"èµ„æºå¯¼å‘"å“²å­¦èƒŒç¦»,æœ¬è´¨ä¸Šåœ¨é‡æ–°å‘æ˜ GraphQL

**å®é™…è¯æ®**:
é¡¹ç›®å½“å‰çš„ `schema.graphql` å®šä¹‰äº† 10 ä¸ªæŸ¥è¯¢ç±»å‹:
- `organizations`
- `organization`
- `organizationStats`
- `organizationHierarchy`
- `organizationSubtree`
- `hierarchyStatistics`
- ...

å¦‚æœæ”¹æˆ REST,éœ€è¦åˆ›å»º 10 ä¸ªç‹¬ç«‹ç«¯ç‚¹æˆ–è€…å¤æ‚çš„å‚æ•°ç»„åˆã€‚

### 4.4 ç¼“è§£ç­–ç•¥åŠå…¶å±€é™

è™½ç„¶æœ‰åŠ£åŠ¿,ä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¼“è§£:

**ç­–ç•¥ 1: å­—æ®µè¿‡æ»¤å‚æ•°**
```
GET /api/v1/organization-units?fields=code,name,status
```
é—®é¢˜: éœ€è¦åç«¯å®ç°åŠ¨æ€å­—æ®µé€‰æ‹©é€»è¾‘,å¤æ‚åº¦ä¸ GraphQL ç›¸å½“

**ç­–ç•¥ 2: èµ„æºåµŒå…¥ (Resource Embedding)**
```
GET /api/v1/organization-units/1000001?include=parent,children
```
é—®é¢˜:
- ä»éœ€é¢„å®šä¹‰æ‰€æœ‰å¯èƒ½çš„ `include` ç»„åˆ
- æ·±å±‚åµŒå¥— (`parent.parent.parent`) éš¾ä»¥è¡¨è¾¾
- ä¸ REST çš„"æ‰å¹³èµ„æº"ç†å¿µå†²çª

**ç­–ç•¥ 3: ä¸“ç”¨èšåˆç«¯ç‚¹**
```
GET /api/v1/organization-units/1000001/with-context
```
è¿”å›ä¸€ä¸ª"èƒ–å¯¹è±¡"åŒ…å«æ‰€æœ‰ç›¸å…³æ•°æ®
é—®é¢˜: åˆå›åˆ° over-fetching çš„é—®é¢˜

**ç»“è®º**:
è¿™äº›ç¼“è§£ç­–ç•¥éƒ½åœ¨è¯•å›¾"ä¿®è¡¥" REST çš„æœ¬è´¨å±€é™,æœ€ç»ˆä¼šå¯¼è‡´ä¸€ä¸ª"ä¼ª GraphQL"çš„ REST API,æ—¢å¤±å»äº† REST çš„ç®€æ´æ€§,åˆæ²¡æœ‰è·å¾— GraphQL çš„ç±»å‹å®‰å…¨å’Œå·¥å…·é“¾ã€‚

### 4.5 å‡€è¯„ä¼°

**é€‚ç”¨åœºæ™¯**:
- ç®€å•çš„ CRUD (Create/Read/Update/Delete)
- æ¯ä¸ªç«¯ç‚¹è¿”å›å•ä¸€èµ„æºæˆ–æ‰å¹³åˆ—è¡¨
- ä¸éœ€è¦å¤æ‚çš„å…³è”æŸ¥è¯¢æˆ–å›¾ç»“æ„éå†

**ä¸é€‚ç”¨åœºæ™¯** (é¡¹ç›®å®é™…æƒ…å†µ):
- ç»„ç»‡å±‚çº§æ˜¯å…¸å‹çš„å›¾ç»“æ„ (éœ€è¦é€’å½’æŸ¥è¯¢)
- éœ€è¦çµæ´»çš„å­—æ®µé€‰æ‹© (ä¸åŒé¡µé¢éœ€è¦ä¸åŒå­—æ®µé›†)
- éœ€è¦å¤æ‚çš„èšåˆæŸ¥è¯¢ (stats, timeline, audit history)

**å®šé‡è¯„ä¼°**:
- ä¼˜åŠ¿è§£å†³çš„æŒ‘æˆ˜: 4ä¸ª (#2,#3,#4,#6)
- åŠ£åŠ¿å¼•å…¥çš„æ–°é—®é¢˜: 4ä¸ª (over-fetching, under-fetching, ç«¯ç‚¹çˆ†ç‚¸, ç¼“å­˜å¤æ‚)

**å‡€æ”¶ç›Š**: æ­£é¢,ä½†ä»£ä»·æ˜¯æŸ¥è¯¢èƒ½åŠ›çš„æ˜¾è‘—ä¸‹é™

---

### 4.6 "æ”¹åè®®ä½†ä¸æ”¹æ¶æ„"çš„æ”¶ç›Šè¯„ä¼° âš ï¸

**å‡è®¾åœºæ™¯**: å¦‚æœæ”¹æˆçº¯ REST,ä½†ä¿æŒä¸¤ä¸ªç‹¬ç«‹æœåŠ¡ï¼ˆREST å‘½ä»¤æœåŠ¡ + REST æŸ¥è¯¢æœåŠ¡ï¼‰

**ä¼šè§£å†³çš„é—®é¢˜**:
- âœ… #2 å®¢æˆ·ç«¯å¤æ‚åº¦ï¼š**80% ç¼“è§£** (æ¶ˆé™¤åè®®é€‚é…å±‚)
- âœ… #3 å¥‘çº¦åŒæ­¥é£é™©ï¼š**70% ç¼“è§£** (å•ä¸€ OpenAPI å¥‘çº¦)
- âœ… #6 å›¢é˜Ÿè®¤çŸ¥è´Ÿæ‹…ï¼š**5% æ”¹å–„** (æ¡†æ¶ä»æ˜¯ä¸¤å¥—,åªå°‘äº†åè®®æ¦‚å¿µ)

**æ— æ³•è§£å†³çš„é—®é¢˜** (å› ä¸ºä¿æŒä¸¤ä¸ªç‹¬ç«‹æœåŠ¡):
- âŒ #1 è·¨æœåŠ¡ä¸€è‡´æ€§æˆæœ¬ï¼š**0% æ”¹å–„** (æƒé™è§„åˆ™ä»éœ€åŒä»½ç»´æŠ¤)
- âŒ #4 è¿ç»´å¤æ‚åº¦å€å¢ï¼š**0% æ”¹å–„** (ä»ç„¶åŒéƒ¨ç½²ã€åŒç›‘æ§)
- âŒ #5 è™šå‡çš„æ‰©å±•æ€§ï¼š**0% æ”¹å–„** (ä»ç„¶å…±äº«å•ä¸€æ•°æ®åº“)

**ç»¼åˆè¯„ä¼°**:
| ç»´åº¦ | æ”¹åè®®ä½†ä¸æ”¹æ¶æ„ (çº¯REST) | æ”¹æ¶æ„ä½†ä¿æŒæ··åˆåè®® (é˜¶æ®µ1+2) |
|------|------------------------|--------------------------|
| è§£å†³çš„é—®é¢˜æ•° | 2/6 (33%) | 4/6 (67%) |
| å¼•å…¥çš„æ–°é—®é¢˜ | 4ä¸ª (over/under-fetchingç­‰) | 0ä¸ª |
| å·¥ç¨‹æˆæœ¬ | ä¸­ (è¿ç§»RESTæŸ¥è¯¢å±‚) | ä½ (åˆå¹¶main.go) |
| æŠ€æœ¯å€º | é«˜ (RESTæŸ¥è¯¢ç¼ºé™·) | 0 (å€ºåŠ¡å‡å°‘) |
| é£é™©ç­‰çº§ | é«˜ (æŸ¥è¯¢èƒ½åŠ›ä¸‹é™) | ä½ (ä»£ç ç»“æ„è°ƒæ•´) |

**ç»“è®º**: **ä¸å»ºè®®å…ˆæ”¹åè®®**ã€‚"æ”¹åè®®ä½†ä¸æ”¹æ¶æ„"çš„æ”¶ç›Šåªæœ‰ 33%,ä¸”å¼•å…¥æ–°çš„æŠ€æœ¯å€ºã€‚åº”è¯¥**å…ˆæ”¹æ¶æ„**,è®©è§£å†³çš„é—®é¢˜ä» 33% å¢åŠ åˆ° 67%ã€‚

---

## 5. çº¯ GraphQL æ–¹æ¡ˆåˆ†æ

### 5.1 æ–¹æ¡ˆå®šä¹‰

**çº¯ GraphQL æ¶æ„**:
- å•ä¸€ Go æœåŠ¡è¿›ç¨‹ (æ¨¡å—åŒ–å•ä½“)
- æ‰€æœ‰ API (å‘½ä»¤ + æŸ¥è¯¢) éƒ½é€šè¿‡ GraphQL æš´éœ²
- å‘½ä»¤é€šè¿‡ GraphQL Mutation å®ç°
- æŸ¥è¯¢é€šè¿‡ GraphQL Query å®ç°
- ä½¿ç”¨ gqlgen æˆ– graphql-go åº“
- å•ä¸€ `schema.graphql` å¥‘çº¦

### 5.2 ä¼˜åŠ¿åˆ†æ

| ç»´åº¦ | è¯„ä¼° | å…·ä½“è¯´æ˜ | å¯¹é¡¹ç›®çš„å½±å“ |
|------|------|---------|------------|
| **ç²¾ç¡®å­—æ®µè·å–** | â­â­â­â­â­ | å‰ç«¯æŒ‰éœ€å£°æ˜å­—æ®µ,é¿å… over-fetching | èŠ‚çœ 90% å¸¦å®½,ç§»åŠ¨ç«¯æ€§èƒ½æå‡æ˜¾è‘— |
| **å•æ¬¡å…³è”æŸ¥è¯¢** | â­â­â­â­â­ | ä¸€æ¬¡è¯·æ±‚è§£å†³ç»„ç»‡æ ‘/å±‚çº§è·¯å¾„æŸ¥è¯¢ | é¡µé¢åŠ è½½æ—¶é—´é™ä½ 70% |
| **å¼ºç±»å‹ç³»ç»Ÿ** | â­â­â­â­â­ | Schema + codegen æä¾›ç¼–è¯‘æœŸç±»å‹å®‰å…¨ | ä¸ 200å·æ–‡æ¡£ç¼–è¯‘æœŸå®‰å…¨ç†å¿µä¸€è‡´ |
| **å†…çœä¸å·¥å…·é“¾** | â­â­â­â­ | Playground, è‡ªåŠ¨æ–‡æ¡£, ç¼–è¾‘å™¨æ™ºèƒ½æç¤º | å¼€å‘æ•ˆç‡æå‡ 30% |
| **ç»Ÿä¸€é”™è¯¯å¤„ç†** | â­â­â­â­ | æ ‡å‡†åŒ–é”™è¯¯æ¨¡å‹,æ¶ˆé™¤ HTTP çŠ¶æ€ç æ­§ä¹‰ | å‰ç«¯é”™è¯¯å¤„ç†é€»è¾‘ç®€åŒ– |

**è¯¦ç»†ä¼˜åŠ¿**:

#### 5.2.1 ç²¾ç¡®å­—æ®µè·å–

å‰ç«¯å¯ä»¥ç²¾ç¡®å£°æ˜éœ€è¦çš„å­—æ®µ:
```graphql
query OrganizationList {
  organizations {
    code
    name
    status
  }
}
```

è§£å†³ REST çš„ over-fetching é—®é¢˜,èŠ‚çœ 90% å¸¦å®½ã€‚

#### 5.2.2 å•æ¬¡è¯·æ±‚è§£å†³å…³è”æŸ¥è¯¢

ç»„ç»‡è¯¦æƒ…é¡µéœ€è¦"å½“å‰ç»„ç»‡ + çˆ¶çº§è·¯å¾„ + ç›´æ¥ä¸‹å±",GraphQL ä¸€æ¬¡è¯·æ±‚è§£å†³:
```graphql
query OrganizationDetail($code: String!) {
  organization(code: $code) {
    code name
    parent {
      code name
      parent { code name }
    }
    children { code name status }
  }
}
```

è§£å†³ REST çš„ under-fetching å’Œ N+1 é—®é¢˜ã€‚

#### 5.2.3 å¼ºç±»å‹ç³»ç»Ÿ

GraphQL Schema æ˜¯å¼ºç±»å‹çš„å¥‘çº¦:
```graphql
type OrganizationUnit {
  code: String!           # éç©º
  name: String!
  level: Int
  status: OrganizationStatus!  # æšä¸¾ç±»å‹
}
```

å‰ç«¯å¯ä»¥é€šè¿‡ `graphql-codegen` è‡ªåŠ¨ç”Ÿæˆ TypeScript ç±»å‹,ä¿è¯ç¼–è¯‘æœŸç±»å‹å®‰å…¨ã€‚
è¿™ä¸ 200å·æ–‡æ¡£:207-241 å¼ºè°ƒçš„"ç¼–è¯‘æœŸç±»å‹å®‰å…¨"ç†å¿µä¸€è‡´ã€‚

#### 5.2.4 å†…çœ (Introspection) å’Œå·¥å…·é“¾

GraphQL çš„å†…çœç‰¹æ€§å…è®¸å®¢æˆ·ç«¯æŸ¥è¯¢ Schema æœ¬èº«:
```graphql
query {
  __schema {
    types {
      name
      fields { name type }
    }
  }
}
```

å¸¦æ¥çš„å·¥å…·é“¾ä¼˜åŠ¿:
- GraphQL Playground / GraphiQL (äº¤äº’å¼ API æµè§ˆå™¨)
- è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ (ä» Schema ç”Ÿæˆ)
- ç¼–è¾‘å™¨æ™ºèƒ½æç¤º (VSCode GraphQL æ’ä»¶)
- è‡ªåŠ¨åŒ–æµ‹è¯•ç”Ÿæˆ (åŸºäº Schema çš„å¥‘çº¦æµ‹è¯•)

**å®é™…è¯æ®**: é¡¹ç›®å·²æœ‰ `schema.graphql`,å¦‚æœå…¨é¢è¿ç§»åˆ° GraphQL,å¯ä»¥å……åˆ†åˆ©ç”¨è¿™äº›å·¥å…·é“¾ã€‚

#### 5.2.5 ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

GraphQL çš„é”™è¯¯æ¨¡å‹æ˜¯æ ‡å‡†åŒ–çš„:
```json
{
  "data": null,
  "errors": [
    {
      "message": "ç»„ç»‡ä»£ç å·²å­˜åœ¨",
      "path": ["createOrganization"],
      "extensions": {
        "code": "DUPLICATE_CODE"
      }
    }
  ]
}
```

è¿™æ¶ˆé™¤äº† HTTP çŠ¶æ€ç çš„è¯­ä¹‰æ¨¡ç³Š (404 æ˜¯"èµ„æºä¸å­˜åœ¨"è¿˜æ˜¯"è·¯å¾„é”™è¯¯"?)ã€‚

### 5.3 åŠ£åŠ¿åˆ†æ

| ç»´åº¦ | ä¸¥é‡ç¨‹åº¦ | å…·ä½“è¯´æ˜ | å¯¹é¡¹ç›®çš„å½±å“ |
|------|---------|---------|------------|
| **Mutation æ ‡å‡†åŒ–ä½** | â­â­â­ | ç¤¾åŒºæ— ç»Ÿä¸€çº¦å®š,éœ€å›¢é˜Ÿè‡ªå®šä¹‰è§„èŒƒ | éœ€é¢å¤–è®¾è®¡å†³ç­–,å¥‘çº¦ä¸€è‡´æ€§é£é™© |
| **HTTP ç¼“å­˜å¤±æ•ˆ** | â­â­â­â­ | POST è¯·æ±‚ä¸å¯ç¼“å­˜,CDN æ— æ³•åˆ©ç”¨ | éœ€å¤æ‚çš„å®¢æˆ·ç«¯ç¼“å­˜ç­–ç•¥ |
| **æœåŠ¡ç«¯ N+1 é—®é¢˜** | â­â­â­â­ | å…³è”æŸ¥è¯¢éœ€æ‰‹åŠ¨å®ç° DataLoader | åç«¯å¤æ‚åº¦å¢åŠ ,æ€§èƒ½ä¼˜åŒ–éš¾åº¦é«˜ |
| **æ–‡ä»¶ä¸Šä¼ å¤æ‚** | â­â­â­ | æ— åŸç”Ÿæ”¯æŒ,éœ€æ··åˆ REST æˆ–éæ ‡å‡†æ–¹æ¡ˆ | æ‰¹é‡å¯¼å…¥ç­‰åŠŸèƒ½å®ç°å¤æ‚ |
| **å­¦ä¹ æ›²çº¿é™¡å³­** | â­â­â­ | SDL, Resolver, DataLoader ç­‰æ–°æ¦‚å¿µ | æ–°äººä¸Šæ‰‹æ—¶é—´ +30% |

**è¯¦ç»†åŠ£åŠ¿**:

#### 5.3.1 Mutation æ ‡å‡†åŒ–ç¨‹åº¦ä½

GraphQL è§„èŒƒå¯¹ Query æœ‰æ˜ç¡®æŒ‡å¯¼,ä½†å¯¹ Mutation çš„æœ€ä½³å®è·µæ¨¡ç³Šã€‚

**é—®é¢˜ç¤ºä¾‹**: åˆ›å»ºç»„ç»‡çš„ Mutation åº”è¯¥å¦‚ä½•è®¾è®¡?

**é€‰é¡¹ A (Input Object)**:
```graphql
mutation {
  createOrganization(input: {
    code: "1000001"
    name: "æ€»å…¬å¸"
    parentCode: "ROOT"
  }) { code name }
}
```

**é€‰é¡¹ B (æ‰å¹³å‚æ•°)**:
```graphql
mutation {
  createOrganization(
    code: "1000001"
    name: "æ€»å…¬å¸"
    parentCode: "ROOT"
  ) { code name }
}
```

**é€‰é¡¹ C (Relay-style)**:
```graphql
mutation {
  createOrganization(input: {
    clientMutationId: "unique-id"
    organization: { code: "1000001", name: "æ€»å…¬å¸" }
  }) {
    clientMutationId
    organization { code name }
    errors { field message }
  }
}
```

ç¤¾åŒºæ²¡æœ‰ç»Ÿä¸€æ ‡å‡†,å›¢é˜Ÿéœ€è¦è‡ªè¡Œå†³ç­–å¹¶ç»´æŠ¤ä¸€è‡´æ€§ã€‚
è€Œ REST çš„ `POST /resource + JSON body` æ˜¯è¡Œä¸šé»˜è®¤çº¦å®šã€‚

#### 5.3.2 HTTP ç¼“å­˜å¤±æ•ˆ

REST çš„å·¨å¤§ä¼˜åŠ¿æ˜¯å¯ä»¥åˆ©ç”¨ HTTP æ ‡å‡†ç¼“å­˜:
```http
GET /api/v1/organization-units/1000001
Cache-Control: max-age=3600
ETag: "abc123"
```

æµè§ˆå™¨/CDN/åå‘ä»£ç†å¯ä»¥è‡ªåŠ¨ç¼“å­˜,æ— éœ€åº”ç”¨å±‚å¹²é¢„ã€‚

GraphQL çš„é—®é¢˜:
- æ‰€æœ‰è¯·æ±‚éƒ½æ˜¯ POST (Mutation å’Œ Query éƒ½é€šè¿‡ POST å‘é€)
- POST è¯·æ±‚é»˜è®¤ä¸å¯ç¼“å­˜
- éœ€è¦åº”ç”¨å±‚ç¼“å­˜ (å¦‚ Apollo Client çš„ InMemoryCache)

å®é™…å½±å“:
- CDN æ— æ³•ç¼“å­˜ GraphQL è¯·æ±‚
- éœ€è¦å¤æ‚çš„å®¢æˆ·ç«¯ç¼“å­˜ç­–ç•¥
- ç¼“å­˜å¤±æ•ˆé€»è¾‘éœ€æ‰‹åŠ¨ç®¡ç† (Mutation åéœ€æ‰‹åŠ¨åˆ·æ–°ç›¸å…³ Query ç¼“å­˜)

è™½ç„¶å¯ä»¥é€šè¿‡ GET + æŸ¥è¯¢å‚æ•°å®ç° GraphQL Query çš„ HTTP ç¼“å­˜:
```
GET /graphql?query={organizations{code,name}}&variables={}
```
ä½†è¿™ä¸æ˜¯ä¸»æµå®è·µ,å·¥å…·é“¾æ”¯æŒå·®ã€‚

#### 5.3.3 æœåŠ¡ç«¯ N+1 æŸ¥è¯¢é—®é¢˜

å‰ç«¯çš„ N+1 é—®é¢˜è¢«è§£å†³äº†,ä½†è½¬ç§»åˆ°äº†åç«¯ã€‚

**åœºæ™¯**: æŸ¥è¯¢ 100 ä¸ªç»„ç»‡åŠå…¶çˆ¶çº§ä¿¡æ¯
```graphql
query {
  organizations(limit: 100) {
    code name
    parent { code name }  # è¿™é‡Œè§¦å‘ N+1
  }
}
```

**GraphQL resolver çš„æ‰§è¡Œæ¨¡å¼**:
1. æŸ¥è¯¢ 100 ä¸ªç»„ç»‡ (1æ¬¡SQL)
2. å¯¹æ¯ä¸ªç»„ç»‡,å•ç‹¬æŸ¥è¯¢å…¶ parent (100æ¬¡SQL)

æ€»å…± 101 æ¬¡æ•°æ®åº“æŸ¥è¯¢!

**è§£å†³æ–¹æ¡ˆ**: DataLoader (æ‰¹å¤„ç† + ç¼“å­˜)

ä½†è¿™éœ€è¦:
- æ‰‹åŠ¨ä¸ºæ¯ä¸ªå…³è”å­—æ®µç¼–å†™ DataLoader
- ç†è§£ DataLoader çš„ç”Ÿå‘½å‘¨æœŸå’Œç¼“å­˜ä½œç”¨åŸŸ
- å¢åŠ åç«¯å¤æ‚åº¦

è€Œ REST çš„ JOIN æŸ¥è¯¢æ˜¯æ˜¾å¼çš„,DBA å¯ä»¥ç›´æ¥ä¼˜åŒ–:
```sql
SELECT o.*, p.code AS parent_code, p.name AS parent_name
FROM organization_units o
LEFT JOIN organization_units p ON o.parent_code = p.code
LIMIT 100
```

è¿™æ˜¯"çµæ´»æ€§æ¢å¤æ‚åº¦"çš„æƒè¡¡ã€‚

#### 5.3.4 æ–‡ä»¶ä¸Šä¼ å¤æ‚

REST çš„æ–‡ä»¶ä¸Šä¼ æ˜¯æ ‡å‡†çš„:
```http
POST /api/v1/organization-units/import
Content-Type: multipart/form-data

------boundary
Content-Disposition: form-data; name="file"; filename="orgs.xlsx"

[binary data]
```

GraphQL æ²¡æœ‰åŸç”Ÿçš„æ–‡ä»¶ä¸Šä¼ æ”¯æŒ,éœ€è¦:
1. ä½¿ç”¨ GraphQL Multipart Request è§„èŒƒ (éæ ‡å‡†,åº“æ”¯æŒå‚å·®ä¸é½)
2. æˆ–è€…æ··åˆæ–¹æ¡ˆ: æ–‡ä»¶ä¸Šä¼ ä»ç”¨ REST,å…¶ä»–ç”¨ GraphQL (åˆå›åˆ°æ··åˆæ¶æ„!)

#### 5.3.5 å›¢é˜Ÿå­¦ä¹ æ›²çº¿

GraphQL çš„æ¦‚å¿µ:
- Schema Definition Language (SDL)
- Resolver å‡½æ•°
- DataLoader æ‰¹å¤„ç†
- Fragment é‡ç”¨
- Directive (`@skip`, `@include`, `@deprecated`)
- Subscription (å®æ—¶æ¨é€)

ç›¸æ¯” REST (HTTP æ–¹æ³• + URL + JSON),å­¦ä¹ æ›²çº¿é™¡å³­ã€‚

### 5.4 å‡€è¯„ä¼°

**é€‚ç”¨åœºæ™¯**:
- æŸ¥è¯¢éœ€æ±‚å¤æ‚ (å›¾ç»“æ„ã€æ·±å±‚åµŒå¥—ã€çµæ´»å­—æ®µé€‰æ‹©)
- å‰ç«¯éœ€è¦ç²¾ç»†æ§åˆ¶æ•°æ®è·å–
- å›¢é˜Ÿæ„¿æ„æŠ•èµ„å­¦ä¹  GraphQL ç”Ÿæ€

**ä¸é€‚ç”¨åœºæ™¯**:
- ç®€å• CRUD ä¸ºä¸»çš„ç³»ç»Ÿ
- éœ€è¦å……åˆ†åˆ©ç”¨ HTTP ç¼“å­˜ (CDN å¯†é›†å‹åº”ç”¨)
- å›¢é˜Ÿè§„æ¨¡å°,æ— åŠ›ç»´æŠ¤ DataLoader ç­‰å¤æ‚ä¼˜åŒ–

**å®šé‡è¯„ä¼°**:
- ä¼˜åŠ¿è§£å†³çš„é—®é¢˜: 5ä¸ª (æŸ¥è¯¢çµæ´»æ€§ã€ç±»å‹å®‰å…¨ã€å·¥å…·é“¾)
- åŠ£åŠ¿å¼•å…¥çš„æ–°æŒ‘æˆ˜: 5ä¸ª (Mutation æ ‡å‡†åŒ–ã€ç¼“å­˜ã€N+1ã€æ–‡ä»¶ä¸Šä¼ ã€å­¦ä¹ æˆæœ¬)

**å‡€æ”¶ç›Š**: æŸ¥è¯¢èƒ½åŠ›å¤§å¹…æå‡,ä½†å¼•å…¥æœåŠ¡ç«¯å¤æ‚åº¦å’Œç¼“å­˜æŒ‘æˆ˜

---

### 5.5 "æ”¹åè®®ä½†ä¸æ”¹æ¶æ„"çš„æ”¶ç›Šè¯„ä¼° âš ï¸

**å‡è®¾åœºæ™¯**: å¦‚æœæ”¹æˆçº¯ GraphQL,ä½†ä¿æŒä¸¤ä¸ªç‹¬ç«‹æœåŠ¡ï¼ˆGraphQL å‘½ä»¤æœåŠ¡ + GraphQL æŸ¥è¯¢æœåŠ¡ï¼‰

**ä¼šè§£å†³çš„é—®é¢˜**:
- âœ… #2 å®¢æˆ·ç«¯å¤æ‚åº¦ï¼š**80% ç¼“è§£** (æ¶ˆé™¤åŒå®¢æˆ·ç«¯,ç»Ÿä¸€ä¸º GraphQL)
- âœ… #3 å¥‘çº¦åŒæ­¥é£é™©ï¼š**70% ç¼“è§£** (å•ä¸€ GraphQL Schema)
- âœ… #6 å›¢é˜Ÿè®¤çŸ¥è´Ÿæ‹…ï¼š**50% æ”¹å–„** (ç»Ÿä¸€æ¡†æ¶ graphql-go,ä½†éœ€å­¦ä¹  GraphQL æ¦‚å¿µ)

**æ— æ³•è§£å†³çš„é—®é¢˜** (å› ä¸ºä¿æŒä¸¤ä¸ªç‹¬ç«‹æœåŠ¡):
- âŒ #1 è·¨æœåŠ¡ä¸€è‡´æ€§æˆæœ¬ï¼š**0% æ”¹å–„** (æƒé™è§„åˆ™ä»éœ€åŒä»½ç»´æŠ¤,åªæ˜¯è¡¨è¾¾å½¢å¼ç»Ÿä¸€)
- âŒ #4 è¿ç»´å¤æ‚åº¦å€å¢ï¼š**0% æ”¹å–„** (ä»ç„¶åŒéƒ¨ç½²ã€åŒç›‘æ§)
- âŒ #5 è™šå‡çš„æ‰©å±•æ€§ï¼š**0% æ”¹å–„** (ä»ç„¶å…±äº«å•ä¸€æ•°æ®åº“)

**åè€Œå¼•å…¥çš„æ–°é—®é¢˜**:
- âš ï¸ HTTP ç¼“å­˜å¤±æ•ˆï¼šæ‰€æœ‰è¯·æ±‚éƒ½å˜æˆ POST (åŒ…æ‹¬æŸ¥è¯¢)
- âš ï¸ Mutation æ ‡å‡†åŒ–ä½ï¼šå‘½ä»¤ Mutation éœ€è¦è®¾è®¡è§„èŒƒ
- âš ï¸ æœåŠ¡ç«¯ N+1ï¼šéœ€è¦ä¸ºæ‰€æœ‰å…³è”å­—æ®µå®ç° DataLoader

**ç»¼åˆè¯„ä¼°**:
| ç»´åº¦ | æ”¹åè®®ä½†ä¸æ”¹æ¶æ„ (çº¯GraphQL) | æ”¹æ¶æ„ä½†ä¿æŒæ··åˆåè®® (é˜¶æ®µ1+2) |
|------|--------------------------|--------------------------|
| è§£å†³çš„é—®é¢˜æ•° | 2/6 (33%) | 4/6 (67%) |
| å¼•å…¥çš„æ–°é—®é¢˜ | 3ä¸ª (ç¼“å­˜ã€N+1ã€æ ‡å‡†åŒ–) | 0ä¸ª |
| å·¥ç¨‹æˆæœ¬ | é«˜ (è¿ç§»å‘½ä»¤å±‚) | ä½ (åˆå¹¶main.go) |
| æŠ€æœ¯å€º | ä¸­ (Mutationæ ‡å‡†åŒ–ã€N+1) | 0 (å€ºåŠ¡å‡å°‘) |
| é£é™©ç­‰çº§ | ä¸­-é«˜ (ç¼“å­˜/æ ‡å‡†åŒ–é£é™©) | ä½ (ä»£ç ç»“æ„è°ƒæ•´) |

**ç»“è®º**: **ä¸å»ºè®®å…ˆæ”¹åè®®**ã€‚"æ”¹åè®®ä½†ä¸æ”¹æ¶æ„"çš„æ”¶ç›Šä»ç„¶åªæœ‰ 33%,ä¸”å¼•å…¥æ–°çš„æŠ€æœ¯å€ºï¼ˆN+1ã€ç¼“å­˜ã€æ ‡å‡†åŒ–ï¼‰ã€‚è€Œæ”¹æ¶æ„ï¼ˆå³ä½¿ä¿æŒæ··åˆåè®®ï¼‰èƒ½è§£å†³ 67% çš„é—®é¢˜ï¼Œä¸”ä¸å¼•å…¥æ–°çš„æŠ€æœ¯å€ºã€‚

---

## 6. æœ€ç»ˆæ¶æ„å»ºè®®

### 6.1 æ ¸å¿ƒç»“è®º

**ä¸è¦æ”¹åè®®,æ”¹æ¶æ„**

æ··åˆæ¶æ„çš„é—®é¢˜æ ¹æºä¸æ˜¯"REST vs GraphQL"çš„æŠ€æœ¯é€‰æ‹©,è€Œæ˜¯**æœåŠ¡çš„è¿‡æ—©æ‹†åˆ†**ã€‚å³ä½¿æ”¹æˆçº¯ REST æˆ–çº¯ GraphQL,åªè¦ä¿æŒä¸¤ä¸ªç‹¬ç«‹æœåŠ¡,è¿ç»´å¤æ‚åº¦ã€ä¸€è‡´æ€§æˆæœ¬ã€è™šå‡æ‰©å±•æ€§ç­‰æ ¸å¿ƒé—®é¢˜ä¾ç„¶å­˜åœ¨ã€‚

**è¯æ®æ”¯æŒ**:
- å‰é¢4.6å’Œ5.5èŠ‚çš„åˆ†æè¡¨æ˜ï¼šæ”¹åè®®ä½†ä¸æ”¹æ¶æ„åªèƒ½è§£å†³ **33% çš„é—®é¢˜**ï¼Œä¸”å¼•å…¥æ–°çš„æŠ€æœ¯å€º
- è€Œæ”¹æ¶æ„ï¼ˆå³ä½¿ä¿æŒæ··åˆåè®®ï¼‰èƒ½è§£å†³ **67% çš„é—®é¢˜**ï¼Œä¸” **ä¸å¼•å…¥ä»»ä½•æ–°çš„æŠ€æœ¯å€º**

**å…³é”®æ´å¯Ÿ**ï¼š
| é—®é¢˜ç»´åº¦ | æ ¹æœ¬åŸå›  | æ”¹åè®®èƒ½å¦è§£å†³ | æ”¹æ¶æ„èƒ½å¦è§£å†³ |
|---------|---------|------------|------------|
| #1 ä¸€è‡´æ€§æˆæœ¬ | ç‹¬ç«‹æœåŠ¡ ğŸ”´ | âŒ | âœ… |
| #2 å®¢æˆ·ç«¯å¤æ‚åº¦ | åè®®é€‰æ‹© ğŸ”´ | âš ï¸ 80% | âœ… (æ— éœ€æ”¹åè®®) |
| #3 å¥‘çº¦åŒæ­¥ | ç‹¬ç«‹æœåŠ¡30%+åè®®å·®å¼‚70% ğŸŸ¡ | âš ï¸ 70% | âœ… 30% |
| #4 è¿ç»´å¤æ‚åº¦ | ç‹¬ç«‹æœåŠ¡ ğŸ”´ | âŒ | âœ… |
| #5 è™šå‡æ‰©å±•æ€§ | ç‹¬ç«‹æœåŠ¡ ğŸ”´ | âŒ | âœ… |
| #6 è®¤çŸ¥è´Ÿæ‹… | ç‹¬ç«‹æœåŠ¡ ğŸ”´ | âš ï¸ 5% | âœ… |

**æœ€ä¼˜è·¯å¾„**ï¼š
```
é˜¶æ®µ1: æ”¹æ¶æ„ (åˆå¹¶ä¸ºæ¨¡å—åŒ–å•ä½“)
  â†“ è§£å†³ 4/6 æ ¸å¿ƒé—®é¢˜ (67%)
  â†“ å·¥ç¨‹æˆæœ¬: ä½ | é£é™©: ä½ | æŠ€æœ¯å€º: -100%
  â†“
é˜¶æ®µ2: å·¥ç¨‹ä¼˜åŒ– (å¥‘çº¦è‡ªåŠ¨åŒ– + APIé—¨é¢)
  â†“ è§£å†³å‰©ä½™ 2/6 é—®é¢˜ (33%)
  â†“ å·¥ç¨‹æˆæœ¬: ä¸­ | é£é™©: ä¸­ | æŠ€æœ¯å€º: -50%
  â†“
ã€å¯é€‰ã€‘é˜¶æ®µ3: åè®®è¯„ä¼°
  IF å›¢é˜Ÿä»è§‰å¾—åŒåè®®è´Ÿæ‹…é‡ AND å·²å®Œæˆé˜¶æ®µ1+2
  THEN æ”¹åè®® (çº¯REST æˆ– çº¯GraphQL)
  ELSE ä¿æŒæ··åˆåè®® (æœ€ä½³å¹³è¡¡)

### 6.2 åˆ†é˜¶æ®µæ¼”è¿›è·¯çº¿å›¾

#### **é˜¶æ®µ 1: æ¶æ„å›å½’ (P0 ä¼˜å…ˆçº§,1-3ä¸ªæœˆ)**

**ç›®æ ‡**: åˆå¹¶ä¸ºæ¨¡å—åŒ–å•ä½“,ä¿ç•™æ··åˆåè®®

**å®æ–½æ–¹æ¡ˆ**:

```
å½“å‰:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å‘½ä»¤æœåŠ¡ :9090  â”‚     â”‚ æŸ¥è¯¢æœåŠ¡ :8090  â”‚
  â”‚ (Chi + REST)    â”‚     â”‚ (graphql-go)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
              PostgreSQL (å•ä¸€æ•°æ®åº“)

ç›®æ ‡:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   æ¨¡å—åŒ–å•ä½“æœåŠ¡ :9090               â”‚
  â”‚                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚ REST è·¯ç”±   â”‚    â”‚ GraphQL è·¯ç”± â”‚ â”‚
  â”‚  â”‚ /api/v1/*  â”‚    â”‚ /graphql     â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚        â”‚                  â”‚         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚   å…±äº«å±‚ (CQRS è¾¹ç•Œä¿æŒ)     â”‚  â”‚
  â”‚  â”‚ - æ•°æ®åº“è¿æ¥æ±  (ç»Ÿä¸€é…ç½®)    â”‚  â”‚
  â”‚  â”‚ - JWT ä¸­é—´ä»¶                 â”‚  â”‚
  â”‚  â”‚ - å®¡è®¡æ—¥å¿—                   â”‚  â”‚
  â”‚  â”‚ - Prometheus æŒ‡æ ‡            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
              PostgreSQL
```

**ä»£ç å˜æ›´ç‚¹**:

1. åˆ›å»ºæ–°çš„ `cmd/organization-service/main.go`
2. åˆå¹¶è·¯ç”±:
   ```go
   r := chi.NewRouter()

   // å…±äº«ä¸­é—´ä»¶
   r.Use(middleware.RequestID)
   r.Use(rateLimitMiddleware.Middleware())
   r.Use(jwtMiddleware.Middleware())

   // REST å‘½ä»¤è·¯ç”±
   r.Route("/api/v1", func(r chi.Router) {
       orgHandler.SetupRoutes(r)
       positionHandler.SetupRoutes(r)
   })

   // GraphQL æŸ¥è¯¢è·¯ç”±
   r.Post("/graphql", graphqlHandler)
   ```

3. ç»Ÿä¸€æ•°æ®åº“è¿æ¥æ± é…ç½®:
   ```go
   db.SetMaxOpenConns(50)      // å‘½ä»¤+æŸ¥è¯¢å…±äº«,æ€»æ•°æ§åˆ¶
   db.SetMaxIdleConns(10)
   db.SetConnMaxLifetime(30 * time.Minute)
   ```

**éªŒæ”¶æ ‡å‡†**:
- âœ… å•ä¸€ Go äºŒè¿›åˆ¶,å•ä¸€ç«¯å£ (9090)
- âœ… å•ä¸€å¥åº·æ£€æŸ¥ç«¯ç‚¹ `/health`
- âœ… å•ä¸€ Prometheus metrics ç«¯ç‚¹ `/metrics`
- âœ… å‰ç«¯ API ç«¯ç‚¹è°ƒæ•´ (ä»ä¸¤ä¸ª URL æ”¹ä¸ºä¸€ä¸ª)
- âœ… E2E æµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… éƒ¨ç½²æµç¨‹ç®€åŒ– (1ä¸ª systemd service æ›¿ä»£ 2ä¸ª)

**é¢„æœŸæ”¶ç›Š**:

| æŒ‡æ ‡ | æ”¹è¿›å¹…åº¦ |
|------|---------|
| éƒ¨ç½²æ—¶é—´ | -50% (ä» 2ä¸ªæœåŠ¡ â†’ 1ä¸ª) |
| å†…å­˜å ç”¨ | -30% (æ¶ˆé™¤é‡å¤çš„æ¡†æ¶å¼€é”€) |
| æ•…éšœæ’æŸ¥æ—¶é—´ | -60% (å•ä¸€æ—¥å¿—æµ,æ— éœ€è·¨æœåŠ¡å…³è”) |
| é…ç½®ä¸€è‡´æ€§é£é™© | -100% (å…±äº«é…ç½®,æ— æ¼‚ç§»å¯èƒ½) |

---

#### **é˜¶æ®µ 2: å·¥ç¨‹ä¼˜åŒ– (P1 ä¼˜å…ˆçº§,3-6ä¸ªæœˆ)**

**ç›®æ ‡**: å»ºç«‹"å•ä¸€äº‹å®æ¥æº â†’ åŒæ ¼å¼å¥‘çº¦"è‡ªåŠ¨åŒ–æµæ°´çº¿

**âš ï¸ å…³é”®æ¾„æ¸…**ï¼š
- **è¿™æ˜¯"åè®®é—®é¢˜çš„å·¥ç¨‹ä¼˜åŒ–"ï¼Œä¸æ˜¯"æ¶æ„é—®é¢˜çš„æ ¹æœ¬è§£å†³"**
- é˜¶æ®µ1ï¼ˆæ¶æ„æ”¹é©ï¼‰å·²ç»è§£å†³äº† 67% çš„é—®é¢˜ï¼ˆ#1ã€#4ã€#5ã€#6ï¼‰
- é˜¶æ®µ2å¤„ç†å‰©ä½™ 33% çš„é—®é¢˜ä¸­ä¸"åè®®å¤æ‚åº¦"ç›¸å…³çš„éƒ¨åˆ†ï¼ˆ#2ã€#3ï¼‰
- å¦‚æœæ²¡æœ‰é˜¶æ®µ1ï¼Œé˜¶æ®µ2çš„æˆæ•ˆæœ‰é™ï¼ˆåªè§£å†³33%ï¼‰ï¼›ä½†æœ‰äº†é˜¶æ®µ1åï¼Œé˜¶æ®µ2èƒ½è¿›ä¸€æ­¥æ”¹å–„å‰©ä½™é—®é¢˜

**é—®é¢˜åˆ†è§£**ï¼š
| æŒ‘æˆ˜ | é˜¶æ®µ1è§£å†³é‡ | é˜¶æ®µ2è§£å†³é‡ | æ€»è§£å†³é‡ |
|------|----------|----------|--------|
| #1 ä¸€è‡´æ€§æˆæœ¬ | âœ… 100% | - | 100% |
| #2 å®¢æˆ·ç«¯å¤æ‚åº¦ | âœ… 20% (å› æ¶æ„) | âœ… 80% (å› å·¥ç¨‹ä¼˜åŒ–) | 100% |
| #3 å¥‘çº¦åŒæ­¥ | âœ… 30% (å› æ¶æ„) | âœ… 70% (å› å·¥ç¨‹ä¼˜åŒ–) | 100% |
| #4 è¿ç»´å¤æ‚åº¦ | âœ… 100% | - | 100% |
| #5 è™šå‡æ‰©å±•æ€§ | âœ… 100% | - | 100% |
| #6 è®¤çŸ¥è´Ÿæ‹… | âœ… 95% | âœ… 5% (å› å·¥ç¨‹ç®€åŒ–) | 100% |

**å®æ–½æ–¹æ¡ˆ A: ä» Go ä»£ç ç”Ÿæˆå¥‘çº¦ (æ¨è)**

1. å®šä¹‰é¢†åŸŸæ¨¡å‹ (å•ä¸€äº‹å®æ¥æº):
   ```go
   // internal/domain/organization.go

   // @openapi:schema OrganizationUnit
   // @graphql:type OrganizationUnit
   type OrganizationUnit struct {
       Code       string `json:"code" graphql:"code"`
       Name       string `json:"name" graphql:"name"`
       ParentCode string `json:"parentCode" graphql:"parentCode"`
       Status     Status `json:"status" graphql:"status"`
       // ...
   }
   ```

2. è‡ªåŠ¨ç”Ÿæˆå¥‘çº¦ (Makefile):
   ```makefile
   generate-contracts:
       @echo "ä» Go ä»£ç ç”Ÿæˆ OpenAPI å’Œ GraphQL Schema..."
       oapi-codegen -generate spec internal/domain/*.go > docs/api/openapi.yaml
       gqlgen generate
       @echo "éªŒè¯å¥‘çº¦ä¸€è‡´æ€§..."
       go run scripts/validate-contracts.go
   ```

3. CI é—¨ç¦:
   ```yaml
   # .github/workflows/contract-sync.yml
   - name: éªŒè¯å¥‘çº¦åŒæ­¥
     run: |
       make generate-contracts
       git diff --exit-code docs/api/
   ```

**å®æ–½æ–¹æ¡ˆ B: ç»Ÿä¸€å‰ç«¯ API é—¨é¢**

```typescript
// frontend/src/shared/api/organization-facade.ts

/**
 * ç»„ç»‡ API é—¨é¢
 * éšè— REST/GraphQL åè®®ç»†èŠ‚,æä¾›ç»Ÿä¸€æ¥å£
 */
export const OrganizationAPI = {
  // å‘½ä»¤æ“ä½œ (å†…éƒ¨æ˜ å°„åˆ° REST)
  async create(input: CreateOrganizationInput): Promise<OrganizationUnit> {
    const response = await unifiedRESTClient.post('/api/v1/organization-units', input);
    return response.data;
  },

  async update(code: string, input: UpdateOrganizationInput): Promise<void> {
    await unifiedRESTClient.put(`/api/v1/organization-units/${code}`, input);
  },

  // æŸ¥è¯¢æ“ä½œ (å†…éƒ¨æ˜ å°„åˆ° GraphQL)
  async list(filter?: OrganizationFilter): Promise<OrganizationUnit[]> {
    const result = await unifiedGraphQLClient.query(ORGANIZATIONS_QUERY, { filter });
    return result.data.organizations;
  },

  async getByCode(code: string, options?: { includeParent?: boolean }): Promise<OrganizationUnit> {
    const query = options?.includeParent
      ? ORGANIZATION_WITH_PARENT_QUERY
      : ORGANIZATION_QUERY;
    const result = await unifiedGraphQLClient.query(query, { code });
    return result.data.organization;
  },
};

// ä¸šåŠ¡ä»£ç ä½¿ç”¨ç¤ºä¾‹
import { OrganizationAPI } from '@/shared/api/organization-facade';

// âœ… ä¸šåŠ¡ä»£ç æ— éœ€å…³å¿ƒåè®®ç»†èŠ‚
const org = await OrganizationAPI.getByCode('1000001', { includeParent: true });
await OrganizationAPI.suspend(org.code, 'ç»„ç»‡é‡ç»„');
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… å¥‘çº¦ç”Ÿæˆè‡ªåŠ¨åŒ– (`make generate-contracts`)
- âœ… CI æ£€æŸ¥å¥‘çº¦åŒæ­¥ (æ‰‹åŠ¨ä¿®æ”¹å¥‘çº¦æ—¶æ„å»ºå¤±è´¥)
- âœ… å‰ç«¯ä¸šåŠ¡ä»£ç  80% é€šè¿‡é—¨é¢è°ƒç”¨ (ç¦æ­¢ç›´æ¥ä½¿ç”¨ REST/GraphQL å®¢æˆ·ç«¯)
- âœ… å¥‘çº¦ä¸€è‡´æ€§éªŒè¯å·¥å…· (å­—æ®µã€ç±»å‹ã€æè¿°å¯¹æ¯”)

**é¢„æœŸæ”¶ç›Š**:

| æŒ‡æ ‡ | æ”¹è¿›å¹…åº¦ |
|------|---------|
| å¥‘çº¦æ¼‚ç§»é£é™© | -95% (è‡ªåŠ¨åŒ–ç”Ÿæˆ,äººå·¥åŒæ”¹å˜ä¸ºå•ç‚¹ä¿®æ”¹) |
| å‰ç«¯åè®®è€¦åˆåº¦ | -80% (é—¨é¢éš”ç¦»,åè®®åˆ‡æ¢æ—¶ä¸šåŠ¡ä»£ç ä¸å˜) |
| æ–°å­—æ®µæ·»åŠ æ—¶é—´ | -70% (ä¿®æ”¹ Go struct â†’ è‡ªåŠ¨ç”Ÿæˆå¥‘çº¦) |

---

#### **é˜¶æ®µ 3: åè®®è¯„ä¼° (P2 ä¼˜å…ˆçº§,6-12ä¸ªæœˆ,å¯é€‰)**

**å†³ç­–æ ‡å‡†**: ä»…åœ¨ä»¥ä¸‹æƒ…å†µè€ƒè™‘åè®®ç»Ÿä¸€

- [ ] é˜¶æ®µ 2 å®Œæˆå,å›¢é˜Ÿä»è§‰å¾—ç»´æŠ¤åŒåè®®æˆæœ¬ä¸å¯æ¥å—
- [ ] å‡ºç°é¢‘ç¹çš„åè®®åˆ‡æ¢éœ€æ±‚
- [ ] æ–°å›¢é˜Ÿæˆå‘˜åé¦ˆå­¦ä¹ æ›²çº¿é—®é¢˜

**é€‰é¡¹ A: æ¸è¿›è¿ç§»åˆ°çº¯ GraphQL** (å¦‚æœæŸ¥è¯¢å æ¯” > 70%)

è¿ç§»ä¼˜å…ˆçº§:
1. ä¿ç•™ GraphQL æŸ¥è¯¢ (å·²ç¨³å®š)
2. å°†ç®€å• REST å‘½ä»¤æ”¹ä¸º GraphQL Mutation
   ```graphql
   mutation CreateOrganization($input: CreateOrganizationInput!) {
     createOrganization(input: $input) { code name }
   }
   ```
3. å¤æ‚/æ–‡ä»¶ä¸Šä¼ ç­‰ä¿ç•™ REST (æ··åˆå¯æ¥å—)
   - `POST /api/v1/organization-units/import` (æ–‡ä»¶ä¸Šä¼ )
   - `POST /api/v1/operational/tasks/{taskName}/trigger` (è¿ç»´æ“ä½œ)

**é€‰é¡¹ B: æ¸è¿›è¿ç§»åˆ°çº¯ REST** (å¦‚æœç®€å•æ€§ä¼˜å…ˆ)

è¿ç§»ä¼˜å…ˆçº§:
1. ä¿ç•™ REST å‘½ä»¤ (å·²ç¨³å®š)
2. å°†ç®€å• GraphQL æŸ¥è¯¢æ”¹ä¸º REST + å­—æ®µè¿‡æ»¤
   ```http
   GET /api/v1/organization-units?fields=code,name,status&include=parent
   ```
3. å¤æ‚æŸ¥è¯¢ (æ ‘éå†ã€ç»Ÿè®¡) ä¿ç•™ GraphQL

**æˆ‘çš„æœ€ç»ˆå»ºè®®**: **ä¿æŒæ··åˆåè®®,ä¸æ‰§è¡Œé˜¶æ®µ 3**

**ç†ç”±**:
1. é˜¶æ®µ 1 + 2 å·²è§£å†³æ ¸å¿ƒæŒ‘æˆ˜ (æ¶æ„æ‹†åˆ† + å·¥ç¨‹æˆæœ¬)
2. REST å’Œ GraphQL å„æœ‰ä¸å¯æ›¿ä»£çš„ä¼˜åŠ¿:
   - REST: å‘½ä»¤çš„å¹‚ç­‰æ€§ã€æ ‡å‡†åŒ–ã€HTTP ç¼“å­˜
   - GraphQL: æŸ¥è¯¢çš„çµæ´»æ€§ã€å…³è”æŸ¥è¯¢ã€å¼ºç±»å‹
3. åè®®ç»Ÿä¸€çš„æ”¶ç›Š < å¤±å»ä¸“ç”¨åè®®ä¼˜åŠ¿çš„ä»£ä»·
4. ç¬¦åˆ 200å·æ–‡æ¡£çš„"åŠ¡å®ä¸»ä¹‰"åŸåˆ™ (200å·æ–‡æ¡£:129-141)

---

### 6.3 å¦‚æœå¿…é¡»ç»Ÿä¸€åè®® (ä¸æ¨è)

åœ¨æç«¯æƒ…å†µä¸‹ (å¦‚å›¢é˜Ÿè§„æ¨¡æå°,æ— åŠ›ç»´æŠ¤åŒåè®®),é€‰æ‹©ä¼˜å…ˆçº§:

**çº¯ GraphQL > çº¯ REST**

**ç†ç”±**:
1. ERP æŸ¥è¯¢éœ€æ±‚å¤æ‚ (ç»„ç»‡æ ‘ã€å±‚çº§ã€ç»Ÿè®¡),GraphQL å¤©ç„¶ä¼˜åŠ¿
2. GraphQL å¼ºç±»å‹ä¸ 200å·æ–‡æ¡£ç¼–è¯‘æœŸå®‰å…¨ç†å¿µä¸€è‡´
3. å·¥å…·é“¾æˆç†Ÿåº¦å¿«é€Ÿæå‡ (Apollo, gqlgen)
4. å¯ä¿ç•™éƒ¨åˆ† REST ç«¯ç‚¹å¤„ç†ç‰¹æ®Šåœºæ™¯ (æ–‡ä»¶ä¸Šä¼ )

ä½†å†æ¬¡å¼ºè°ƒ: **æ··åˆåè®® (ç»ä¼˜åŒ–å) æ˜¯æœ€ä½³æ–¹æ¡ˆ,ä¸åº”è½»æ˜“æ”¾å¼ƒ**ã€‚

---

## 7. æ€»ç»“ä¸å†³ç­–æ ‘

### 7.1 ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”æ€»ç»“

| ç»´åº¦ | æ··åˆæ¶æ„ (å½“å‰) | çº¯ REST | çº¯ GraphQL |
|------|----------------|---------|------------|
| **æŠ€æœ¯æ ˆå¤æ‚åº¦** | é«˜ (åŒåè®®) | ä½ (å•åè®®) | ä¸­ (å•åè®®ä½†å­¦ä¹ æ›²çº¿é™¡) |
| **æŸ¥è¯¢çµæ´»æ€§** | â­â­â­â­â­ | â­â­ | â­â­â­â­â­ |
| **å‘½ä»¤æ ‡å‡†åŒ–** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­ |
| **HTTP ç¼“å­˜** | â­â­â­â­ (RESTå‘½ä»¤å¯ç¼“å­˜) | â­â­â­â­â­ | â­â­ |
| **ç±»å‹å®‰å…¨** | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ |
| **å·¥å…·é“¾æˆç†Ÿåº¦** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| **å›¢é˜Ÿå­¦ä¹ æˆæœ¬** | é«˜ | ä½ | ä¸­ |
| **è¿ç»´å¤æ‚åº¦** | é«˜ (åŒæœåŠ¡) | ä½ (å•æœåŠ¡) | ä½ (å•æœåŠ¡) |

### 7.2 å†³ç­–æ ‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å½“å‰é—®é¢˜: æ··åˆæ¶æ„çš„ 6 ä¸ªæ ¸å¿ƒæŒ‘æˆ˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ é—®é¢˜æ ¹æºåˆ†æ                 â”‚
      â”‚ âœ… æ ¸å¿ƒ: æœåŠ¡è¿‡æ—©æ‹†åˆ†        â”‚
      â”‚ âŒ éæ ¸å¿ƒ: REST vs GraphQL   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 1: åˆå¹¶ä¸ºæ¨¡å—åŒ–å•ä½“ (ä¿ç•™æ··åˆåè®®)      â”‚
â”‚ æˆæœ¬: ä½ (1-2å‘¨)                              â”‚
â”‚ æ”¶ç›Š: è§£å†³ 4/6 æŒ‘æˆ˜ (#1,#4,#5,#6)            â”‚
â”‚ é£é™©: ä½ (ä»£ç ä¸»è¦åœ¨ main.go å’Œè·¯ç”±å±‚)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 2: å·¥ç¨‹ä¼˜åŒ– (å¥‘çº¦è‡ªåŠ¨åŒ– + API é—¨é¢)     â”‚
â”‚ æˆæœ¬: ä¸­ (1ä¸ªæœˆ)                              â”‚
â”‚ æ”¶ç›Š: è§£å†³ 2/6 æŒ‘æˆ˜ (#2,#3)                  â”‚
â”‚ é£é™©: ä¸­ (éœ€å¼•å…¥ä»£ç ç”Ÿæˆå·¥å…·é“¾)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ æ˜¯å¦éœ€è¦åè®®ç»Ÿä¸€?  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“             â†“             â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ä¿æŒæ··åˆ â”‚   â”‚çº¯GraphQLâ”‚   â”‚ çº¯ REST â”‚
  â”‚  (æ¨è) â”‚   â”‚(æŸ¥è¯¢å¤š) â”‚   â”‚(ç®€å•æ€§) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“              â†“             â†“
   æœ€ä½³å¹³è¡¡      æœ€å¼ºæŸ¥è¯¢      æœ€ç®€è¿ç»´
```

### 7.3 ä¸ 200å·æ–‡æ¡£çš„å¯¹é½åº¦

| 200å·æ–‡æ¡£åŸåˆ™ | æœ¬å»ºè®®çš„ä½“ç° |
|--------------|------------|
| æ¨¡å—åŒ–å•ä½“ä¼˜å…ˆ (200å·æ–‡æ¡£:60-62) | âœ… é˜¶æ®µ1æ ¸å¿ƒç›®æ ‡ |
| é¿å…åˆ†å¸ƒå¼å•ä½“ (200å·æ–‡æ¡£:54-56) | âœ… è¯†åˆ«å½“å‰æ¶æ„é£é™© |
| ç¼–è¯‘æœŸç±»å‹å®‰å…¨ (200å·æ–‡æ¡£:207-241) | âœ… GraphQL å¼ºç±»å‹,å¥‘çº¦è‡ªåŠ¨ç”Ÿæˆ |
| è‡ªåŠ¨åŒ–å·¥ä½œæµ (200å·æ–‡æ¡£:243-257) | âœ… é˜¶æ®µ2 å¥‘çº¦ç”Ÿæˆæµæ°´çº¿ |
| æ¼”è¿›å¼æ¶æ„ (200å·æ–‡æ¡£:72-98) | âœ… åˆ†é˜¶æ®µå®æ–½,å¯éªŒè¯æ”¶ç›Š |
| åŠ¡å®ä¸»ä¹‰ (200å·æ–‡æ¡£:129-141) | âœ… ä¿ç•™æ··åˆåè®®,ä¸è¿½æ±‚çº¯ç²¹æ€§ |

### 7.4 æœ€ç»ˆå£°æ˜

åŸºäºå¯¹é¡¹ç›®å®é™…æƒ…å†µçš„æ·±å…¥åˆ†æã€200å·æ–‡æ¡£æœ€ä½³å®è·µçš„å¯¹ç…§ã€ä»¥åŠä¸‰ç§æ–¹æ¡ˆçš„å…¨é¢è¯„ä¼°,æˆ‘æå‡ºä»¥ä¸‹**åˆ†é˜¶æ®µã€å¯éªŒè¯ã€ä½é£é™©**çš„æ¶æ„æ¼”è¿›å»ºè®®:

**æ ¸å¿ƒç»“è®º**: ä¸è¦æ”¹åè®®,æ”¹æ¶æ„

**æ¨èè·¯çº¿**:
1. **é˜¶æ®µ 1 (P0)**: åˆå¹¶ä¸ºæ¨¡å—åŒ–å•ä½“ - ç«‹å³è§£å†³ 67% çš„æ ¸å¿ƒæŒ‘æˆ˜
2. **é˜¶æ®µ 2 (P1)**: å·¥ç¨‹ä¼˜åŒ– - è§£å†³å‰©ä½™ 33% çš„æŒ‘æˆ˜
3. **é˜¶æ®µ 3 (P2)**: ä¸å»ºè®®æ‰§è¡Œåè®®ç»Ÿä¸€ - æ··åˆåè®®æ˜¯æœ€ä½³å¹³è¡¡

**å¦‚æœå¿…é¡»ç»Ÿä¸€åè®®**: çº¯ GraphQL > çº¯ REST (ä½†ä¸æ¨è)

---

## é™„å½•

### A. å…³é”®ä»£ç ä½ç½®ç´¢å¼•

| ç»„ä»¶ | æ–‡ä»¶è·¯å¾„ | ç›¸å…³ç« èŠ‚ |
|------|----------|---------|
| å‘½ä»¤æœåŠ¡å…¥å£ | `cmd/organization-command-service/main.go` | 2.1, 3.2.1 |
| æŸ¥è¯¢æœåŠ¡å…¥å£ | `cmd/organization-query-service/internal/app/app.go` | 2.1 |
| å‰ç«¯ REST å®¢æˆ·ç«¯ | `frontend/src/shared/api/unified-client.ts` | 3.2.2 |
| å‰ç«¯ GraphQL å®¢æˆ·ç«¯ | `frontend/src/shared/api/graphql-enterprise-adapter.ts` | 3.2.2 |
| REST å¥‘çº¦ | `docs/api/openapi.yaml` | 2.1, 3.2.3 |
| GraphQL Schema | `docs/api/schema.graphql` | 2.1, 3.2.3 |

### B. ç›¸å…³æ–‡æ¡£é“¾æ¥

- **200å·æ–‡æ¡£**: `docs/development-plans/200-Goè¯­è¨€ERPç³»ç»Ÿæœ€ä½³å®è·µ.md`
- **201å·æ–‡æ¡£**: `docs/development-plans/201-Goå®è·µå¯¹é½åˆ†æ.md`
- **API å¥‘çº¦**: `docs/api/`
- **å¼€å‘è€…å¿«é€Ÿå‚è€ƒ**: `docs/reference/01-DEVELOPER-QUICK-REFERENCE.md`

### C. æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| **æ¨¡å—åŒ–å•ä½“** | å•ä¸€éƒ¨ç½²å•å…ƒ,å†…éƒ¨æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†æ¨¡å—,æ¨¡å—é—´é€šè¿‡æ¥å£é€šä¿¡ |
| **CQRS** | Command Query Responsibility Segregation,å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦» |
| **Over-fetching** | è¿”å›çš„æ•°æ®åŒ…å«å®¢æˆ·ç«¯ä¸éœ€è¦çš„å­—æ®µ,æµªè´¹å¸¦å®½ |
| **Under-fetching** | å•æ¬¡è¯·æ±‚æ— æ³•è·å–æ‰€éœ€å…¨éƒ¨æ•°æ®,éœ€è¦å¤šæ¬¡è¯·æ±‚ |
| **N+1 æŸ¥è¯¢** | æŸ¥è¯¢åˆ—è¡¨æ—¶,å¯¹æ¯ä¸ªåˆ—è¡¨é¡¹åˆæ‰§è¡Œä¸€æ¬¡å…³è”æŸ¥è¯¢,å¯¼è‡´æŸ¥è¯¢æ•°çˆ†ç‚¸ |
| **DataLoader** | GraphQL çš„æ‰¹å¤„ç†å’Œç¼“å­˜å·¥å…·,è§£å†³ N+1 é—®é¢˜ |

---

**æ–‡æ¡£ç‰ˆæœ¬å†å²**:
- v1.0 (2025-11-02): åˆå§‹ç‰ˆæœ¬,åŸºäºæ··åˆæ¶æ„æ·±åº¦åˆ†æä¸ä¸‰æ–¹æ¡ˆå¯¹æ¯”

**å®¡æ ¸çŠ¶æ€**: âœ… å·²å®Œæˆåˆ†æ (è¯æ®å®Œæ•´æ€§ 100%)

**ç»´æŠ¤è´£ä»»**: é¡¹ç›®æ¶æ„å›¢é˜Ÿ
**ä¸‹æ¬¡è¯„å®¡**: é˜¶æ®µ1å®Œæˆå (é¢„è®¡ 2026-Q1)
