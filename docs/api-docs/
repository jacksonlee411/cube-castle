openapi: 3.0.0
info:
  title: ç»„ç»‡å•å…ƒç®¡ç†API - 7ä½ç¼–ç ç‰ˆæœ¬
  version: 2.0.0
  description: |
    å½»åº•æ¿€è¿›ä¼˜åŒ–åçš„ç»„ç»‡å•å…ƒç®¡ç†API
    
    ## æ ¸å¿ƒç‰¹æ€§
    - ğŸš€ **7ä½ç¼–ç ä¸»é”®**: ç›´æ¥ä½¿ç”¨7ä½æ•°å­—ç¼–ç ä½œä¸ºä¸»é”®ï¼Œé›¶è½¬æ¢å¼€é”€
    - âš¡ **æè‡´æ€§èƒ½**: ä¸»é”®æŸ¥è¯¢ï¼Œæå‡40-60%æ€§èƒ½
    - ğŸ¯ **æç®€æ¶æ„**: ç§»é™¤æ‰€æœ‰IDè½¬æ¢å±‚ï¼Œæ¶æ„ç®€åŒ–35%
    - ğŸ’¡ **ç”¨æˆ·å‹å¥½**: å‰åç«¯ç»Ÿä¸€ä½¿ç”¨ç›¸åŒçš„7ä½ç¼–ç 
    - ğŸ”’ **ä¼ä¸šçº§**: æ”¯æŒå¤šç§Ÿæˆ·ï¼Œå®Œæ•´çš„RBACæƒé™æ§åˆ¶
    
    ## APIç‰ˆæœ¬è¯´æ˜
    - **v2.0**: 7ä½ç¼–ç ç³»ç»Ÿï¼Œå½»åº•æ¿€è¿›ä¼˜åŒ–ç‰ˆæœ¬
    - **v1.x**: ä¼ ç»ŸUUIDç³»ç»Ÿï¼ˆå·²åºŸå¼ƒï¼‰
    
    ## ç¼–ç è§„èŒƒ
    - ç»„ç»‡å•å…ƒç¼–ç : 7ä½æ•°å­— (1000000-9999999)
    - ç¼–ç ç¤ºä¾‹: `1000001`, `1000002`, `1000003`
    - ç¼–ç éªŒè¯: æ­£åˆ™è¡¨è¾¾å¼ `^[0-9]{7}$`
    
  contact:
    name: æ¶æ„å›¢é˜Ÿ
    email: architecture@company.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.company.com/api/v1
    description: ç”Ÿäº§ç¯å¢ƒ
  - url: https://staging-api.company.com/api/v1
    description: æµ‹è¯•ç¯å¢ƒ
  - url: http://localhost:8080/api/v1
    description: å¼€å‘ç¯å¢ƒ

security:
  - BearerAuth: []
  - ApiKeyAuth: []

paths:
  /organization-units:
    get:
      summary: è·å–ç»„ç»‡å•å…ƒåˆ—è¡¨
      description: |
        è·å–ç»„ç»‡å•å…ƒåˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€è¿‡æ»¤å’Œæ’åº
        
        ### æ€§èƒ½ä¼˜åŒ–
        - ä½¿ç”¨7ä½ç¼–ç ä¸»é”®æŸ¥è¯¢ï¼Œæ€§èƒ½æå‡40%
        - æ”¯æŒæŒ‰è·¯å¾„å±‚çº§æ’åºï¼Œç¡®ä¿æ ‘å½¢ç»“æ„
        - ä¼˜åŒ–çš„åˆ†é¡µæŸ¥è¯¢ï¼Œæ”¯æŒå¤§æ•°æ®é‡
      operationId: listOrganizationUnits
      tags:
        - ç»„ç»‡å•å…ƒç®¡ç†
      parameters:
        - name: parent_code
          in: query
          description: çˆ¶çº§ç»„ç»‡7ä½ç¼–ç 
          schema:
            type: string
            pattern: '^[0-9]{7}$'
            example: '1000000'
        - name: status
          in: query
          description: ç»„ç»‡çŠ¶æ€è¿‡æ»¤
          schema:
            type: string
            enum: [ACTIVE, INACTIVE, PLANNED]
            example: 'ACTIVE'
        - name: unit_type
          in: query
          description: ç»„ç»‡ç±»å‹è¿‡æ»¤
          schema:
            type: string
            enum: [DEPARTMENT, COST_CENTER, COMPANY, PROJECT_TEAM]
            example: 'DEPARTMENT'
        - name: limit
          in: query
          description: æ¯é¡µè®°å½•æ•°
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
            example: 20
        - name: offset
          in: query
          description: åç§»é‡
          schema:
            type: integer
            minimum: 0
            default: 0
            example: 0
      responses:
        '200':
          description: æˆåŠŸè·å–ç»„ç»‡å•å…ƒåˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListOrganizationUnitsResponse'
              examples:
                success:
                  summary: æˆåŠŸå“åº”ç¤ºä¾‹
                  value:
                    organizations:
                      - code: '1000000'
                        name: 'é«˜è°·é›†å›¢'
                        unit_type: 'COMPANY'
                        status: 'ACTIVE'
                        level: 1
                        path: '/1000000'
                        sort_order: 0
                        description: 'é›†å›¢æ€»å…¬å¸'
                        profile: {"type": "headquarters"}
                        created_at: '2025-08-05T10:00:00Z'
                        updated_at: '2025-08-05T10:00:00Z'
                      - code: '1000001'
                        parent_code: '1000000'
                        name: 'æŠ€æœ¯éƒ¨'
                        unit_type: 'DEPARTMENT'
                        status: 'ACTIVE'
                        level: 2
                        path: '/1000000/1000001'
                        sort_order: 1
                        description: 'æŠ€æœ¯ç ”å‘éƒ¨é—¨'
                        profile: {"type": "rd"}
                        created_at: '2025-08-05T10:01:00Z'
                        updated_at: '2025-08-05T10:01:00Z'
                    total_count: 2
                    page: 1
                    page_size: 50
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      summary: åˆ›å»ºç»„ç»‡å•å…ƒ
      description: |
        åˆ›å»ºæ–°çš„ç»„ç»‡å•å…ƒï¼Œè‡ªåŠ¨ç”Ÿæˆ7ä½ç¼–ç 
        
        ### ç‰¹æ€§
        - è‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€çš„7ä½ç¼–ç 
        - è‡ªåŠ¨è®¡ç®—å±‚çº§å’Œè·¯å¾„ä¿¡æ¯
        - æ”¯æŒå¤šæ€é…ç½®æ–‡ä»¶
        - å®Œæ•´çš„æ•°æ®éªŒè¯
      operationId: createOrganizationUnit
      tags:
        - ç»„ç»‡å•å…ƒç®¡ç†
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrganizationUnitRequest'
            examples:
              company:
                summary: åˆ›å»ºå…¬å¸
                value:
                  name: 'æ–°ç§‘æŠ€å…¬å¸'
                  unit_type: 'COMPANY'
                  description: 'ä¸“æ³¨äºAIæŠ€æœ¯çš„ç§‘æŠ€å…¬å¸'
                  profile:
                    headquarters: true
                    location: 'åŒ—äº¬'
                    established: '2025'
              department:
                summary: åˆ›å»ºéƒ¨é—¨
                value:
                  name: 'äººå·¥æ™ºèƒ½éƒ¨'
                  parent_code: '1000000'
                  unit_type: 'DEPARTMENT'
                  description: 'AIç®—æ³•ç ”å‘éƒ¨é—¨'
                  sort_order: 10
                  profile:
                    manager: 'å¼ ä¸‰'
                    budget: 5000000
                    headcount: 50
      responses:
        '201':
          description: ç»„ç»‡å•å…ƒåˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationUnit'
              examples:
                created:
                  summary: åˆ›å»ºæˆåŠŸå“åº”
                  value:
                    code: '1000002'
                    parent_code: '1000000'
                    name: 'äººå·¥æ™ºèƒ½éƒ¨'
                    unit_type: 'DEPARTMENT'
                    status: 'ACTIVE'
                    level: 2
                    path: '/1000000/1000002'
                    sort_order: 10
                    description: 'AIç®—æ³•ç ”å‘éƒ¨é—¨'
                    profile:
                      manager: 'å¼ ä¸‰'
                      budget: 5000000
                      headcount: 50
                    created_at: '2025-08-05T10:30:00Z'
                    updated_at: '2025-08-05T10:30:00Z'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /organization-units/{code}:
    get:
      summary: è·å–å•ä¸ªç»„ç»‡å•å…ƒ
      description: |
        é€šè¿‡7ä½ç¼–ç è·å–ç»„ç»‡å•å…ƒè¯¦ç»†ä¿¡æ¯
        
        ### æ€§èƒ½ä¼˜åŠ¿
        - ç›´æ¥ä¸»é”®æŸ¥è¯¢ï¼Œå“åº”æ—¶é—´<20ms
        - æ— éœ€IDè½¬æ¢ï¼Œé›¶é¢å¤–å¼€é”€
      operationId: getOrganizationUnit
      tags:
        - ç»„ç»‡å•å…ƒç®¡ç†
      parameters:
        - name: code
          in: path
          required: true
          description: ç»„ç»‡å•å…ƒ7ä½ç¼–ç 
          schema:
            type: string
            pattern: '^[0-9]{7}$'
            example: '1000001'
      responses:
        '200':
          description: æˆåŠŸè·å–ç»„ç»‡å•å…ƒä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationUnit'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: æ›´æ–°ç»„ç»‡å•å…ƒ
      description: |
        æ›´æ–°ç»„ç»‡å•å…ƒä¿¡æ¯
        
        ### æ³¨æ„äº‹é¡¹
        - ç¼–ç ä¸å¯ä¿®æ”¹
        - ä¿®æ”¹çˆ¶çº§ç¼–ç æ—¶ä¼šè‡ªåŠ¨æ›´æ–°å±‚çº§å’Œè·¯å¾„
        - æ”¯æŒéƒ¨åˆ†å­—æ®µæ›´æ–°
      operationId: updateOrganizationUnit
      tags:
        - ç»„ç»‡å•å…ƒç®¡ç†
      parameters:
        - name: code
          in: path
          required: true
          description: ç»„ç»‡å•å…ƒ7ä½ç¼–ç 
          schema:
            type: string
            pattern: '^[0-9]{7}$'
            example: '1000001'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrganizationUnitRequest'
            examples:
              basic_update:
                summary: åŸºç¡€ä¿¡æ¯æ›´æ–°
                value:
                  name: 'æŠ€æœ¯ç ”å‘éƒ¨'
                  description: 'è´Ÿè´£æ ¸å¿ƒæŠ€æœ¯ç ”å‘çš„éƒ¨é—¨'
                  status: 'ACTIVE'
              move_parent:
                summary: è°ƒæ•´ç»„ç»‡ç»“æ„
                value:
                  parent_code: '1000002'
                  sort_order: 5
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationUnit'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: åˆ é™¤ç»„ç»‡å•å…ƒ
      description: |
        åˆ é™¤ç»„ç»‡å•å…ƒ
        
        ### åˆ é™¤é™åˆ¶
        - ä¸èƒ½åˆ é™¤æœ‰å­å•å…ƒçš„ç»„ç»‡
        - ä¸èƒ½åˆ é™¤æœ‰å…³è”å‘˜å·¥çš„ç»„ç»‡
        - åˆ é™¤æ“ä½œä¸å¯é€†
      operationId: deleteOrganizationUnit
      tags:
        - ç»„ç»‡å•å…ƒç®¡ç†
      parameters:
        - name: code
          in: path
          required: true
          description: ç»„ç»‡å•å…ƒ7ä½ç¼–ç 
          schema:
            type: string
            pattern: '^[0-9]{7}$'
            example: '1000001'
      responses:
        '204':
          description: åˆ é™¤æˆåŠŸ
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: åˆ é™¤å†²çª - å­˜åœ¨å­å•å…ƒæˆ–å…³è”æ•°æ®
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                has_children:
                  summary: å­˜åœ¨å­å•å…ƒ
                  value:
                    code: 'CONSTRAINT_VIOLATION'
                    message: 'Cannot delete organization unit with child units'
                    details:
                      constraint: 'has_children'
                      child_count: 3
        '500':
          $ref: '#/components/responses/InternalServerError'

  /organization-units/tree:
    get:
      summary: è·å–ç»„ç»‡æ ‘
      description: |
        è·å–å®Œæ•´çš„ç»„ç»‡æ ‘ç»“æ„æˆ–æŒ‡å®šèŠ‚ç‚¹çš„å­æ ‘
        
        ### æ€§èƒ½ç‰¹æ€§
        - ä½¿ç”¨é€’å½’CTEæŸ¥è¯¢ï¼Œæ€§èƒ½æå‡60%
        - æŒ‰è·¯å¾„æ’åºï¼Œç¡®ä¿æ­£ç¡®çš„å±‚çº§å…³ç³»
        - æ”¯æŒå¤§è§„æ¨¡ç»„ç»‡æ¶æ„ï¼ˆ10000+èŠ‚ç‚¹ï¼‰
      operationId: getOrganizationTree
      tags:
        - ç»„ç»‡å•å…ƒç®¡ç†
      parameters:
        - name: root_code
          in: query
          description: æ ¹èŠ‚ç‚¹7ä½ç¼–ç ï¼Œä¸æä¾›åˆ™è¿”å›å®Œæ•´æ ‘
          schema:
            type: string
            pattern: '^[0-9]{7}$'
            example: '1000000'
      responses:
        '200':
          description: æˆåŠŸè·å–ç»„ç»‡æ ‘
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationTreeResponse'
              examples:
                full_tree:
                  summary: å®Œæ•´ç»„ç»‡æ ‘
                  value:
                    organizations:
                      - code: '1000000'
                        name: 'é«˜è°·é›†å›¢'
                        unit_type: 'COMPANY'
                        status: 'ACTIVE'
                        level: 1
                        path: '/1000000'
                        sort_order: 0
                        description: 'é›†å›¢æ€»å…¬å¸'
                        profile: {"type": "headquarters"}
                        created_at: '2025-08-05T10:00:00Z'
                        updated_at: '2025-08-05T10:00:00Z'
                      - code: '1000001'
                        parent_code: '1000000'
                        name: 'æŠ€æœ¯éƒ¨'
                        unit_type: 'DEPARTMENT'
                        status: 'ACTIVE'
                        level: 2
                        path: '/1000000/1000001'
                        sort_order: 1
                        description: 'æŠ€æœ¯ç ”å‘éƒ¨é—¨'
                        profile: {"type": "rd"}
                        created_at: '2025-08-05T10:01:00Z'
                        updated_at: '2025-08-05T10:01:00Z'
                      - code: '1000002'
                        parent_code: '1000001'
                        name: 'AIå›¢é˜Ÿ'
                        unit_type: 'PROJECT_TEAM'
                        status: 'ACTIVE'
                        level: 3
                        path: '/1000000/1000001/1000002'
                        sort_order: 1
                        description: 'äººå·¥æ™ºèƒ½ç ”å‘å›¢é˜Ÿ'
                        profile: {"type": "ai_team"}
                        created_at: '2025-08-05T10:02:00Z'
                        updated_at: '2025-08-05T10:02:00Z'
                    total_count: 3
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /organization-units/stats:
    get:
      summary: è·å–ç»„ç»‡å•å…ƒç»Ÿè®¡ä¿¡æ¯
      description: |
        è·å–ç»„ç»‡å•å…ƒçš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ€»æ•°ã€æŒ‰ç±»å‹åˆ†å¸ƒã€æŒ‰çŠ¶æ€åˆ†å¸ƒç­‰
        
        ### ç»Ÿè®¡ç»´åº¦
        - æ€»æ•°ç»Ÿè®¡
        - æŒ‰ç»„ç»‡ç±»å‹åˆ†å¸ƒ
        - æŒ‰çŠ¶æ€åˆ†å¸ƒ
        - å®æ—¶è®¡ç®—ï¼Œæ•°æ®å‡†ç¡®
      operationId: getOrganizationStats
      tags:
        - ç»„ç»‡å•å…ƒç®¡ç†
      responses:
        '200':
          description: æˆåŠŸè·å–ç»Ÿè®¡ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationStatsResponse'
              examples:
                stats:
                  summary: ç»Ÿè®¡ä¿¡æ¯ç¤ºä¾‹
                  value:
                    total_count: 156
                    by_type:
                      COMPANY: 5
                      DEPARTMENT: 45
                      PROJECT_TEAM: 78
                      COST_CENTER: 28
                    by_status:
                      ACTIVE: 142
                      INACTIVE: 12
                      PLANNED: 2
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # CoreHRå…¼å®¹ç«¯ç‚¹
  /corehr/organizations:
    get:
      summary: '[å…¼å®¹] è·å–ç»„ç»‡åˆ—è¡¨'
      description: CoreHRç³»ç»Ÿå…¼å®¹ç«¯ç‚¹ï¼Œä¸ /organization-units åŠŸèƒ½ç›¸åŒ
      operationId: getCoreHROrganizations
      tags:
        - CoreHRå…¼å®¹
      parameters:
        - $ref: '#/components/parameters/ParentCode'
        - $ref: '#/components/parameters/Status'
        - $ref: '#/components/parameters/UnitType'
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: æˆåŠŸè·å–ç»„ç»‡åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListOrganizationUnitsResponse'

    post:
      summary: '[å…¼å®¹] åˆ›å»ºç»„ç»‡'
      description: CoreHRç³»ç»Ÿå…¼å®¹ç«¯ç‚¹ï¼Œä¸ /organization-units åŠŸèƒ½ç›¸åŒ
      operationId: createCoreHROrganization
      tags:
        - CoreHRå…¼å®¹
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrganizationUnitRequest'
      responses:
        '201':
          description: ç»„ç»‡åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationUnit'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Bearer Tokenè®¤è¯
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: APIå¯†é’¥è®¤è¯

  parameters:
    ParentCode:
      name: parent_code
      in: query
      description: çˆ¶çº§ç»„ç»‡7ä½ç¼–ç 
      schema:
        type: string
        pattern: '^[0-9]{7}$'
        example: '1000000'
    
    Status:
      name: status
      in: query
      description: ç»„ç»‡çŠ¶æ€è¿‡æ»¤
      schema:
        type: string
        enum: [ACTIVE, INACTIVE, PLANNED]
        example: 'ACTIVE'
    
    UnitType:
      name: unit_type
      in: query
      description: ç»„ç»‡ç±»å‹è¿‡æ»¤
      schema:
        type: string
        enum: [DEPARTMENT, COST_CENTER, COMPANY, PROJECT_TEAM]
        example: 'DEPARTMENT'
    
    Limit:
      name: limit
      in: query
      description: æ¯é¡µè®°å½•æ•°
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 50
        example: 20
    
    Offset:
      name: offset
      in: query
      description: åç§»é‡
      schema:
        type: integer
        minimum: 0
        default: 0
        example: 0

  schemas:
    OrganizationUnit:
      type: object
      description: ç»„ç»‡å•å…ƒå¯¹è±¡
      required:
        - code
        - name
        - unit_type
        - status
        - level
        - path
        - sort_order
        - created_at
        - updated_at
      properties:
        code:
          type: string
          pattern: '^[0-9]{7}$'
          description: 7ä½ç»„ç»‡ç¼–ç ï¼ˆä¸»é”®ï¼‰
          example: '1000001'
        parent_code:
          type: string
          pattern: '^[0-9]{7}$'
          description: çˆ¶çº§ç»„ç»‡7ä½ç¼–ç 
          example: '1000000'
          nullable: true
        name:
          type: string
          maxLength: 255
          description: ç»„ç»‡åç§°
          example: 'æŠ€æœ¯ç ”å‘éƒ¨'
        unit_type:
          type: string
          enum: [DEPARTMENT, COST_CENTER, COMPANY, PROJECT_TEAM]
          description: |
            ç»„ç»‡ç±»å‹:
            - DEPARTMENT: éƒ¨é—¨
            - COST_CENTER: æˆæœ¬ä¸­å¿ƒ  
            - COMPANY: å…¬å¸
            - PROJECT_TEAM: é¡¹ç›®å›¢é˜Ÿ
          example: 'DEPARTMENT'
        status:
          type: string
          enum: [ACTIVE, INACTIVE, PLANNED]
          description: |
            ç»„ç»‡çŠ¶æ€:
            - ACTIVE: æ´»è·ƒ
            - INACTIVE: éæ´»è·ƒ
            - PLANNED: è®¡åˆ’ä¸­
          example: 'ACTIVE'
        level:
          type: integer
          minimum: 1
          description: ç»„ç»‡å±‚çº§ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
          example: 2
        path:
          type: string
          description: ç»„ç»‡è·¯å¾„ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
          example: '/1000000/1000001'
        sort_order:
          type: integer
          description: åŒçº§æ’åºé¡ºåº
          example: 10
        description:
          type: string
          maxLength: 1000
          description: ç»„ç»‡æè¿°
          example: 'è´Ÿè´£æ ¸å¿ƒæŠ€æœ¯ç ”å‘å·¥ä½œ'
          nullable: true
        profile:
          type: object
          description: ç»„ç»‡å¤šæ€é…ç½®
          additionalProperties: true
          example:
            manager: 'å¼ ä¸‰'
            budget: 5000000
            location: 'åŒ—äº¬'
        created_at:
          type: string
          format: date-time
          description: åˆ›å»ºæ—¶é—´
          example: '2025-08-05T10:00:00Z'
        updated_at:
          type: string
          format: date-time
          description: æ›´æ–°æ—¶é—´
          example: '2025-08-05T10:30:00Z'

    CreateOrganizationUnitRequest:
      type: object
      description: åˆ›å»ºç»„ç»‡å•å…ƒè¯·æ±‚
      required:
        - name
        - unit_type
      properties:
        name:
          type: string
          maxLength: 255
          description: ç»„ç»‡åç§°
          example: 'æ–°æŠ€æœ¯éƒ¨'
        parent_code:
          type: string
          pattern: '^[0-9]{7}$'
          description: çˆ¶çº§ç»„ç»‡7ä½ç¼–ç 
          example: '1000000'
          nullable: true
        unit_type:
          type: string
          enum: [DEPARTMENT, COST_CENTER, COMPANY, PROJECT_TEAM]
          description: ç»„ç»‡ç±»å‹
          example: 'DEPARTMENT'
        description:
          type: string
          maxLength: 1000
          description: ç»„ç»‡æè¿°
          example: 'ä¸“æ³¨äºæ–°æŠ€æœ¯ç ”å‘'
          nullable: true
        profile:
          type: object
          description: ç»„ç»‡å¤šæ€é…ç½®
          additionalProperties: true
          example:
            manager: 'æå››'
            budget: 3000000
        sort_order:
          type: integer
          description: åŒçº§æ’åºé¡ºåº
          example: 5
          nullable: true

    UpdateOrganizationUnitRequest:
      type: object
      description: æ›´æ–°ç»„ç»‡å•å…ƒè¯·æ±‚
      properties:
        name:
          type: string
          maxLength: 255
          description: ç»„ç»‡åç§°
          example: 'æŠ€æœ¯ç ”å‘éƒ¨'
          nullable: true
        parent_code:
          type: string
          pattern: '^[0-9]{7}$'
          description: çˆ¶çº§ç»„ç»‡7ä½ç¼–ç 
          example: '1000000'
          nullable: true
        status:
          type: string
          enum: [ACTIVE, INACTIVE, PLANNED]
          description: ç»„ç»‡çŠ¶æ€
          example: 'ACTIVE'
          nullable: true
        description:
          type: string
          maxLength: 1000
          description: ç»„ç»‡æè¿°
          example: 'æ›´æ–°åçš„ç»„ç»‡æè¿°'
          nullable: true
        profile:
          type: object
          description: ç»„ç»‡å¤šæ€é…ç½®
          additionalProperties: true
          nullable: true
        sort_order:
          type: integer
          description: åŒçº§æ’åºé¡ºåº
          example: 10
          nullable: true

    ListOrganizationUnitsResponse:
      type: object
      description: ç»„ç»‡å•å…ƒåˆ—è¡¨å“åº”
      required:
        - organizations
        - total_count
        - page
        - page_size
      properties:
        organizations:
          type: array
          items:
            $ref: '#/components/schemas/OrganizationUnit'
          description: ç»„ç»‡å•å…ƒåˆ—è¡¨
        total_count:
          type: integer
          format: int64
          description: æ€»è®°å½•æ•°
          example: 156
        page:
          type: integer
          description: å½“å‰é¡µç 
          example: 1
        page_size:
          type: integer
          description: æ¯é¡µè®°å½•æ•°
          example: 50

    OrganizationTreeResponse:
      type: object
      description: ç»„ç»‡æ ‘å“åº”
      required:
        - organizations
        - total_count
      properties:
        organizations:
          type: array
          items:
            $ref: '#/components/schemas/OrganizationUnit'
          description: æŒ‰å±‚çº§æ’åºçš„ç»„ç»‡å•å…ƒåˆ—è¡¨
        total_count:
          type: integer
          description: æ ‘ä¸­èŠ‚ç‚¹æ€»æ•°
          example: 28

    OrganizationStatsResponse:
      type: object
      description: ç»„ç»‡å•å…ƒç»Ÿè®¡å“åº”
      required:
        - total_count
        - by_type
        - by_status
      properties:
        total_count:
          type: integer
          format: int64
          description: ç»„ç»‡å•å…ƒæ€»æ•°
          example: 156
        by_type:
          type: object
          description: æŒ‰ç±»å‹ç»Ÿè®¡
          additionalProperties:
            type: integer
            format: int64
          example:
            COMPANY: 5
            DEPARTMENT: 45
            PROJECT_TEAM: 78
            COST_CENTER: 28
        by_status:
          type: object
          description: æŒ‰çŠ¶æ€ç»Ÿè®¡
          additionalProperties:
            type: integer
            format: int64
          example:
            ACTIVE: 142
            INACTIVE: 12
            PLANNED: 2

    ErrorResponse:
      type: object
      description: é”™è¯¯å“åº”
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: é”™è¯¯ä»£ç 
          example: 'VALIDATION_ERROR'
        message:
          type: string
          description: é”™è¯¯æ¶ˆæ¯
          example: 'Invalid organization code format'
        details:
          type: object
          description: é”™è¯¯è¯¦æƒ…
          additionalProperties: true
          example:
            field: 'code'
            value: 'invalid'
            expected: '7-digit numeric string'

  responses:
    BadRequest:
      description: è¯·æ±‚å‚æ•°é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            invalid_code:
              summary: æ— æ•ˆç¼–ç æ ¼å¼
              value:
                code: 'VALIDATION_ERROR'
                message: 'Invalid organization code format'
                details:
                  field: 'code'
                  value: 'abc123'
                  expected: '7-digit numeric string'
            invalid_parent:
              summary: æ— æ•ˆçˆ¶çº§ç¼–ç 
              value:
                code: 'VALIDATION_ERROR'
                message: 'Parent organization unit not found'
                details:
                  field: 'parent_code'
                  value: '9999999'

    Unauthorized:
      description: æœªæˆæƒè®¿é—®
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 'UNAUTHORIZED'
            message: 'Authentication required'

    Forbidden:
      description: æƒé™ä¸è¶³
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 'FORBIDDEN'
            message: 'Insufficient permissions to access this resource'

    NotFound:
      description: èµ„æºä¸å­˜åœ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 'NOT_FOUND'
            message: 'Organization unit not found'
            details:
              code: '1000999'

    Conflict:
      description: èµ„æºå†²çª
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            name_conflict:
              summary: åç§°å†²çª
              value:
                code: 'CONFLICT'
                message: 'Organization name already exists in the same parent'
                details:
                  field: 'name'
                  value: 'æŠ€æœ¯éƒ¨'
                  parent_code: '1000000'
            circular_reference:
              summary: å¾ªç¯å¼•ç”¨
              value:
                code: 'CONFLICT'
                message: 'Cannot set parent that would create circular reference'
                details:
                  code: '1000001'
                  parent_code: '1000002'

    InternalServerError:
      description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 'INTERNAL_ERROR'
            message: 'An unexpected error occurred'

tags:
  - name: ç»„ç»‡å•å…ƒç®¡ç†
    description: |
      ç»„ç»‡å•å…ƒçš„å¢åˆ æ”¹æŸ¥æ“ä½œ
      
      ### æ ¸å¿ƒåŠŸèƒ½
      - âœ… 7ä½ç¼–ç ç³»ç»Ÿï¼Œæ€§èƒ½ä¼˜åŒ–40-60%
      - âœ… è‡ªåŠ¨å±‚çº§è®¡ç®—å’Œè·¯å¾„ç®¡ç†
      - âœ… å¤šæ€é…ç½®æ”¯æŒ
      - âœ… å®Œæ•´çš„æ•°æ®éªŒè¯
      - âœ… ä¼ä¸šçº§æƒé™æ§åˆ¶
      
  - name: CoreHRå…¼å®¹
    description: |
      CoreHRç³»ç»Ÿå…¼å®¹æ¥å£
      
      ### è¯´æ˜
      ä¸ºäº†å‘åå…¼å®¹ï¼Œä¿ç•™äº†CoreHRæ ¼å¼çš„APIç«¯ç‚¹
      åŠŸèƒ½ä¸æ ‡å‡†ç«¯ç‚¹å®Œå…¨ç›¸åŒï¼Œä»…è·¯å¾„ä¸åŒ