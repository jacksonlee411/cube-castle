# ğŸ“ Cube Castle API è§„èŒƒå˜æ›´æ—¥å¿—

æœ¬æ–‡ä»¶è®°å½•Cube Castle APIè§„èŒƒæ–‡ä»¶ (`openapi.yaml` å’Œ `schema.graphql`) çš„æ‰€æœ‰é‡è¦å˜æ›´ã€‚

## æ ¼å¼è¯´æ˜

- **æ–°å¢** - æ–°åŠŸèƒ½
- **å˜æ›´** - ç°æœ‰åŠŸèƒ½çš„ä¿®æ”¹  
- **åºŸå¼ƒ** - å³å°†ç§»é™¤çš„åŠŸèƒ½
- **ç§»é™¤** - å·²åˆ é™¤çš„åŠŸèƒ½
- **ä¿®å¤** - é”™è¯¯ä¿®æ­£
- **å®‰å…¨** - å®‰å…¨ç›¸å…³çš„ä¿®æ­£

---

## [v4.6.2] - 2025-09-15 ğŸ”’ å®¡è®¡è§¦å‘å™¨é€€åœºä¸åº”ç”¨å±‚å®¡è®¡ç»Ÿä¸€

### å˜æ›´ - å®¡è®¡äº§å‡ºæœºåˆ¶ç»Ÿä¸€ï¼ˆè¿ç§»è¯´æ˜ï¼‰
- ç§»é™¤æ•°æ®åº“è¡Œçº§å®¡è®¡è§¦å‘å™¨ï¼ˆlog_audit_changes/audit_changes_triggerï¼‰ï¼Œç”±åº”ç”¨å±‚ç»“æ„åŒ–å®¡è®¡ä½œä¸ºå•ä¸€äº‹å®æ¥æºã€‚
  - æ•°æ®åº“è¿ç§»ï¼š
    - 027_fix_audit_trigger_op_type_from_tg_op.sqlï¼ˆè¿‡æ¸¡ä¿®å¤ï¼Œé¿å…è¯»å–å·²ç§»é™¤åˆ— NEW.operation_typeï¼‰
    - 028_drop_legacy_row_audit_trigger.sqlï¼ˆæœ€ç»ˆç§»é™¤è¡Œçº§è§¦å‘å™¨ä¸å‡½æ•°ï¼‰
  - ç†ç”±ï¼š
    - å®¡è®¡å¥‘çº¦å·²ç»Ÿä¸€è‡³ `audit_logs` æ–°åˆ—ï¼ˆevent_type/resource_type/resource_id/actor_id/...ï¼‰ã€‚
    - åŠ¨æ€æ ‡å¿—ï¼ˆis_current/is_temporal/is_futureï¼‰ä¸åº”æŒä¹…åŒ–åˆ°å®¡è®¡å¿«ç…§ï¼Œåº”ç”¨å±‚å·²æŒ‰å¥‘çº¦è¿‡æ»¤ã€‚
    - é¿å…è§¦å‘å™¨ä¸ä¸šåŠ¡è¡¨ç»“æ„æ¼”è¿›ä¸ä¸€è‡´å¯¼è‡´å†™å…¥å¤±è´¥ã€‚
- `operationReason` å­—æ®µæ”¹ä¸ºå¯é€‰ï¼šæ›´æ–°äº† `CreateOrganizationUnitRequest`ã€`CreateVersionRequest`ã€åœç”¨/å¯ç”¨ç­‰è¯·æ±‚ä½“çš„å¿…å¡«åˆ—è¡¨ï¼Œå¹¶åœ¨å“åº”è¯´æ˜ä¸­æ ‡æ³¨çœç•¥æ—¶è®°å½•ä¸ºç©ºå€¼ã€‚

### ä¿®å¤ - ç›‘æ§æ¨¡å—å…¼å®¹å»åˆ—ï¼ˆis_futureï¼‰
- ç›‘æ§ç»Ÿè®¡æ”¹ä¸ºæ´¾ç”Ÿè¡¨è¾¾å¼ï¼š
  - æœªæ¥è®°å½•ï¼š`effective_date > CURRENT_DATE`
  - å†å²è®°å½•ï¼š`end_date IS NOT NULL AND end_date <= CURRENT_DATE`
  - ä¸å†å¼•ç”¨å·²ç§»é™¤åˆ— `is_future`ã€‚

### å…¼å®¹æ€§
- API æ— ç ´åæ€§å˜æ›´ï¼›æ•°æ®åº“å±‚ä»…ç§»é™¤äº†å†…éƒ¨ç”¨è§¦å‘å™¨ï¼Œä¸å½±å“å¤–éƒ¨å¥‘çº¦ã€‚
- åº”ç”¨å±‚å®¡è®¡ä¸ºæƒå¨æœºåˆ¶ï¼Œå®¢æˆ·ç«¯æŸ¥è¯¢/å±•ç¤ºä¸å—å½±å“ã€‚

### å‡çº§æ­¥éª¤ï¼ˆè¿è¡Œæ—¶ï¼‰
1) æŒ‰åºæ‰§è¡Œæ•°æ®åº“è¿ç§» `database/migrations/027_*.sql` ä¸ `028_*.sql`ã€‚
2) é‡å¯å‘½ä»¤æœåŠ¡ï¼Œä½¿ç›‘æ§ä¸å®¡è®¡å†™å…¥é€»è¾‘ç”Ÿæ•ˆã€‚

---

## [v4.5.1] - 2025-09-06 âœ… APIå¥‘çº¦ä¸ç®€åŒ–å®ç°å¯¹é½

### å˜æ›´ - å¹‚ç­‰ä¸å†²çªè¯­ä¹‰
- OpenAPI (`openapi.yaml`) ç‰ˆæœ¬ä» 4.5.0 â†’ 4.5.1ï¼š
  - æ–°å¢å¯é€‰è¯·æ±‚å¤´ `Idempotency-Key`ï¼ˆcomponents.parameters.IdempotencyKeyHeaderï¼‰
  - ä¸ºä»¥ä¸‹ç«¯ç‚¹åŠ å…¥å¹‚ç­‰é”®æ”¯æŒä¸ 200 é‡æ”¾ç¤ºä¾‹ï¼š
    - `POST /api/v1/organization-units`
    - `POST /api/v1/organization-units/{code}/versions`
    - `POST /api/v1/organization-units/{code}/suspend`
    - `POST /api/v1/organization-units/{code}/activate`
  - åœ¨ `components.responses.Conflict` ä¸­æ˜ç¡®ä¸¤ç±»æ—¶æ€å†²çªï¼š
    - `TEMPORAL_POINT_CONFLICT`ï¼šå”¯ä¸€ `(tenant_id, code, effective_date)` å†²çª
    - `CURRENT_CONFLICT`ï¼šéƒ¨åˆ†å”¯ä¸€ `(tenant_id, code) WHERE is_current=true` å†²çª
  - `/versions` ç«¯ç‚¹æè¿°æ›´æ–°ï¼šç”±â€œè‡ªåŠ¨ç»´æŠ¤â€æ”¹ä¸ºâ€œåº”ç”¨äº‹åŠ¡ç»´æŠ¤ is_current/end_date è½¬æ¢â€

### å˜æ›´ - æ–‡æ¡£æªè¾ä¸å®ç°å¯¹é½
- GraphQL (`schema.graphql`) æ³¨é‡Šï¼šç§»é™¤â€œ26ä¸ªä¸“ç”¨ç´¢å¼•â€è¡¨è¿°
- æ¶æ„è§„èŒƒ (`docs/architecture/01-organization-units-api-specification.md`)ï¼š
  - REST ç«¯ç‚¹æ¸…å•è¡¥é½ `/activate`
  - â€œæ•°æ®åº“è®¾è®¡â€æ”¹ä¸ºæœ€å°çº¦æŸä¸ç´¢å¼•ï¼Œå¼ºè°ƒåº”ç”¨å±‚äº‹åŠ¡ç»´æŠ¤ä¸æ—¥åˆ‡

### å…¼å®¹æ€§
- æ— ç ´åæ€§å˜æ›´ï¼›ä¸ºå®¢æˆ·ç«¯å¢åŠ äº†å¯é€‰çš„ `Idempotency-Key` æ”¯æŒã€‚

---
## [v4.4.0] - 2025-08-31 ğŸš€ **æ—¶æ€ç‰ˆæœ¬åˆ›å»ºåŠŸèƒ½æ–°å¢**

### âœ¨ æ–°å¢ - æ—¶æ€ç‰ˆæœ¬ç®¡ç†APIç«¯ç‚¹
- **æ–°å¢RESTç«¯ç‚¹**: `POST /api/v1/organization-units/{code}/versions` - ä¸ºç°æœ‰ç»„ç»‡åˆ›å»ºæ–°çš„æ—¶æ€ç‰ˆæœ¬
  - **åŠŸèƒ½**: æ”¯æŒå†å²æ•°æ®è¡¥æ­£å’Œæœªæ¥ç”Ÿæ•ˆç‰ˆæœ¬åˆ›å»º
  - **è‡ªåŠ¨åŒ–**: è‡ªåŠ¨ç®¡ç†is_currentçŠ¶æ€è½¬æ¢å’Œend_dateè®¡ç®—
  - **éªŒè¯**: å®Œæ•´çš„æ—¥æœŸå†²çªæ£€æŸ¥å’Œä¸šåŠ¡è§„åˆ™éªŒè¯

### ğŸ“‹ Schemaå®šä¹‰æ‰©å±•
- **æ–°å¢Schema**: `CreateVersionRequest` - æ—¶æ€ç‰ˆæœ¬åˆ›å»ºè¯·æ±‚ç»“æ„
  - **å­—æ®µ**: name, unitType, parentCode, description, effectiveDate, endDate, operationReason
  - **éªŒè¯**: æ—¥æœŸæ ¼å¼æ ¡éªŒã€å­—æ®µé•¿åº¦é™åˆ¶ã€ä¸šåŠ¡è§„åˆ™æ£€æŸ¥
- **å“åº”å¢å¼º**: æ”¯æŒè¯¦ç»†çš„å†²çªä¿¡æ¯å’Œç‰ˆæœ¬çŠ¶æ€è¿”å›

### ğŸ”§ è§£å†³æ ¸å¿ƒé—®é¢˜
- **ä¿®å¤**: å‰ç«¯æ’å…¥æ–°ç‰ˆæœ¬åŠŸèƒ½ç¼ºå¤±å¯¹åº”APIç«¯ç‚¹çš„é—®é¢˜
- **æ”¹è¿›**: æä¾›ç¬¦åˆCQRSæ¶æ„çš„æ ‡å‡†åŒ–æ—¶æ€æ•°æ®ç®¡ç†æ¥å£
- **å¢å¼º**: æ”¯æŒæ•°æ®åº“ç°æœ‰çš„26ä¸ªæ—¶æ€ä¸“ç”¨ç´¢å¼•å’Œè‡ªåŠ¨åŒ–è§¦å‘å™¨

### ğŸ“ˆ ç‰ˆæœ¬å‡çº§æŒ‡å—
- **å‰ç«¯**: å°†é”™è¯¯çš„`/events`ç«¯ç‚¹è°ƒç”¨æ›¿æ¢ä¸ºæ–°çš„`/versions`ç«¯ç‚¹
- **è¯·æ±‚ç»“æ„**: ä½¿ç”¨`CreateVersionRequest`æ ¼å¼æ›¿ä»£åŸæœ‰`events`æ ¼å¼
- **é”™è¯¯å¤„ç†**: æ–°å¢409å†²çªå“åº”å’Œè¯¦ç»†é”™è¯¯ä¿¡æ¯å¤„ç†

---

## [v4.6.0] - 2025-08-30 ğŸ¯ **å®¡è®¡ç³»ç»Ÿç²¾ç¡®åŒ–é‡æ„**

### ğŸš¨ é‡å¤§å˜æ›´ - å®¡è®¡ç³»ç»Ÿæ¶æ„è°ƒæ•´
- **å˜æ›´æŸ¥è¯¢ç»“æ„**: ç§»é™¤`organizationAuditHistory`æŸ¥è¯¢ï¼Œæ–°å¢`auditHistory(recordId: UUID!)`æŸ¥è¯¢
  - **ç†ç”±**: å®¡è®¡è®°å½•ç°åœ¨ç²¾ç¡®è¿½è¸ªæ¯ä¸ªæ—¶æ€ç‰ˆæœ¬(record_id)ï¼Œè€Œä¸æ˜¯ç»„ç»‡ä»£ç çº§åˆ«
  - **å½±å“**: å‰ç«¯éœ€è¦ä¼ é€’å…·ä½“çš„recordIdè€Œä¸æ˜¯ç»„ç»‡ä»£ç æ¥è·å–å®¡è®¡ä¿¡æ¯
- **å˜æ›´AuditLogDetailç±»å‹**: ç§»é™¤`businessEntityId`å­—æ®µï¼Œä¿ç•™`recordId`å­—æ®µä½œä¸ºå”¯ä¸€æ ‡è¯†
  - **ç†ç”±**: ç®€åŒ–å®¡è®¡æ¨¡å‹ï¼Œæ¯ä¸ªå®¡è®¡è®°å½•ç›´æ¥å…³è”åˆ°å…·ä½“çš„æ—¶æ€ç‰ˆæœ¬è®°å½•
  - **å½±å“**: å®¡è®¡è®°å½•ç°åœ¨åªè¿”å›recordIdï¼Œä¸å†è¿”å›ç»„ç»‡ä»£ç 

### ğŸ“‹ å®¡è®¡æŸ¥è¯¢ä¼˜åŒ–
- **æ–°å¢æŸ¥è¯¢**: `auditHistory(recordId: UUID!, startDate: Date, endDate: Date, operation: OperationType, userId: UUID, limit: Int)`
  - **åŠŸèƒ½**: è·å–ç‰¹å®štemporalç‰ˆæœ¬çš„å®Œæ•´å®¡è®¡å†å²
  - **æ€§èƒ½**: ä¼˜åŒ–ç´¢å¼•è®¾è®¡ï¼ŒæŸ¥è¯¢å“åº”æ—¶é—´<50ms
- **ç§»é™¤æŸ¥è¯¢**: `organizationAuditHistory(code: String!)`
  - **ç†ç”±**: æ›¿æ¢ä¸ºæ›´ç²¾ç¡®çš„record_idçº§åˆ«æŸ¥è¯¢
- **ä¿ç•™æŸ¥è¯¢**: `auditLog(auditId: String!)`å•æ¡å®¡è®¡è®°å½•æŸ¥è¯¢ä¿æŒä¸å˜

### ğŸ—‘ï¸ æ¸…ç†åºŸå¼ƒç±»å‹
- **ç§»é™¤ç±»å‹**: `OrganizationAuditHistory`, `AuditTimelineEntry`, `AuditHistoryMeta`, `ChangesSummary`
  - **ç†ç”±**: è¿™äº›ç±»å‹æ”¯æŒå·²åºŸå¼ƒçš„ç»„ç»‡çº§åˆ«å®¡è®¡æŸ¥è¯¢
- **ç®€åŒ–å“åº”**: `auditHistory`æŸ¥è¯¢ç›´æ¥è¿”å›`[AuditLogDetail!]!`æ•°ç»„
  - **ç†ç”±**: å‡å°‘åµŒå¥—ç»“æ„ï¼Œç®€åŒ–å‰ç«¯é›†æˆ

### ğŸ“ˆ ç‰ˆæœ¬å‡çº§æŒ‡å—
- **å‰ç«¯ä¿®æ”¹**: å°†`AuditAPI.getOrganizationAuditHistory(code)`æ›¿æ¢ä¸º`AuditAPI.getRecordAuditHistory(recordId)`
- **æŸ¥è¯¢è°ƒæ•´**: åœ¨ç»„ç»‡è¯¦æƒ…é¡µé¢ä¼ é€’å½“å‰é€‰ä¸­ç‰ˆæœ¬çš„recordIdè€Œä¸æ˜¯ç»„ç»‡ä»£ç 
- **ç±»å‹æ›´æ–°**: æ›´æ–°TypeScriptæ¥å£ï¼Œç§»é™¤`businessEntityId`ç›¸å…³å­—æ®µ

---

## [v4.5.0] - 2025-08-30 ğŸ“‹ **å®¡è®¡åŠŸèƒ½å®ç”¨åŒ–ç®€åŒ–** 

### ğŸ—‘ï¸ ç§»é™¤ - å®Œå…¨åˆ é™¤organizationChangeAnalysis
- **åˆ é™¤GraphQLæŸ¥è¯¢**: å®Œå…¨ç§»é™¤`organizationChangeAnalysis`æŸ¥è¯¢ç«¯ç‚¹
  - **ç†ç”±**: éµå¾ªAPIä¼˜å…ˆåŸåˆ™ï¼Œåˆ é™¤æœªå®ç°ä¸”è¿‡åº¦è®¾è®¡çš„åŠŸèƒ½
- **åˆ é™¤ç±»å‹å®šä¹‰**: ç§»é™¤`OrganizationChangeAnalysis`ã€`VersionRange`ã€`AnalysisType`ç±»å‹
  - **ç†ç”±**: æ¸…ç†ä¸å†ä½¿ç”¨çš„ç±»å‹å®šä¹‰ï¼Œå‡å°‘APIè¡¨é¢ç§¯
- **æ›´æ–°å¥‘çº¦æµ‹è¯•**: è°ƒæ•´å‰ç«¯æµ‹è¯•é¢„æœŸæŸ¥è¯¢æ•°é‡ä»10ä¸ªå‡å°‘åˆ°9ä¸ª
  - **ç†ç”±**: ä¿æŒæµ‹è¯•ä¸å®é™…APIè§„èŒƒçš„ä¸€è‡´æ€§

### ğŸ“‹ ä¸“æ³¨ - æ ¸å¿ƒå®¡è®¡åŠŸèƒ½
- **ä¿ç•™æ ¸å¿ƒæŸ¥è¯¢**: `organizationAuditHistory`å’Œ`auditLog`æŸ¥è¯¢
  - **ç†ç”±**: è¿™äº›æä¾›å®é™…ä¸šåŠ¡ä»·å€¼çš„åŸºç¡€å®¡è®¡åŠŸèƒ½
- **ç®€åŒ–APIè¡¨é¢ç§¯**: GraphQLæŸ¥è¯¢ä»10ä¸ªå‡å°‘åˆ°9ä¸ª
  - **ç†ç”±**: æ›´å°çš„APIè¡¨é¢ç§¯æ›´æ˜“ç»´æŠ¤å’Œç†è§£

---

## [v4.4.0] - 2025-08-30 ğŸ—‘ï¸ **å®Œå…¨ç§»é™¤è¿‡åº¦è®¾è®¡åŠŸèƒ½**

### ğŸ¯ ç§»é™¤ - å®Œå…¨åˆ é™¤organizationChangeAnalysis
- **åˆ é™¤GraphQLæŸ¥è¯¢**: å®Œå…¨ç§»é™¤`organizationChangeAnalysis`æŸ¥è¯¢ç«¯ç‚¹
  - **ç†ç”±**: éµå¾ªAPIä¼˜å…ˆåŸåˆ™ï¼Œåˆ é™¤æœªå®ç°ä¸”è¿‡åº¦è®¾è®¡çš„åŠŸèƒ½
- **åˆ é™¤ç±»å‹å®šä¹‰**: ç§»é™¤`OrganizationChangeAnalysis`ã€`VersionRange`ã€`AnalysisType`ç±»å‹
  - **ç†ç”±**: æ¸…ç†ä¸å†ä½¿ç”¨çš„ç±»å‹å®šä¹‰ï¼Œå‡å°‘APIè¡¨é¢ç§¯
- **æ›´æ–°å¥‘çº¦æµ‹è¯•**: è°ƒæ•´å‰ç«¯æµ‹è¯•é¢„æœŸæŸ¥è¯¢æ•°é‡ä»10ä¸ªå‡å°‘åˆ°9ä¸ª
  - **ç†ç”±**: ä¿æŒæµ‹è¯•ä¸å®é™…APIè§„èŒƒçš„ä¸€è‡´æ€§

### ğŸ“‹ ä¸“æ³¨ - æ ¸å¿ƒå®¡è®¡åŠŸèƒ½
- **ä¿ç•™æ ¸å¿ƒæŸ¥è¯¢**: `organizationAuditHistory`å’Œ`auditLog`æŸ¥è¯¢
  - **ç†ç”±**: è¿™äº›æä¾›å®é™…ä¸šåŠ¡ä»·å€¼çš„åŸºç¡€å®¡è®¡åŠŸèƒ½
- **ç®€åŒ–APIè¡¨é¢ç§¯**: GraphQLæŸ¥è¯¢ä»10ä¸ªå‡å°‘åˆ°9ä¸ª
  - **ç†ç”±**: æ›´å°çš„APIè¡¨é¢ç§¯æ›´æ˜“ç»´æŠ¤å’Œç†è§£

### ğŸ“š æ–‡æ¡£åŒæ­¥
- **æ¸…ç†APIè§„èŒƒ**: ç§»é™¤APIè¡¨æ ¼å’Œæƒé™æ˜ å°„ä¸­çš„ç›¸å…³å¼•ç”¨
- **æ›´æ–°å¼€å‘è®¡åˆ’**: æ¸…ç†è¿‡æ—¶çš„å®ç°è®¡åˆ’å’Œè¿›åº¦è®°å½•
- **ç‰ˆæœ¬å‡çº§**: Schemaç‰ˆæœ¬ä»v4.3.0å‡çº§è‡³v4.4.0

### ğŸ¯ è®¾è®¡åŸåˆ™å¼ºåŒ–
- **APIä¼˜å…ˆåŸåˆ™**: ä¸¥æ ¼éµå¾ª"å…ˆå®šä¹‰APIå¥‘çº¦ï¼Œåå®ç°ä»£ç "
- **å®ç”¨ä¸»ä¹‰**: ä¸“æ³¨è§£å†³å®é™…ä¸šåŠ¡é—®é¢˜ï¼Œé¿å…è¿‡åº¦å·¥ç¨‹åŒ–
- **å¯ç»´æŠ¤æ€§**: ä¿æŒå°è€Œä¸“æ³¨çš„APIè¡¨é¢ç§¯

---

## [v4.3.0] - 2025-08-30 âœ‚ï¸ **è¿‡åº¦è®¾è®¡ç®€åŒ–é‡æ„**

### ğŸ¯ ç§»é™¤ - è¿‡åº¦è®¾è®¡çš„å®¡è®¡åˆ†æåŠŸèƒ½
- **ç§»é™¤å¤æ‚è¶‹åŠ¿åˆ†æ**: ä»`OrganizationChangeAnalysis`ä¸­ç§»é™¤`TrendAnalysis`ç±»å‹
  - ç§»é™¤å­—æ®µ: `changeFrequency`, `stabilityScore`, `riskTrend`
  - **ç†ç”±**: éœ€è¦6-9ä¸ªæœˆå¼€å‘å‘¨æœŸï¼Œè¶…å‡ºå®é™…ä¸šåŠ¡éœ€æ±‚ï¼Œç¼ºä¹è¡Œä¸šæ ‡å‡†åŸºå‡†
- **ç§»é™¤è‡ªåŠ¨å½±å“è¯„ä¼°**: ä»`OrganizationChangeAnalysis`ä¸­ç§»é™¤`ImpactAssessment`ç±»å‹
  - ç§»é™¤å­—æ®µ: `overallImpact`, `affectedSystems`, `mitigationRequired`
  - **ç†ç”±**: éœ€è¦å¤æ‚çš„è·¨ç³»ç»Ÿé›†æˆåˆ†æï¼Œå½“å‰æ•°æ®åŸºç¡€ä¸è¶³
- **ç§»é™¤æ™ºèƒ½å»ºè®®ç”Ÿæˆ**: ä»`OrganizationChangeAnalysis`ä¸­ç§»é™¤`recommendations`å­—æ®µ
  - **ç†ç”±**: éœ€è¦é¢†åŸŸä¸“å®¶çŸ¥è¯†åº“å’Œä¸šåŠ¡è§„åˆ™å¼•æ“ï¼Œå®ç°å¤æ‚åº¦é«˜ä½†ç”¨æˆ·ä¿¡ä»»åº¦ä½

### ğŸ“‹ ä¿ç•™ - æ ¸å¿ƒä¸šåŠ¡ä»·å€¼åŠŸèƒ½
- **ä¿ç•™å˜æ›´æ‘˜è¦**: `ChangesSummary`ç±»å‹å®Œæ•´ä¿ç•™
  - åŒ…å«: `operationSummary`, `totalChanges`, `keyChanges`
  - **ç†ç”±**: æä¾›å®ç”¨çš„å®¡è®¡ä¿¡æ¯ï¼Œæ»¡è¶³å®é™…HRç®¡ç†éœ€æ±‚
- **ä¿ç•™æ—¶é—´èŒƒå›´**: `VersionRange`ç±»å‹å®Œæ•´ä¿ç•™
  - **ç†ç”±**: åŸºç¡€æ—¶æ€æŸ¥è¯¢å¿…éœ€ä¿¡æ¯

### ğŸ¨ ä¼˜åŒ– - APIæ–‡æ¡£æ›´æ–°
- **ç®€åŒ–åŠŸèƒ½æè¿°**: æ›´æ–°`organizationChangeAnalysis`æŸ¥è¯¢è¯´æ˜
- **æ–°å¢è®¾è®¡åŸåˆ™**: æ˜ç¡®"ä¸“æ³¨æ ¸å¿ƒä¸šåŠ¡ä»·å€¼ï¼Œé¿å…è¿‡åº¦å·¥ç¨‹åŒ–"
- **ç‰ˆæœ¬å‡çº§**: Schemaç‰ˆæœ¬ä»v4.2.1å‡çº§è‡³v4.3.0

### ğŸ“Š å½±å“è¯„ä¼°
- **å¼€å‘æˆæœ¬é™ä½**: ä»6-9ä¸ªæœˆå‡å°‘è‡³2-4å‘¨å®ç°å‘¨æœŸ  
- **ç»´æŠ¤æˆæœ¬é™ä½**: ç§»é™¤å¤æ‚ç®—æ³•é€»è¾‘ï¼Œé™ä½é•¿æœŸç»´æŠ¤è´Ÿæ‹…
- **ç”¨æˆ·ä»·å€¼æå‡**: ä¸“æ³¨å®é™…éœ€æ±‚ï¼Œæä¾›æ¸…æ™°çš„å®¡è®¡å†å²ä¿¡æ¯

---

## [v4.2.2] - 2025-08-27 ğŸ—ï¸ **å•è¡¨æ—¶æ€æ¶æ„APIä¼˜åŒ–**

### ğŸ”§ ç®€åŒ– - GraphQL Schemaä¼˜åŒ–
- **ç§»é™¤versionSequenceå­—æ®µ**: ä»`AuditLogDetail`å’Œ`AuditTimelineEntry`ç±»å‹ä¸­ç§»é™¤ä¸å¿…è¦çš„ç‰ˆæœ¬åºåˆ—æ¦‚å¿µ
  - **ç†ç”±**: å•è¡¨æ—¶æ€æ¶æ„ä½¿ç”¨`recordId: UUID`å·²è¶³å¤Ÿæ ‡è¯†ç‰ˆæœ¬ï¼Œ`versionSequence`å¼•å…¥ä¸å¿…è¦å¤æ‚æ€§
  - **å½±å“**: ç®€åŒ–å®¢æˆ·ç«¯é›†æˆé€»è¾‘ï¼Œç›´æ¥ä½¿ç”¨æ•°æ®åº“åŸç”ŸUUIDæ ‡è¯†ç¬¦
- **ä¼˜åŒ–VersionRangeç±»å‹**: é‡æ„ä¸ºåŸºäºæ—¥æœŸçš„èŒƒå›´æŸ¥è¯¢
  - **å˜æ›´**: `fromVersion/toVersion: Int` â†’ `fromDate/toDate: Date`
  - **å˜æ›´**: `totalVersions: Int` â†’ `totalRecords: Int` 
  - **ç†ç”±**: ä¸å•è¡¨æ—¶æ€æ¶æ„çš„`effective_date`å­—æ®µç›´æ¥å¯¹åº”ï¼Œé¿å…ç‰ˆæœ¬å·æ˜ å°„å¤æ‚æ€§
- **ç®€åŒ–organizationChangeAnalysisæŸ¥è¯¢**: å‚æ•°ä»ç‰ˆæœ¬å·æ”¹ä¸ºæ—¥æœŸèŒƒå›´
  - **å˜æ›´**: æŸ¥è¯¢å‚æ•°ä»`fromVersion/toVersion`æ”¹ä¸º`fromDate/toDate`
  - **æ€§èƒ½æå‡**: åˆ©ç”¨26ä¸ªä¸“ç”¨æ—¶æ€ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶é—´ä»300msé™è‡³100ms
  - **ç†ç”±**: ç›´æ¥åˆ©ç”¨PostgreSQLæ—¶æ€ç´¢å¼•ï¼Œé¿å…ç‰ˆæœ¬å·æŸ¥æ‰¾çš„é¢å¤–å¼€é”€

### ğŸ“‹ æ¶æ„å¯¹é½
- **APIæ–‡æ¡£ä¸æ•°æ®åº“æ¶æ„ä¸€è‡´æ€§**: ç§»é™¤å¤šè¡¨æ¦‚å¿µå¼•å…¥çš„å¤æ‚æ€§ï¼Œç›´æ¥åæ˜ å•è¡¨æ—¶æ€æ¶æ„çš„ç®€æ´æ€§
- **æ€§èƒ½æ–‡æ¡£æ›´æ–°**: æ›´æ–°æŸ¥è¯¢æ€§èƒ½é¢„æœŸï¼ŒåŸºäº26ä¸ªä¸“ç”¨ç´¢å¼•çš„å®é™…è¡¨ç°
- **æœ¯è¯­æ ‡å‡†åŒ–**: ç»Ÿä¸€ä½¿ç”¨åŸºäºæ—¥æœŸçš„æ—¶æ€æŸ¥è¯¢è¯­ä¹‰

### âš ï¸ ç ´åæ€§å˜æ›´
- å®¢æˆ·ç«¯éœ€è¦æ›´æ–°æ—¶æ€æŸ¥è¯¢é€»è¾‘ï¼Œä»ç‰ˆæœ¬å·åˆ‡æ¢åˆ°æ—¥æœŸèŒƒå›´
- `AuditLogDetail`å’Œ`AuditTimelineEntry`å“åº”ç»“æ„ä¸­ç§»é™¤`versionSequence`å­—æ®µ
- `organizationChangeAnalysis`æŸ¥è¯¢å‚æ•°æ¥å£å˜æ›´

---

## [v4.2.1] - 2025-08-23 ğŸ”§ **æ–‡æ¡£å®Œå–„å’Œå¢å¼º**

### ğŸ”§ æ”¹è¿›
- **profileå­—æ®µå¢å¼º**: ä¸ºä¸åŒunitTypeæä¾›è¯¦ç»†çš„é…ç½®ç»“æ„è¯´æ˜
  - DEPARTMENT: budget, managerPositionCode, costCenterCode, headCountLimit, establishedDate
  - COMPANY: legalName, registrationNumber, taxId, industry, incorporationDate  
  - PROJECT_TEAM: projectCode, projectManager, startDate, endDate, budget
  - ORGANIZATION_UNIT: function, region, parentType
- **æšä¸¾ç±»å‹è¡¥å……**: åœ¨OpenAPIè§„èŒƒä¸­æ·»åŠ ç¼ºå¤±çš„æšä¸¾å®šä¹‰
  - AnalysisType: SUMMARY, DETAILED
  - ConsistencyCheckMode: FAST, DEEP, TARGETED
  - SearchField: NAME, DESCRIPTION, CODE_PATH, NAME_PATH
  - SortField: CODE, NAME, CREATED_AT, UPDATED_AT, EFFECTIVE_DATE, LEVEL, SORT_ORDER
  - SortOrder: ASC, DESC

### ğŸ“ˆ ç¬¦åˆåº¦æ”¹è¿›
- **100%ç«¯ç‚¹è¦†ç›–**: ç¡®è®¤batch-refresh-hierarchyç«¯ç‚¹å®Œæ•´å®ç°
- **é…ç½®æ–‡æ¡£å®Œå–„**: profileå­—æ®µçš„ç±»å‹ç‰¹å®šé…ç½®ç»“æ„è¯´æ˜
- **è·¨åè®®ä¸€è‡´æ€§**: OpenAPIå’ŒGraphQLæšä¸¾å®šä¹‰å®Œå…¨å¯¹åº”

## [v4.2.0] - 2025-08-23 ğŸš€ **APIè§„èŒƒæ­£å¼å‘å¸ƒ**

### ğŸ†• æ–°å¢
- **OpenAPI 3.0.3è§„èŒƒ**: åˆ›å»ºå®Œæ•´çš„REST APIè§„èŒƒæ–‡æ¡£ (`openapi.yaml`)
  - 11ä¸ªRESTç«¯ç‚¹çš„å®Œæ•´å®šä¹‰ (CRUD + ä¸šåŠ¡æ“ä½œ + è¿ç»´å·¥å…·)
  - OAuth 2.0 Client Credentials Flowè®¤è¯
  - 17ä¸ªç»†ç²’åº¦PBACæƒé™æ¨¡å‹
  - ç»Ÿä¸€ä¼ä¸šçº§å“åº”ä¿¡å°ç»“æ„
  - å®Œæ•´çš„é”™è¯¯å¤„ç†ä½“ç³» (401/403/400/500)

- **GraphQL Schemaå®šä¹‰**: åˆ›å»ºå®Œæ•´çš„GraphQL Schema (`schema.graphql`)
  - 10ä¸ªGraphQLæŸ¥è¯¢çš„å®Œæ•´ç±»å‹å®šä¹‰
  - æ—¶æ€æŸ¥è¯¢æ”¯æŒ (asOfDateå‚æ•°)
  - å±‚çº§æŸ¥è¯¢ä¼˜åŒ– (17çº§æ·±åº¦æ”¯æŒ)
  - å®¡è®¡å’Œåˆ†ææŸ¥è¯¢åŠŸèƒ½
  - æ€§èƒ½ä¼˜åŒ–çš„è¾“å…¥/è¾“å‡ºç±»å‹

- **Single Source of Truthæœºåˆ¶**: å»ºç«‹APIè§„èŒƒçš„æƒå¨æ¥æºæœºåˆ¶
  - ä¸¥æ ¼çš„å˜æ›´ç®¡ç†æµç¨‹
  - ç‰ˆæœ¬æ§åˆ¶æ ‡å‡†
  - è‡ªåŠ¨åŒ–éªŒè¯æœºåˆ¶

### ğŸ”§ ç‰¹æ€§
- **ä¸¥æ ¼CQRSæ¶æ„åˆè§„**: æŸ¥è¯¢æ“ä½œä»…GraphQLï¼Œå‘½ä»¤æ“ä½œä»…REST
- **ä¼ä¸šçº§å®‰å…¨æ¨¡å‹**: OAuth 2.0 + JWT + PBACæƒé™ä½“ç³»
- **æ—¶æ€æ•°æ®æ”¯æŒ**: å®Œæ•´çš„å†å²ç‰ˆæœ¬ç®¡ç†å’Œæœªæ¥ç”Ÿæ•ˆè®¡åˆ’
- **æ™ºèƒ½å±‚çº§ç®¡ç†**: 17çº§æ·±åº¦ + åŒè·¯å¾„ç³»ç»Ÿ + è‡ªåŠ¨çº§è”æ›´æ–°
- **æ€§èƒ½ä¼˜åŒ–**: 26ä¸ªä¸“ç”¨ç´¢å¼•ï¼Œå“åº”æ—¶é—´ < 200msç›®æ ‡

### ğŸ“‹ ç«¯ç‚¹æ€»è§ˆ

#### REST APIç«¯ç‚¹ (11ä¸ª)
- **æ ‡å‡†CRUD** (3ä¸ª): POST, PUT, DELETE `/api/v1/organization-units`
  - å˜æ›´ï¼šè‡ª v4.6.x èµ·ï¼Œ`PATCH /api/v1/organization-units/{code}` å·²ä»å¥‘çº¦ä¸­ç§»é™¤ï¼Œè¯·ä½¿ç”¨ `PUT` æˆ–ä¸“ç”¨ç«¯ç‚¹ï¼ˆversions/history/events/suspend/activateï¼‰ã€‚
- **ä¸šåŠ¡æ“ä½œ** (3ä¸ª): suspend, activate, validate
- **è¿ç»´å·¥å…·** (2ä¸ª): refresh-hierarchy, batch-refresh-hierarchy  
- **CoreHRå…¼å®¹** (2ä¸ª): å…¼å®¹æ€§åˆ›å»ºç«¯ç‚¹

#### GraphQLæŸ¥è¯¢ (10ä¸ª)
- **åŸºç¡€æŸ¥è¯¢** (3ä¸ª): organizations, organization, organizationStats
- **å±‚çº§æŸ¥è¯¢** (3ä¸ª): organizationHierarchy, organizationSubtree, hierarchyStatistics
- **å®¡è®¡æŸ¥è¯¢** (3ä¸ª): organizationAuditHistory, auditLog, organizationChangeAnalysis
- **è¿ç»´æŸ¥è¯¢** (1ä¸ª): hierarchyConsistencyCheck

### ğŸ”’ å®‰å…¨ç‰¹æ€§
- **OAuth 2.0 Client Credentials Flow**: ä¼ä¸šçº§æœºå™¨å¯¹æœºå™¨è®¤è¯
- **JWTæ ‡å‡†è½½è·**: æƒé™ã€ç§Ÿæˆ·ã€å®¡è®¡ä¿¡æ¯
- **17ä¸ªæ ¸å¿ƒæƒé™**: org:read, org:create, org:update, org:delete, org:suspend, org:activate, ç­‰
- **å¤šç§Ÿæˆ·éš”ç¦»**: ä¸¥æ ¼çš„ç§Ÿæˆ·æ•°æ®è¾¹ç•Œ
- **å®¡è®¡è¿½è¸ª**: å®Œæ•´çš„æ“ä½œè®°å½•å’Œè´£ä»»è¿½æº¯

### ğŸ“Š æ•°æ®æ¨¡å‹
- **OrganizationUnit**: 40+å­—æ®µçš„å®Œæ•´ç»„ç»‡æ¨¡å‹
- **æ—¶æ€å­—æ®µ**: effectiveDate, endDate, isCurrent, isFuture
- **å®¡è®¡å­—æ®µ**: operationType, operatedBy, operationReason, recordId
- **å±‚çº§å­—æ®µ**: level, hierarchyDepth, codePath, namePath
- **é…ç½®å­—æ®µ**: profile (JSONB), æ”¯æŒåŠ¨æ€é…ç½®

### ğŸ¯ æ€§èƒ½ç›®æ ‡
- **GraphQLæŸ¥è¯¢**: < 200ms (å®é™…1.5-8ms)
- **RESTåˆ›å»º**: < 300ms
- **RESTæ›´æ–°**: < 200ms  
- **å±‚çº§åˆ·æ–°**: < 2000ms
- **å¹¶å‘æ”¯æŒ**: 1000+ QPS (æŸ¥è¯¢), 100+ TPS (å‘½ä»¤)

---

## ğŸ“ˆ ç‰ˆæœ¬ç»Ÿè®¡

- **å½“å‰ç‰ˆæœ¬**: v4.2.0
- **æ€»ç«¯ç‚¹æ•°**: 21ä¸ª (11 REST + 10 GraphQL)
- **æƒé™æ•°é‡**: 17ä¸ªç»†ç²’åº¦æƒé™
- **æ•°æ®æ¨¡å‹**: 25+æ ¸å¿ƒç±»å‹å®šä¹‰
- **æ–‡æ¡£é¡µé¢**: 1000+ è¡Œå®Œæ•´è§„èŒƒ

---

## ğŸ”„ å…¼å®¹æ€§è¯´æ˜

### v4.2.0 å…¼å®¹æ€§
- **åˆå§‹å‘å¸ƒ**: æ— å…¼å®¹æ€§é—®é¢˜
- **å‘½åè§„èŒƒ**: ç»Ÿä¸€camelCaseå­—æ®µå‘½å
- **åè®®åˆ†ç¦»**: ä¸¥æ ¼CQRSæ¶æ„å®æ–½
- **é”™è¯¯æ ¼å¼**: ç»Ÿä¸€ä¼ä¸šçº§é”™è¯¯å“åº”ç»“æ„

### æœªæ¥ç‰ˆæœ¬ç­–ç•¥
- **ä¸»ç‰ˆæœ¬** (v5.0): ç ´åæ€§APIå˜æ›´
- **æ¬¡ç‰ˆæœ¬** (v4.3): æ–°åŠŸèƒ½æ·»åŠ ï¼Œå‘åå…¼å®¹
- **ä¿®è®¢ç‰ˆæœ¬** (v4.2.1): Bugä¿®å¤å’Œæ€§èƒ½ä¼˜åŒ–

---

## ğŸ“ å˜æ›´æ”¯æŒ

### å¦‚ä½•æäº¤å˜æ›´
1. **åˆ›å»ºIssue**: æè¿°APIå˜æ›´éœ€æ±‚å’Œä¸šåŠ¡åœºæ™¯
2. **è§„èŒƒè®¾è®¡**: å…ˆåœ¨è§„èŒƒæ–‡ä»¶ä¸­è®¾è®¡å˜æ›´
3. **ç¤¾åŒºè®¨è®º**: é€šè¿‡PRè¿›è¡ŒæŠ€æœ¯è®¨è®º
4. **æµ‹è¯•éªŒè¯**: ç¡®ä¿å˜æ›´ä¸ç ´åç°æœ‰åŠŸèƒ½
5. **æ–‡æ¡£æ›´æ–°**: åŒæ­¥æ›´æ–°ç›¸å…³æ–‡æ¡£

### è”ç³»æ–¹å¼
- **APIæ”¯æŒ**: api-support@yourcompany.com
- **æŠ€æœ¯è®¨è®º**: ä¼ä¸šå†…éƒ¨æŠ€æœ¯å§”å‘˜ä¼š
- **ç´§æ€¥é—®é¢˜**: é€šè¿‡å†…éƒ¨Issueè·Ÿè¸ªç³»ç»Ÿ

---

**ğŸ“ è¯´æ˜**: æœ¬CHANGELOGéµå¾ª [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/) æ ¼å¼ï¼Œé‡‡ç”¨ [è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/lang/zh-CN/) è§„èŒƒã€‚

**ğŸ”„ æœ€åæ›´æ–°**: 2025-08-23  
**ğŸ“‹ ä¸‹æ¬¡ç‰ˆæœ¬**: v4.3.0 (è®¡åˆ’2025-11-23)
