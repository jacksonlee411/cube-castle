# ADR-006: 统一标识符命名策略 - 采用code替代business_id

**状态**: 已接受  
**决策日期**: 2025-08-05  
**决策者**: 架构团队  
**影响范围**: 全项目API设计和数据库设计

## 🎯 决策摘要

决定在所有对外API中使用 `code` 作为主要实体标识符，完全隐藏内部UUID，以降低用户认知负担，提升系统易用性。

## 📋 背景

### 当前问题
在组织单元API规范不一致性调查中，发现了以下问题：
1. `business_id` 命名容易引起混淆，技术色彩过重
2. UUID和business_id双重暴露增加了用户认知复杂度
3. 不同文档中字段命名不统一 (`business_id` vs `parent_id` vs `parent_unit_id`)
4. 与主流企业级HR系统的命名惯例不符

### 业务需求
1. 降低前端开发和第三方集成的复杂度
2. 提供更直观、业务友好的API接口
3. 统一项目中所有实体的标识符命名规范
4. 符合企业级HR系统的行业标准

## 🔍 决策考量

### 调研的命名方案

| 方案 | 优势 | 劣势 | 适用性 |
|------|------|------|--------|
| `code` | 业务语义清晰、符合行业标准、简洁 | 无明显劣势 | ⭐⭐⭐⭐⭐ |
| `org_id` | 技术意图明确 | 对业务人员抽象 | ⭐⭐⭐⭐ |
| `unit_id` | 准确描述实体 | 略长，技术色彩重 | ⭐⭐⭐ |
| `external_id` | 区分内外标识符 | 过于技术化 | ⭐⭐ |
| `business_id` | 原有命名 | 容易混淆，技术色彩重 | ⭐ |

### 主流产品对比分析
- **SAP SuccessFactors**: 使用 `externalCode`
- **Workday**: 使用 `Reference_ID` / `Organization_Code`
- **Oracle HCM**: 使用 `OrganizationCode`
- **GitHub**: 使用可读标识符 (`username`, `repo_name`)
- **Stripe**: 使用前缀+编码 (`cus_xxx`, `prod_xxx`)

### 技术架构考量
1. **UUID隐藏策略**: 内部继续使用UUID作为主键，API层面完全隐藏
2. **性能优化**: 通过缓存机制实现高效的ID转换
3. **数据一致性**: 数据库层面保持UUID关系，API层面转换为code
4. **扩展性**: 为未来的编码规则变更预留空间

## ✅ 决策内容

### 核心决策
1. **统一使用 `code` 作为主要标识符字段名**
   - 替代原有的 `business_id`
   - 格式：7位数字 (1000000-9999999)
   - 示例：`"code": "1000001"`

2. **关系引用采用 `{entity}_code` 格式**
   - 父级关系：`parent_code`
   - 部门关系：`department_code`
   - 经理关系：`manager_code`

3. **UUID完全内部化**
   - 数据库主键继续使用UUID
   - 所有对外API不暴露UUID
   - 通过适配层实现ID转换

4. **建立统一的ID生成和转换机制**
   - 数据库序列自动生成code
   - 不同实体使用独立的位数：组织单元(7位)、员工(8位)、职位(7位)、作业档案(5位)
   - Redis缓存ID映射关系
   - API适配层负责转换逻辑

### 实施范围
```yaml
立即实施:
  - 组织单元 (organization_units) - 7位编码
  - 员工 (employees) - 8位编码
  - 职位 (positions) - 7位编码
  - 作业档案 (job_profiles) - 5位编码

分阶段扩展:
  - 所有业务实体按需求确定位数
  - 系统配置实体
  - 第三方集成接口
```

## 🏗️ 实施策略

### 技术实现
```yaml
数据库层:
  - 保持UUID主键不变
  - 添加code字段和唯一索引
  - 创建自动生成序列和触发器

API层:
  - 实现ID转换适配器
  - 缓存code↔UUID映射关系
  - 更新所有API响应格式

前端层:
  - 更新TypeScript类型定义
  - 重新生成API客户端
  - 修改所有组件的ID使用
```

### 迁移计划
```yaml
阶段1 (1-2天): 标准确定和文档更新
阶段2 (2-3天): 数据库schema更新和数据迁移
阶段3 (2-3天): 后端API实现和转换逻辑
阶段4 (2-3天): 前端更新和集成测试
阶段5 (1天): 文档同步和部署验证
```

## 📊 预期收益

### 用户体验提升
- **认知负担降低80%**: 用户只需理解一种ID类型
- **API集成简化60%**: 消除双重ID系统的复杂性
- **文档理解提升**: "编码"比"业务ID"更直观

### 开发效率提升
- **代码简化25%**: 移除ID转换的冗余逻辑
- **维护成本降低**: 统一的命名规范减少混淆
- **团队协作改善**: 业务和技术团队使用相同术语

### 系统性能优化
- **查询性能提升**: 优化的索引策略
- **缓存效率**: 简化的缓存键设计
- **扩展性**: 为未来增长预留空间

## ⚠️ 风险评估

### 技术风险
```yaml
低风险:
  - ID转换性能开销 (通过缓存缓解)
  - 序列耗尽问题 (90万ID足够使用)

中风险:
  - 数据迁移复杂性 (已有详细迁移计划)
  - 缓存一致性问题 (通过事务确保一致性)
```

### 业务风险  
```yaml
低风险:
  - 用户适应新的ID格式 (更直观，易于接受)
  - 第三方集成调整 (标准化后更容易集成)
```

### 缓解措施
```yaml
技术缓解:
  - 完整的回滚计划
  - 分阶段实施降低风险
  - 全面的测试覆盖

业务缓解:
  - 用户培训和文档支持
  - 渐进式推广策略
  - 及时反馈收集和改进
```

## 📋 成功标准

### 技术指标
- [ ] 所有API响应统一使用code字段
- [ ] UUID在API层面100%隐藏
- [ ] ID转换性能 < 10ms
- [ ] 缓存命中率 > 95%
- [ ] 零ID转换错误

### 业务指标
- [ ] 用户满意度调研显示认知复杂度降低
- [ ] 第三方集成时间缩短 > 50%
- [ ] API文档理解度提升
- [ ] 开发团队反馈积极

### 质量指标
- [ ] 单元测试覆盖率 > 90%
- [ ] 集成测试通过率 100%
- [ ] 性能测试满足要求
- [ ] 安全测试无问题

## 🔄 监控和维护

### 监控指标
```yaml
性能监控:
  - ID转换响应时间
  - Code生成成功率
  - 缓存命中率
  - 数据库查询性能

业务监控:
  - API使用量变化
  - 错误率趋势
  - 用户反馈统计
  - 第三方集成成功率
```

### 维护策略
```yaml
定期评估:
  - 每月性能指标评估
  - 每季度用户满意度调研
  - 每半年标准更新评估

持续改进:
  - 基于反馈优化ID生成策略
  - 根据使用情况调整缓存策略
  - 扩展编码格式支持更多场景
```

## 📚 相关文档

### 标准规范
- [标识符命名标准](../standards/identifier-naming-standards.md)
- [API设计原则](../api-specifications/api-design-principles.md)

### 实施指南
- [激进UUID隐藏实施方案](实施方案文档链接)
- [数据库迁移脚本](迁移脚本链接)
- [API更新清单](更新清单链接)

### 架构文档
- [ADR-004: 组织单元架构](ADR-004-organization-units-architecture.md)
- [组织单元API规范](../api-specifications/organization-units-api-specification.md)

## 🔄 决策演进

### 版本历史
- **v1.0 (2025-08-05)**: 初始决策，确定code命名标准
- **v1.1 (计划中)**: 支持字母数字混合格式
- **v2.0 (计划中)**: 分层编码体系支持

### 相关决策
- **ADR-004**: 组织单元架构设计
- **ADR-002**: 路由标准化
- **ADR-001**: 职位API架构

### 未来考虑点
- 编码格式的进一步优化
- 多租户编码隔离策略
- 与外部系统的编码映射机制

---

**决策记录者**: 系统架构师  
**技术审核**: 开发团队负责人  
**业务审核**: 产品负责人  
**最终批准**: CTO  

**实施负责人**: 全栈开发团队  
**监控负责人**: 运维团队  
**文档维护**: 架构团队