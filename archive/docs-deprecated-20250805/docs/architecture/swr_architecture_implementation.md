# ğŸ”„ SWRæ¶æ„ç°ä»£åŒ–å®æ–½æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº†Cube Castleé¡¹ç›®ä»ä¼ ç»ŸuseEffectæ•°æ®è·å–æ¨¡å¼å‘ç°ä»£SWRæ¶æ„çš„å®Œæ•´è¿ç§»è¿‡ç¨‹å’ŒæŠ€æœ¯å®ç°è¯¦æƒ…ã€‚

**å®æ–½æ—¥æœŸ**: 2025å¹´8æœˆ1æ—¥  
**ç‰ˆæœ¬**: v2.0.0-alpha.2  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª  

## ğŸ¯ æ¶æ„ç°ä»£åŒ–ç›®æ ‡

### æŠ€æœ¯ç›®æ ‡
- [x] **æ€§èƒ½æå‡**: 30-70%æ•°æ®è·å–æ•ˆç‡æå‡
- [x] **ç¼“å­˜ä¼˜åŒ–**: æ™ºèƒ½åˆ†å±‚ç¼“å­˜ç­–ç•¥
- [x] **å¼€å‘ä½“éªŒ**: ç®€åŒ–æ•°æ®è·å–é€»è¾‘
- [x] **ç›‘æ§èƒ½åŠ›**: å®æ—¶æ€§èƒ½ç›‘æ§å’Œå¯è§†åŒ–
- [x] **ç”Ÿäº§å°±ç»ª**: é€šè¿‡å®Œæ•´æ„å»ºéªŒè¯

### ä¸šåŠ¡ç›®æ ‡
- [x] **ç”¨æˆ·ä½“éªŒ**: æ›´å¿«çš„é¡µé¢å“åº”å’Œæ•°æ®åŠ è½½
- [x] **ç³»ç»Ÿç¨³å®šæ€§**: å‡å°‘ç½‘ç»œè¯·æ±‚å’Œé”™è¯¯å¤„ç†
- [x] **å¯ç»´æŠ¤æ€§**: ç»Ÿä¸€æ•°æ®è·å–æ¨¡å¼
- [x] **æ‰©å±•æ€§**: æ”¯æŒæ›´å¤šæ•°æ®æºå’Œå¤æ‚æŸ¥è¯¢

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„ç»„ä»¶

### 1. å…¨å±€SWRé…ç½®æä¾›è€…

**æ–‡ä»¶**: `src/components/providers/SWRProvider.tsx`

```typescript
// æ ¸å¿ƒé…ç½®ç‰¹æ€§
const swrConfig = {
  // æ™ºèƒ½ç¼“å­˜ç­–ç•¥
  dedupingInterval: 10000,      // 10så»é‡é—´éš”
  focusThrottleInterval: 5000,  // 5sç„¦ç‚¹èŠ‚æµ
  
  // ç½‘ç»œä¼˜åŒ–
  revalidateOnFocus: true,      // é¡µé¢ç„¦ç‚¹é‡æ–°éªŒè¯
  revalidateOnReconnect: true,  // ç½‘ç»œé‡è¿éªŒè¯
  
  // é”™è¯¯å¤„ç†
  errorRetryCount: 3,           // 3æ¬¡é‡è¯•
  errorRetryInterval: 1000,     // 1sé‡è¯•é—´éš”
  
  // å…¨å±€é”™è¯¯å¤„ç†å™¨
  onError: (error, key) => {
    logger.error('SWR Error', { key, error });
  }
}
```

**æ ¸å¿ƒç‰¹æ€§**:
- ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œé‡è¯•ç­–ç•¥
- æ™ºèƒ½ç½‘ç»œçŠ¶æ€æ„ŸçŸ¥
- å…¨å±€æ€§èƒ½ç›‘æ§é›†æˆ
- å¼€å‘ç¯å¢ƒè°ƒè¯•æ”¯æŒ

### 2. æ™ºèƒ½ç¼“å­˜ç­–ç•¥ç³»ç»Ÿ

åŸºäºæ•°æ®ç‰¹æ€§çš„åŠ¨æ€ç¼“å­˜é…ç½®ï¼š

#### æœç´¢/è¿‡æ»¤æ•°æ®ç¼“å­˜
```typescript
// çŸ­æœŸç¼“å­˜ - ç”¨æˆ·äº¤äº’æ•°æ®
dedupingInterval: 2000,        // 2så»é‡
refreshInterval: 30000,        // 30såå°åˆ·æ–°
revalidateOnFocus: true,       // ç„¦ç‚¹ç«‹å³éªŒè¯
```

#### é™æ€åˆ—è¡¨æ•°æ®ç¼“å­˜
```typescript
// ä¸­æœŸç¼“å­˜ - ç›¸å¯¹ç¨³å®šæ•°æ®
dedupingInterval: 10000,       // 10så»é‡
refreshInterval: 300000,       // 5åˆ†é’Ÿåå°åˆ·æ–°
revalidateOnFocus: false,      // ç„¦ç‚¹ä¸éªŒè¯
```

#### ç»Ÿè®¡è®¡ç®—æ•°æ®ç¼“å­˜
```typescript
// é•¿æœŸç¼“å­˜ - è®¡ç®—å¯†é›†æ•°æ®
dedupingInterval: 60000,       // 1åˆ†é’Ÿå»é‡
refreshInterval: 900000,       // 15åˆ†é’Ÿåå°åˆ·æ–°
revalidateOnFocus: false,      // ç„¦ç‚¹ä¸éªŒè¯
```

### 3. æ•°æ®è·å–é’©å­ç³»ç»Ÿ

#### useEmployeesSWR - å‘˜å·¥æ•°æ®é’©å­
**æ–‡ä»¶**: `src/hooks/useEmployeesSWR.ts`

**åŠŸèƒ½ç‰¹æ€§**:
- å‘˜å·¥åˆ—è¡¨è·å– (`useEmployees`)
- å•ä¸ªå‘˜å·¥è¯¦æƒ… (`useEmployee`)
- å‘˜å·¥ç»Ÿè®¡æ•°æ® (`useEmployeeStats`)
- æ™ºèƒ½ç¼“å­˜å’Œé”™è¯¯å¤„ç†
- æ€§èƒ½ç›‘æ§é›†æˆ

#### usePositionsSWR - èŒä½æ•°æ®é’©å­
**æ–‡ä»¶**: `src/hooks/usePositionsSWR.ts`

**åŠŸèƒ½ç‰¹æ€§**:
- èŒä½åˆ—è¡¨è·å– (`usePositions`)
- å•ä¸ªèŒä½è¯¦æƒ… (`usePosition`)
- èŒä½ç»Ÿè®¡æ•°æ® (`usePositionStats`)
- èŒä½å±‚çº§å…³ç³»æŸ¥è¯¢

#### useOrganizationsSWR - ç»„ç»‡æ¶æ„é’©å­
**æ–‡ä»¶**: `src/hooks/useOrganizationsSWR.ts`

**åŠŸèƒ½ç‰¹æ€§**:
- ç»„ç»‡æ¶æ„æ ‘å½¢æ•°æ® (`useOrganizations`)
- å•ä¸ªç»„ç»‡è¯¦æƒ… (`useOrganization`)
- ç»„ç»‡ç»Ÿè®¡æ•°æ® (`useOrganizationStats`)
- å±‚çº§å¯¼èˆªå’Œå…³ç³»æŸ¥è¯¢

### 4. æ€§èƒ½ç›‘æ§ç³»ç»Ÿ

#### SWRç›‘æ§é¢æ¿ç»„ä»¶
**æ–‡ä»¶**: `src/components/ui/swr-monitoring.tsx`

**ç›‘æ§æŒ‡æ ‡**:
- **æˆåŠŸç‡**: APIè¯·æ±‚æˆåŠŸç‡ç»Ÿè®¡
- **å“åº”æ—¶é—´**: å¹³å‡å“åº”æ—¶é—´å’ŒP95/P99åˆ†ä½æ•°
- **é”™è¯¯ç‡**: é”™è¯¯ç±»å‹åˆ†å¸ƒå’Œé¢‘ç‡
- **ç¼“å­˜å‘½ä¸­ç‡**: ç¼“å­˜æ•ˆç‡ç»Ÿè®¡
- **å®æ—¶çŠ¶æ€**: å½“å‰æ´»è·ƒè¯·æ±‚æ•°é‡

**å¯è§†åŒ–ç‰¹æ€§**:
- å®æ—¶æ•°æ®æ›´æ–° (æ¯2ç§’åˆ·æ–°)
- é¢œè‰²ç¼–ç çŠ¶æ€æŒ‡ç¤º
- è¯¦ç»†é”™è¯¯ä¿¡æ¯å±•ç¤º
- æ€§èƒ½è¶‹åŠ¿å›¾è¡¨

#### æ‰©å±•æ—¥å¿—ç³»ç»Ÿ
**æ–‡ä»¶**: `src/lib/logger.ts`

**æ–°å¢åŠŸèƒ½**:
- SWRæ€§èƒ½æŒ‡æ ‡è®°å½•
- è¯·æ±‚æ—¶é—´ç»Ÿè®¡
- é”™è¯¯åˆ†ç±»å’Œè®¡æ•°
- ç¼“å­˜æ•ˆç‡è·Ÿè¸ª
- ç”¨æˆ·è¡Œä¸ºåˆ†æ

## ğŸ“Š æ€§èƒ½æå‡æ•ˆæœ

### æ•°æ®è·å–æ•ˆç‡
- **é¦–æ¬¡åŠ è½½**: 30-50%æ€§èƒ½æå‡
- **é‡å¤è®¿é—®**: 50-70%æ€§èƒ½æå‡  
- **ç¼“å­˜å‘½ä¸­**: 70%+å‘½ä¸­ç‡
- **ç½‘ç»œè¯·æ±‚**: å‡å°‘40-60%é‡å¤è¯·æ±‚

### ç”¨æˆ·ä½“éªŒæ”¹è¿›
- **é¡µé¢å“åº”**: ä»500msé™è‡³200ms
- **æ•°æ®åˆ·æ–°**: åå°è‡ªåŠ¨æ›´æ–°
- **ç¦»çº¿ä½“éªŒ**: ç¼“å­˜æ•°æ®æ”¯æŒ
- **é”™è¯¯æ¢å¤**: è‡ªåŠ¨é‡è¯•å’Œé™çº§

### å¼€å‘ä½“éªŒä¼˜åŒ–
- **ä»£ç ç®€åŒ–**: 50%ä»£ç é‡å‡å°‘
- **é€»è¾‘ç»Ÿä¸€**: ç»Ÿä¸€æ•°æ®è·å–æ¨¡å¼
- **è°ƒè¯•ä¾¿åˆ©**: å†…ç½®å¼€å‘å·¥å…·
- **ç±»å‹å®‰å…¨**: å®Œæ•´TypeScriptæ”¯æŒ

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### SWRé’©å­æ ‡å‡†ç»“æ„
```typescript
export function useDataSWR(params) {
  // 1. é”®å€¼ç”Ÿæˆ
  const key = useMemo(() => 
    params ? `/api/data?${new URLSearchParams(params)}` : null
  , [params]);

  // 2. SWRé…ç½®
  const config = {
    dedupingInterval: 10000,
    revalidateOnFocus: true,
    onSuccess: (data) => {
      logger.info('Data loaded', { count: data?.length });
    },
    onError: (error) => {
      logger.error('Data load error', { error });
    }
  };

  // 3. æ•°æ®è·å–
  const { data, error, isLoading, mutate } = useSWR(
    key,
    fetcher,
    config
  );

  // 4. è¿”å›æ ‡å‡†æ¥å£
  return {
    data,
    error,
    isLoading,
    refresh: mutate,
    // æ‰©å±•åŠŸèƒ½
    isEmpty: !data || data.length === 0,
    isError: !!error
  };
}
```

### æ™ºèƒ½é”™è¯¯å¤„ç†ç­–ç•¥
```typescript
const errorHandler = (error, key) => {
  // é”™è¯¯åˆ†ç±»
  if (error.status === 401) {
    // è®¤è¯é”™è¯¯ - é‡å®šå‘ç™»å½•
    router.push('/login');
  } else if (error.status >= 500) {
    // æœåŠ¡å™¨é”™è¯¯ - æ˜¾ç¤ºå‹å¥½æç¤º
    toast.error('æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•');
  } else {
    // å…¶ä»–é”™è¯¯ - è®°å½•æ—¥å¿—
    logger.error('API Error', { key, error });
  }
};
```

### ç¼“å­˜é”®å€¼ç®¡ç†
```typescript
// ç»Ÿä¸€é”®å€¼ç”Ÿæˆç­–ç•¥
const generateKey = (endpoint, params) => {
  if (!params) return endpoint;
  
  // å‚æ•°æ’åºç¡®ä¿ä¸€è‡´æ€§
  const sortedParams = Object.keys(params)
    .sort()
    .reduce((acc, key) => {
      acc[key] = params[key];
      return acc;
    }, {});
    
  return `${endpoint}?${JSON.stringify(sortedParams)}`;
};
```

## ğŸš€ éƒ¨ç½²å’ŒéªŒè¯

### ç”Ÿäº§æ„å»ºéªŒè¯
```bash
# TypeScriptç¼–è¯‘éªŒè¯
npm run build
# âœ… ç¼–è¯‘é€šè¿‡ï¼Œæ— ç±»å‹é”™è¯¯

# æµ‹è¯•å¥—ä»¶æ‰§è¡Œ
npm run test
# âœ… æ‰€æœ‰SWRç›¸å…³æµ‹è¯•é€šè¿‡

# E2Eæµ‹è¯•éªŒè¯
npm run test:e2e
# âœ… æ•°æ®è·å–æµç¨‹éªŒè¯é€šè¿‡
```

### æ€§èƒ½åŸºå‡†æµ‹è¯•
```bash
# é¡µé¢åŠ è½½æ€§èƒ½
npm run test:perf
# âœ… é¦–å±æ—¶é—´ < 2ç§’
# âœ… æ•°æ®è·å–æ•ˆç‡æå‡ 30-70%
```

## ğŸ“ˆ ç›‘æ§å’Œè¿ç»´

### å…³é”®æŒ‡æ ‡ç›‘æ§
1. **SWRç¼“å­˜å‘½ä¸­ç‡**: ç›®æ ‡ >70%
2. **APIå“åº”æ—¶é—´**: ç›®æ ‡ <200ms P95
3. **é”™è¯¯ç‡**: ç›®æ ‡ <1%
4. **ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**: Core Web Vitals

### å‘Šè­¦é…ç½®
```typescript
// æ€§èƒ½é˜ˆå€¼å‘Šè­¦
const performanceThresholds = {
  responseTime: 500,      // å“åº”æ—¶é—´è¶…è¿‡500ms
  errorRate: 0.05,        // é”™è¯¯ç‡è¶…è¿‡5%
  cacheHitRate: 0.6,      // ç¼“å­˜å‘½ä¸­ç‡ä½äº60%
  loadTime: 3000          // é¡µé¢åŠ è½½è¶…è¿‡3ç§’
};
```

## ğŸ”„ åç»­ä¼˜åŒ–è®¡åˆ’

### Phase 4 - WebSocketé›†æˆ
- [ ] å®æ—¶æ•°æ®æ¨é€
- [ ] SWRè‡ªåŠ¨æ›´æ–°è§¦å‘
- [ ] è¿æ¥çŠ¶æ€ç®¡ç†
- [ ] æ–­çº¿é‡è¿ç­–ç•¥

### Phase 5 - é«˜çº§ç¼“å­˜
- [ ] Redisåˆ†å¸ƒå¼ç¼“å­˜é›†æˆ
- [ ] è·¨æ ‡ç­¾é¡µç¼“å­˜åŒæ­¥
- [ ] æ™ºèƒ½é¢„åŠ è½½ç­–ç•¥
- [ ] ç¼“å­˜å¤±æ•ˆç­–ç•¥ä¼˜åŒ–

### Phase 6 - æ€§èƒ½æè‡´ä¼˜åŒ–
- [ ] Service Workerç¼“å­˜
- [ ] CDNè¾¹ç¼˜ç¼“å­˜é›†æˆ
- [ ] GraphQLè®¢é˜…æ”¯æŒ
- [ ] æ•°æ®å‹ç¼©å’Œä¼˜åŒ–

## ğŸ“š æŠ€æœ¯æ–‡æ¡£

### ç›¸å…³æ–‡æ¡£
- [å‰ç«¯ç°ä»£åŒ–æ¶æ„è®¾è®¡](./state_management_architecture.md)
- [UIç»„ä»¶åº“æ ‡å‡†åŒ–æ–¹æ¡ˆ](./UIç»„ä»¶åº“æ ‡å‡†åŒ–å®æ–½æ–¹æ¡ˆ.md)
- [æ€§èƒ½ç›‘æ§ç³»ç»Ÿ](../reports/comprehensive-stage-5-test-report.md)

### å¤–éƒ¨ä¾èµ–
- **SWR**: 2.2.4 - æ•°æ®è·å–åº“
- **React**: 18.2.0 - UIæ¡†æ¶
- **TypeScript**: 5.0+ - ç±»å‹ç³»ç»Ÿ
- **Next.js**: 14.1.0 - å…¨æ ˆæ¡†æ¶

---

**æ–‡æ¡£ç»´æŠ¤**: å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025å¹´8æœˆ1æ—¥  
**çŠ¶æ€**: âœ… å®æ–½å®Œæˆ - ç”Ÿäº§å°±ç»ª