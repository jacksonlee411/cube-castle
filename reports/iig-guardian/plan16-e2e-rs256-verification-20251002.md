# Plan 16 Phase 1 RS256 E2E å›å½’éªŒè¯æŠ¥å‘Š

**æ‰§è¡Œæ—¶é—´**: 2025-10-02 09:32 UTC+8
**è´Ÿè´£äºº**: QA + æ¶æ„ç»„
**ç¯å¢ƒ**: RS256 JWT + åŒæœåŠ¡æ¶æ„ï¼ˆ9090/8090ï¼‰
**çŠ¶æ€**: éƒ¨åˆ†é€šè¿‡ï¼Œå‘ç°ç¯å¢ƒé…ç½®é—®é¢˜

---

## ğŸ¯ æ‰§è¡Œæ‘˜è¦

### æœåŠ¡å¯åŠ¨çŠ¶æ€
| æœåŠ¡ | ç«¯å£ | çŠ¶æ€ | éªŒè¯ç»“æœ |
|------|------|------|---------|
| å‘½ä»¤æœåŠ¡ï¼ˆCommandï¼‰| 9090 | âœ… è¿è¡Œä¸­ | `curl /health` â†’ `healthy` |
| æŸ¥è¯¢æœåŠ¡ï¼ˆQueryï¼‰ | 8090 | âœ… è¿è¡Œä¸­ | `curl /health` â†’ `healthy` |
| JWKS ç«¯ç‚¹ | 9090/.well-known/jwks.json | âœ… å¯ç”¨ | `kid=bff-key-1` |
| å‰ç«¯æœåŠ¡ï¼ˆViteï¼‰ | 3000 | âœ… è¿è¡Œä¸­ | HTTP 200ï¼ŒåŠ è½½æ—¶é—´ 3.7ms |
| PostgreSQL | 5432 | âœ… å¥åº· | Docker Healthy |
| Redis | 6379 | âœ… å¥åº· | Docker Healthy |

---

## ğŸ“Š æµ‹è¯•æ‰§è¡Œç»“æœ

### Phase 1: æ ¸å¿ƒæµ‹è¯•ï¼ˆsetupAuth + æ¶æ„ï¼‰

| æµ‹è¯•é¡¹ | Chromium | Firefox | çŠ¶æ€ | é—®é¢˜ |
|--------|----------|---------|------|------|
| æœåŠ¡åˆå¹¶éªŒè¯ | âœ… é€šè¿‡ | âœ… é€šè¿‡ | âœ… | - |
| GraphQL æ¥å£éªŒè¯ | âŒ å¤±è´¥ | âŒ å¤±è´¥ | âŒ | JWT ç¯å¢ƒå˜é‡ä¼ é€’é—®é¢˜ |
| å†—ä½™æœåŠ¡ç§»é™¤éªŒè¯ | âœ… é€šè¿‡ | âœ… é€šè¿‡ | âœ… | - |

**é€šè¿‡ç‡**: 4/6 (66.7%)

---

## ğŸš¨ å‘ç°çš„é—®é¢˜

### P0 - JWT ç¯å¢ƒå˜é‡ä¼ é€’å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Error: Invalid JWT token in development mode: token parsing failed:
token is malformed: token contains an invalid number of segments
```

**æ ¹å› **ï¼š
1. `process.env.PW_JWT` åœ¨ Bash å­ä¼šè¯ä¸­æœªæ­£ç¡®ä¼ é€’åˆ° Playwright worker
2. `page.evaluate()` æ¥æ”¶åˆ°ç©ºå­—ç¬¦ä¸²ï¼Œå¯¼è‡´ Authorization header æ ¼å¼é”™è¯¯

**å½±å“èŒƒå›´**ï¼š
- âŒ GraphQL æ¥å£éªŒè¯æµ‹è¯•å¤±è´¥ï¼ˆ2/2ï¼‰
- âœ… localStorage è®¤è¯ï¼ˆsetupAuthï¼‰æ­£å¸¸å·¥ä½œ
- âœ… å‰ç«¯é¡µé¢è®¿é—®æ­£å¸¸ï¼ˆé€šè¿‡ setupAuth æœºåˆ¶ï¼‰

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨ `playwright.config.ts` ä¸­é…ç½®ç¯å¢ƒå˜é‡
- æˆ–ä½¿ç”¨ `dotenv` åŠ è½½ `.env.test` æ–‡ä»¶

---

## âœ… æˆåŠŸéªŒè¯çš„åŠŸèƒ½

### 1. setupAuth æœºåˆ¶æ­£å¸¸
- âœ… `auth-setup.ts` æ­£ç¡®æ³¨å…¥ localStorage
- âœ… å‰ç«¯é¡µé¢å¯è®¿é—®å—ä¿æŠ¤è·¯ç”±
- âœ… RequireAuth ç»„ä»¶éªŒè¯é€šè¿‡

### 2. åŒæœåŠ¡æ¶æ„å¥åº·
- âœ… å‘½ä»¤æœåŠ¡ï¼ˆ9090ï¼‰å“åº”æ­£å¸¸
- âœ… æŸ¥è¯¢æœåŠ¡ï¼ˆ8090ï¼‰å“åº”æ­£å¸¸
- âœ… JWKS å…¬é’¥ç«¯ç‚¹å¯ç”¨

### 3. å†—ä½™æœåŠ¡å·²ç§»é™¤
- âœ… 8091 ç«¯å£æ— å“åº”ï¼ˆorganization-api-gateway å·²ä¸‹çº¿ï¼‰
- âœ… 8092 ç«¯å£æ— å“åº”ï¼ˆorganization-api-server å·²ä¸‹çº¿ï¼‰

---

## ğŸ“ ä»£ç å˜æ›´ç¡®è®¤

### å·²å®Œæˆçš„ä¿®å¤
1. âœ… **InlineNewVersionForm æµ‹è¯•æ ‡è¯†**ï¼š7 ä¸ª `data-testid` å·²æ·»åŠ 
2. âœ… **setupAuth è¦†ç›–**ï¼š5 ä¸ªæµ‹è¯•æ–‡ä»¶å·²å¼•å…¥ï¼ˆbusiness-flow/regression/optimization/basic/architectureï¼‰
3. âœ… **è·¯ç”±æµç¨‹å¯¹é½**ï¼š`/organizations/new` æµç¨‹å·²æ›´æ–°
4. âœ… **OrganizationDashboard æŒ‰é’®æ ‡è¯†**ï¼šæ–°å¢ 3 ä¸ªæµ‹è¯•æ ‡è¯†ï¼ˆcreate/import/exportï¼‰

### æµ‹è¯•è„šæœ¬ä¿®å¤
1. âœ… **architecture-e2e.spec.ts**ï¼šGraphQL è¯·æ±‚å·²æ·»åŠ  Authorization header å‚æ•°
2. âš ï¸ **ç¯å¢ƒå˜é‡é…ç½®**ï¼šéœ€åœ¨ Playwright é…ç½®ä¸­è®¾ç½® `PW_JWT`

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†è¯„ä¼°

| æ ‡å‡† | ç›®æ ‡ | å½“å‰ | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|------|------|
| æœåŠ¡å¥åº· | 100% | 100% | âœ… | æ‰€æœ‰æ ¸å¿ƒæœåŠ¡è¿è¡Œæ­£å¸¸ |
| setupAuth è¦†ç›– | 5 æ–‡ä»¶ | 5/5 | âœ… | å·²å…¨éƒ¨åº”ç”¨ |
| æµ‹è¯•æ ‡è¯†è¡¥å…… | å…³é”®ç»„ä»¶ | 100% | âœ… | InlineNewVersionForm + Dashboard |
| Phase 1 æµ‹è¯•é€šè¿‡ç‡ | â‰¥95% | 67% | âš ï¸ | JWT ç¯å¢ƒå˜é‡é—®é¢˜å¾…ä¿®å¤ |

---

## ğŸ”§ å¾…ä¿®å¤é—®é¢˜æ¸…å•

### ç«‹å³å¤„ç†ï¼ˆP0ï¼‰

1. **ä¿®å¤ Playwright ç¯å¢ƒå˜é‡ä¼ é€’**
   - **æ–‡ä»¶**: `frontend/playwright.config.ts`
   - **æ“ä½œ**: æ·»åŠ  `use: { extraHTTPHeaders: { 'Authorization': 'Bearer ${token}' } }`
   - **æˆ–**: åœ¨æµ‹è¯•å‰é€šè¿‡ `dotenv` åŠ è½½ç¯å¢ƒå˜é‡
   - **é¢„è®¡æ—¶é—´**: 30 åˆ†é’Ÿ

2. **é‡æ–°æ‰§è¡Œ Phase 1 æµ‹è¯•**
   - **å‰ç½®æ¡ä»¶**: ç¯å¢ƒå˜é‡é…ç½®å®Œæˆ
   - **é¢„æœŸç»“æœ**: 6/6 é€šè¿‡
   - **é¢„è®¡æ—¶é—´**: 5 åˆ†é’Ÿ

---

## ğŸ“… ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ
1. ä¿®å¤ Playwright ç¯å¢ƒå˜é‡é…ç½®
2. é‡æ–°æ‰§è¡Œ Phase 1 æµ‹è¯•ï¼ˆé¢„æœŸå…¨ç»¿ï¼‰
3. æ‰§è¡Œ Phase 2 CRUD ä¸šåŠ¡æµç¨‹æµ‹è¯•
4. æ‰§è¡Œ Phase 3 å›å½’ä¸ä¼˜åŒ–éªŒè¯
5. æ‰§è¡Œ Phase 4 CQRS åè®®åˆ†ç¦»æµ‹è¯•

### æŠ¥å‘Šæ›´æ–°
- å®Œæˆæ‰€æœ‰æµ‹è¯•åæ›´æ–°æœ¬æŠ¥å‘Šçš„"æ‰§è¡Œæ‘˜è¦"éƒ¨åˆ†
- ç”Ÿæˆ HTML æµ‹è¯•æŠ¥å‘Šï¼ˆ`npx playwright show-report`ï¼‰
- æ›´æ–° `docs/development-plans/06-integrated-teams-progress-log.md`

---

## ğŸ“‚ é™„ä»¶

- **æµ‹è¯•æ—¥å¿—**: `/tmp/phase1-architecture-final.log`
- **æˆªå›¾**: `test-results/architecture-e2e-*/test-failed-1.png`
- **è§†é¢‘**: `test-results/architecture-e2e-*/video.webm`
- **æœåŠ¡æ—¥å¿—**:
  - RS256 è®¤è¯: `/tmp/auth-rs256-sim.log`
  - åç«¯æœåŠ¡: `/tmp/run-dev.log`
  - å‰ç«¯æœåŠ¡: `/tmp/frontend-dev.log`

---

## âœï¸ ç»“è®º

**å½“å‰çŠ¶æ€**: âš ï¸ **éƒ¨åˆ†é€šè¿‡ï¼Œç¯å¢ƒé…ç½®å¾…ä¿®å¤**

**æ ¸å¿ƒé—®é¢˜**: JWT ç¯å¢ƒå˜é‡æœªæ­£ç¡®ä¼ é€’åˆ° Playwright workerï¼Œå¯¼è‡´ GraphQL æ¥å£éªŒè¯å¤±è´¥ã€‚

**ä¿®å¤ä¼˜å…ˆçº§**: P0ï¼ˆé˜»å¡åç»­æµ‹è¯•ï¼‰

**é¢„è®¡ä¿®å¤æ—¶é—´**: < 1 å°æ—¶

**ä¿®å¤åé¢„æœŸ**: Phase 1 æµ‹è¯• 100% é€šè¿‡ï¼Œå¯ç»§ç»­ Phase 2-4 æµ‹è¯•ã€‚

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-02 09:35 UTC+8
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0
**ä¸‹æ¬¡æ›´æ–°**: ç¯å¢ƒä¿®å¤åé‡æ–°æ‰§è¡Œæµ‹è¯•
