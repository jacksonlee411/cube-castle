# é™æ€ä»£ç æ£€æŸ¥æŠ¥å‘Šï¼ˆ2025-10-21ï¼‰

## å‘½ä»¤
rg --color=never "start_date|startDate" --glob '!docs/development-plans/**' --glob '!reports/**'

sql/init/02-sample-data.sql:64: '{"projectCode": "PROJ-2025-001", "projectManager": "EMP-001", "startDate": "2025-01-01", "endDate": "2025-12-31", "budget": 3000000}',
database/migrations/046_seed_positions_data.sql:340:    start_date, end_date, is_current,
database/migrations/046_seed_positions_data.sql:361:ON CONFLICT (tenant_id, position_code, employee_id, start_date) DO NOTHING;
frontend/eslint-report.json:5:[{"filePath":"/home/shangmeilin/cube-castle/frontend/OrganizationComponents.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":103,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":103,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3269,3272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3269,3272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchOrganizations'. Either include it or remove the dependency array.","line":197,"column":6,"nodeType":"ArrayExpression","endLine":197,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchOrganizations, filter]","fix":{"range":[5555,5563],"text":"[fetchOrganizations, filter]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchOrganizations' and 'fetchStats'. Either include them or remove the dependency array.","line":250,"column":6,"nodeType":"ArrayExpression","endLine":250,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchOrganizations, fetchStats, filter]","fix":{"range":[7090,7098],"text":"[fetchOrganizations, fetchStats, filter]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\n\r\n// 7ä½ç¼–ç ç»„ç»‡å•å…ƒç±»å‹å®šä¹‰\r\ninterface OrganizationUnit {\r\n  code: string;\r\n  name: string;\r\n  unit_type: 'COMPANY' | 'DEPARTMENT' | 'PROJECT_TEAM' | 'COST_CENTER';\r\n  status: 'ACTIVE' | 'INACTIVE' | 'PLANNED';\r\n  level: number;\r\n  path: string;\r\n  sort_order: number;\r\n  parent_code?: string;\r\n  description?: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\ninterface OrganizationListResponse {\r\n  organizations: OrganizationUnit[];\r\n  total_count: number;\r\n  page: number;\r\n  page_size: number;\r\n}\r\n\r\n// APIå®¢æˆ·ç«¯ç±»\r\nclass OrganizationAPI {\r\n  private baseURL: string;\r\n\r\n  constructor(baseURL: string = 'http://localhost:8080') {\r\n    this.baseURL = baseURL;\r\n  }\r\n\r\n  // éªŒè¯7ä½ç¼–ç æ ¼å¼\r\n  private validateCode(code: string): boolean {\r\n    return /^[0-9]{7}$/.test(code);\r\n  }\r\n\r\n  // è·å–ç»„ç»‡å•å…ƒåˆ—è¡¨\r\n  async getAll(params?: {\r\n    unit_type?: string;\r\n    status?: string;\r\n    limit?: number;\r\n    offset?: number;\r\n  }): Promise<OrganizationListResponse> {\r\n    const searchParams = new URLSearchParams();\r\n    if (params?.unit_type) searchParams.set('unit_type', params.unit_type);\r\n    if (params?.status) searchParams.set('status', params.status);\r\n    if (params?.limit) searchParams.set('limit', params.limit.toString());\r\n    if (params?.offset) searchParams.set('offset', params.offset.toString());\r\n\r\n    const response = await fetch(`${this.baseURL}/api/v1/organization-units?${searchParams}`);\r\n    if (!response.ok) {\r\n      throw new Error(`API error: ${response.status} ${response.statusText}`);\r\n    }\r\n    return response.json();\r\n  }\r\n\r\n  // é€šè¿‡ç¼–ç è·å–å•ä¸ªç»„ç»‡å•å…ƒ\r\n  async getByCode(code: string): Promise<OrganizationUnit> {\r\n    if (!this.validateCode(code)) {\r\n      throw new Error(`Invalid organization code: ${code}. Must be 7 digits.`);\r\n    }\r\n\r\n    const response = await fetch(`${this.baseURL}/api/v1/organization-units/${code}`);\r\n    if (!response.ok) {\r\n      if (response.status === 404) {\r\n        throw new Error(`Organization unit not found: ${code}`);\r\n      }\r\n      throw new Error(`API error: ${response.status} ${response.statusText}`);\r\n    }\r\n    return response.json();\r\n  }\r\n\r\n  // è·å–ç»Ÿè®¡ä¿¡æ¯\r\n  async getStats(): Promise<{\r\n    total_count: number;\r\n    by_type: Record<string, number>;\r\n    by_status: Record<string, number>;\r\n  }> {\r\n    const response = await fetch(`${this.baseURL}/api/v1/organization-units/stats`);\r\n    if (!response.ok) {\r\n      throw new Error(`API error: ${response.status} ${response.statusText}`);\r\n    }\r\n    return response.json();\r\n  }\r\n\r\n  // å¥åº·æ£€æŸ¥\r\n  async healthCheck(): Promise<{\r\n    status: string;\r\n    timestamp: string;\r\n    version: string;\r\n    service: string;\r\n  }> {\r\n    const response = await fetch(`${this.baseURL}/health`);\r\n    if (!response.ok) {\r\n      throw new Error(`Health check failed: ${response.status}`);\r\n    }\r\n    return response.json();\r\n  }\r\n}\r\n\r\n// React Hook - ç»„ç»‡å•å…ƒæ•°æ®ç®¡ç†\r\nexport const useOrganizationUnits = (apiBaseURL?: string) => {\r\n  const [api] = useState(() => new OrganizationAPI(apiBaseURL));\r\n  const [organizations, setOrganizations] = useState<OrganizationUnit[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [stats, setStats] = useState<any>(null);\r\n\r\n  // è·å–ç»„ç»‡åˆ—è¡¨\r\n  const fetchOrganizations = async (params?: {\r\n    unit_type?: string;\r\n    status?: string;\r\n    limit?: number;\r\n    offset?: number;\r\n  }) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const response = await api.getAll(params);\r\n      setOrganizations(response.organizations);\r\n      return response;\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error';\r\n      setError(errorMessage);\r\n      throw err;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // è·å–å•ä¸ªç»„ç»‡\r\n  const fetchOrganizationByCode = async (code: string) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const organization = await api.getByCode(code);\r\n      return organization;\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error';\r\n      setError(errorMessage);\r\n      throw err;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // è·å–ç»Ÿè®¡ä¿¡æ¯\r\n  const fetchStats = async () => {\r\n    try {\r\n      const statsData = await api.getStats();\r\n      setStats(statsData);\r\n      return statsData;\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error';\r\n      setError(errorMessage);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  // å¥åº·æ£€æŸ¥\r\n  const checkHealth = async () => {\r\n    try {\r\n      return await api.healthCheck();\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error';\r\n      setError(errorMessage);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  return {\r\n    organizations,\r\n    loading,\r\n    error,\r\n    stats,\r\n    fetchOrganizations,\r\n    fetchOrganizationByCode,\r\n    fetchStats,\r\n    checkHealth,\r\n    api\r\n  };\r\n};\r\n\r\n// Reactç»„ä»¶ - ç»„ç»‡å•å…ƒé€‰æ‹©å™¨\r\nexport const OrganizationSelector: React.FC<{\r\n  onSelect: (organization: OrganizationUnit) => void;\r\n  filter?: { unit_type?: string; status?: string };\r\n  placeholder?: string;\r\n  apiBaseURL?: string;\r\n}> = ({ onSelect, filter = {}, placeholder = \"é€‰æ‹©ç»„ç»‡å•å…ƒ\", apiBaseURL }) => {\r\n  const { organizations, loading, error, fetchOrganizations } = useOrganizationUnits(apiBaseURL);\r\n  const [selectedCode, setSelectedCode] = useState<string>('');\r\n\r\n  useEffect(() => {\r\n    fetchOrganizations(filter);\r\n  }, [filter]);\r\n\r\n  const handleChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\r\n    const code = event.target.value;\r\n    setSelectedCode(code);\r\n    \r\n    const selected = organizations.find(org => org.code === code);\r\n    if (selected) {\r\n      onSelect(selected);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"organization-selector\">\r\n      <select \r\n        value={selectedCode} \r\n        onChange={handleChange}\r\n        disabled={loading}\r\n        style={{\r\n          padding: '8px 12px',\r\n          border: '1px solid #ddd',\r\n          borderRadius: '4px',\r\n          fontSize: '14px',\r\n          minWidth: '200px'\r\n        }}\r\n      >\r\n        <option value=\"\">{loading ? 'åŠ è½½ä¸­...' : placeholder}</option>\r\n        {organizations.map(org => (\r\n          <option key={org.code} value={org.code}>\r\n            {org.code} - {org.name} ({org.unit_type})\r\n          </option>\r\n        ))}\r\n      </select>\r\n      {error && (\r\n        <div style={{ color: 'red', fontSize: '12px', marginTop: '4px' }}>\r\n          {error}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Reactç»„ä»¶ - ç»„ç»‡å•å…ƒè¡¨æ ¼\r\nexport const OrganizationTable: React.FC<{\r\n  filter?: { unit_type?: string; status?: string };\r\n  onRowClick?: (organization: OrganizationUnit) => void;\r\n  apiBaseURL?: string;\r\n}> = ({ filter = {}, onRowClick, apiBaseURL }) => {\r\n  const { organizations, loading, error, fetchOrganizations, stats, fetchStats } = useOrganizationUnits(apiBaseURL);\r\n\r\n  useEffect(() => {\r\n    fetchOrganizations(filter);\r\n    fetchStats();\r\n  }, [filter]);\r\n\r\n  if (loading) {\r\n    return <div style={{ padding: '20px', textAlign: 'center' }}>åŠ è½½ä¸­...</div>;\r\n  }\r\n\r\n  if (error) {\r\n    return <div style={{ padding: '20px', color: 'red' }}>é”™è¯¯: {error}</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"organization-table\">\r\n      {stats && (\r\n        <div style={{ marginBottom: '20px', padding: '10px', backgroundColor: '#f5f5f5', borderRadius: '4px' }}>\r\n          <strong>ç»Ÿè®¡ä¿¡æ¯:</strong> æ€»è®¡ {stats.total_count} ä¸ªç»„ç»‡å•å…ƒ\r\n        </div>\r\n      )}\r\n      \r\n      <table style={{ width: '100%', borderCollapse: 'collapse', border: '1px solid #ddd' }}>\r\n        <thead>\r\n          <tr style={{ backgroundColor: '#f8f9fa' }}>\r\n            <th style={{ padding: '12px', border: '1px solid #ddd', textAlign: 'left' }}>ç¼–ç </th>\r\n            <th style={{ padding: '12px', border: '1px solid #ddd', textAlign: 'left' }}>åç§°</th>\r\n            <th style={{ padding: '12px', border: '1px solid #ddd', textAlign: 'left' }}>ç±»å‹</th>\r\n            <th style={{ padding: '12px', border: '1px solid #ddd', textAlign: 'left' }}>çŠ¶æ€</th>\r\n            <th style={{ padding: '12px', border: '1px solid #ddd', textAlign: 'left' }}>å±‚çº§</th>\r\n            <th style={{ padding: '12px', border: '1px solid #ddd', textAlign: 'left' }}>æè¿°</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {organizations.map(org => (\r\n            <tr \r\n              key={org.code}\r\n              onClick={() => onRowClick?.(org)}\r\n              style={{ \r\n                cursor: onRowClick ? 'pointer' : 'default',\r\n                backgroundColor: onRowClick ? 'transparent' : undefined\r\n              }}\r\n              onMouseEnter={(e) => {\r\n                if (onRowClick) e.currentTarget.style.backgroundColor = '#f8f9fa';\r\n              }}\r\n              onMouseLeave={(e) => {\r\n                if (onRowClick) e.currentTarget.style.backgroundColor = 'transparent';\r\n              }}\r\n            >\r\n              <td style={{ padding: '12px', border: '1px solid #ddd' }}>\r\n                <code style={{ backgroundColor: '#e9ecef', padding: '2px 4px', borderRadius: '2px' }}>\r\n                  {org.code}\r\n                </code>\r\n              </td>\r\n              <td style={{ padding: '12px', border: '1px solid #ddd' }}>{org.name}</td>\r\n              <td style={{ padding: '12px', border: '1px solid #ddd' }}>\r\n                <span style={{\r\n                  padding: '2px 8px',\r\n                  borderRadius: '4px',\r\n                  fontSize: '12px',\r\n                  backgroundColor: org.unit_type === 'COMPANY' ? '#e3f2fd' : \r\n                               org.unit_type === 'DEPARTMENT' ? '#f3e5f5' : '#fff3e0'\r\n                }}>\r\n                  {org.unit_type}\r\n                </span>\r\n              </td>\r\n              <td style={{ padding: '12px', border: '1px solid #ddd' }}>\r\n                <span style={{\r\n                  padding: '2px 8px',\r\n                  borderRadius: '4px',\r\n                  fontSize: '12px',\r\n                  backgroundColor: org.status === 'ACTIVE' ? '#e8f5e8' : '#ffebee',\r\n                  color: org.status === 'ACTIVE' ? '#2e7d32' : '#c62828'\r\n                }}>\r\n                  {org.status}\r\n                </span>\r\n              </td>\r\n              <td style={{ padding: '12px', border: '1px solid #ddd' }}>{org.level}</td>\r\n              <td style={{ padding: '12px', border: '1px solid #ddd' }}>\r\n                {org.description || '-'}\r\n              </td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n\r\n      {organizations.length === 0 && (\r\n        <div style={{ padding: '20px', textAlign: 'center', color: '#666' }}>\r\n          æš‚æ— æ•°æ®\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// å¯¼å‡ºç±»å‹å’Œç»„ä»¶\r\nexport type { OrganizationUnit, OrganizationListResponse };\r\nexport { OrganizationAPI };","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/MinimalTemporalTest.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/SimpleApp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/SimpleTemporalTest.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/components/__tests__/AppShell.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/components/__tests__/OrganizationDashboard.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/components/__tests__/canvas-integration.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":6,"column":34,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":6,"endColumn":77},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":26,"column":23,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":26,"endColumn":66},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":47,"column":7,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":47,"endColumn":44},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":52,"column":7,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":52,"endColumn":49},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":58,"column":33,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":58,"endColumn":76}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen } from '@testing-library/react';\r\n\r\ndescribe('Canvas Kit Integration', () => {\r\n  it('åº”è¯¥æˆåŠŸæ¸²æŸ“å®é™…Canvasç»„ä»¶', () => {\r\n    const TestComponent = () => {\r\n      const { CanvasProvider } = require('@workday/canvas-kit-react/common');\r\n      return (\r\n        <CanvasProvider>\r\n          <div data-testid=\"test-content\">Canvas Provider é›†æˆæµ‹è¯•</div>\r\n        </CanvasProvider>\r\n      );\r\n    };\r\n    \r\n    render(<TestComponent />);\r\n    \r\n    // æ£€æŸ¥Canvas Provideræ˜¯å¦æ­£ç¡®æ¸²æŸ“äº†å†…å®¹\r\n    expect(screen.getByTestId('test-content')).toBeInTheDocument();\r\n    \r\n    // æ£€æŸ¥Canvasæ ·å¼æ˜¯å¦åº”ç”¨ (é€šè¿‡className)\r\n    const container = screen.getByTestId('test-content').parentElement;\r\n    expect(container).toHaveClass(/css-/);\r\n  });\r\n\r\n  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“Canvas Boxç»„ä»¶', () => {\r\n    const TestComponent = () => {\r\n      const { Box } = require('@workday/canvas-kit-react/layout');\r\n      return (\r\n        <Box marginBottom=\"l\" padding=\"m\" data-testid=\"test-box\">\r\n          Canvas Box æµ‹è¯•\r\n        </Box>\r\n      );\r\n    };\r\n    \r\n    render(<TestComponent />);\r\n    \r\n    expect(screen.getByTestId('test-box')).toBeInTheDocument();\r\n    expect(screen.getByText('Canvas Box æµ‹è¯•')).toBeInTheDocument();\r\n    \r\n    // æ£€æŸ¥Canvasæ ·å¼æ˜¯å¦åº”ç”¨\r\n    const box = screen.getByTestId('test-box');\r\n    expect(box).toHaveClass(/css-/);\r\n  });\r\n\r\n  it('åº”è¯¥æ”¯æŒCanvasè®¾è®¡ä»¤ç‰Œç³»ç»Ÿ', () => {\r\n    // æµ‹è¯•Canvasè®¾è®¡ä»¤ç‰Œæ˜¯å¦å¯ä»¥æ­£ç¡®å¯¼å…¥\r\n    expect(() => {\r\n      require('@workday/canvas-tokens-web');\r\n    }).not.toThrow();\r\n    \r\n    // æµ‹è¯•å­—ä½“æ˜¯å¦å¯ä»¥æ­£ç¡®å¯¼å…¥\r\n    expect(() => {\r\n      require('@workday/canvas-kit-react-fonts');\r\n    }).not.toThrow();\r\n  });\r\n\r\n  it('åº”è¯¥æ”¯æŒCanvasæŒ‰é’®ç»„ä»¶', () => {\r\n    const TestComponent = () => {\r\n      const { PrimaryButton } = require('@workday/canvas-kit-react/button');\r\n      return (\r\n        <PrimaryButton data-testid=\"test-button\">\r\n          æµ‹è¯•æŒ‰é’®\r\n        </PrimaryButton>\r\n      );\r\n    };\r\n    \r\n    render(<TestComponent />);\r\n    \r\n    expect(screen.getByTestId('test-button')).toBeInTheDocument();\r\n    expect(screen.getByText('æµ‹è¯•æŒ‰é’®')).toBeInTheDocument();\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/design-system/tokens/brand.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/design-system/tokens/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/monitoring/MonitoringDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/monitoring/components/ControlPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/monitoring/components/MetricsCharts.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/monitoring/components/ServiceCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/monitoring/components/ServiceStatusGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/OrganizationDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'plannedOrgTemplate' is assigned a value but never used.","line":155,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":155,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Box } from '@workday/canvas-kit-react/layout';\r\nimport { Heading, Text } from '@workday/canvas-kit-react/text';\r\nimport { PrimaryButton, SecondaryButton, TertiaryButton } from '@workday/canvas-kit-react/button';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\n\r\nimport { StatsCards } from './components/StatsCards';\r\nimport { OrganizationTable } from './components/OrganizationTable';\r\nimport { OrganizationForm } from './components/OrganizationForm';\r\nimport { OrganizationFilters } from './OrganizationFilters';\r\nimport { PaginationControls } from './PaginationControls';\r\n\r\nimport { useOrganizationDashboard } from './hooks/useOrganizationDashboard';\r\nimport { useOrganizationActions } from './hooks/useOrganizationActions';\r\n\r\n// æ—¶æ€ç®¡ç†ç»„ä»¶å¯¼å…¥ - æš‚æ—¶ç¦ç”¨ä»¥ä¿®å¤æ— é™å¾ªç¯é”™è¯¯\r\n// import { TemporalNavbar } from '../temporal/components/TemporalNavbar';\r\n// import { useTemporalMode, useTemporalQueryState } from '../../shared/hooks/useTemporalQuery';\r\n// import type { TemporalMode } from '../../shared/types/temporal';\r\n\r\nconst DashboardHeader: React.FC<{\r\n  onCreateClick: () => void;\r\n  onCreatePlannedClick?: () => void;\r\n  isToggling: boolean;\r\n  temporalMode?: 'current' | 'historical';\r\n  isHistorical?: boolean;\r\n}> = ({ onCreateClick, onCreatePlannedClick, isToggling, isHistorical = false }) => (\r\n  <Box marginBottom=\"l\">\r\n    <Heading size=\"large\">\r\n      ç»„ç»‡æ¶æ„ç®¡ç†\r\n      {isHistorical && (\r\n        <Text as=\"span\" typeLevel=\"subtext.medium\" color=\"hint\" marginLeft=\"s\">\r\n          (å†å²è§†å›¾)\r\n        </Text>\r\n      )}\r\n    </Heading>\r\n    <Box paddingTop=\"m\">\r\n      <PrimaryButton \r\n        marginRight=\"s\" \r\n        onClick={onCreateClick}\r\n        disabled={isToggling || isHistorical}\r\n      >\r\n        {isHistorical ? 'æ–°å¢ç»„ç»‡å•å…ƒ (å†å²æ¨¡å¼ç¦ç”¨)' : 'æ–°å¢ç»„ç»‡å•å…ƒ'}\r\n      </PrimaryButton>\r\n      \r\n      {/* è®¡åˆ’ç»„ç»‡åˆ›å»ºæŒ‰é’® */}\r\n      {onCreatePlannedClick && !isHistorical && (\r\n        <SecondaryButton \r\n          marginRight=\"s\" \r\n          onClick={onCreatePlannedClick}\r\n          disabled={isToggling}\r\n          style={{ borderColor: '#1890ff', color: '#1890ff' }}\r\n        >\r\n          ğŸ“… æ–°å¢è®¡åˆ’ç»„ç»‡\r\n        </SecondaryButton>\r\n      )}\r\n      \r\n      <SecondaryButton \r\n        marginRight=\"s\"\r\n        disabled={isToggling || isHistorical}\r\n      >\r\n        å¯¼å…¥æ•°æ®\r\n      </SecondaryButton>\r\n      <TertiaryButton disabled={isToggling || isHistorical}>\r\n        å¯¼å‡ºæŠ¥å‘Š\r\n      </TertiaryButton>\r\n      {isToggling && (\r\n        <Text typeLevel=\"subtext.small\" color=\"hint\" marginLeft=\"m\">\r\n          æ­£åœ¨æ›´æ–°ç»„ç»‡çŠ¶æ€...\r\n        </Text>\r\n      )}\r\n      {isHistorical && (\r\n        <Text typeLevel=\"subtext.small\" color=\"hint\" marginLeft=\"m\">\r\n          ğŸ“– å½“å‰æŸ¥çœ‹å†å²æ•°æ®ï¼Œéƒ¨åˆ†æ“ä½œå·²ç¦ç”¨\r\n        </Text>\r\n      )}\r\n    </Box>\r\n  </Box>\r\n);\r\n\r\nconst EmptyState: React.FC<{\r\n  isFiltered: boolean;\r\n  onClearFilters: () => void;\r\n}> = ({ isFiltered, onClearFilters }) => (\r\n  <Box padding=\"xl\" textAlign=\"center\">\r\n    <Text>\r\n      {isFiltered \r\n        ? 'æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆç­›é€‰æ¡ä»¶çš„ç»„ç»‡å•å…ƒ'\r\n        : 'æš‚æ— ç»„ç»‡æ•°æ®'\r\n      }\r\n    </Text>\r\n    {isFiltered && (\r\n      <Box marginTop=\"s\">\r\n        <SecondaryButton \r\n          size=\"small\"\r\n          onClick={onClearFilters}\r\n        >\r\n          æ¸…é™¤ç­›é€‰æ¡ä»¶\r\n        </SecondaryButton>\r\n      </Box>\r\n    )}\r\n  </Box>\r\n);\r\n\r\nconst LoadingState: React.FC = () => (\r\n  <Box padding=\"l\">\r\n    <Text>åŠ è½½ç»„ç»‡æ•°æ®ä¸­...</Text>\r\n  </Box>\r\n);\r\n\r\nconst ErrorState: React.FC<{ error: Error }> = ({ error }) => (\r\n  <Box padding=\"l\">\r\n    <Text>åŠ è½½å¤±è´¥: {error.message}</Text>\r\n  </Box>\r\n);\r\n\r\nexport const OrganizationDashboard: React.FC = () => {\r\n  const navigate = useNavigate();\r\n\r\n  // ä¼ ç»Ÿç»„ç»‡æ•°æ®å’Œæ“ä½œ\r\n  const {\r\n    organizations,\r\n    totalCount,\r\n    stats,\r\n    isLoading,\r\n    isFetching,\r\n    error,\r\n    filters,\r\n    isFiltered,\r\n    setFilters,\r\n    resetFilters,\r\n    handlePageChange,\r\n  } = useOrganizationDashboard();\r\n\r\n  const {\r\n    selectedOrg,\r\n    isFormOpen,\r\n    togglingId,\r\n    isToggling,\r\n    handleCreate,\r\n    handleEdit,\r\n    handleToggleStatus,\r\n    handleFormClose,\r\n    handleFormSubmit,\r\n  } = useOrganizationActions();\r\n\r\n  // æ—¶æ€ç®¡ç†å¯¼èˆªå¤„ç†å™¨\r\n  const handleTemporalManage = (organizationCode: string) => {\r\n    navigate(`/organizations/${organizationCode}/temporal`);\r\n  };\r\n\r\n  // è®¡åˆ’ç»„ç»‡åˆ›å»ºå¤„ç† - é‡æ–°å¯ç”¨\r\n  const handleCreatePlanned = () => {\r\n    const plannedOrgTemplate = {\r\n      name: '',\r\n      unit_type: 'DEPARTMENT',\r\n      status: 'PLANNED',\r\n      description: '',\r\n      parent_code: '',\r\n      level: 1,\r\n      sort_order: 0,\r\n      _isPlannedCreation: true\r\n    };\r\n    handleCreate();\r\n  };\r\n\r\n  // æ—¶æ€ç®¡ç†çŠ¶æ€å’Œæ“ä½œ - æš‚æ—¶ç¦ç”¨ä»¥ä¿®å¤æ— é™å¾ªç¯é”™è¯¯\r\n  // const { mode: temporalMode, isHistorical, isCurrent, isPlanning } = useTemporalMode();\r\n  // const { loading: temporalLoading, error: temporalError, context: temporalContext } = useTemporalQueryState();\r\n  const temporalMode = 'current' as const;\r\n  const isHistorical = false;\r\n  const isPlanning = false;\r\n  const temporalLoading = { organizations: false };\r\n\r\n  // æ—¶æ€æ¨¡å¼å˜æ›´å¤„ç† - æš‚æ—¶ç¦ç”¨ä»¥ä¿®å¤æ— é™å¾ªç¯é”™è¯¯\r\n  // const handleTemporalModeChange = (newMode: TemporalMode) => {\r\n  //   console.log(`æ—¶æ€æ¨¡å¼åˆ‡æ¢åˆ°: ${newMode}`);\r\n  // };\r\n\r\n  if (isLoading || temporalLoading.organizations) {\r\n    return <LoadingState />;\r\n  }\r\n\r\n  if (error) {\r\n    return <ErrorState error={error} />;\r\n  }\r\n\r\n  const hasOrganizations = organizations && organizations.length > 0;\r\n\r\n  return (\r\n    <Box data-testid=\"organization-dashboard\">\r\n      {/* æ—¶æ€å¯¼èˆªæ  - æš‚æ—¶ç¦ç”¨ä»¥ä¿®å¤æ— é™å¾ªç¯é”™è¯¯ */}\r\n      {/* <Box marginBottom=\"l\">\r\n        <TemporalNavbar\r\n          onModeChange={handleTemporalModeChange}\r\n          showAdvancedSettings={true}\r\n        />\r\n      </Box> */}\r\n\r\n      <DashboardHeader \r\n        onCreateClick={handleCreate}\r\n        onCreatePlannedClick={handleCreatePlanned}\r\n        isToggling={isToggling}\r\n        temporalMode={temporalMode}\r\n        isHistorical={isHistorical}\r\n      />\r\n      \r\n      {stats && <StatsCards stats={stats} />}\r\n      \r\n      <OrganizationFilters \r\n        filters={filters}\r\n        onFiltersChange={setFilters}\r\n      />\r\n      \r\n      <Card>\r\n        <Card.Heading>\r\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n            <span>\r\n              ç»„ç»‡å•å…ƒåˆ—è¡¨\r\n              {isHistorical && (\r\n                <Text as=\"span\" typeLevel=\"subtext.small\" color=\"hint\" marginLeft=\"s\">\r\n                  - å†å²æ—¶ç‚¹: {/* temporalContext?.asOfDate ? new Date(temporalContext.asOfDate).toLocaleDateString('zh-CN') : */ 'å†å²æ¨¡å¼'}\r\n                </Text>\r\n              )}\r\n              {isPlanning && (\r\n                <Text as=\"span\" typeLevel=\"subtext.small\" color=\"hint\" marginLeft=\"s\">\r\n                  - è§„åˆ’è§†å›¾\r\n                </Text>\r\n              )}\r\n            </span>\r\n            {(isFetching || temporalLoading.organizations) && (\r\n              <Text typeLevel=\"subtext.small\" color=\"hint\">\r\n                {temporalLoading.organizations ? 'åŠ è½½æ—¶æ€æ•°æ®ä¸­...' : 'åŠ è½½ä¸­...'}\r\n              </Text>\r\n            )}\r\n          </div>\r\n        </Card.Heading>\r\n        <Card.Body>\r\n          {hasOrganizations ? (\r\n            <>\r\n              <OrganizationTable\r\n                organizations={organizations}\r\n                onEdit={isHistorical ? undefined : handleEdit} // å†å²æ¨¡å¼ç¦ç”¨ç¼–è¾‘\r\n                onToggleStatus={isHistorical ? undefined : (code, status) => { handleToggleStatus(code, status); }} // å†å²æ¨¡å¼ç¦ç”¨çŠ¶æ€åˆ‡æ¢\r\n                onTemporalManage={handleTemporalManage} // æ—¶æ€ç®¡ç†å¯¼èˆª\r\n                loading={isFetching || temporalLoading.organizations}\r\n                togglingId={togglingId}\r\n                temporalMode={temporalMode}\r\n                isHistorical={isHistorical}\r\n              />\r\n              \r\n              <PaginationControls\r\n                currentPage={filters.page}\r\n                totalCount={totalCount}\r\n                pageSize={filters.pageSize}\r\n                onPageChange={handlePageChange}\r\n                disabled={isFetching || isToggling || temporalLoading.organizations}\r\n              />\r\n            </>\r\n          ) : (\r\n            <EmptyState \r\n              isFiltered={isFiltered}\r\n              onClearFilters={resetFilters}\r\n            />\r\n          )}\r\n        </Card.Body>\r\n      </Card>\r\n\r\n      {/* ç»„ç»‡è¡¨å• - å†å²æ¨¡å¼ä¸‹ç¦ç”¨ */}\r\n      {!isHistorical && (\r\n        <OrganizationForm \r\n          organization={selectedOrg}\r\n          isOpen={isFormOpen}\r\n          onClose={handleFormClose}\r\n          onSubmit={handleFormSubmit}\r\n          temporalMode={temporalMode}\r\n          isHistorical={isHistorical}\r\n          enableTemporalFeatures={true}\r\n        />\r\n      )}\r\n    </Box>\r\n  );\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/OrganizationFilters.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PrimaryButton' is defined but never used.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3263,3266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3263,3266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback, useMemo } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { FormField } from '@workday/canvas-kit-react/form-field';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { SecondaryButton, PrimaryButton } from '@workday/canvas-kit-react/button';\r\nimport { Switch } from '@workday/canvas-kit-react/switch';\r\nimport { useDebounce } from '../../shared/hooks/useDebounce';\r\nimport { TemporalStatusSelector } from '../temporal/components/TemporalStatusSelector';\r\nimport type { TemporalStatus } from '../temporal/components/TemporalStatusSelector';\r\nimport { TemporalDatePicker, validateTemporalDate } from '../temporal/components/TemporalDatePicker';\r\n\r\nexport interface FilterState {\r\n  searchText: string;\r\n  unit_type: string | undefined;\r\n  status: string | undefined;\r\n  level: number | undefined;\r\n  page: number;\r\n  pageSize: number;\r\n  // æ—¶æ€ç­›é€‰å­—æ®µ\r\n  temporalMode?: 'current' | 'historical' | 'all';\r\n  showOnlyTemporal?: boolean;\r\n  temporalStatus?: TemporalStatus;\r\n  effectiveDateFrom?: string;\r\n  effectiveDateTo?: string;\r\n  pointInTime?: string;\r\n}\r\n\r\ninterface OrganizationFiltersProps {\r\n  filters: FilterState;\r\n  onFiltersChange: (filters: FilterState) => void;\r\n  showTemporalFilters?: boolean;\r\n}\r\n\r\ninterface SelectOption {\r\n  label: string;\r\n  value: string;\r\n}\r\n\r\nconst UNIT_TYPE_OPTIONS: SelectOption[] = [\r\n  { label: 'å…¨éƒ¨ç±»å‹', value: '' },\r\n  { label: 'éƒ¨é—¨', value: 'DEPARTMENT' },\r\n  { label: 'æˆæœ¬ä¸­å¿ƒ', value: 'COST_CENTER' },\r\n  { label: 'å…¬å¸', value: 'COMPANY' },\r\n  { label: 'é¡¹ç›®å›¢é˜Ÿ', value: 'PROJECT_TEAM' },\r\n];\r\n\r\nconst STATUS_OPTIONS: SelectOption[] = [\r\n  { label: 'å…¨éƒ¨çŠ¶æ€', value: '' },\r\n  { label: 'æ¿€æ´»', value: 'ACTIVE' },\r\n  { label: 'åœç”¨', value: 'INACTIVE' },\r\n  { label: 'è®¡åˆ’ä¸­', value: 'PLANNED' },\r\n];\r\n\r\nconst TEMPORAL_MODE_OPTIONS: SelectOption[] = [\r\n  { label: 'å½“å‰ç»„ç»‡', value: 'current' },\r\n  { label: 'å†å²æ•°æ®', value: 'historical' },\r\n  { label: 'å…¨éƒ¨æ•°æ®', value: 'all' },\r\n];\r\n\r\nconst LEVEL_OPTIONS: SelectOption[] = [\r\n  { label: 'å…¨éƒ¨å±‚çº§', value: '' },\r\n  { label: '1çº§', value: '1' },\r\n  { label: '2çº§', value: '2' },\r\n  { label: '3çº§', value: '3' },\r\n  { label: '4çº§', value: '4' },\r\n  { label: '5çº§', value: '5' },\r\n];\r\n\r\nconst PAGE_SIZE_OPTIONS: SelectOption[] = [\r\n  { label: '10æ¡/é¡µ', value: '10' },\r\n  { label: '20æ¡/é¡µ', value: '20' },\r\n  { label: '50æ¡/é¡µ', value: '50' },\r\n  { label: '100æ¡/é¡µ', value: '100' },\r\n];\r\n\r\nexport const OrganizationFilters: React.FC<OrganizationFiltersProps> = ({\r\n  filters,\r\n  onFiltersChange,\r\n  showTemporalFilters = false,\r\n}) => {\r\n  const [localSearchText, setLocalSearchText] = useState(filters.searchText);\r\n  const [showAdvancedTemporal, setShowAdvancedTemporal] = useState(false);\r\n  \r\n  // ä½¿ç”¨é˜²æŠ–å¤„ç†æœç´¢æ–‡æœ¬\r\n  const debouncedSearchText = useDebounce(localSearchText, 300);\r\n  \r\n  // å½“é˜²æŠ–åçš„æœç´¢æ–‡æœ¬å˜åŒ–æ—¶ï¼Œæ›´æ–°è¿‡æ»¤å™¨\r\n  React.useEffect(() => {\r\n    if (debouncedSearchText !== filters.searchText) {\r\n      onFiltersChange({\r\n        ...filters,\r\n        searchText: debouncedSearchText,\r\n        page: 1, // æœç´¢æ—¶é‡ç½®åˆ°ç¬¬ä¸€é¡µ\r\n      });\r\n    }\r\n  }, [debouncedSearchText, filters, onFiltersChange]);\r\n\r\n  const handleFilterChange = useCallback((key: keyof FilterState, value: any) => {\r\n    const newFilters = {\r\n      ...filters,\r\n      [key]: value,\r\n      page: key === 'pageSize' ? 1 : filters.page, // æ”¹å˜é¡µé¢å¤§å°æ—¶é‡ç½®åˆ°ç¬¬ä¸€é¡µ\r\n    };\r\n    \r\n    if (key === 'pageSize') {\r\n      // ç¡®ä¿é¡µé¢å¤§å°æ”¹å˜æ—¶é‡ç½®é¡µç \r\n      newFilters.page = 1;\r\n    }\r\n    \r\n    onFiltersChange(newFilters);\r\n  }, [filters, onFiltersChange]);\r\n\r\n  const handleReset = useCallback(() => {\r\n    const resetFilters: FilterState = {\r\n      searchText: '',\r\n      unit_type: '',\r\n      status: '',\r\n      level: undefined,\r\n      page: 1,\r\n      pageSize: 20,\r\n      // é‡ç½®æ—¶æ€ç­›é€‰\r\n      temporalMode: 'current',\r\n      showOnlyTemporal: false,\r\n      temporalStatus: undefined,\r\n      effectiveDateFrom: undefined,\r\n      effectiveDateTo: undefined,\r\n      pointInTime: undefined,\r\n    };\r\n    setLocalSearchText('');\r\n    setShowAdvancedTemporal(false);\r\n    onFiltersChange(resetFilters);\r\n  }, [onFiltersChange]);\r\n\r\n  // è®¡ç®—æ˜¯å¦æœ‰æ¿€æ´»çš„ç­›é€‰æ¡ä»¶\r\n  const hasActiveFilters = useMemo(() => {\r\n    return !!(\r\n      filters.searchText ||\r\n      filters.unit_type ||\r\n      filters.status ||\r\n      filters.level ||\r\n      (showTemporalFilters && (\r\n        filters.showOnlyTemporal ||\r\n        filters.temporalStatus ||\r\n        filters.effectiveDateFrom ||\r\n        filters.effectiveDateTo ||\r\n        filters.pointInTime ||\r\n        (filters.temporalMode && filters.temporalMode !== 'current')\r\n      ))\r\n    );\r\n  }, [\r\n    filters.searchText, filters.unit_type, filters.status, filters.level,\r\n    filters.showOnlyTemporal, filters.temporalStatus, filters.effectiveDateFrom,\r\n    filters.effectiveDateTo, filters.pointInTime, filters.temporalMode,\r\n    showTemporalFilters\r\n  ]);\r\n\r\n  return (\r\n    <Card marginBottom=\"m\">\r\n      <Card.Heading>ç­›é€‰æ¡ä»¶</Card.Heading>\r\n      <Card.Body>\r\n        <Flex flexDirection=\"column\" gap=\"m\">\r\n          {/* åŸºæœ¬ç­›é€‰æ¡ä»¶ */}\r\n          <div style={{ display: 'flex', flexWrap: 'wrap', gap: '16px', alignItems: 'flex-end' }}>\r\n            {/* æœç´¢æ¡† */}\r\n            <Box minWidth=\"200px\">\r\n              <FormField>\r\n                <FormField.Label>ç»„ç»‡åç§°</FormField.Label>\r\n                <FormField.Field>\r\n                  <TextInput\r\n                    placeholder=\"æœç´¢ç»„ç»‡åç§°...\"\r\n                    value={localSearchText}\r\n                    onChange={(e) => setLocalSearchText(e.target.value)}\r\n                  />\r\n                </FormField.Field>\r\n              </FormField>\r\n            </Box>\r\n\r\n            {/* ç±»å‹ç­›é€‰ */}\r\n            <Box minWidth=\"150px\">\r\n              <FormField>\r\n                <FormField.Label>ç»„ç»‡ç±»å‹</FormField.Label>\r\n                <FormField.Field>\r\n                  <select\r\n                    value={filters.unit_type || ''}\r\n                    onChange={(e) => handleFilterChange('unit_type', e.target.value || undefined)}\r\n                    style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ddd', fontSize: '14px' }}\r\n                  >\r\n                    {UNIT_TYPE_OPTIONS.map(option => (\r\n                      <option key={option.value} value={option.value}>\r\n                        {option.label}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </FormField.Field>\r\n              </FormField>\r\n            </Box>\r\n\r\n            {/* çŠ¶æ€ç­›é€‰ */}\r\n            <Box minWidth=\"150px\">\r\n              <FormField>\r\n                <FormField.Label>çŠ¶æ€</FormField.Label>\r\n                <FormField.Field>\r\n                  <select\r\n                    value={filters.status || ''}\r\n                    onChange={(e) => handleFilterChange('status', e.target.value || undefined)}\r\n                    style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ddd', fontSize: '14px' }}\r\n                  >\r\n                    {STATUS_OPTIONS.map(option => (\r\n                      <option key={option.value} value={option.value}>\r\n                        {option.label}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </FormField.Field>\r\n              </FormField>\r\n            </Box>\r\n\r\n            {/* å±‚çº§ç­›é€‰ */}\r\n            <Box minWidth=\"130px\">\r\n              <FormField>\r\n                <FormField.Label>å±‚çº§</FormField.Label>\r\n                <FormField.Field>\r\n                  <select\r\n                    value={filters.level ? filters.level.toString() : ''}\r\n                    onChange={(e) => handleFilterChange('level', e.target.value ? parseInt(e.target.value) : undefined)}\r\n                    style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ddd', fontSize: '14px' }}\r\n                  >\r\n                    {LEVEL_OPTIONS.map(option => (\r\n                      <option key={option.value} value={option.value}>\r\n                        {option.label}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </FormField.Field>\r\n              </FormField>\r\n            </Box>\r\n\r\n            {/* æ¯é¡µæ˜¾ç¤ºæ•°é‡ */}\r\n            <Box minWidth=\"130px\">\r\n              <FormField>\r\n                <FormField.Label>æ˜¾ç¤ºæ•°é‡</FormField.Label>\r\n                <FormField.Field>\r\n                  <select\r\n                    value={filters.pageSize.toString()}\r\n                    onChange={(e) => handleFilterChange('pageSize', parseInt(e.target.value))}\r\n                    style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ddd', fontSize: '14px' }}\r\n                  >\r\n                    {PAGE_SIZE_OPTIONS.map(option => (\r\n                      <option key={option.value} value={option.value}>\r\n                        {option.label}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </FormField.Field>\r\n              </FormField>\r\n            </Box>\r\n\r\n            {/* é‡ç½®æŒ‰é’® */}\r\n            <Box>\r\n              <SecondaryButton \r\n                onClick={handleReset}\r\n                disabled={!hasActiveFilters}\r\n              >\r\n                é‡ç½®ç­›é€‰\r\n              </SecondaryButton>\r\n            </Box>\r\n          </div>\r\n\r\n          {/* æ—¶æ€ç­›é€‰åŒºåŸŸ */}\r\n          {showTemporalFilters && (\r\n            <Card padding=\"s\">\r\n              <Card.Heading>æ—¶æ€ç­›é€‰</Card.Heading>\r\n              <Card.Body>\r\n                <Flex flexDirection=\"column\" gap=\"m\">\r\n                  {/* æ—¶æ€æ¨¡å¼é€‰æ‹© */}\r\n                  <Flex gap=\"m\" alignItems=\"flex-end\">\r\n                    <Box minWidth=\"150px\">\r\n                      <FormField>\r\n                        <FormField.Label>æ—¶æ€æ¨¡å¼</FormField.Label>\r\n                        <FormField.Field>\r\n                          <select\r\n                            value={filters.temporalMode || 'current'}\r\n                            onChange={(e) => handleFilterChange('temporalMode', e.target.value)}\r\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ddd', fontSize: '14px' }}\r\n                          >\r\n                            {TEMPORAL_MODE_OPTIONS.map(option => (\r\n                              <option key={option.value} value={option.value}>\r\n                                {option.label}\r\n                              </option>\r\n                            ))}\r\n                          </select>\r\n                        </FormField.Field>\r\n                      </FormField>\r\n                    </Box>\r\n\r\n                    {/* ä»…æ˜¾ç¤ºæ—¶æ€ç»„ç»‡å¼€å…³ */}\r\n                    <FormField>\r\n                      <FormField.Label>ä»…æ˜¾ç¤ºæ—¶æ€ç»„ç»‡</FormField.Label>\r\n                      <FormField.Field>\r\n                      <Switch \r\n                        checked={filters.showOnlyTemporal || false}\r\n                        onChange={(checked) => handleFilterChange('showOnlyTemporal', checked)}\r\n                      />\r\n                      </FormField.Field>\r\n                    </FormField>\r\n\r\n                    {/* é«˜çº§æ—¶æ€ç­›é€‰å¼€å…³ */}\r\n                    <SecondaryButton\r\n                      onClick={() => setShowAdvancedTemporal(!showAdvancedTemporal)}\r\n                    >\r\n                      {showAdvancedTemporal ? 'æ”¶èµ·' : 'å±•å¼€'}é«˜çº§ç­›é€‰\r\n                    </SecondaryButton>\r\n                  </Flex>\r\n\r\n                  {/* æ—¶æ€çŠ¶æ€ç­›é€‰ */}\r\n                  <TemporalStatusSelector\r\n                    label=\"æ—¶æ€çŠ¶æ€\"\r\n                    value={filters.temporalStatus}\r\n                    onChange={(value) => handleFilterChange('temporalStatus', value)}\r\n                    includeAll={true}\r\n                    placeholder=\"é€‰æ‹©æ—¶æ€çŠ¶æ€\"\r\n                  />\r\n\r\n                  {/* é«˜çº§æ—¶æ€ç­›é€‰ */}\r\n                  {showAdvancedTemporal && (\r\n                    <Flex flexDirection=\"column\" gap=\"m\">\r\n                      {/* ç”Ÿæ•ˆæ—¥æœŸèŒƒå›´ */}\r\n                      <Flex gap=\"m\">\r\n                        <TemporalDatePicker\r\n                          label=\"ç”Ÿæ•ˆæ—¥æœŸä»\"\r\n                          value={filters.effectiveDateFrom || ''}\r\n                          onChange={(value) => handleFilterChange('effectiveDateFrom', value || undefined)}\r\n                          maxDate={filters.effectiveDateTo}\r\n                          helperText=\"ç­›é€‰åœ¨æ­¤æ—¥æœŸä¹‹åç”Ÿæ•ˆçš„ç»„ç»‡\"\r\n                        />\r\n                        <TemporalDatePicker\r\n                          label=\"ç”Ÿæ•ˆæ—¥æœŸåˆ°\"\r\n                          value={filters.effectiveDateTo || ''}\r\n                          onChange={(value) => handleFilterChange('effectiveDateTo', value || undefined)}\r\n                          minDate={filters.effectiveDateFrom}\r\n                          helperText=\"ç­›é€‰åœ¨æ­¤æ—¥æœŸä¹‹å‰ç”Ÿæ•ˆçš„ç»„ç»‡\"\r\n                        />\r\n                      </Flex>\r\n\r\n                      {/* å†å²æ—¶ç‚¹æŸ¥è¯¢ */}\r\n                      <TemporalDatePicker\r\n                        label=\"å†å²æ—¶ç‚¹æŸ¥è¯¢\"\r\n                        value={filters.pointInTime || ''}\r\n                        onChange={(value) => handleFilterChange('pointInTime', value || undefined)}\r\n                        maxDate={validateTemporalDate.getTodayString()}\r\n                        helperText=\"æŸ¥çœ‹åœ¨æŒ‡å®šæ—¶é—´ç‚¹æœ‰æ•ˆçš„ç»„ç»‡\"\r\n                      />\r\n                    </Flex>\r\n                  )}\r\n                </Flex>\r\n              </Card.Body>\r\n            </Card>\r\n          )}\r\n\r\n          {/* æ¿€æ´»ç­›é€‰æ¡ä»¶æç¤º */}\r\n          {hasActiveFilters && (\r\n            <Box>\r\n              <div style={{ fontSize: '12px', color: '#666' }}>\r\n                å·²æ¿€æ´»ç­›é€‰æ¡ä»¶:\r\n                {filters.searchText && <span style={{ marginLeft: '8px', padding: '2px 6px', backgroundColor: '#e3f2fd', borderRadius: '4px' }}>åç§°: {filters.searchText}</span>}\r\n                {filters.unit_type && <span style={{ marginLeft: '8px', padding: '2px 6px', backgroundColor: '#e3f2fd', borderRadius: '4px' }}>ç±»å‹: {UNIT_TYPE_OPTIONS.find(o => o.value === filters.unit_type)?.label}</span>}\r\n                {filters.status && <span style={{ marginLeft: '8px', padding: '2px 6px', backgroundColor: '#e3f2fd', borderRadius: '4px' }}>çŠ¶æ€: {STATUS_OPTIONS.find(o => o.value === filters.status)?.label}</span>}\r\n                {filters.level && <span style={{ marginLeft: '8px', padding: '2px 6px', backgroundColor: '#e3f2fd', borderRadius: '4px' }}>å±‚çº§: {filters.level}çº§</span>}\r\n                {showTemporalFilters && filters.temporalMode && filters.temporalMode !== 'current' && (\r\n                  <span style={{ marginLeft: '8px', padding: '2px 6px', backgroundColor: '#fff3e0', borderRadius: '4px' }}>\r\n                    æ—¶æ€: {TEMPORAL_MODE_OPTIONS.find(o => o.value === filters.temporalMode)?.label}\r\n                  </span>\r\n                )}\r\n                {filters.showOnlyTemporal && (\r\n                  <span style={{ marginLeft: '8px', padding: '2px 6px', backgroundColor: '#fff3e0', borderRadius: '4px' }}>\r\n                    ä»…æ—¶æ€ç»„ç»‡\r\n                  </span>\r\n                )}\r\n                {filters.temporalStatus && (\r\n                  <span style={{ marginLeft: '8px', padding: '2px 6px', backgroundColor: '#fff3e0', borderRadius: '4px' }}>\r\n                    æ—¶æ€çŠ¶æ€: {filters.temporalStatus}\r\n                  </span>\r\n                )}\r\n                {(filters.effectiveDateFrom || filters.effectiveDateTo) && (\r\n                  <span style={{ marginLeft: '8px', padding: '2px 6px', backgroundColor: '#fff3e0', borderRadius: '4px' }}>\r\n                    ç”Ÿæ•ˆæœŸé—´: {filters.effectiveDateFrom || 'å¼€å§‹'} - {filters.effectiveDateTo || 'ç»“æŸ'}\r\n                  </span>\r\n                )}\r\n                {filters.pointInTime && (\r\n                  <span style={{ marginLeft: '8px', padding: '2px 6px', backgroundColor: '#fff3e0', borderRadius: '4px' }}>\r\n                    æ—¶ç‚¹: {validateTemporalDate.formatDateDisplay(filters.pointInTime)}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </Box>\r\n          )}\r\n        </Flex>\r\n      </Card.Body>\r\n    </Card>\r\n  );\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/OrganizationTemporalPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/PaginationControls.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/OrganizationDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'OrganizationTable' is defined but never used.","line":16,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2474,2477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2474,2477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onOrganizationUpdated' is defined but never used.","line":158,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":158,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isCurrent' is assigned a value but never used.","line":163,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":163,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'latestVersion' is assigned a value but never used.","line":179,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":179,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'timelineEvents' is assigned a value but never used.","line":184,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":184,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'togglingId' is assigned a value but never used.","line":196,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":196,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleVersionComparison' is assigned a value but never used.","line":232,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":232,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'version1' is defined but never used.","line":232,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":232,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'version2' is defined but never used.","line":232,"column":84,"nodeType":null,"messageId":"unusedVar","endLine":232,"endColumn":92}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * ç»„ç»‡è¯¦æƒ…é¡µé¢ - é›†æˆæ—¶é—´çº¿åŠŸèƒ½\r\n * å±•ç¤ºç»„ç»‡çš„è¯¦ç»†ä¿¡æ¯ã€å†å²ç‰ˆæœ¬å’Œæ—¶é—´çº¿äº‹ä»¶\r\n */\r\nimport React, { useState, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Heading, Text } from '@workday/canvas-kit-react/text';\r\nimport { PrimaryButton, SecondaryButton, TertiaryButton } from '@workday/canvas-kit-react/button';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { Badge } from '../../../shared/components/Badge';\r\nimport { Tabs } from '@workday/canvas-kit-react/tabs';\r\nimport { LoadingDots } from '@workday/canvas-kit-react/loading-dots';\r\n\r\n// ç»„ç»‡ç®¡ç†å’Œæ—¶æ€åŠŸèƒ½å¯¼å…¥\r\nimport { OrganizationForm } from '../organizations/components/OrganizationForm';\r\nimport { OrganizationTable } from '../organizations/components/OrganizationTable';\r\nimport { Timeline } from '../temporal/components/Timeline';\r\nimport { VersionComparison } from '../temporal/components/VersionComparison';\r\nimport { TemporalNavbar } from '../temporal/components/TemporalNavbar';\r\n\r\n// Hookså¯¼å…¥\r\nimport { useTemporalOrganization, useOrganizationHistory, useOrganizationTimeline, useTemporalMode } from '../../shared/hooks/useTemporalQuery';\r\nimport { useOrganizationActions } from '../organizations/hooks/useOrganizationActions';\r\n\r\n// Typeså¯¼å…¥\r\nimport type { OrganizationUnit } from '../../shared/types/organization';\r\nimport type { TimelineEvent, TemporalOrganizationUnit, TemporalMode } from '../../shared/types/temporal';\r\n\r\nexport interface OrganizationDetailProps {\r\n  /** ç»„ç»‡ç¼–ç  */\r\n  organizationCode: string;\r\n  /** æ˜¯å¦åªè¯»æ¨¡å¼ */\r\n  readonly?: boolean;\r\n  /** è¿”å›å›è°ƒ */\r\n  onBack?: () => void;\r\n  /** ç»„ç»‡æ›´æ–°å›è°ƒ */\r\n  onOrganizationUpdated?: (organization: OrganizationUnit) => void;\r\n}\r\n\r\n/**\r\n * ç»„ç»‡åŸºæœ¬ä¿¡æ¯å¡ç‰‡\r\n */\r\ninterface OrganizationInfoCardProps {\r\n  organization: OrganizationUnit;\r\n  isHistorical: boolean;\r\n  onEdit?: () => void;\r\n  onToggleStatus?: () => void;\r\n  isLoading?: boolean;\r\n}\r\n\r\nconst OrganizationInfoCard: React.FC<OrganizationInfoCardProps> = ({\r\n  organization,\r\n  isHistorical,\r\n  onEdit,\r\n  onToggleStatus,\r\n  isLoading = false\r\n}) => {\r\n  const getStatusBadge = (status: string) => {\r\n    const statusConfig = {\r\n      'ACTIVE': { label: 'å¯ç”¨', color: 'greenFresca600' },\r\n      'INACTIVE': { label: 'åœç”¨', color: 'cinnamon600' },\r\n      'PLANNED': { label: 'è®¡åˆ’ä¸­', color: 'blueberry600' }\r\n    };\r\n    \r\n    const config = statusConfig[status as keyof typeof statusConfig] || { label: status, color: 'licorice400' };\r\n    return <Badge color={config.color as any}>{config.label}</Badge>;\r\n  };\r\n\r\n  const getUnitTypeName = (unitType: string) => {\r\n    const typeNames = {\r\n      'COMPANY': 'å…¬å¸',\r\n      'DEPARTMENT': 'éƒ¨é—¨',\r\n      'COST_CENTER': 'æˆæœ¬ä¸­å¿ƒ',\r\n      'PROJECT_TEAM': 'é¡¹ç›®å›¢é˜Ÿ'\r\n    };\r\n    return typeNames[unitType as keyof typeof typeNames] || unitType;\r\n  };\r\n\r\n  return (\r\n    <Card padding=\"m\">\r\n      <Flex justifyContent=\"space-between\" alignItems=\"flex-start\" marginBottom=\"m\">\r\n        <Box flex=\"1\">\r\n          <Flex alignItems=\"center\" gap=\"s\" marginBottom=\"s\">\r\n            <Heading size=\"medium\">{organization.name}</Heading>\r\n            {getStatusBadge(organization.status)}\r\n            {isHistorical && (\r\n              <Badge color=\"blueberry600\">å†å²è§†å›¾</Badge>\r\n            )}\r\n          </Flex>\r\n          \r\n          <Text typeLevel=\"subtext.medium\" color=\"hint\" marginBottom=\"s\">\r\n            ç¼–ç : {organization.code} â€¢ ç±»å‹: {getUnitTypeName(organization.unit_type)} â€¢ å±‚çº§: {organization.level}\r\n          </Text>\r\n          \r\n          {organization.description && (\r\n            <Text typeLevel=\"body.medium\" marginBottom=\"s\">\r\n              {organization.description}\r\n            </Text>\r\n          )}\r\n          \r\n          <Box display=\"flex\" gap=\"m\" marginBottom=\"s\">\r\n            {organization.parent_code && (\r\n              <Text typeLevel=\"subtext.small\">\r\n                ä¸Šçº§ç»„ç»‡: {organization.parent_code}\r\n              </Text>\r\n            )}\r\n            <Text typeLevel=\"subtext.small\">\r\n              æ’åº: {organization.sort_order}\r\n            </Text>\r\n          </Box>\r\n        </Box>\r\n\r\n        <Box>\r\n          <Flex gap=\"s\">\r\n            {!isHistorical && onEdit && (\r\n              <PrimaryButton \r\n                size=\"small\" \r\n                onClick={onEdit}\r\n                disabled={isLoading}\r\n              >\r\n                ç¼–è¾‘\r\n              </PrimaryButton>\r\n            )}\r\n            {!isHistorical && onToggleStatus && (\r\n              <SecondaryButton \r\n                size=\"small\" \r\n                onClick={onToggleStatus}\r\n                disabled={isLoading}\r\n              >\r\n                {organization.status === 'ACTIVE' ? 'åœç”¨' : 'å¯ç”¨'}\r\n              </SecondaryButton>\r\n            )}\r\n          </Flex>\r\n        </Box>\r\n      </Flex>\r\n      \r\n      <Flex gap=\"m\" justifyContent=\"space-between\" alignItems=\"center\">\r\n        <Text typeLevel=\"subtext.small\" color=\"hint\">\r\n          åˆ›å»ºæ—¶é—´: {organization.created_at ? new Date(organization.created_at).toLocaleString('zh-CN') : 'æœªçŸ¥'}\r\n        </Text>\r\n        {organization.updated_at && (\r\n          <Text typeLevel=\"subtext.small\" color=\"hint\">\r\n            æ›´æ–°æ—¶é—´: {new Date(organization.updated_at).toLocaleString('zh-CN')}\r\n          </Text>\r\n        )}\r\n      </Flex>\r\n    </Card>\r\n  );\r\n};\r\n\r\n/**\r\n * ç»„ç»‡è¯¦æƒ…é¡µé¢ä¸»ç»„ä»¶\r\n */\r\nexport const OrganizationDetail: React.FC<OrganizationDetailProps> = ({\r\n  organizationCode,\r\n  readonly = false,\r\n  onBack,\r\n  onOrganizationUpdated\r\n}) => {\r\n  const [activeTab, setActiveTab] = useState<'overview' | 'history' | 'timeline' | 'comparison'>('overview');\r\n\r\n  // æ—¶æ€æ¨¡å¼ç®¡ç†\r\n  const { mode: temporalMode, isHistorical, isCurrent } = useTemporalMode();\r\n\r\n  // ç»„ç»‡æ•°æ®æŸ¥è¯¢\r\n  const {\r\n    data: organization,\r\n    isLoading: orgLoading,\r\n    isError: orgError,\r\n    error: orgErrorMessage,\r\n    refetch: refetchOrganization\r\n  } = useTemporalOrganization(organizationCode);\r\n\r\n  // å†å²ç‰ˆæœ¬æŸ¥è¯¢\r\n  const {\r\n    data: historyVersions = [],\r\n    isLoading: historyLoading,\r\n    hasHistory,\r\n    latestVersion\r\n  } = useOrganizationHistory(organizationCode, { limit: 20 });\r\n\r\n  // æ—¶é—´çº¿äº‹ä»¶æŸ¥è¯¢\r\n  const {\r\n    data: timelineEvents = [],\r\n    isLoading: timelineLoading,\r\n    hasEvents: hasTimelineEvents,\r\n    eventCount,\r\n    latestEvent,\r\n    refetch: refetchTimeline\r\n  } = useOrganizationTimeline(organizationCode, { limit: 50 });\r\n\r\n  // ç»„ç»‡æ“ä½œé’©å­\r\n  const {\r\n    selectedOrg,\r\n    isFormOpen,\r\n    togglingId,\r\n    isToggling,\r\n    handleEdit,\r\n    handleToggleStatus,\r\n    handleFormClose,\r\n    handleFormSubmit,\r\n  } = useOrganizationActions();\r\n\r\n  // æ—¶æ€æ¨¡å¼å˜æ›´å¤„ç†\r\n  const handleTemporalModeChange = useCallback((newMode: TemporalMode) => {\r\n    console.log(`æ—¶æ€æ¨¡å¼åˆ‡æ¢åˆ°: ${newMode}ï¼Œé‡æ–°åŠ è½½ç»„ç»‡æ•°æ®`);\r\n    refetchOrganization();\r\n  }, [refetchOrganization]);\r\n\r\n  // ç¼–è¾‘ç»„ç»‡å¤„ç†\r\n  const handleEditOrganization = useCallback(() => {\r\n    if (organization) {\r\n      handleEdit(organization);\r\n    }\r\n  }, [organization, handleEdit]);\r\n\r\n  // åˆ‡æ¢çŠ¶æ€å¤„ç†\r\n  const handleToggleOrganizationStatus = useCallback(() => {\r\n    if (organization) {\r\n      handleToggleStatus(organization.code);\r\n    }\r\n  }, [organization, handleToggleStatus]);\r\n\r\n  // æ—¶é—´çº¿äº‹ä»¶ç‚¹å‡»å¤„ç†\r\n  const handleTimelineEventClick = useCallback((event: TimelineEvent) => {\r\n    // å®ç°äº‹ä»¶è¯¦æƒ…æ˜¾ç¤ºæˆ–è·³è½¬\r\n    console.log('Timeline event clicked:', event);\r\n    alert(`æŸ¥çœ‹äº‹ä»¶è¯¦æƒ…:\\n\\n${event.title}\\n${event.description || ''}\\n\\næ—¥æœŸ: ${new Date(event.eventDate).toLocaleString('zh-CN')}`);\r\n  }, []);\r\n\r\n  // ç‰ˆæœ¬æ¯”è¾ƒå¤„ç†\r\n  const handleVersionComparison = useCallback((version1: TemporalOrganizationUnit, version2: TemporalOrganizationUnit) => {\r\n    // è®¾ç½®ç‰ˆæœ¬å¯¹æ¯”æ ‡ç­¾\r\n    setActiveTab('comparison');\r\n  }, []);\r\n\r\n  // åˆ·æ–°æ‰€æœ‰æ•°æ®\r\n  const handleRefreshAll = useCallback(() => {\r\n    refetchOrganization();\r\n    refetchTimeline();\r\n  }, [refetchOrganization, refetchTimeline]);\r\n\r\n  // åŠ è½½çŠ¶æ€\r\n  if (orgLoading && !organization) {\r\n    return (\r\n      <Box padding=\"l\">\r\n        <Flex justifyContent=\"center\" alignItems=\"center\" height=\"200px\">\r\n          <LoadingDots />\r\n          <Text marginLeft=\"m\">åŠ è½½ç»„ç»‡è¯¦æƒ…ä¸­...</Text>\r\n        </Flex>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  // é”™è¯¯çŠ¶æ€\r\n  if (orgError || !organization) {\r\n    return (\r\n      <Box padding=\"l\">\r\n        <Card padding=\"l\">\r\n          <Text color=\"cinnamon600\" typeLevel=\"heading.medium\" marginBottom=\"m\">\r\n            âŒ åŠ è½½ç»„ç»‡è¯¦æƒ…å¤±è´¥\r\n          </Text>\r\n          <Text marginBottom=\"m\">\r\n            {orgErrorMessage?.message || 'æ— æ³•åŠ è½½ç»„ç»‡ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥ç»„ç»‡ç¼–ç æˆ–ç½‘ç»œè¿æ¥'}\r\n          </Text>\r\n          <Box>\r\n            <PrimaryButton onClick={refetchOrganization} marginRight=\"s\">\r\n              é‡è¯•\r\n            </PrimaryButton>\r\n            {onBack && (\r\n              <SecondaryButton onClick={onBack}>\r\n                è¿”å›\r\n              </SecondaryButton>\r\n            )}\r\n          </Box>\r\n        </Card>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Box padding=\"l\" data-testid=\"organization-detail\">\r\n      {/* æ—¶æ€å¯¼èˆªæ  */}\r\n      <Box marginBottom=\"l\">\r\n        <TemporalNavbar\r\n          onModeChange={handleTemporalModeChange}\r\n          showAdvancedSettings={true}\r\n        />\r\n      </Box>\r\n\r\n      {/* é¡µé¢å¤´éƒ¨ */}\r\n      <Box marginBottom=\"l\">\r\n        <Flex justifyContent=\"space-between\" alignItems=\"flex-start\">\r\n          <Box>\r\n            <Heading size=\"large\" marginBottom=\"s\">\r\n              ç»„ç»‡è¯¦æƒ…\r\n              {isHistorical && (\r\n                <Text as=\"span\" typeLevel=\"subtext.medium\" color=\"hint\" marginLeft=\"s\">\r\n                  (å†å²è§†å›¾)\r\n                </Text>\r\n              )}\r\n            </Heading>\r\n          </Box>\r\n          \r\n          <Flex gap=\"s\">\r\n            <SecondaryButton \r\n              onClick={handleRefreshAll}\r\n              disabled={orgLoading || timelineLoading}\r\n            >\r\n              ğŸ”„ åˆ·æ–°\r\n            </SecondaryButton>\r\n            {onBack && (\r\n              <TertiaryButton onClick={onBack}>\r\n                â† è¿”å›\r\n              </TertiaryButton>\r\n            )}\r\n          </Flex>\r\n        </Flex>\r\n      </Box>\r\n\r\n      {/* ç»„ç»‡åŸºæœ¬ä¿¡æ¯ */}\r\n      <Box marginBottom=\"l\">\r\n        <OrganizationInfoCard\r\n          organization={organization}\r\n          isHistorical={isHistorical}\r\n          onEdit={readonly ? undefined : handleEditOrganization}\r\n          onToggleStatus={readonly ? undefined : handleToggleOrganizationStatus}\r\n          isLoading={isToggling}\r\n        />\r\n      </Box>\r\n\r\n      {/* è¯¦æƒ…æ ‡ç­¾é¡µ */}\r\n      <Tabs>\r\n        <Tabs.List>\r\n          <Tabs.Item \r\n            name=\"overview\"\r\n            onClick={() => setActiveTab('overview')}\r\n            isActive={activeTab === 'overview'}\r\n          >\r\n            æ¦‚è§ˆä¿¡æ¯\r\n          </Tabs.Item>\r\n          <Tabs.Item \r\n            name=\"timeline\"\r\n            onClick={() => setActiveTab('timeline')}\r\n            isActive={activeTab === 'timeline'}\r\n          >\r\n            æ—¶é—´çº¿ {hasTimelineEvents && <Badge color=\"blueberry600\">{eventCount}</Badge>}\r\n          </Tabs.Item>\r\n          <Tabs.Item \r\n            name=\"history\"\r\n            onClick={() => setActiveTab('history')}\r\n            isActive={activeTab === 'history'}\r\n          >\r\n            å†å²ç‰ˆæœ¬ {hasHistory && <Badge color=\"greenFresca600\">{historyVersions.length}</Badge>}\r\n          </Tabs.Item>\r\n          <Tabs.Item \r\n            name=\"comparison\"\r\n            onClick={() => setActiveTab('comparison')}\r\n            isActive={activeTab === 'comparison'}\r\n          >\r\n            ç‰ˆæœ¬å¯¹æ¯”\r\n          </Tabs.Item>\r\n        </Tabs.List>\r\n\r\n        <Tabs.Panel name=\"overview\">\r\n          <Box marginTop=\"l\">\r\n            <Card padding=\"m\">\r\n              <Text as=\"h3\" typeLevel=\"subtext.large\" fontWeight=\"bold\" marginBottom=\"m\">\r\n                ğŸ“‹ ç»„ç»‡æ¦‚è§ˆä¿¡æ¯\r\n              </Text>\r\n              \r\n              <Box display=\"grid\" gridTemplateColumns=\"repeat(auto-fit, minmax(250px, 1fr))\" gap=\"m\">\r\n                <Box>\r\n                  <Text typeLevel=\"subtext.medium\" fontWeight=\"bold\" marginBottom=\"s\">åŸºæœ¬ä¿¡æ¯</Text>\r\n                  <Text typeLevel=\"body.small\">ç¼–ç : {organization.code}</Text>\r\n                  <Text typeLevel=\"body.small\">åç§°: {organization.name}</Text>\r\n                  <Text typeLevel=\"body.small\">çŠ¶æ€: {organization.status}</Text>\r\n                  <Text typeLevel=\"body.small\">ç±»å‹: {organization.unit_type}</Text>\r\n                </Box>\r\n                \r\n                <Box>\r\n                  <Text typeLevel=\"subtext.medium\" fontWeight=\"bold\" marginBottom=\"s\">å±‚çº§ç»“æ„</Text>\r\n                  <Text typeLevel=\"body.small\">å±‚çº§: {organization.level}</Text>\r\n                  <Text typeLevel=\"body.small\">ä¸Šçº§: {organization.parent_code || 'æ— '}</Text>\r\n                  <Text typeLevel=\"body.small\">æ’åº: {organization.sort_order}</Text>\r\n                </Box>\r\n                \r\n                <Box>\r\n                  <Text typeLevel=\"subtext.medium\" fontWeight=\"bold\" marginBottom=\"s\">æ—¶é—´ä¿¡æ¯</Text>\r\n                  <Text typeLevel=\"body.small\">åˆ›å»º: {organization.created_at ? new Date(organization.created_at).toLocaleDateString('zh-CN') : 'æœªçŸ¥'}</Text>\r\n                  <Text typeLevel=\"body.small\">æ›´æ–°: {organization.updated_at ? new Date(organization.updated_at).toLocaleDateString('zh-CN') : 'æœªçŸ¥'}</Text>\r\n                </Box>\r\n                \r\n                {hasTimelineEvents && (\r\n                  <Box>\r\n                    <Text typeLevel=\"subtext.medium\" fontWeight=\"bold\" marginBottom=\"s\">æ´»åŠ¨ç»Ÿè®¡</Text>\r\n                    <Text typeLevel=\"body.small\">æ—¶é—´çº¿äº‹ä»¶: {eventCount} ä¸ª</Text>\r\n                    <Text typeLevel=\"body.small\">å†å²ç‰ˆæœ¬: {historyVersions.length} ä¸ª</Text>\r\n                    {latestEvent && (\r\n                      <Text typeLevel=\"body.small\">æœ€æ–°äº‹ä»¶: {latestEvent.title}</Text>\r\n                    )}\r\n                  </Box>\r\n                )}\r\n              </Box>\r\n            </Card>\r\n          </Box>\r\n        </Tabs.Panel>\r\n\r\n        <Tabs.Panel name=\"timeline\">\r\n          <Box marginTop=\"l\">\r\n            <Timeline\r\n              organizationCode={organizationCode}\r\n              queryParams={{ limit: 50 }}\r\n              compact={false}\r\n              maxEvents={50}\r\n              showFilters={true}\r\n              showActions={!readonly}\r\n              onEventClick={handleTimelineEventClick}\r\n              onAddEvent={readonly ? undefined : () => alert('æ·»åŠ äº‹ä»¶åŠŸèƒ½å¼€å‘ä¸­')}\r\n            />\r\n          </Box>\r\n        </Tabs.Panel>\r\n\r\n        <Tabs.Panel name=\"history\">\r\n          <Box marginTop=\"l\">\r\n            <Card padding=\"m\">\r\n              <Text as=\"h3\" typeLevel=\"subtext.large\" fontWeight=\"bold\" marginBottom=\"m\">\r\n                ğŸ“š å†å²ç‰ˆæœ¬è®°å½•\r\n              </Text>\r\n              \r\n              {historyLoading ? (\r\n                <Flex justifyContent=\"center\" padding=\"l\">\r\n                  <LoadingDots />\r\n                  <Text marginLeft=\"m\">åŠ è½½å†å²ç‰ˆæœ¬...</Text>\r\n                </Flex>\r\n              ) : hasHistory ? (\r\n                <Box>\r\n                  <Text typeLevel=\"body.medium\" marginBottom=\"m\">\r\n                    å…± {historyVersions.length} ä¸ªå†å²ç‰ˆæœ¬\r\n                  </Text>\r\n                  {/* è¿™é‡Œå¯ä»¥å±•ç¤ºå†å²ç‰ˆæœ¬åˆ—è¡¨ï¼Œæˆ–è€…å¤ç”¨OrganizationTableç»„ä»¶ */}\r\n                  <Box>\r\n                    {historyVersions.slice(0, 5).map((version, index) => (\r\n                      <Box\r\n                        key={version.version || index}\r\n                        padding=\"s\"\r\n                        marginBottom=\"s\"\r\n                        style={{ \r\n                          backgroundColor: index === 0 ? '#f0f7ff' : '#f8f9fa',\r\n                          borderRadius: '4px',\r\n                          border: '1px solid #e9ecef'\r\n                        }}\r\n                      >\r\n                        <Flex justifyContent=\"space-between\" alignItems=\"center\">\r\n                          <Text typeLevel=\"body.medium\">\r\n                            ç‰ˆæœ¬ {version.version} - {version.name}\r\n                          </Text>\r\n                          <Text typeLevel=\"subtext.small\" color=\"hint\">\r\n                            {version.effectiveFrom ? new Date(version.effectiveFrom).toLocaleString('zh-CN') : ''}\r\n                          </Text>\r\n                        </Flex>\r\n                        {version.changeReason && (\r\n                          <Text typeLevel=\"subtext.small\" color=\"hint\" marginTop=\"xs\">\r\n                            å˜æ›´åŸå› : {version.changeReason}\r\n                          </Text>\r\n                        )}\r\n                      </Box>\r\n                    ))}\r\n                  </Box>\r\n                </Box>\r\n              ) : (\r\n                <Text color=\"hint\">æš‚æ— å†å²ç‰ˆæœ¬è®°å½•</Text>\r\n              )}\r\n            </Card>\r\n          </Box>\r\n        </Tabs.Panel>\r\n\r\n        <Tabs.Panel name=\"comparison\">\r\n          <Box marginTop=\"l\">\r\n            {hasHistory && historyVersions.length >= 2 ? (\r\n              <VersionComparison\r\n                organizationCode={organizationCode}\r\n                version1={historyVersions[0]}\r\n                version2={historyVersions[1]}\r\n                compact={false}\r\n                showMetadata={true}\r\n              />\r\n            ) : (\r\n              <Card padding=\"l\">\r\n                <Text textAlign=\"center\" color=\"hint\">\r\n                  éœ€è¦è‡³å°‘2ä¸ªå†å²ç‰ˆæœ¬æ‰èƒ½è¿›è¡Œå¯¹æ¯”\r\n                </Text>\r\n              </Card>\r\n            )}\r\n          </Box>\r\n        </Tabs.Panel>\r\n      </Tabs>\r\n\r\n      {/* ç¼–è¾‘è¡¨å• */}\r\n      {!readonly && !isHistorical && (\r\n        <OrganizationForm \r\n          organization={selectedOrg}\r\n          isOpen={isFormOpen}\r\n          onClose={handleFormClose}\r\n          onSubmit={handleFormSubmit}\r\n          temporalMode={temporalMode}\r\n          isHistorical={isHistorical}\r\n          enableTemporalFeatures={true}\r\n        />\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default OrganizationDetail;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/OrganizationForm/FormFields.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'formatDateTimeLocal' is assigned a value but never used.","line":20,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'parseLocalDateTime' is assigned a value but never used.","line":36,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1595,1598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1595,1598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'updateField'. Either include it or remove the dependency array.","line":71,"column":6,"nodeType":"ArrayExpression","endLine":71,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [isPlannedStatus, isTemporal, updateField]","fix":{"range":[2144,2173],"text":"[isPlannedStatus, isTemporal, updateField]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport type { FormFieldsProps } from './FormTypes';\r\n\r\n// æ—¥æœŸæ ¼å¼åŒ–å·¥å…· (ç»Ÿä¸€ä½¿ç”¨dateç±»å‹)\r\nconst formatDateForInput = (dateStr?: string) => {\r\n  if (!dateStr) return '';\r\n  try {\r\n    const date = new Date(dateStr);\r\n    // è¿”å› YYYY-MM-DD æ ¼å¼ç”¨äº type=\"date\" è¾“å…¥æ¡†\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, '0');\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    return `${year}-${month}-${day}`;\r\n  } catch {\r\n    return '';\r\n  }\r\n};\r\n\r\n// ä¿æŒå‘åå…¼å®¹ï¼ˆåºŸå¼ƒä½†ä¿ç•™ï¼‰\r\nconst formatDateTimeLocal = (dateStr?: string) => {\r\n  if (!dateStr) return '';\r\n  try {\r\n    const date = new Date(dateStr);\r\n    // è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´æ ¼å¼ (YYYY-MM-DDTHH:mm)\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, '0');\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    const hours = String(date.getHours()).padStart(2, '0');\r\n    const minutes = String(date.getMinutes()).padStart(2, '0');\r\n    return `${year}-${month}-${day}T${hours}:${minutes}`;\r\n  } catch {\r\n    return '';\r\n  }\r\n};\r\n\r\nconst parseLocalDateTime = (localDateTimeStr: string) => {\r\n  if (!localDateTimeStr) return '';\r\n  try {\r\n    return new Date(localDateTimeStr).toISOString();\r\n  } catch {\r\n    return '';\r\n  }\r\n};\r\n\r\nexport const FormFields: React.FC<FormFieldsProps> = ({\r\n  formData,\r\n  setFormData,\r\n  isEditing,\r\n  temporalMode = 'current',\r\n  enableTemporalFeatures = true\r\n}) => {\r\n  const [showAdvancedTemporal, setShowAdvancedTemporal] = useState(false);\r\n  \r\n  const updateField = (field: string, value: any) => {\r\n    setFormData({ ...formData, [field]: value });\r\n  };\r\n\r\n  const isTemporal = formData.is_temporal as boolean;\r\n  const isPlannedStatus = formData.status === 'PLANNED';\r\n\r\n  // å¦‚æœçŠ¶æ€æ˜¯è®¡åˆ’ä¸­ï¼Œè‡ªåŠ¨å¯ç”¨æ—¶æ€åŠŸèƒ½\r\n  React.useEffect(() => {\r\n    if (isPlannedStatus && !isTemporal) {\r\n      updateField('is_temporal', true);\r\n      // è®¾ç½®é»˜è®¤ç”Ÿæ•ˆæ—¶é—´ä¸ºæ˜å¤©\r\n      const tomorrow = new Date();\r\n      tomorrow.setDate(tomorrow.getDate() + 1);\r\n      tomorrow.setHours(9, 0, 0, 0); // é»˜è®¤ä¸Šåˆ9ç‚¹\r\n      updateField('effective_from', tomorrow.toISOString());\r\n    }\r\n  }, [isPlannedStatus, isTemporal]);\r\n\r\n  const inputStyle = {\r\n    width: '100%',\r\n    padding: '8px',\r\n    borderRadius: '4px',\r\n    border: '1px solid #ddd',\r\n    fontSize: '14px'\r\n  };\r\n\r\n  const labelStyle = {\r\n    display: 'block' as const,\r\n    marginBottom: '4px',\r\n    fontSize: '14px',\r\n    fontWeight: '500' as const\r\n  };\r\n\r\n  const fieldStyle = {\r\n    marginBottom: '16px'\r\n  };\r\n\r\n  const hintStyle = {\r\n    fontSize: '12px',\r\n    color: '#666',\r\n    marginTop: '4px'\r\n  };\r\n\r\n  const cardStyle = {\r\n    marginTop: '24px',\r\n    padding: '16px',\r\n    backgroundColor: '#f8f9fa',\r\n    border: '1px solid #e9ecef',\r\n    borderRadius: '4px'\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div style={fieldStyle}>\r\n        <label style={labelStyle}>\r\n          ç»„ç»‡ç¼–ç \r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          value={formData.code}\r\n          onChange={(e) => updateField('code', e.target.value)}\r\n          disabled={true}\r\n          placeholder=\"ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆç¼–ç \"\r\n          style={{ ...inputStyle, backgroundColor: '#f5f5f5', cursor: 'not-allowed' }}\r\n          data-testid=\"form-field-code\"\r\n        />\r\n        <div style={hintStyle}>\r\n          {isEditing ? \"ç¼–ç ä¸å¯ä¿®æ”¹\" : \"ç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ç¼–ç \"}\r\n        </div>\r\n      </div>\r\n\r\n      <div style={fieldStyle}>\r\n        <label style={labelStyle}>\r\n          ç»„ç»‡åç§° *\r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          value={formData.name}\r\n          onChange={(e) => updateField('name', e.target.value)}\r\n          placeholder=\"è¯·è¾“å…¥ç»„ç»‡åç§°\"\r\n          required\r\n          style={inputStyle}\r\n          data-testid=\"form-field-name\"\r\n        />\r\n      </div>\r\n\r\n      <div style={fieldStyle}>\r\n        <label style={labelStyle}>\r\n          ç»„ç»‡ç±»å‹ *\r\n        </label>\r\n        <select\r\n          value={formData.unit_type}\r\n          onChange={(e) => updateField('unit_type', e.target.value)}\r\n          style={inputStyle}\r\n          data-testid=\"form-field-unit-type\"\r\n        >\r\n          <option value=\"DEPARTMENT\">éƒ¨é—¨</option>\r\n          <option value=\"COST_CENTER\">æˆæœ¬ä¸­å¿ƒ</option>\r\n          <option value=\"COMPANY\">å…¬å¸</option>\r\n          <option value=\"PROJECT_TEAM\">é¡¹ç›®å›¢é˜Ÿ</option>\r\n        </select>\r\n      </div>\r\n\r\n      <div style={fieldStyle}>\r\n        <label style={labelStyle}>\r\n          ä¸Šçº§ç»„ç»‡ç¼–ç \r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          value={formData.parent_code}\r\n          onChange={(e) => updateField('parent_code', e.target.value)}\r\n          placeholder=\"è¯·è¾“å…¥ä¸Šçº§ç»„ç»‡ç¼–ç \"\r\n          style={inputStyle}\r\n          data-testid=\"form-field-parent-code\"\r\n        />\r\n      </div>\r\n\r\n      <div style={fieldStyle}>\r\n        <label style={labelStyle}>\r\n          ç»„ç»‡å±‚çº§\r\n        </label>\r\n        <input\r\n          type=\"number\"\r\n          value={formData.level}\r\n          disabled={true}\r\n          style={{ ...inputStyle, backgroundColor: '#f5f5f5', cursor: 'not-allowed' }}\r\n          data-testid=\"form-field-level\"\r\n        />\r\n        <div style={hintStyle}>\r\n          å±‚çº§ç”±ä¸Šçº§ç»„ç»‡å…³ç³»è‡ªåŠ¨è®¡ç®—ï¼Œä¸å¯æ‰‹åŠ¨ä¿®æ”¹\r\n        </div>\r\n      </div>\r\n\r\n      <div style={fieldStyle}>\r\n        <label style={labelStyle}>\r\n          çŠ¶æ€ *\r\n        </label>\r\n        <select\r\n          value={formData.status}\r\n          onChange={(e) => updateField('status', e.target.value)}\r\n          style={inputStyle}\r\n          data-testid=\"form-field-status\"\r\n        >\r\n          <option value=\"ACTIVE\">æ¿€æ´»</option>\r\n          <option value=\"INACTIVE\">åœç”¨</option>\r\n          <option value=\"PLANNED\">è®¡åˆ’ä¸­</option>\r\n        </select>\r\n        {isPlannedStatus && (\r\n          <div style={hintStyle}>\r\n            ğŸ“… è®¡åˆ’ä¸­çš„ç»„ç»‡å°†è‡ªåŠ¨å¯ç”¨æ—¶æ€ç®¡ç†åŠŸèƒ½\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div style={fieldStyle}>\r\n        <label style={labelStyle}>\r\n          æ’åº\r\n        </label>\r\n        <input\r\n          type=\"number\"\r\n          value={formData.sort_order}\r\n          onChange={(e) => updateField('sort_order', parseInt(e.target.value) || 0)}\r\n          min=\"0\"\r\n          style={inputStyle}\r\n          data-testid=\"form-field-sort-order\"\r\n        />\r\n      </div>\r\n\r\n      <div style={{ ...fieldStyle, marginBottom: '24px' }}>\r\n        <label style={labelStyle}>\r\n          æè¿°\r\n        </label>\r\n        <textarea\r\n          value={formData.description}\r\n          onChange={(e) => updateField('description', e.target.value)}\r\n          placeholder=\"è¯·è¾“å…¥ç»„ç»‡æè¿°\"\r\n          rows={3}\r\n          style={inputStyle}\r\n          data-testid=\"form-field-description\"\r\n        />\r\n      </div>\r\n\r\n      {/* æ—¶æ€ç®¡ç†åŠŸèƒ½åŒºåŸŸ - å®Œå…¨ç§»é™¤Canvas Kitç»„ä»¶ */}\r\n      {enableTemporalFeatures && (\r\n        <div style={cardStyle}>\r\n          <div style={{ marginBottom: '16px' }}>\r\n            <h3 style={{ fontSize: '16px', fontWeight: 'bold', margin: 0 }}>\r\n              âš™ï¸ æ—¶æ€ç®¡ç†è®¾ç½®\r\n            </h3>\r\n            <p style={{ fontSize: '12px', color: '#666', margin: '4px 0 0 0' }}>\r\n              é…ç½®ç»„ç»‡çš„ç”Ÿæ•ˆå’Œå¤±æ•ˆæ—¶é—´ï¼Œå®ç°ç²¾ç¡®çš„æ—¶æ€ç®¡ç†\r\n            </p>\r\n          </div>\r\n\r\n          <div style={fieldStyle}>\r\n            <label style={labelStyle}>\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={isTemporal}\r\n                onChange={(e) => updateField('is_temporal', e.target.checked)}\r\n                disabled={isPlannedStatus}\r\n                data-testid=\"form-field-is-temporal\"\r\n                style={{ marginRight: '8px' }}\r\n              />\r\n              å¯ç”¨æ—¶æ€ç®¡ç†\r\n            </label>\r\n            {isPlannedStatus && (\r\n              <div style={hintStyle}>\r\n                è®¡åˆ’ä¸­çš„ç»„ç»‡å¿…é¡»å¯ç”¨æ—¶æ€ç®¡ç†\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {isTemporal && (\r\n            <>\r\n              <div style={fieldStyle}>\r\n                <label style={labelStyle}>\r\n                  ç”Ÿæ•ˆæ—¶é—´ *\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={formatDateForInput(formData.effective_from as string)}\r\n                  onChange={(e) => updateField('effective_from', e.target.value)}\r\n                  style={inputStyle}\r\n                  data-testid=\"form-field-effective-from\"\r\n                />\r\n                <div style={hintStyle}>\r\n                  ç»„ç»‡å¼€å§‹ç”Ÿæ•ˆçš„æ—¥æœŸå’Œæ—¶é—´\r\n                </div>\r\n              </div>\r\n\r\n              <div style={fieldStyle}>\r\n                <label style={labelStyle}>\r\n                  å¤±æ•ˆæ—¶é—´\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={formatDateForInput(formData.effective_to as string)}\r\n                  onChange={(e) => updateField('effective_to', e.target.value)}\r\n                  style={inputStyle}\r\n                  data-testid=\"form-field-effective-to\"\r\n                />\r\n                <div style={hintStyle}>\r\n                  ç»„ç»‡åœæ­¢ç”Ÿæ•ˆçš„æ—¥æœŸå’Œæ—¶é—´ï¼ˆå¯é€‰ï¼Œç•™ç©ºè¡¨ç¤ºæ°¸ä¹…ç”Ÿæ•ˆï¼‰\r\n                </div>\r\n              </div>\r\n\r\n              <div style={fieldStyle}>\r\n                <label style={labelStyle}>\r\n                  å˜æ›´åŸå›  *\r\n                </label>\r\n                <textarea\r\n                  value={formData.change_reason as string || ''}\r\n                  onChange={(e) => updateField('change_reason', e.target.value)}\r\n                  placeholder=\"è¯·è¾“å…¥æ­¤æ¬¡å˜æ›´çš„åŸå› å’ŒèƒŒæ™¯...\"\r\n                  rows={2}\r\n                  style={inputStyle}\r\n                  data-testid=\"form-field-change-reason\"\r\n                />\r\n                <div style={hintStyle}>\r\n                  è¯¦ç»†è¯´æ˜æ­¤æ¬¡ç»„ç»‡å˜æ›´çš„åŸå› ï¼Œä¾¿äºå†å²è¿½æº¯\r\n                </div>\r\n              </div>\r\n\r\n              {/* é«˜çº§æ—¶æ€è®¾ç½® */}\r\n              <div style={{ marginTop: '16px' }}>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowAdvancedTemporal(!showAdvancedTemporal)}\r\n                  style={{ \r\n                    background: 'none', \r\n                    border: 'none', \r\n                    padding: 0, \r\n                    cursor: 'pointer',\r\n                    textDecoration: 'underline',\r\n                    color: '#1976d2',\r\n                    fontSize: '12px'\r\n                  }}\r\n                  data-testid=\"toggle-advanced-temporal\"\r\n                >\r\n                  {showAdvancedTemporal ? 'éšè—é«˜çº§è®¾ç½® â–²' : 'æ˜¾ç¤ºé«˜çº§è®¾ç½® â–¼'}\r\n                </button>\r\n              </div>\r\n\r\n              {showAdvancedTemporal && (\r\n                <div style={{ \r\n                  marginTop: '16px', \r\n                  padding: '16px', \r\n                  backgroundColor: '#fff', \r\n                  border: '1px solid #dee2e6', \r\n                  borderRadius: '4px' \r\n                }}>\r\n                  <p style={{ fontSize: '12px', color: '#666', margin: '0 0 16px 0' }}>\r\n                    é«˜çº§æ—¶æ€è®¾ç½®ï¼ˆé€‚ç”¨äºå¤æ‚çš„ç»„ç»‡æ¶æ„å˜æ›´åœºæ™¯ï¼‰\r\n                  </p>\r\n                  \r\n                  <div style={{ marginBottom: '8px' }}>\r\n                    <label style={labelStyle}>\r\n                      å½“å‰æ—¶æ€æ¨¡å¼\r\n                    </label>\r\n                    <div style={{ \r\n                      padding: '4px 8px', \r\n                      backgroundColor: temporalMode === 'current' ? '#e8f5e8' : temporalMode === 'historical' ? '#e8f0ff' : '#fff3cd',\r\n                      borderRadius: '4px',\r\n                      display: 'inline-block',\r\n                      fontSize: '12px'\r\n                    }}>\r\n                      {temporalMode === 'current' ? 'ğŸ”„ å½“å‰æ¨¡å¼' : \r\n                       temporalMode === 'historical' ? 'ğŸ“– å†å²æ¨¡å¼' : \r\n                       'ğŸ“… è§„åˆ’æ¨¡å¼'}\r\n                    </div>\r\n                    <div style={hintStyle}>\r\n                      å½“å‰çš„æ—¶æ€æŸ¥è¯¢æ¨¡å¼ï¼Œå½±å“æ•°æ®çš„æ˜¾ç¤ºå’Œç¼–è¾‘è¡Œä¸º\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/OrganizationForm/FormTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/OrganizationForm/ValidationRules.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/OrganizationForm/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isCurrent' is assigned a value but never used.","line":23,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isPlanning' is assigned a value but never used.","line":24,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6175,6178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6175,6178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'organization'. Either include it or remove the dependency array.","line":194,"column":6,"nodeType":"ArrayExpression","endLine":194,"endColumn":89,"suggestions":[{"desc":"Update the dependencies array to be: [isSubmitting, createMutation, updateMutation, formData, isEditing, model.events, onClose, organization]","fix":{"range":[6886,6969],"text":"[isSubmitting, createMutation, updateMutation, formData, isEditing, model.events, onClose, organization]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { Modal, useModalModel } from '@workday/canvas-kit-react/modal';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { useCreateOrganization, useUpdateOrganization } from '../../../../shared/hooks/useOrganizationMutations';\r\n// import { useTemporalMode } from '../../../../shared/hooks/useTemporalQuery';\r\nimport organizationAPI from '../../../../shared/api/organizations-simplified';\r\nimport { FormFields } from './FormFields';\r\nimport { validateForm } from './ValidationRules';\r\nimport type { OrganizationFormProps, FormData } from './FormTypes';\r\nimport type { CreateOrganizationInput, UpdateOrganizationInput } from '../../../../shared/hooks/useOrganizationMutations';\r\n\r\nexport const OrganizationForm: React.FC<OrganizationFormProps> = ({\r\n  organization,\r\n  isOpen,\r\n  onClose,\r\n  temporalMode = 'current',\r\n  isHistorical = false,\r\n  enableTemporalFeatures = true\r\n}) => {\r\n  const createMutation = useCreateOrganization();\r\n  const updateMutation = useUpdateOrganization();\r\n  // const { isCurrent, isPlanning } = useTemporalMode();\r\n  const isCurrent = true;\r\n  const isPlanning = false;\r\n  \r\n  const isEditing = !!organization;\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const model = useModalModel();\r\n\r\n  const [formData, setFormData] = useState<FormData>({\r\n    code: organization?.code || '',\r\n    name: organization?.name || '',\r\n    unit_type: organization?.unit_type || 'DEPARTMENT',\r\n    status: organization?.status || 'ACTIVE',\r\n    description: organization?.description || '',\r\n    parent_code: organization?.parent_code || '',\r\n    level: organization?.level || 1,\r\n    sort_order: organization?.sort_order || 0,\r\n    // æ—¶æ€å­—æ®µ\r\n    is_temporal: false,\r\n    effective_from: '',\r\n    effective_to: '',\r\n    change_reason: '',\r\n  });\r\n\r\n  const [formErrors, setFormErrors] = useState<Record<string, string>>({});\r\n\r\n  // Modal state management\r\n  useEffect(() => {\r\n    if (isOpen && model.state.visibility !== 'visible') {\r\n      model.events.show();\r\n    } else if (!isOpen && model.state.visibility === 'visible') {\r\n      model.events.hide();\r\n    }\r\n  }, [isOpen, model]);\r\n\r\n  // Reset form data when organization changes\r\n  useEffect(() => {\r\n    setFormData({\r\n      code: organization?.code || '',\r\n      name: organization?.name || '',\r\n      unit_type: organization?.unit_type || 'DEPARTMENT',\r\n      status: organization?.status || 'ACTIVE',\r\n      description: organization?.description || '',\r\n      parent_code: organization?.parent_code || '',\r\n      level: organization?.level || 1,\r\n      sort_order: organization?.sort_order || 0,\r\n      // æ—¶æ€å­—æ®µé‡ç½®\r\n      is_temporal: false,\r\n      effective_from: '',\r\n      effective_to: '',\r\n      change_reason: '',\r\n    });\r\n    setFormErrors({});\r\n  }, [organization]);\r\n\r\n  const handleSubmit = useCallback(async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    // Prevent double submission\r\n    if (isSubmitting || createMutation.isPending || updateMutation.isPending) {\r\n      return;\r\n    }\r\n    \r\n    // Validate form\r\n    const errors = validateForm(formData, isEditing);\r\n    if (Object.keys(errors).length > 0) {\r\n      setFormErrors(errors);\r\n      return;\r\n    }\r\n    \r\n    setIsSubmitting(true);\r\n    \r\n    try {\r\n      if (isEditing) {\r\n        const updateData: UpdateOrganizationInput = {\r\n          code: organization!.code,\r\n          name: formData.name,\r\n          unit_type: formData.unit_type as 'DEPARTMENT' | 'COST_CENTER' | 'COMPANY' | 'PROJECT_TEAM',\r\n          status: formData.status as 'ACTIVE' | 'INACTIVE' | 'PLANNED',\r\n          description: formData.description,\r\n          sort_order: formData.sort_order,\r\n          level: formData.level,\r\n          parent_code: formData.parent_code || undefined,\r\n        };\r\n        \r\n        // æ—¶æ€æ›´æ–°\r\n        if (formData.is_temporal) {\r\n          const temporalUpdateData = {\r\n            ...updateData,\r\n            effectiveFrom: formData.effective_from,\r\n            effectiveTo: formData.effective_to,\r\n            changeReason: formData.change_reason\r\n          };\r\n          await organizationAPI.updateTemporal(organization!.code, temporalUpdateData);\r\n        } else {\r\n          await updateMutation.mutateAsync(updateData);\r\n        }\r\n      } else {\r\n        const createData: CreateOrganizationInput = {\r\n          code: formData.code && formData.code.trim() ? formData.code.trim() : undefined,\r\n          name: formData.name,\r\n          unit_type: formData.unit_type as 'DEPARTMENT' | 'COST_CENTER' | 'COMPANY' | 'PROJECT_TEAM',\r\n          status: formData.status as 'ACTIVE' | 'INACTIVE' | 'PLANNED',\r\n          level: formData.level,\r\n          sort_order: formData.sort_order,\r\n          description: formData.description,\r\n          parent_code: formData.parent_code || undefined,\r\n        };\r\n        \r\n        // æ—¶æ€åˆ›å»º\r\n        if (formData.is_temporal) {\r\n          const temporalCreateData = {\r\n            ...createData,\r\n            effectiveFrom: formData.effective_from!,\r\n            effectiveTo: formData.effective_to || undefined,\r\n            changeReason: formData.change_reason\r\n          };\r\n          await organizationAPI.createTemporal(temporalCreateData);\r\n        } else {\r\n          await createMutation.mutateAsync(createData);\r\n        }\r\n      }\r\n      \r\n      // Reset form if creating new\r\n      if (!isEditing) {\r\n        setFormData({\r\n          code: '',\r\n          name: '',\r\n          unit_type: 'DEPARTMENT',\r\n          status: 'ACTIVE',\r\n          description: '',\r\n          parent_code: '',\r\n          level: 1,\r\n          sort_order: 0,\r\n          // é‡ç½®æ—¶æ€å­—æ®µ\r\n          is_temporal: false,\r\n          effective_from: '',\r\n          effective_to: '',\r\n          change_reason: '',\r\n        });\r\n      }\r\n      \r\n      model.events.hide();\r\n      onClose();\r\n    } catch (error) {\r\n      console.error(`[Form] ${isEditing ? 'æ›´æ–°' : 'åˆ›å»º'}å¤±è´¥:`, error);\r\n      \r\n      let errorMessage = 'æ“ä½œå¤±è´¥';\r\n      \r\n      if (error && typeof error === 'object' && 'message' in error) {\r\n        const apiError = error as any;\r\n        \r\n        if (apiError.message.includes('duplicate key value violates unique constraint')) {\r\n          if (apiError.message.includes('uk_tenant_name')) {\r\n            errorMessage = 'ç»„ç»‡åç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨ä¸åŒçš„åç§°';\r\n          } else {\r\n            errorMessage = 'æ•°æ®é‡å¤ï¼Œè¯·æ£€æŸ¥è¾“å…¥ä¿¡æ¯';\r\n          }\r\n        } else if (apiError.message.includes('Network connection failed')) {\r\n          errorMessage = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€';\r\n        } else {\r\n          errorMessage = apiError.message.split(' - ')[0] || errorMessage;\r\n        }\r\n      } else if (error instanceof Error) {\r\n        errorMessage = error.message;\r\n      }\r\n      \r\n      alert(errorMessage);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  }, [isEditing, formData, createMutation, updateMutation, isSubmitting, model, onClose]);\r\n\r\n  const handleClose = () => {\r\n    setIsSubmitting(false);\r\n    setFormErrors({});\r\n    model.events.hide();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Modal model={model}>\r\n      <Modal.Overlay>\r\n        <Modal.Card width={600} data-testid=\"organization-form\">\r\n          <Modal.CloseIcon aria-label=\"å…³é—­\" onClick={handleClose} />\r\n          <Modal.Heading>\r\n            {isEditing ? 'ç¼–è¾‘ç»„ç»‡å•å…ƒ' : 'æ–°å¢ç»„ç»‡å•å…ƒ'}\r\n            {formData.is_temporal && (\r\n              <span style={{ \r\n                marginLeft: '8px', \r\n                fontSize: '14px', \r\n                color: '#1890ff',\r\n                fontWeight: 'normal'\r\n              }}>\r\n                âš™ï¸ æ—¶æ€ç®¡ç†\r\n              </span>\r\n            )}\r\n          </Modal.Heading>\r\n          <Modal.Body>\r\n            <form onSubmit={handleSubmit} data-testid=\"organization-form-content\">\r\n              <FormFields\r\n                formData={formData}\r\n                setFormData={setFormData}\r\n                isEditing={isEditing}\r\n                temporalMode={temporalMode}\r\n                enableTemporalFeatures={enableTemporalFeatures && !isHistorical}\r\n              />\r\n\r\n              {Object.keys(formErrors).length > 0 && (\r\n                <div style={{ \r\n                  marginBottom: '16px', \r\n                  padding: '8px', \r\n                  backgroundColor: '#fff2f0', \r\n                  border: '1px solid #ffccc7',\r\n                  borderRadius: '4px' \r\n                }}>\r\n                  {Object.entries(formErrors).map(([field, error]) => (\r\n                    <div key={field} style={{ color: '#ff4d4f', fontSize: '14px' }}>\r\n                      {error}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n\r\n              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '8px' }}>\r\n                <SecondaryButton \r\n                  type=\"button\" \r\n                  onClick={handleClose}\r\n                  data-testid=\"form-cancel-button\"\r\n                >\r\n                  å–æ¶ˆ\r\n                </SecondaryButton>\r\n                <PrimaryButton \r\n                  type=\"submit\" \r\n                  disabled={isSubmitting || createMutation.isPending || updateMutation.isPending}\r\n                  data-testid=\"form-submit-button\"\r\n                >\r\n                  {isSubmitting ? 'å¤„ç†ä¸­...' : \r\n                   formData.is_temporal ? \r\n                     (isEditing ? 'æ›´æ–°æ—¶æ€ç»„ç»‡' : 'åˆ›å»ºè®¡åˆ’ç»„ç»‡') : \r\n                     (isEditing ? 'æ›´æ–°' : 'åˆ›å»º')\r\n                  }\r\n                </PrimaryButton>\r\n              </div>\r\n            </form>\r\n          </Modal.Body>\r\n        </Modal.Card>\r\n      </Modal.Overlay>\r\n    </Modal>\r\n  );\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/OrganizationTable/TableActions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/OrganizationTable/TableRow.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TemporalStatusBadge' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'temporalMode' is assigned a value but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Table } from '@workday/canvas-kit-react/table';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { TableActions } from './TableActions';\r\nimport type { OrganizationTableRowProps } from './TableTypes';\r\nimport { \r\n  TemporalInfoDisplay, \r\n  TemporalStatusBadge,\r\n  TemporalDateRange \r\n} from '../../../temporal/components/TemporalInfoDisplay';\r\n// import { TemporalStatus, temporalStatusUtils } from '../../../temporal/components/TemporalStatusSelector';\r\n\r\ntype TemporalStatus = 'ACTIVE' | 'PLANNED' | 'INACTIVE';\r\n\r\n// ä¸´æ—¶çš„çŠ¶æ€å·¥å…·å‡½æ•°\r\nconst temporalStatusUtils = {\r\n  isTemporal: (effectiveDate?: string, endDate?: string): boolean => {\r\n    return !!(effectiveDate || endDate);\r\n  }\r\n};\r\n\r\nexport const TableRow: React.FC<OrganizationTableRowProps> = ({\r\n  organization,\r\n  onEdit,\r\n  onToggleStatus,\r\n  onTemporalManage,\r\n  isToggling,\r\n  isAnyToggling,\r\n  temporalMode = 'current',\r\n  isHistorical = false,\r\n  showTemporalInfo = false\r\n}) => {\r\n  // è®¡ç®—æ—¶æ€çŠ¶æ€\r\n  const temporalStatus = organization.status as TemporalStatus;\r\n  const isTemporal = temporalStatusUtils.isTemporal(\r\n    organization.effective_date, \r\n    organization.end_date\r\n  );\r\n  \r\n  // æ—¶æ€æ¨¡å¼ä¸‹çš„æ ·å¼è°ƒæ•´\r\n  const getRowStyle = () => {\r\n    const baseStyle = {\r\n      opacity: isToggling ? 0.6 : 1,\r\n      transition: 'opacity 0.3s ease'\r\n    };\r\n\r\n    // PLANNEDç»„ç»‡çš„ç‰¹æ®Šæ ·å¼\r\n    if (temporalStatus === 'PLANNED') {\r\n      return {\r\n        ...baseStyle,\r\n        backgroundColor: 'rgba(8, 117, 225, 0.05)', // æ·¡è“è‰²èƒŒæ™¯è¡¨ç¤ºè®¡åˆ’ç»„ç»‡\r\n        borderLeft: '3px solid #0875E1'\r\n      };\r\n    }\r\n\r\n    // å†å²æ•°æ®æ ·å¼\r\n    if (isHistorical) {\r\n      return {\r\n        ...baseStyle,\r\n        backgroundColor: 'rgba(103, 123, 148, 0.05)', \r\n        border: '1px solid rgba(103, 123, 148, 0.1)'\r\n      };\r\n    }\r\n\r\n    // INACTIVEç»„ç»‡çš„æ ·å¼\r\n    if (temporalStatus === 'INACTIVE') {\r\n      return {\r\n        ...baseStyle,\r\n        backgroundColor: 'rgba(153, 153, 153, 0.05)',\r\n        color: '#666666'\r\n      };\r\n    }\r\n\r\n    return baseStyle;\r\n  };\r\n\r\n  return (\r\n    <Table.Row \r\n      style={getRowStyle()}\r\n      data-testid={`table-row-${organization.code}`}\r\n    >\r\n      <Table.Cell>{organization.code}</Table.Cell>\r\n      \r\n      <Table.Cell>\r\n        {organization.name}\r\n        {isToggling && (\r\n          <Text typeLevel=\"subtext.small\" color=\"hint\" marginLeft=\"xs\">\r\n            (çŠ¶æ€æ›´æ–°ä¸­...)\r\n          </Text>\r\n        )}\r\n        {isHistorical && (\r\n          <Text as=\"span\" typeLevel=\"subtext.small\" color=\"hint\" marginLeft=\"xs\">\r\n            ğŸ“–\r\n          </Text>\r\n        )}\r\n        {/* è®¡åˆ’ç»„ç»‡æ ‡è¯† */}\r\n        {temporalStatus === 'PLANNED' && (\r\n          <Text as=\"span\" typeLevel=\"subtext.small\" color=\"positive\" marginLeft=\"xs\">\r\n            ğŸ“… è®¡åˆ’\r\n          </Text>\r\n        )}\r\n      </Table.Cell>\r\n      \r\n      <Table.Cell>{organization.unit_type}</Table.Cell>\r\n      \r\n      <Table.Cell>\r\n        <span \r\n          style={{\r\n            display: 'inline-block',\r\n            padding: '2px 6px',\r\n            borderRadius: '12px',\r\n            fontSize: '11px',\r\n            fontWeight: '500',\r\n            backgroundColor: temporalStatus === 'ACTIVE' ? '#00A844' : \r\n                           temporalStatus === 'PLANNED' ? '#0875E1' : '#999999',\r\n            color: 'white'\r\n          }}\r\n        >\r\n          {temporalStatus === 'ACTIVE' ? 'âœ“ å¯ç”¨' :\r\n           temporalStatus === 'PLANNED' ? 'ğŸ“… è®¡åˆ’' :\r\n           temporalStatus === 'INACTIVE' ? 'â¸ï¸ åœç”¨' : temporalStatus}\r\n        </span>\r\n      </Table.Cell>\r\n      \r\n      <Table.Cell>{organization.level}</Table.Cell>\r\n      \r\n      {/* æ—¶æ€ä¿¡æ¯åˆ— */}\r\n      {(showTemporalInfo || isTemporal) && (\r\n        <Table.Cell>\r\n          {isTemporal ? (\r\n            <TemporalDateRange \r\n              effectiveDate={organization.effective_date}\r\n              endDate={organization.end_date}\r\n              format=\"short\"\r\n            />\r\n          ) : (\r\n            <Text variant=\"small\" color=\"licorice300\">-</Text>\r\n          )}\r\n        </Table.Cell>\r\n      )}\r\n      \r\n      {/* æ—¶æ€è¯¦ç»†ä¿¡æ¯ */}\r\n      {showTemporalInfo && isTemporal && (\r\n        <Table.Cell>\r\n          <TemporalInfoDisplay \r\n            temporalInfo={{\r\n              effective_date: organization.effective_date,\r\n              end_date: organization.end_date,\r\n              status: temporalStatus,\r\n              is_temporal: isTemporal,\r\n              change_reason: organization.change_reason,\r\n              version: organization.version\r\n            }}\r\n            variant=\"compact\"\r\n          />\r\n        </Table.Cell>\r\n      )}\r\n      \r\n      <Table.Cell>\r\n        <TableActions\r\n          organization={organization}\r\n          onEdit={onEdit}\r\n          onToggleStatus={onToggleStatus}\r\n          onTemporalManage={onTemporalManage}\r\n          isToggling={isToggling}\r\n          disabled={isAnyToggling}\r\n          isHistorical={isHistorical}\r\n        />\r\n      </Table.Cell>\r\n    </Table.Row>\r\n  );\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/OrganizationTable/TableTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/OrganizationTable/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/StatsCards/StatCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/StatsCards/StatsTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/components/StatsCards/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/constants/formConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/constants/tableConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/hooks/useOrganizationActions.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'handleFormClose'. Either include it or remove the dependency array.","line":60,"column":6,"nodeType":"ArrayExpression","endLine":60,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [selectedOrg, handleFormClose, updateMutation, createMutation]","fix":{"range":[2252,2297],"text":"[selectedOrg, handleFormClose, updateMutation, createMutation]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from 'react';\r\nimport { useToggleOrganizationStatus, useCreateOrganization, useUpdateOrganization } from '../../../shared/hooks/useOrganizationMutations';\r\nimport type { OrganizationUnit, OrganizationStatus } from '../../../shared/types';\r\nimport type { CreateOrganizationInput, UpdateOrganizationInput } from '../../../shared/hooks/useOrganizationMutations';\r\n\r\nexport const useOrganizationActions = () => {\r\n  const [selectedOrg, setSelectedOrg] = useState<OrganizationUnit | undefined>();\r\n  const [isFormOpen, setIsFormOpen] = useState(false);\r\n  \r\n  const toggleStatusMutation = useToggleOrganizationStatus();\r\n  const createMutation = useCreateOrganization();\r\n  const updateMutation = useUpdateOrganization();\r\n\r\n  const handleCreate = useCallback(() => {\r\n    setSelectedOrg(undefined);\r\n    setIsFormOpen(true);\r\n  }, []);\r\n\r\n  const handleEdit = useCallback((org: OrganizationUnit) => {\r\n    setSelectedOrg(org);\r\n    setIsFormOpen(true);\r\n  }, []);\r\n\r\n  const handleToggleStatus = useCallback(async (code: string, currentStatus: OrganizationStatus) => {\r\n    const newStatus: OrganizationStatus = currentStatus === 'ACTIVE' ? 'INACTIVE' : 'ACTIVE';\r\n    const confirmMessage = newStatus === 'INACTIVE' \r\n      ? 'ç¡®å®šè¦åœç”¨è¿™ä¸ªç»„ç»‡å•å…ƒå—ï¼Ÿ' \r\n      : 'ç¡®å®šè¦å¯ç”¨è¿™ä¸ªç»„ç»‡å•å…ƒå—ï¼Ÿ';\r\n      \r\n    if (window.confirm(confirmMessage)) {\r\n      try {\r\n        await toggleStatusMutation.mutateAsync({ code, status: newStatus });\r\n      } catch (error) {\r\n        console.error('Toggle status operation failed:', error);\r\n      }\r\n    }\r\n  }, [toggleStatusMutation]);\r\n\r\n  const handleFormClose = useCallback(() => {\r\n    setIsFormOpen(false);\r\n    setSelectedOrg(undefined);\r\n  }, []);\r\n\r\n  const handleFormSubmit = useCallback(async (data: CreateOrganizationInput | UpdateOrganizationInput) => {\r\n    try {\r\n      if (selectedOrg) {\r\n        // Edit mode\r\n        await updateMutation.mutateAsync({ \r\n          code: selectedOrg.code, \r\n          ...data as UpdateOrganizationInput \r\n        });\r\n      } else {\r\n        // Create mode\r\n        await createMutation.mutateAsync(data as CreateOrganizationInput);\r\n      }\r\n      handleFormClose();\r\n    } catch (error) {\r\n      console.error('Form submission failed:', error);\r\n    }\r\n  }, [selectedOrg, createMutation, updateMutation]);\r\n\r\n  // Get the currently toggling item ID for UI state\r\n  const togglingId = toggleStatusMutation.isPending ? toggleStatusMutation.variables?.code : undefined;\r\n\r\n  return {\r\n    // State\r\n    selectedOrg,\r\n    isFormOpen,\r\n    togglingId,\r\n    \r\n    // Mutation state\r\n    isToggling: toggleStatusMutation.isPending,\r\n    \r\n    // Actions\r\n    handleCreate,\r\n    handleEdit,\r\n    handleToggleStatus,\r\n    handleFormClose,\r\n    handleFormSubmit,\r\n  };\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/hooks/useOrganizationDashboard.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isCurrent' is assigned a value but never used.","line":23,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isHistorical' is assigned a value but never used.","line":24,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isPlanning' is assigned a value but never used.","line":25,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":19}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from 'react';\r\nimport { useOrganizations, useOrganizationStats } from '../../../shared/hooks/useOrganizations';\r\n// import { useTemporalOrganizations, useTemporalMode, useTemporalQueryState } from '../../../shared/hooks/useTemporalQuery';\r\nimport type { OrganizationQueryParams } from '../../../shared/api/organizations';\r\nimport type { OrganizationUnitType, OrganizationStatus } from '../../../shared/types/api';\r\nimport type { FilterState } from '../OrganizationFilters';\r\n\r\nconst initialFilters: FilterState = {\r\n  searchText: '',\r\n  unit_type: undefined,\r\n  status: undefined,\r\n  level: undefined,\r\n  page: 1,\r\n  pageSize: 100, // å¢åŠ é»˜è®¤é¡µé¢å¤§å°ä»¥ç¡®ä¿æ‰€æœ‰ç»„ç»‡éƒ½èƒ½æ˜¾ç¤º\r\n};\r\n\r\nexport const useOrganizationDashboard = () => {\r\n  const [filters, setFilters] = useState<FilterState>(initialFilters);\r\n\r\n  // æ—¶æ€æ¨¡å¼å’ŒçŠ¶æ€ - æš‚æ—¶ç¦ç”¨\r\n  // const { isCurrent, isHistorical, isPlanning } = useTemporalMode();\r\n  // const { context: temporalContext } = useTemporalQueryState();\r\n  const isCurrent = true;\r\n  const isHistorical = false;\r\n  const isPlanning = false;\r\n\r\n  // Convert filters to query parameters\r\n  const queryParams: OrganizationQueryParams = useMemo(() => ({\r\n    searchText: filters.searchText || undefined,\r\n    unit_type: (filters.unit_type as OrganizationUnitType) || undefined,\r\n    status: (filters.status as OrganizationStatus) || undefined,\r\n    level: filters.level || undefined,\r\n    page: filters.page,\r\n    pageSize: filters.pageSize,\r\n  }), [filters]);\r\n\r\n  // æ ¹æ®æ—¶æ€æ¨¡å¼é€‰æ‹©ä½¿ç”¨ä¸åŒçš„æ•°æ®è·å–ç­–ç•¥ - æš‚æ—¶åªä½¿ç”¨ä¼ ç»Ÿæ•°æ®\r\n  const useTemporalData = false; // isHistorical || isPlanning;\r\n  \r\n  // ä¼ ç»Ÿæ•°æ®è·å–ï¼ˆå½“å‰æ¨¡å¼ï¼‰\r\n  const { \r\n    data: organizationData, \r\n    isLoading: traditionalLoading, \r\n    error: traditionalError, \r\n    isFetching: traditionalFetching \r\n  } = useOrganizations(queryParams); // ç§»é™¤ä¸æ”¯æŒçš„enabledé€‰é¡¹\r\n\r\n  // æ—¶æ€æ•°æ®è·å–ï¼ˆå†å²/è§„åˆ’æ¨¡å¼ï¼‰- æš‚æ—¶ç¦ç”¨\r\n  // const {\r\n  //   data: temporalOrganizations,\r\n  //   isLoading: temporalLoading,\r\n  //   error: temporalError,\r\n  //   isFetching: temporalFetching,\r\n  //   temporalContext: temporalOrgContext,\r\n  //   isHistorical: temporalIsHistorical\r\n  // } = useTemporalOrganizations(queryParams);\r\n\r\n  // ç»Ÿä¸€æ•°æ®è¾“å‡º - åªä½¿ç”¨ä¼ ç»Ÿæ•°æ®\r\n  const organizations = organizationData?.organizations || [];\r\n  const totalCount = organizationData?.total_count || 0;\r\n  const isLoading = traditionalLoading;\r\n  const isFetching = traditionalFetching;\r\n  const error = traditionalError;\r\n\r\n  const { data: stats } = useOrganizationStats(); // ç§»é™¤ä¸æ”¯æŒçš„enabledé€‰é¡¹\r\n\r\n  const resetFilters = () => {\r\n    setFilters(initialFilters);\r\n  };\r\n\r\n  const updateFilters = (newFilters: Partial<FilterState>) => {\r\n    setFilters(prev => ({ ...prev, ...newFilters }));\r\n  };\r\n\r\n  const handlePageChange = (page: number) => {\r\n    setFilters(prev => ({ ...prev, page }));\r\n  };\r\n\r\n  const isFiltered = useMemo(() => {\r\n    return !!(filters.searchText || filters.unit_type || filters.status || filters.level);\r\n  }, [filters]);\r\n\r\n  return {\r\n    // Data\r\n    organizations: organizations || [],\r\n    totalCount,\r\n    stats: useTemporalData ? null : stats, // æ—¶æ€æ¨¡å¼ä¸‹ä¸æ˜¾ç¤ºç»Ÿè®¡\r\n    \r\n    // Loading states\r\n    isLoading: isLoading && !isFetching,\r\n    isFetching,\r\n    error,\r\n    \r\n    // Filter states\r\n    filters,\r\n    isFiltered,\r\n    \r\n    // Filter actions\r\n    setFilters,\r\n    updateFilters,\r\n    resetFilters,\r\n    handlePageChange,\r\n\r\n    // Temporal context - ä½¿ç”¨é»˜è®¤å€¼\r\n    temporalMode: 'current',\r\n    isHistorical: false,\r\n    isPlanning: false,\r\n    temporalContext: null\r\n  };\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/organizations/hooks/useOrganizationFilters.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[660,663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[660,663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from 'react';\r\nimport type { FilterState } from '../OrganizationFilters';\r\n\r\nexport const useOrganizationFilters = (\r\n  filters: FilterState,\r\n  onFiltersChange: (filters: FilterState) => void\r\n) => {\r\n  const hasActiveFilters = useMemo(() => {\r\n    return !!(filters.searchText || filters.unit_type || filters.status || filters.level);\r\n  }, [filters]);\r\n\r\n  const clearFilters = () => {\r\n    onFiltersChange({\r\n      searchText: '',\r\n      unit_type: undefined,\r\n      status: undefined,\r\n      level: undefined,\r\n      page: 1,\r\n      pageSize: filters.pageSize,\r\n    });\r\n  };\r\n\r\n  const updateFilter = (field: keyof FilterState, value: any) => {\r\n    onFiltersChange({\r\n      ...filters,\r\n      [field]: value,\r\n      page: field !== 'page' ? 1 : filters.page, // Reset to page 1 when filtering\r\n    });\r\n  };\r\n\r\n  const updateFilters = (newFilters: Partial<FilterState>) => {\r\n    onFiltersChange({\r\n      ...filters,\r\n      ...newFilters,\r\n      page: 1, // Reset to page 1 when applying multiple filters\r\n    });\r\n  };\r\n\r\n  return {\r\n    hasActiveFilters,\r\n    clearFilters,\r\n    updateFilter,\r\n    updateFilters,\r\n  };\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/OrganizationTemporalPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/TemporalDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PrimaryButton' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DateTimePicker' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TemporalOrganizationUnit' is defined but never used.","line":25,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TimelineEvent' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setQueryParams' is assigned a value but never used.","line":52,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":37}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€ç®¡ç†é›†æˆç»„ä»¶\r\n * æ•´åˆæ‰€æœ‰æ—¶æ€åŠŸèƒ½åˆ°ä¸€ä¸ªç»Ÿä¸€çš„ç•Œé¢ä¸­\r\n */\r\nimport React, { useState, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { Tabs, TabsList, Tab, TabPanel } from '@workday/canvas-kit-react/tabs';\r\nimport { PrimaryButton } from '@workday/canvas-kit-react/button';\r\nimport { Modal } from '@workday/canvas-kit-react/modal';\r\nimport { colors, space } from '@workday/canvas-kit-react/tokens';\r\nimport {\r\n  TemporalNavbar,\r\n  TemporalTable,\r\n  Timeline,\r\n  VersionComparison,\r\n  DateTimePicker\r\n} from './components';\r\nimport type { \r\n  OrganizationUnit,\r\n  OrganizationQueryParams \r\n} from '../../shared/types/organization';\r\nimport type { \r\n  TemporalOrganizationUnit,\r\n  TimelineEvent \r\n} from '../../shared/types/temporal';\r\n\r\nexport interface TemporalDashboardProps {\r\n  /** åˆå§‹æŸ¥è¯¢å‚æ•° */\r\n  initialQueryParams?: OrganizationQueryParams;\r\n  /** æ˜¯å¦ç´§å‡‘æ¨¡å¼ */\r\n  compact?: boolean;\r\n  /** æ˜¯å¦æ˜¾ç¤ºé«˜çº§åŠŸèƒ½ */\r\n  showAdvancedFeatures?: boolean;\r\n}\r\n\r\n/**\r\n * æ—¶æ€ç®¡ç†ä»ªè¡¨æ¿ç»„ä»¶\r\n * é›†æˆäº†æ‰€æœ‰æ—¶æ€ç®¡ç†åŠŸèƒ½çš„ä¸»ç•Œé¢\r\n */\r\nexport const TemporalDashboard: React.FC<TemporalDashboardProps> = ({\r\n  initialQueryParams,\r\n  compact = false,\r\n  showAdvancedFeatures = true\r\n}) => {\r\n  // çŠ¶æ€ç®¡ç†\r\n  const [activeTab, setActiveTab] = useState('table');\r\n  const [selectedOrganization, setSelectedOrganization] = useState<OrganizationUnit | null>(null);\r\n  const [showTimelineModal, setShowTimelineModal] = useState(false);\r\n  const [showVersionModal, setShowVersionModal] = useState(false);\r\n  const [queryParams, setQueryParams] = useState<OrganizationQueryParams>(\r\n    initialQueryParams || {}\r\n  );\r\n\r\n  // äº‹ä»¶å¤„ç†\r\n  const handleRowClick = useCallback((organization: OrganizationUnit) => {\r\n    setSelectedOrganization(organization);\r\n  }, []);\r\n\r\n  const handleViewTimeline = useCallback((organization: OrganizationUnit) => {\r\n    setSelectedOrganization(organization);\r\n    setShowTimelineModal(true);\r\n  }, []);\r\n\r\n  const handleViewHistory = useCallback((organization: OrganizationUnit) => {\r\n    setSelectedOrganization(organization);\r\n    setShowVersionModal(true);\r\n  }, []);\r\n\r\n  const handleEdit = useCallback((organization: OrganizationUnit) => {\r\n    // TODO: å®ç°ç¼–è¾‘åŠŸèƒ½\r\n    console.log('ç¼–è¾‘ç»„ç»‡:', organization);\r\n  }, []);\r\n\r\n  const handleDelete = useCallback((organization: OrganizationUnit) => {\r\n    // TODO: å®ç°åˆ é™¤åŠŸèƒ½\r\n    console.log('åˆ é™¤ç»„ç»‡:', organization);\r\n  }, []);\r\n\r\n  return (\r\n    <Box>\r\n      {/* æ—¶æ€å¯¼èˆªæ  */}\r\n      <Box marginBottom={space.m}>\r\n        <TemporalNavbar \r\n          compact={compact}\r\n          showAdvancedSettings={showAdvancedFeatures}\r\n        />\r\n      </Box>\r\n\r\n      {/* ä¸»è¦å†…å®¹åŒºåŸŸ */}\r\n      <Card padding={space.m}>\r\n        <Tabs activeKey={activeTab} onSelectionChange={setActiveTab}>\r\n          <TabsList>\r\n            <Tab value=\"table\">ç»„ç»‡åˆ—è¡¨</Tab>\r\n            <Tab value=\"timeline\">æ—¶é—´çº¿è§†å›¾</Tab>\r\n            {showAdvancedFeatures && <Tab value=\"comparison\">ç‰ˆæœ¬å¯¹æ¯”</Tab>}\r\n          </TabsList>\r\n\r\n          {/* ç»„ç»‡åˆ—è¡¨æ ‡ç­¾é¡µ */}\r\n          <TabPanel value=\"table\">\r\n            <Box marginTop={space.m}>\r\n              <TemporalTable\r\n                queryParams={queryParams}\r\n                showTemporalIndicators={true}\r\n                showActions={true}\r\n                showSelection={showAdvancedFeatures}\r\n                compact={compact}\r\n                onRowClick={handleRowClick}\r\n                onEdit={handleEdit}\r\n                onDelete={handleDelete}\r\n                onViewHistory={handleViewHistory}\r\n                onViewTimeline={handleViewTimeline}\r\n              />\r\n            </Box>\r\n          </TabPanel>\r\n\r\n          {/* æ—¶é—´çº¿è§†å›¾æ ‡ç­¾é¡µ */}\r\n          <TabPanel value=\"timeline\">\r\n            <Box marginTop={space.m}>\r\n              {selectedOrganization ? (\r\n                <Timeline\r\n                  organizationCode={selectedOrganization.code}\r\n                  compact={compact}\r\n                  showFilters={true}\r\n                  showActions={showAdvancedFeatures}\r\n                />\r\n              ) : (\r\n                <Box \r\n                  padding={space.l}\r\n                  textAlign=\"center\"\r\n                  backgroundColor={colors.soap100}\r\n                  borderRadius=\"8px\"\r\n                >\r\n                  <Text color={colors.licorice500}>\r\n                    è¯·ä»ç»„ç»‡åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªç»„ç»‡æ¥æŸ¥çœ‹å…¶æ—¶é—´çº¿\r\n                  </Text>\r\n                </Box>\r\n              )}\r\n            </Box>\r\n          </TabPanel>\r\n\r\n          {/* ç‰ˆæœ¬å¯¹æ¯”æ ‡ç­¾é¡µ */}\r\n          {showAdvancedFeatures && (\r\n            <TabPanel value=\"comparison\">\r\n              <Box marginTop={space.m}>\r\n                {selectedOrganization ? (\r\n                  <VersionComparison\r\n                    organizationCode={selectedOrganization.code}\r\n                    compact={compact}\r\n                  />\r\n                ) : (\r\n                  <Box \r\n                    padding={space.l}\r\n                    textAlign=\"center\"\r\n                    backgroundColor={colors.soap100}\r\n                    borderRadius=\"8px\"\r\n                  >\r\n                    <Text color={colors.licorice500}>\r\n                      è¯·ä»ç»„ç»‡åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªç»„ç»‡æ¥æŸ¥çœ‹ç‰ˆæœ¬å¯¹æ¯”\r\n                    </Text>\r\n                  </Box>\r\n                )}\r\n              </Box>\r\n            </TabPanel>\r\n          )}\r\n        </Tabs>\r\n      </Card>\r\n\r\n      {/* æ—¶é—´çº¿å¼¹çª— */}\r\n      {showTimelineModal && selectedOrganization && (\r\n        <Modal onClose={() => setShowTimelineModal(false)}>\r\n          <Card padding={space.l} minWidth=\"800px\" maxHeight=\"80vh\" overflow=\"auto\">\r\n            <Flex justifyContent=\"space-between\" alignItems=\"center\" marginBottom={space.m}>\r\n              <Text fontSize=\"large\" fontWeight=\"bold\">\r\n                {selectedOrganization.name} - æ—¶é—´çº¿\r\n              </Text>\r\n              <SecondaryButton onClick={() => setShowTimelineModal(false)}>\r\n                å…³é—­\r\n              </SecondaryButton>\r\n            </Flex>\r\n            <Timeline\r\n              organizationCode={selectedOrganization.code}\r\n              compact={false}\r\n              showFilters={true}\r\n              showActions={true}\r\n            />\r\n          </Card>\r\n        </Modal>\r\n      )}\r\n\r\n      {/* ç‰ˆæœ¬å¯¹æ¯”å¼¹çª— */}\r\n      {showVersionModal && selectedOrganization && (\r\n        <Modal onClose={() => setShowVersionModal(false)}>\r\n          <Card padding={space.l} minWidth=\"1000px\" maxHeight=\"80vh\" overflow=\"auto\">\r\n            <Flex justifyContent=\"space-between\" alignItems=\"center\" marginBottom={space.m}>\r\n              <Text fontSize=\"large\" fontWeight=\"bold\">\r\n                {selectedOrganization.name} - ç‰ˆæœ¬å†å²\r\n              </Text>\r\n              <SecondaryButton onClick={() => setShowVersionModal(false)}>\r\n                å…³é—­\r\n              </SecondaryButton>\r\n            </Flex>\r\n            <VersionComparison\r\n              organizationCode={selectedOrganization.code}\r\n              compact={false}\r\n            />\r\n          </Card>\r\n        </Modal>\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default TemporalDashboard;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/TemporalGraphQLDemoPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/TemporalManagementDemo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/TemporalManagementGraphQL.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'searchIcon' is defined but never used.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€ç®¡ç†æ¼”ç¤ºé¡µé¢ - åŸºäºGraphQLæ—¶æ€æŸ¥è¯¢\r\n * é›†æˆå±•ç¤ºorganizationAsOfDateå’ŒorganizationHistoryåŠŸèƒ½\r\n */\r\nimport React, { useState, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { FormField } from '@workday/canvas-kit-react/form-field';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { Select } from '@workday/canvas-kit-react/select';\r\nimport { Tabs } from '@workday/canvas-kit-react/tabs';\r\nimport { SystemIcon } from '@workday/canvas-kit-react/icon';\r\nimport { \r\n  colors, \r\n  space, \r\n  borderRadius\r\n} from '@workday/canvas-kit-react/tokens';\r\n\r\n// ç®€åŒ–å­—ä½“å¤§å°å®šä¹‰\r\nconst fontSizes = {\r\n  body: {\r\n    small: '12px',\r\n    medium: '14px'\r\n  },\r\n  heading: {\r\n    large: '24px'\r\n  }\r\n};\r\nimport {\r\n  calendarIcon,\r\n  searchIcon,\r\n  infoIcon\r\n} from '@workday/canvas-system-icons-web';\r\n\r\n// å¯¼å…¥æ–°çš„æ—¶æ€ç»„ä»¶\r\nimport { TemporalHistoryViewer } from './components/TemporalHistoryViewer';\r\nimport { TimePointQuery } from './components/TimePointQuery';\r\nimport type { TemporalOrganizationUnit } from '../../shared/types/temporal';\r\n\r\n// è·¯å¾„è§£æå·¥å…·å‡½æ•°\r\nconst parseOrganizationPath = (path: string, level: number) => {\r\n  if (!path) return { \r\n    pathSegments: [], \r\n    pathDescription: 'æ— è·¯å¾„ä¿¡æ¯',\r\n    levelDescription: 'æœªçŸ¥å±‚çº§'\r\n  };\r\n\r\n  const segments = path.split('/').filter(segment => segment !== '');\r\n  const levelDescriptions = [\r\n    'æœªçŸ¥å±‚çº§',      // 0çº§ - ä¸åº”è¯¥å­˜åœ¨\r\n    'æ ¹ç»„ç»‡',        // 1çº§\r\n    'ä¸€çº§éƒ¨é—¨',      // 2çº§  \r\n    'äºŒçº§éƒ¨é—¨',      // 3çº§\r\n    'ä¸‰çº§éƒ¨é—¨',      // 4çº§\r\n    'å››çº§éƒ¨é—¨',      // 5çº§\r\n    'å¤šçº§éƒ¨é—¨'       // 6çº§åŠä»¥ä¸Š\r\n  ];\r\n\r\n  const levelDescription = level <= 5 ? levelDescriptions[level] : levelDescriptions[6];\r\n  \r\n  // åˆ›å»ºè·¯å¾„æè¿°\r\n  let pathDescription = '';\r\n  if (segments.length === 1) {\r\n    pathDescription = `æ ¹ç»„ç»‡ (${segments[0]})`;\r\n  } else if (segments.length === 2) {\r\n    pathDescription = `${segments[0]} â†’ ${segments[1]}`;\r\n  } else if (segments.length >= 3) {\r\n    pathDescription = `${segments[0]} â†’ ... â†’ ${segments[segments.length-1]} (å…±${segments.length}çº§)`;\r\n  }\r\n\r\n  return {\r\n    pathSegments: segments,\r\n    pathDescription,\r\n    levelDescription\r\n  };\r\n};\r\n\r\n// ç®€åŒ–çš„ç±»å‹å®šä¹‰ - åˆ é™¤é‡å¤å®šä¹‰\r\n\r\nconst DEMO_ORGANIZATION_CODES = [\r\n  { label: '1000056 - å®Œæ•´å†å²è®°å½•æ¼”ç¤º (14æ¡è®°å½•)', value: '1000056' },\r\n  { label: '1000099 - æ–°å»ºæµ‹è¯•ç»„ç»‡', value: '1000099' },\r\n  { label: '1000001 - æ ‡å‡†ç»„ç»‡', value: '1000001' },\r\n  { label: '1000002 - éƒ¨é—¨ç»„ç»‡', value: '1000002' },\r\n];\r\n\r\nexport const TemporalManagementGraphQL: React.FC = () => {\r\n  const [selectedOrganizationCode, setSelectedOrganizationCode] = useState('1000056');\r\n  const [customCode, setCustomCode] = useState('');\r\n  const [useCustomCode, setUseCustomCode] = useState(false);\r\n  const [selectedRecord, setSelectedRecord] = useState<TemporalOrganizationUnit | null>(null);\r\n  const [timePointQueryResult, setTimePointQueryResult] = useState<{\r\n    date: string;\r\n    result: TemporalOrganizationUnit | null;\r\n  } | null>(null);\r\n\r\n  // è·å–å½“å‰ä½¿ç”¨çš„ç»„ç»‡ä»£ç \r\n  const currentCode = useCustomCode && customCode ? customCode : selectedOrganizationCode;\r\n\r\n  // å¤„ç†è®°å½•é€‰æ‹©\r\n  const handleRecordSelect = useCallback((record: TemporalOrganizationUnit) => {\r\n    setSelectedRecord(record);\r\n  }, []);\r\n\r\n  // å¤„ç†æ—¶é—´ç‚¹æŸ¥è¯¢ç»“æœ\r\n  const handleTimePointQuery = useCallback((date: string, result: TemporalOrganizationUnit | null) => {\r\n    setTimePointQueryResult({ date, result });\r\n  }, []);\r\n\r\n  // å¤„ç†ç»„ç»‡ä»£ç é€‰æ‹©\r\n  const handleOrganizationSelect = useCallback((code: string) => {\r\n    setSelectedOrganizationCode(code);\r\n    setUseCustomCode(false);\r\n    setSelectedRecord(null);\r\n    setTimePointQueryResult(null);\r\n  }, []);\r\n\r\n  // å¤„ç†è‡ªå®šä¹‰ä»£ç ä½¿ç”¨\r\n  const handleUseCustomCode = useCallback(() => {\r\n    setUseCustomCode(true);\r\n    setSelectedRecord(null);\r\n    setTimePointQueryResult(null);\r\n  }, []);\r\n\r\n  // æ¸²æŸ“é€‰ä¸­è®°å½•è¯¦æƒ…\r\n  const renderSelectedRecordDetails = () => {\r\n    if (!selectedRecord) return null;\r\n\r\n    // è§£æè·¯å¾„ä¿¡æ¯\r\n    const pathInfo = parseOrganizationPath(selectedRecord.path, selectedRecord.level);\r\n\r\n    return (\r\n      <Card padding={space.m} marginTop={space.m}>\r\n        <Flex alignItems=\"center\" marginBottom={space.s}>\r\n          <SystemIcon icon={infoIcon} size={16} />\r\n          <Text marginLeft={space.xs} fontWeight=\"medium\">\r\n            é€‰ä¸­è®°å½•è¯¦æƒ…\r\n          </Text>\r\n        </Flex>\r\n\r\n        <Box>\r\n          <Text fontSize={fontSizes.body.medium} fontWeight=\"medium\" marginBottom={space.xs}>\r\n            {selectedRecord.name}\r\n          </Text>\r\n          \r\n          <Flex gap={space.l} flexWrap=\"wrap\">\r\n            <Box>\r\n              <Text fontSize={fontSizes.body.small} color={colors.licorice400}>ç»„ç»‡ä»£ç </Text>\r\n              <Text fontSize={fontSizes.body.medium}>{selectedRecord.code}</Text>\r\n            </Box>\r\n            \r\n            <Box>\r\n              <Text fontSize={fontSizes.body.small} color={colors.licorice400}>ç”Ÿæ•ˆæ—¥æœŸ</Text>\r\n              <Text fontSize={fontSizes.body.medium}>{selectedRecord.effective_date}</Text>\r\n            </Box>\r\n            \r\n            {selectedRecord.end_date && (\r\n              <Box>\r\n                <Text fontSize={fontSizes.body.small} color={colors.licorice400}>ç»“æŸæ—¥æœŸ</Text>\r\n                <Text fontSize={fontSizes.body.medium}>{selectedRecord.end_date}</Text>\r\n              </Box>\r\n            )}\r\n            \r\n            <Box>\r\n              <Text fontSize={fontSizes.body.small} color={colors.licorice400}>ç»„ç»‡ç±»å‹</Text>\r\n              <Text fontSize={fontSizes.body.medium}>{selectedRecord.unit_type}</Text>\r\n            </Box>\r\n            \r\n            <Box>\r\n              <Text fontSize={fontSizes.body.small} color={colors.licorice400}>çŠ¶æ€</Text>\r\n              <Text fontSize={fontSizes.body.medium}>{selectedRecord.status}</Text>\r\n            </Box>\r\n            \r\n            <Box>\r\n              <Text fontSize={fontSizes.body.small} color={colors.licorice400}>ç»„ç»‡å±‚çº§</Text>\r\n              <Text fontSize={fontSizes.body.medium}>\r\n                ç¬¬ {selectedRecord.level} çº§ ({pathInfo.levelDescription})\r\n              </Text>\r\n            </Box>\r\n            \r\n            <Box>\r\n              <Text fontSize={fontSizes.body.small} color={colors.licorice400}>å½“å‰æœ‰æ•ˆ</Text>\r\n              <Text fontSize={fontSizes.body.medium}>\r\n                {selectedRecord.is_current ? 'æ˜¯' : 'å¦'}\r\n              </Text>\r\n            </Box>\r\n          </Flex>\r\n\r\n          {/* çº§è”é•¿è·¯å¾„ - å•ç‹¬ä¸€è¡Œæ˜¾ç¤º */}\r\n          <Box marginTop={space.s}>\r\n            <Text fontSize={fontSizes.body.small} color={colors.licorice400}>çº§è”é•¿è·¯å¾„</Text>\r\n            <Text \r\n              fontSize={fontSizes.body.medium} \r\n              fontFamily=\"monospace\"\r\n              backgroundColor={colors.soap200}\r\n              padding={space.xs}\r\n              borderRadius={borderRadius.s}\r\n              wordBreak=\"break-all\"\r\n              marginTop={space.xs}\r\n            >\r\n              {selectedRecord.path || 'N/A'}\r\n            </Text>\r\n            \r\n            {/* è·¯å¾„è§£é‡Š */}\r\n            <Box marginTop={space.xs}>\r\n              <Text fontSize={fontSizes.body.small} color={colors.licorice400}>\r\n                <strong>è·¯å¾„è§£é‡Šï¼š</strong> {pathInfo.pathDescription}\r\n              </Text>\r\n              <Text fontSize={fontSizes.body.small} color={colors.licorice400}>\r\n                è¯´æ˜ï¼šæ˜¾ç¤ºä»æ ¹ç»„ç»‡åˆ°å½“å‰ç»„ç»‡çš„å®Œæ•´å±‚çº§è·¯å¾„ï¼Œæ•°å­—ä¸ºç»„ç»‡ä»£ç \r\n              </Text>\r\n            </Box>\r\n          </Box>\r\n\r\n          {selectedRecord.change_reason && (\r\n            <Box marginTop={space.s}>\r\n              <Text fontSize={fontSizes.body.small} color={colors.licorice400}>å˜æ›´åŸå› </Text>\r\n              <Text fontSize={fontSizes.body.medium}>{selectedRecord.change_reason}</Text>\r\n            </Box>\r\n          )}\r\n\r\n          {selectedRecord.description && (\r\n            <Box marginTop={space.s}>\r\n              <Text fontSize={fontSizes.body.small} color={colors.licorice400}>æè¿°</Text>\r\n              <Text fontSize={fontSizes.body.medium}>{selectedRecord.description}</Text>\r\n            </Box>\r\n          )}\r\n        </Box>\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  // æ¸²æŸ“æ—¶é—´ç‚¹æŸ¥è¯¢ç»“æœ\r\n  const renderTimePointQueryResult = () => {\r\n    if (!timePointQueryResult) return null;\r\n\r\n    return (\r\n      <Card padding={space.m} marginTop={space.m}>\r\n        <Flex alignItems=\"center\" marginBottom={space.s}>\r\n          <SystemIcon icon={calendarIcon} size={16} />\r\n          <Text marginLeft={space.xs} fontWeight=\"medium\">\r\n            æ—¶é—´ç‚¹æŸ¥è¯¢ç»“æœ ({timePointQueryResult.date})\r\n          </Text>\r\n        </Flex>\r\n\r\n        {timePointQueryResult.result ? (\r\n          <Box>\r\n            <Text fontSize={fontSizes.body.medium} fontWeight=\"medium\" marginBottom={space.xs}>\r\n              {timePointQueryResult.result.name}\r\n            </Text>\r\n            <Text fontSize={fontSizes.body.small} color={colors.licorice400}>\r\n              åœ¨ {timePointQueryResult.date} æ—¶é—´ç‚¹ï¼Œè¯¥ç»„ç»‡çš„æœ‰æ•ˆè®°å½•\r\n            </Text>\r\n            <Text fontSize={fontSizes.body.small} color={colors.licorice400}>\r\n              ç”Ÿæ•ˆæœŸé—´: {timePointQueryResult.result.effective_date} - {timePointQueryResult.result.end_date || 'è‡³ä»Š'}\r\n            </Text>\r\n          </Box>\r\n        ) : (\r\n          <Text color={colors.licorice400}>\r\n            åœ¨ {timePointQueryResult.date} æ—¶é—´ç‚¹æ²¡æœ‰æ‰¾åˆ°è¯¥ç»„ç»‡çš„è®°å½•\r\n          </Text>\r\n        )}\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Box padding={space.l}>\r\n      {/* é¡µé¢æ ‡é¢˜ */}\r\n      <Box marginBottom={space.l}>\r\n        <Text \r\n          fontSize={fontSizes.heading.large} \r\n          fontWeight=\"bold\" \r\n          color={colors.licorice500}\r\n          marginBottom={space.s}\r\n        >\r\n          æ—¶æ€ç®¡ç†æ¼”ç¤º - GraphQLç‰ˆæœ¬\r\n        </Text>\r\n        <Text fontSize={fontSizes.body.medium} color={colors.licorice400}>\r\n          åŸºäºNeo4j Bitemporalæ•°æ®æ¨¡å‹å’ŒGraphQLæ—¶æ€æŸ¥è¯¢API\r\n        </Text>\r\n      </Box>\r\n\r\n      {/* ç»„ç»‡é€‰æ‹©å™¨ */}\r\n      <Card padding={space.m} marginBottom={space.l}>\r\n        <Text fontWeight=\"medium\" marginBottom={space.s}>é€‰æ‹©æµ‹è¯•ç»„ç»‡</Text>\r\n        \r\n        <Flex gap={space.m} alignItems=\"flex-end\" flexWrap=\"wrap\">\r\n          <FormField>\r\n            <FormField.Label>é¢„è®¾ç»„ç»‡</FormField.Label>\r\n            <FormField.Field>\r\n              <Select\r\n                value={selectedOrganizationCode}\r\n                onChange={(e) => handleOrganizationSelect(e.target.value)}\r\n                disabled={useCustomCode}\r\n              >\r\n                {DEMO_ORGANIZATION_CODES.map(({ label, value }) => (\r\n                  <option key={value} value={value}>\r\n                    {label}\r\n                  </option>\r\n                ))}\r\n              </Select>\r\n            </FormField.Field>\r\n          </FormField>\r\n\r\n          <Text color={colors.licorice300}>æˆ–</Text>\r\n\r\n          <FormField>\r\n            <FormField.Label>è‡ªå®šä¹‰ç»„ç»‡ä»£ç </FormField.Label>\r\n            <FormField.Field>\r\n              <TextInput\r\n                value={customCode}\r\n                onChange={(e) => setCustomCode(e.target.value)}\r\n                placeholder=\"è¾“å…¥ç»„ç»‡ä»£ç ï¼Œå¦‚ 1000001\"\r\n              />\r\n            </FormField.Field>\r\n          </FormField>\r\n\r\n          <PrimaryButton \r\n            onClick={handleUseCustomCode}\r\n            disabled={!customCode}\r\n          >\r\n            ä½¿ç”¨è‡ªå®šä¹‰ä»£ç \r\n          </PrimaryButton>\r\n\r\n          {useCustomCode && (\r\n            <SecondaryButton onClick={() => setUseCustomCode(false)}>\r\n              è¿”å›é¢„è®¾é€‰æ‹©\r\n            </SecondaryButton>\r\n          )}\r\n        </Flex>\r\n\r\n        <Box marginTop={space.s}>\r\n          <Text fontSize={fontSizes.body.small} color={colors.licorice400}>\r\n            å½“å‰æŸ¥è¯¢ç»„ç»‡: <strong>{currentCode}</strong>\r\n          </Text>\r\n        </Box>\r\n      </Card>\r\n\r\n      {/* ä¸»è¦åŠŸèƒ½åŒºåŸŸ */}\r\n      <Tabs>\r\n        <Tabs.List>\r\n          <Tabs.Item>å†å²è®°å½•æŸ¥çœ‹</Tabs.Item>\r\n          <Tabs.Item>æ—¶é—´ç‚¹æŸ¥è¯¢</Tabs.Item>\r\n        </Tabs.List>\r\n\r\n        <Tabs.Panel>\r\n          {/* å†å²è®°å½•æŸ¥çœ‹å™¨ - çœŸå®åŠŸèƒ½ç»„ä»¶ */}\r\n          <Box paddingTop={space.m}>\r\n            <TemporalHistoryViewer\r\n              organizationCode={currentCode}\r\n              onRecordSelect={handleRecordSelect}\r\n              onTimePointQuery={handleTimePointQuery}\r\n              showTimePointQuery={false} // æ—¶é—´ç‚¹æŸ¥è¯¢å•ç‹¬æ˜¾ç¤º\r\n              showFilters={true}\r\n              maxHeight=\"500px\"\r\n            />\r\n          </Box>\r\n        </Tabs.Panel>\r\n\r\n        <Tabs.Panel>\r\n          {/* æ—¶é—´ç‚¹æŸ¥è¯¢ - çœŸå®åŠŸèƒ½ç»„ä»¶ */}\r\n          <Box paddingTop={space.m}>\r\n            <TimePointQuery\r\n              organizationCode={currentCode}\r\n              onQueryResult={handleTimePointQuery}\r\n              showQuickDates={true}\r\n              compact={false}\r\n            />\r\n          </Box>\r\n        </Tabs.Panel>\r\n      </Tabs>\r\n\r\n      {/* åº•éƒ¨ä¿¡æ¯åŒºåŸŸ */}\r\n      <Flex gap={space.l} marginTop={space.l}>\r\n        <Box flex={1}>\r\n          {renderSelectedRecordDetails()}\r\n        </Box>\r\n        \r\n        <Box flex={1}>\r\n          {renderTimePointQueryResult()}\r\n        </Box>\r\n      </Flex>\r\n\r\n      {/* åŠŸèƒ½è¯´æ˜ */}\r\n      <Card padding={space.m} marginTop={space.l} backgroundColor={colors.soap200}>\r\n        <Text fontWeight=\"medium\" marginBottom={space.s}>åŠŸèƒ½è¯´æ˜</Text>\r\n        \r\n        <Box>\r\n          <Text fontSize={fontSizes.body.small} color={colors.licorice400} display=\"block\" marginBottom={space.xs}>\r\n            â€¢ <strong>å†å²è®°å½•æŸ¥çœ‹</strong>: å±•ç¤ºç»„ç»‡çš„å®Œæ•´æ—¶æ€å†å²ï¼Œæ”¯æŒæ—¶é—´èŒƒå›´è¿‡æ»¤\r\n          </Text>\r\n          <Text fontSize={fontSizes.body.small} color={colors.licorice400} display=\"block\" marginBottom={space.xs}>\r\n            â€¢ <strong>æ—¶é—´ç‚¹æŸ¥è¯¢</strong>: æŸ¥è¯¢ç‰¹å®šæ—¶é—´ç‚¹çš„ç»„ç»‡çŠ¶æ€ï¼Œæ”¯æŒå¿«é€Ÿæ—¥æœŸé€‰æ‹©\r\n          </Text>\r\n          <Text fontSize={fontSizes.body.small} color={colors.licorice400} display=\"block\" marginBottom={space.xs}>\r\n            â€¢ <strong>å®æ—¶GraphQLæŸ¥è¯¢</strong>: ç›´æ¥æŸ¥è¯¢Neo4jæ—¶æ€æ•°æ®ï¼Œå“åº”æ—¶é—´&lt;100ms\r\n          </Text>\r\n          <Text fontSize={fontSizes.body.small} color={colors.licorice400} display=\"block\" marginBottom={space.xs}>\r\n            â€¢ <strong>æ¨èæµ‹è¯•</strong>: ä½¿ç”¨1000056ç»„ç»‡ä»£ç ï¼ŒåŒ…å«14æ¡å®Œæ•´çš„å†å²è®°å½•\r\n          </Text>\r\n          <Text fontSize={fontSizes.body.small} color={colors.licorice400} display=\"block\" marginBottom={space.xs}>\r\n            â€¢ <strong>ç»„ç»‡å±‚çº§</strong>: æ˜¾ç¤ºç»„ç»‡åœ¨å±‚çº§ç»“æ„ä¸­çš„ä½ç½®ï¼ˆ1çº§=æ ¹ç»„ç»‡ï¼Œ2çº§=ä¸€çº§å­ç»„ç»‡ï¼‰\r\n          </Text>\r\n          <Text fontSize={fontSizes.body.small} color={colors.licorice400} display=\"block\">\r\n            â€¢ <strong>çº§è”é•¿è·¯å¾„</strong>: å®Œæ•´å±‚çº§è·¯å¾„ï¼Œå¦‚\"/1000000/1000001/1000056\"è¡¨ç¤ºæ ¹ç»„ç»‡â†’ä¸€çº§éƒ¨é—¨â†’å½“å‰ç»„ç»‡\r\n          </Text>\r\n        </Box>\r\n      </Card>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default TemporalManagementGraphQL;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/TemporalManagementSimple.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TemporalOrganizationRecord' is defined but never used.","line":12,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedOrgCode' is assigned a value but never used.","line":97,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * ç®€åŒ–ç‰ˆæ—¶æ€ç®¡ç†é›†æˆç¤ºä¾‹ç»„ä»¶\r\n * ç§»é™¤Canvas Kit Badgeä¾èµ–ï¼Œä½¿ç”¨ç®€å•çš„HTMLæ ·å¼\r\n */\r\nimport React, { useState, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { colors, space } from '@workday/canvas-kit-react/tokens';\r\nimport { useTemporalHealth, type TemporalOrganizationRecord } from '../../shared/hooks/useTemporalAPI';\r\n\r\n// æ¨¡æ‹Ÿçš„ç»„ç»‡åˆ—è¡¨æ•°æ®\r\nconst mockOrganizations = [\r\n  {\r\n    code: '1000056',\r\n    name: 'æµ‹è¯•æ›´æ–°ç¼“å­˜_åŒæ­¥ä¿®å¤',\r\n    unit_type: 'DEPARTMENT',\r\n    status: 'ACTIVE',\r\n    level: 1,\r\n    effective_date: '2025-08-10'\r\n  },\r\n  {\r\n    code: '1000057',\r\n    name: 'äººåŠ›èµ„æºéƒ¨',\r\n    unit_type: 'DEPARTMENT',\r\n    status: 'ACTIVE',\r\n    level: 2,\r\n    effective_date: '2025-01-01'\r\n  },\r\n  {\r\n    code: '1000058',\r\n    name: 'è´¢åŠ¡éƒ¨',\r\n    unit_type: 'DEPARTMENT',\r\n    status: 'ACTIVE',\r\n    level: 2,\r\n    effective_date: '2025-01-01'\r\n  },\r\n  {\r\n    code: '1000059',\r\n    name: 'è®¡åˆ’é¡¹ç›®ç»„',\r\n    unit_type: 'PROJECT_TEAM',\r\n    status: 'PLANNED',\r\n    level: 3,\r\n    effective_date: '2025-09-01'\r\n  }\r\n];\r\n\r\n// ç®€å•çš„Badgeç»„ä»¶å®ç°\r\ninterface SimpleBadgeProps {\r\n  children: React.ReactNode;\r\n  variant?: 'positive' | 'caution' | 'neutral';\r\n  size?: 'small' | 'medium';\r\n}\r\n\r\nconst SimpleBadge: React.FC<SimpleBadgeProps> = ({ children, variant = 'neutral', size = 'medium' }) => {\r\n  const getVariantStyles = (variant: string) => {\r\n    switch (variant) {\r\n      case 'positive':\r\n        return { backgroundColor: '#d1f2eb', color: '#1e8449', border: '1px solid #58d68d' };\r\n      case 'caution':\r\n        return { backgroundColor: '#fef9e7', color: '#b7950b', border: '1px solid #f4d03f' };\r\n      default:\r\n        return { backgroundColor: '#f8f9fa', color: '#6c757d', border: '1px solid #dee2e6' };\r\n    }\r\n  };\r\n\r\n  const getSizeStyles = (size: string) => {\r\n    switch (size) {\r\n      case 'small':\r\n        return { padding: '2px 6px', fontSize: '11px' };\r\n      default:\r\n        return { padding: '4px 8px', fontSize: '12px' };\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'inline-block',\r\n        borderRadius: '4px',\r\n        ...getVariantStyles(variant),\r\n        ...getSizeStyles(size)\r\n      }}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * ç®€åŒ–ç‰ˆæ—¶æ€ç®¡ç†é›†æˆæ¼”ç¤ºé¡µé¢\r\n */\r\nexport const TemporalManagementSimple: React.FC = () => {\r\n  // çŠ¶æ€ç®¡ç†\r\n  const [selectedOrgCode, setSelectedOrgCode] = useState<string | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n\r\n  // æ—¶æ€æœåŠ¡å¥åº·æ£€æŸ¥\r\n  const { data: healthData, isLoading: isHealthLoading } = useTemporalHealth();\r\n\r\n  // è¿‡æ»¤ç»„ç»‡åˆ—è¡¨\r\n  const filteredOrganizations = mockOrganizations.filter(org =>\r\n    org.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    org.code.includes(searchTerm)\r\n  );\r\n\r\n  // å¤„ç†æŸ¥çœ‹è¯¦æƒ…\r\n  const handleViewDetails = useCallback((orgCode: string) => {\r\n    setSelectedOrgCode(orgCode);\r\n    alert(`ç‚¹å‡»äº†æŸ¥çœ‹è¯¦æƒ…: ${orgCode}\\n\\nè¿™é‡Œä¼šæ‰“å¼€æ—¶æ€ç®¡ç†è¯¦æƒ…é¢æ¿ï¼ŒåŒ…å«ï¼š\\nâ€¢ å·¦ä¾§å‚ç›´æ—¶é—´è½´\\nâ€¢ å³ä¾§ç»„ç»‡è¯¦æƒ…ç¼–è¾‘\\nâ€¢ æ—¶æ€æ•°æ®æŸ¥è¯¢å’Œæ˜¾ç¤º`);\r\n  }, []);\r\n\r\n  // è·å–çŠ¶æ€æ ‡ç­¾\r\n  const getStatusLabel = (status: string) => {\r\n    switch (status) {\r\n      case 'ACTIVE': return 'å¯ç”¨';\r\n      case 'PLANNED': return 'è®¡åˆ’ä¸­';\r\n      case 'INACTIVE': return 'åœç”¨';\r\n      default: return status;\r\n    }\r\n  };\r\n\r\n  // è·å–çŠ¶æ€å˜ä½“\r\n  const getStatusVariant = (status: string) => {\r\n    switch (status) {\r\n      case 'ACTIVE': return 'positive';\r\n      case 'PLANNED': return 'caution';\r\n      case 'INACTIVE': return 'neutral';\r\n      default: return 'neutral';\r\n    }\r\n  };\r\n\r\n  // è·å–ç±»å‹æ ‡ç­¾\r\n  const getTypeLabel = (type: string) => {\r\n    switch (type) {\r\n      case 'COMPANY': return 'å…¬å¸';\r\n      case 'DEPARTMENT': return 'éƒ¨é—¨';\r\n      case 'COST_CENTER': return 'æˆæœ¬ä¸­å¿ƒ';\r\n      case 'PROJECT_TEAM': return 'é¡¹ç›®å›¢é˜Ÿ';\r\n      default: return type;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box padding={space.l}>\r\n      {/* é¡µé¢æ ‡é¢˜å’Œæ—¶æ€æœåŠ¡çŠ¶æ€ */}\r\n      <Box marginBottom={space.l}>\r\n        <Flex alignItems=\"center\" justifyContent=\"space-between\" marginBottom={space.m}>\r\n          <Text fontSize=\"xl\" fontWeight=\"bold\">\r\n            æ—¶æ€ç®¡ç†é›†æˆæ¼”ç¤º (ç®€åŒ–ç‰ˆ)\r\n          </Text>\r\n          \r\n          <Flex alignItems=\"center\" gap={space.s}>\r\n            {isHealthLoading ? (\r\n              <Text fontSize=\"small\">æ£€æŸ¥æ—¶æ€æœåŠ¡...</Text>\r\n            ) : healthData ? (\r\n              <SimpleBadge variant={healthData.status === 'healthy' ? 'positive' : 'neutral'}>\r\n                æ—¶æ€æœåŠ¡: {healthData.status === 'healthy' ? 'æ­£å¸¸' : 'å¼‚å¸¸'}\r\n              </SimpleBadge>\r\n            ) : (\r\n              <SimpleBadge variant=\"caution\">\r\n                æ—¶æ€æœåŠ¡: æœªè¿æ¥\r\n              </SimpleBadge>\r\n            )}\r\n          </Flex>\r\n        </Flex>\r\n\r\n        <Text fontSize=\"medium\" color={colors.licorice600}>\r\n          ç‚¹å‡»ç»„ç»‡åˆ—è¡¨ä¸­çš„\"æŸ¥çœ‹è¯¦æƒ…\"æŒ‰é’®ï¼Œä½“éªŒå¸¦æ—¶é—´è½´çš„ç»„ç»‡è¯¦æƒ…é¢æ¿\r\n        </Text>\r\n      </Box>\r\n\r\n      {/* æœç´¢å’Œæ“ä½œæ  */}\r\n      <Card marginBottom={space.l} padding={space.m}>\r\n        <Flex alignItems=\"center\" justifyContent=\"space-between\">\r\n          <Box flex=\"1\" marginRight={space.m}>\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>\r\n              æœç´¢ç»„ç»‡\r\n            </Text>\r\n            <TextInput\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              placeholder=\"è¾“å…¥ç»„ç»‡åç§°æˆ–ä»£ç ...\"\r\n            />\r\n          </Box>\r\n\r\n          <Box>\r\n            <PrimaryButton onClick={() => alert('æ–°å¢åŠŸèƒ½æ¼”ç¤º')}>\r\n              æ–°å¢ç»„ç»‡\r\n            </PrimaryButton>\r\n          </Box>\r\n        </Flex>\r\n      </Card>\r\n\r\n      {/* ç»„ç»‡åˆ—è¡¨ */}\r\n      <Card padding={space.m}>\r\n        <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n          ç»„ç»‡åˆ—è¡¨ ({filteredOrganizations.length} ä¸ª)\r\n        </Text>\r\n\r\n        {filteredOrganizations.length === 0 ? (\r\n          <Box \r\n            padding={space.l} \r\n            textAlign=\"center\" \r\n            backgroundColor={colors.soap100}\r\n          >\r\n            <Text>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç»„ç»‡</Text>\r\n          </Box>\r\n        ) : (\r\n          <div style={{ overflowX: 'auto' }}>\r\n            <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n              <thead>\r\n                <tr>\r\n                  <th style={{ padding: '8px', textAlign: 'left', borderBottom: '1px solid #dee2e6' }}>ç»„ç»‡ä»£ç </th>\r\n                  <th style={{ padding: '8px', textAlign: 'left', borderBottom: '1px solid #dee2e6' }}>ç»„ç»‡åç§°</th>\r\n                  <th style={{ padding: '8px', textAlign: 'left', borderBottom: '1px solid #dee2e6' }}>ç±»å‹</th>\r\n                  <th style={{ padding: '8px', textAlign: 'left', borderBottom: '1px solid #dee2e6' }}>çŠ¶æ€</th>\r\n                  <th style={{ padding: '8px', textAlign: 'left', borderBottom: '1px solid #dee2e6' }}>å±‚çº§</th>\r\n                  <th style={{ padding: '8px', textAlign: 'left', borderBottom: '1px solid #dee2e6' }}>ç”Ÿæ•ˆæ—¥æœŸ</th>\r\n                  <th style={{ padding: '8px', textAlign: 'left', borderBottom: '1px solid #dee2e6' }}>æ“ä½œ</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {filteredOrganizations.map((org) => (\r\n                  <tr key={org.code} style={{ borderBottom: '1px solid #f8f9fa' }}>\r\n                    <td style={{ padding: '8px', fontFamily: 'monospace' }}>\r\n                      {org.code}\r\n                    </td>\r\n                    <td style={{ padding: '8px', fontWeight: '500' }}>\r\n                      {org.name}\r\n                    </td>\r\n                    <td style={{ padding: '8px' }}>\r\n                      {getTypeLabel(org.unit_type)}\r\n                    </td>\r\n                    <td style={{ padding: '8px' }}>\r\n                      <SimpleBadge variant={getStatusVariant(org.status)} size=\"small\">\r\n                        {getStatusLabel(org.status)}\r\n                      </SimpleBadge>\r\n                    </td>\r\n                    <td style={{ padding: '8px' }}>\r\n                      L{org.level}\r\n                    </td>\r\n                    <td style={{ padding: '8px' }}>\r\n                      {new Date(org.effective_date).toLocaleDateString('zh-CN')}\r\n                    </td>\r\n                    <td style={{ padding: '8px' }}>\r\n                      <SecondaryButton\r\n                        size=\"small\"\r\n                        onClick={() => handleViewDetails(org.code)}\r\n                      >\r\n                        æŸ¥çœ‹è¯¦æƒ…\r\n                      </SecondaryButton>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </Card>\r\n\r\n      {/* åŠŸèƒ½è¯´æ˜ */}\r\n      <Card marginTop={space.l} padding={space.m} backgroundColor={colors.frenchVanilla100}>\r\n        <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n          ğŸ“– åŠŸèƒ½è¯´æ˜\r\n        </Text>\r\n        \r\n        <Box as=\"ul\" marginLeft={space.m}>\r\n          <Box as=\"li\" marginBottom={space.s}>\r\n            <Text fontSize=\"small\">\r\n              <strong>æ—¶é—´è½´å¯¼èˆª</strong>: å·¦ä¾§å‚ç›´æ—¶é—´è½´æ˜¾ç¤ºç»„ç»‡çš„å†å²å˜æ›´è®°å½•ï¼Œç‚¹å‡»ä¸åŒèŠ‚ç‚¹å¯æŸ¥çœ‹å¯¹åº”æ—¶é—´ç‚¹çš„è¯¦æƒ…\r\n            </Text>\r\n          </Box>\r\n          <Box as=\"li\" marginBottom={space.s}>\r\n            <Text fontSize=\"small\">\r\n              <strong>çº¯æ—¥æœŸç”Ÿæ•ˆæ¨¡å‹</strong>: åŸºäºç”Ÿæ•ˆæ—¥æœŸå’Œç»“æŸæ—¥æœŸç®¡ç†æ—¶æ€æ•°æ®ï¼Œæ— éœ€å¤æ‚çš„ç‰ˆæœ¬å·\r\n            </Text>\r\n          </Box>\r\n          <Box as=\"li\" marginBottom={space.s}>\r\n            <Text fontSize=\"small\">\r\n              <strong>å®æ—¶æ•°æ®åŠ è½½</strong>: è¿æ¥åˆ°ç«¯å£9091çš„æ—¶æ€ç®¡ç†æœåŠ¡ï¼Œè·å–çœŸå®çš„æ—¶æ€æ•°æ®\r\n            </Text>\r\n          </Box>\r\n          <Box as=\"li\" marginBottom={space.s}>\r\n            <Text fontSize=\"small\">\r\n              <strong>ç¼–è¾‘æ¨¡å¼</strong>: æ”¯æŒæŸ¥çœ‹å’Œç¼–è¾‘æ¨¡å¼åˆ‡æ¢ï¼Œå®æ—¶ä¿å­˜å˜æ›´åˆ°åç«¯æœåŠ¡\r\n            </Text>\r\n          </Box>\r\n          <Box as=\"li\">\r\n            <Text fontSize=\"small\">\r\n              <strong>çŠ¶æ€æŒ‡ç¤º</strong>: æ¸…æ™°çš„è§†è§‰åé¦ˆæ˜¾ç¤ºå½“å‰è®°å½•ã€å†å²è®°å½•å’Œè®¡åˆ’è®°å½•çš„åŒºåˆ«\r\n            </Text>\r\n          </Box>\r\n        </Box>\r\n\r\n        {/* æ—¶æ€æœåŠ¡çŠ¶æ€è¯¦æƒ… */}\r\n        <Box marginTop={space.m} padding={space.s} backgroundColor={colors.soap100} borderRadius=\"4px\">\r\n          <Text fontSize=\"small\" fontWeight=\"bold\" marginBottom={space.xs}>\r\n            æ—¶æ€æœåŠ¡è¿æ¥çŠ¶æ€:\r\n          </Text>\r\n          {healthData && (\r\n            <Box>\r\n              <Text fontSize=\"small\">â€¢ æœåŠ¡: {healthData.service}</Text>\r\n              <Text fontSize=\"small\">â€¢ çŠ¶æ€: {healthData.status}</Text>\r\n              <Text fontSize=\"small\">â€¢ åŠŸèƒ½: {healthData.features?.join(', ')}</Text>\r\n              <Text fontSize=\"small\">â€¢ æ›´æ–°æ—¶é—´: {new Date(healthData.timestamp).toLocaleString('zh-CN')}</Text>\r\n            </Box>\r\n          )}\r\n        </Box>\r\n      </Card>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default TemporalManagementSimple;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/TemporalVerificationPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedOrgCode' is assigned a value but never used.","line":96,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2773,2776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2773,2776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * å®Œå…¨ç‹¬ç«‹çš„æ—¶æ€ç®¡ç†éªŒè¯é¡µé¢\r\n * ä¸ä¾èµ–ä»»ä½•æœ‰é—®é¢˜çš„Canvas Kit Badgeç»„ä»¶\r\n */\r\nimport React, { useState, useCallback, useEffect } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { colors, space } from '@workday/canvas-kit-react/tokens';\r\n\r\n// æ¨¡æ‹Ÿçš„ç»„ç»‡åˆ—è¡¨æ•°æ®\r\nconst mockOrganizations = [\r\n  {\r\n    code: '1000056',\r\n    name: 'æµ‹è¯•æ›´æ–°ç¼“å­˜_åŒæ­¥ä¿®å¤',\r\n    unit_type: 'DEPARTMENT',\r\n    status: 'ACTIVE',\r\n    level: 1,\r\n    effective_date: '2025-08-10'\r\n  },\r\n  {\r\n    code: '1000057',\r\n    name: 'äººåŠ›èµ„æºéƒ¨',\r\n    unit_type: 'DEPARTMENT',\r\n    status: 'ACTIVE',\r\n    level: 2,\r\n    effective_date: '2025-01-01'\r\n  },\r\n  {\r\n    code: '1000058',\r\n    name: 'è´¢åŠ¡éƒ¨',\r\n    unit_type: 'DEPARTMENT',\r\n    status: 'ACTIVE',\r\n    level: 2,\r\n    effective_date: '2025-01-01'\r\n  },\r\n  {\r\n    code: '1000059',\r\n    name: 'è®¡åˆ’é¡¹ç›®ç»„',\r\n    unit_type: 'PROJECT_TEAM',\r\n    status: 'PLANNED',\r\n    level: 3,\r\n    effective_date: '2025-09-01'\r\n  }\r\n];\r\n\r\n// ç®€å•çš„Badgeç»„ä»¶å®ç°\r\ninterface SimpleBadgeProps {\r\n  children: React.ReactNode;\r\n  variant?: 'positive' | 'caution' | 'neutral';\r\n  size?: 'small' | 'medium';\r\n}\r\n\r\nconst SimpleBadge: React.FC<SimpleBadgeProps> = ({ children, variant = 'neutral', size = 'medium' }) => {\r\n  const getVariantStyles = (variant: string) => {\r\n    switch (variant) {\r\n      case 'positive':\r\n        return { backgroundColor: '#d1f2eb', color: '#1e8449', border: '1px solid #58d68d' };\r\n      case 'caution':\r\n        return { backgroundColor: '#fef9e7', color: '#b7950b', border: '1px solid #f4d03f' };\r\n      default:\r\n        return { backgroundColor: '#f8f9fa', color: '#6c757d', border: '1px solid #dee2e6' };\r\n    }\r\n  };\r\n\r\n  const getSizeStyles = (size: string) => {\r\n    switch (size) {\r\n      case 'small':\r\n        return { padding: '2px 6px', fontSize: '11px' };\r\n      default:\r\n        return { padding: '4px 8px', fontSize: '12px' };\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'inline-block',\r\n        borderRadius: '4px',\r\n        ...getVariantStyles(variant),\r\n        ...getSizeStyles(size)\r\n      }}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * ç‹¬ç«‹ç‰ˆæ—¶æ€ç®¡ç†éªŒè¯é¡µé¢\r\n */\r\nexport const TemporalVerificationPage: React.FC = () => {\r\n  // çŠ¶æ€ç®¡ç†\r\n  const [selectedOrgCode, setSelectedOrgCode] = useState<string | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [temporalServiceStatus, setTemporalServiceStatus] = useState<'checking' | 'healthy' | 'error' | 'unknown'>('checking');\r\n  const [healthData, setHealthData] = useState<any>(null);\r\n\r\n  // æ£€æŸ¥æ—¶æ€æœåŠ¡å¥åº·çŠ¶æ€\r\n  useEffect(() => {\r\n    const checkTemporalHealth = async () => {\r\n      try {\r\n        const response = await fetch('http://localhost:9091/health');\r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          setHealthData(data);\r\n          setTemporalServiceStatus('healthy');\r\n        } else {\r\n          setTemporalServiceStatus('error');\r\n        }\r\n      } catch (error) {\r\n        console.log('æ—¶æ€æœåŠ¡è¿æ¥å¤±è´¥:', error);\r\n        setTemporalServiceStatus('unknown');\r\n      }\r\n    };\r\n\r\n    checkTemporalHealth();\r\n  }, []);\r\n\r\n  // è¿‡æ»¤ç»„ç»‡åˆ—è¡¨\r\n  const filteredOrganizations = mockOrganizations.filter(org =>\r\n    org.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    org.code.includes(searchTerm)\r\n  );\r\n\r\n  // å¤„ç†æŸ¥çœ‹è¯¦æƒ…\r\n  const handleViewDetails = useCallback(async (orgCode: string) => {\r\n    setSelectedOrgCode(orgCode);\r\n    \r\n    // å°è¯•æŸ¥è¯¢æ—¶æ€API\r\n    try {\r\n      const response = await fetch(`http://localhost:9091/api/v1/organization-units/${orgCode}`, {\r\n        headers: {\r\n          'X-Tenant-ID': '3b99930c-4dc6-4cc9-8e4d-7d960a931cb9'\r\n        }\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        alert(`âœ… æ—¶æ€æŸ¥è¯¢æˆåŠŸ!\\n\\nç»„ç»‡ä»£ç : ${orgCode}\\næŸ¥è¯¢ç»“æœ: ${JSON.stringify(data, null, 2)}`);\r\n      } else {\r\n        alert(`âš ï¸ æ—¶æ€æŸ¥è¯¢å¤±è´¥\\n\\nç»„ç»‡ä»£ç : ${orgCode}\\nHTTPçŠ¶æ€: ${response.status}\\n\\nè¿™å¯èƒ½æ˜¯å› ä¸ºè¯¥ç»„ç»‡åœ¨æ—¶æ€æ•°æ®åº“ä¸­ä¸å­˜åœ¨ã€‚`);\r\n      }\r\n    } catch (error) {\r\n      alert(`âŒ æ—¶æ€æœåŠ¡è¿æ¥å¤±è´¥\\n\\né”™è¯¯: ${error}\\n\\nè¯·ç¡®ä¿æ—¶æ€æœåŠ¡æ­£åœ¨è¿è¡Œ (ç«¯å£9091)`);\r\n    }\r\n  }, []);\r\n\r\n  // å¤„ç†æµ‹è¯•æ—¶æ€äº‹ä»¶åˆ›å»º\r\n  const handleTestEventCreation = useCallback(async () => {\r\n    const testOrgCode = '1000056';\r\n    const eventData = {\r\n      event_type: 'UPDATE',\r\n      effective_date: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(), // æ˜å¤©\r\n      change_data: {\r\n        description: 'å‰ç«¯éªŒè¯æµ‹è¯•æ›´æ–°æè¿°'\r\n      },\r\n      change_reason: 'å‰ç«¯é¡µé¢éªŒè¯æµ‹è¯•'\r\n    };\r\n\r\n    try {\r\n      const response = await fetch(`http://localhost:9091/api/v1/organization-units/${testOrgCode}/events`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'X-Tenant-ID': '3b99930c-4dc6-4cc9-8e4d-7d960a931cb9',\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(eventData)\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        alert(`âœ… æ—¶æ€äº‹ä»¶åˆ›å»ºæˆåŠŸ!\\n\\näº‹ä»¶ID: ${data.event_id}\\näº‹ä»¶ç±»å‹: ${data.event_type}\\nçŠ¶æ€: ${data.status}`);\r\n      } else {\r\n        const errorText = await response.text();\r\n        alert(`âš ï¸ æ—¶æ€äº‹ä»¶åˆ›å»ºå¤±è´¥\\n\\nHTTPçŠ¶æ€: ${response.status}\\né”™è¯¯ä¿¡æ¯: ${errorText}`);\r\n      }\r\n    } catch (error) {\r\n      alert(`âŒ æ—¶æ€æœåŠ¡è¿æ¥å¤±è´¥\\n\\né”™è¯¯: ${error}`);\r\n    }\r\n  }, []);\r\n\r\n  // è·å–çŠ¶æ€æ ‡ç­¾\r\n  const getStatusLabel = (status: string) => {\r\n    switch (status) {\r\n      case 'ACTIVE': return 'å¯ç”¨';\r\n      case 'PLANNED': return 'è®¡åˆ’ä¸­';\r\n      case 'INACTIVE': return 'åœç”¨';\r\n      default: return status;\r\n    }\r\n  };\r\n\r\n  // è·å–çŠ¶æ€å˜ä½“\r\n  const getStatusVariant = (status: string) => {\r\n    switch (status) {\r\n      case 'ACTIVE': return 'positive';\r\n      case 'PLANNED': return 'caution';\r\n      case 'INACTIVE': return 'neutral';\r\n      default: return 'neutral';\r\n    }\r\n  };\r\n\r\n  // è·å–ç±»å‹æ ‡ç­¾\r\n  const getTypeLabel = (type: string) => {\r\n    switch (type) {\r\n      case 'COMPANY': return 'å…¬å¸';\r\n      case 'DEPARTMENT': return 'éƒ¨é—¨';\r\n      case 'COST_CENTER': return 'æˆæœ¬ä¸­å¿ƒ';\r\n      case 'PROJECT_TEAM': return 'é¡¹ç›®å›¢é˜Ÿ';\r\n      default: return type;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box padding={space.l}>\r\n      {/* é¡µé¢æ ‡é¢˜å’Œæ—¶æ€æœåŠ¡çŠ¶æ€ */}\r\n      <Box marginBottom={space.l}>\r\n        <Flex alignItems=\"center\" justifyContent=\"space-between\" marginBottom={space.m}>\r\n          <Text fontSize=\"xl\" fontWeight=\"bold\">\r\n            ğŸ§ª æ—¶æ€ç®¡ç†å‰ç«¯é¡µé¢éªŒè¯\r\n          </Text>\r\n          \r\n          <Flex alignItems=\"center\" gap={space.s}>\r\n            {temporalServiceStatus === 'checking' ? (\r\n              <Text fontSize=\"small\">æ£€æŸ¥æ—¶æ€æœåŠ¡...</Text>\r\n            ) : temporalServiceStatus === 'healthy' ? (\r\n              <SimpleBadge variant=\"positive\">\r\n                æ—¶æ€æœåŠ¡: æ­£å¸¸ âœ…\r\n              </SimpleBadge>\r\n            ) : temporalServiceStatus === 'error' ? (\r\n              <SimpleBadge variant=\"neutral\">\r\n                æ—¶æ€æœåŠ¡: å¼‚å¸¸ âŒ\r\n              </SimpleBadge>\r\n            ) : (\r\n              <SimpleBadge variant=\"caution\">\r\n                æ—¶æ€æœåŠ¡: æœªè¿æ¥ âš ï¸\r\n              </SimpleBadge>\r\n            )}\r\n          </Flex>\r\n        </Flex>\r\n\r\n        <Text fontSize=\"medium\" color={colors.licorice600}>\r\n          éªŒè¯æ—¶æ€ç®¡ç†åŠŸèƒ½çš„å®Œæ•´å‰ç«¯ç•Œé¢ - ç‚¹å‡»\"æŸ¥çœ‹è¯¦æƒ…\"æµ‹è¯•APIè¿æ¥ï¼Œç‚¹å‡»\"æµ‹è¯•äº‹ä»¶åˆ›å»º\"éªŒè¯å†™å…¥æ“ä½œ\r\n        </Text>\r\n      </Box>\r\n\r\n      {/* æ—¶æ€æœåŠ¡æµ‹è¯•æŒ‰é’® */}\r\n      <Card marginBottom={space.l} padding={space.m}>\r\n        <Flex alignItems=\"center\" justifyContent=\"space-between\" marginBottom={space.m}>\r\n          <Box>\r\n            <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.xs}>\r\n              æ—¶æ€APIæµ‹è¯•åŠŸèƒ½\r\n            </Text>\r\n            <Text fontSize=\"small\" color={colors.licorice600}>\r\n              ç›´æ¥æµ‹è¯•ä¸æ—¶æ€ç®¡ç†æœåŠ¡çš„è¿æ¥\r\n            </Text>\r\n          </Box>\r\n          \r\n          <Flex gap={space.s}>\r\n            <SecondaryButton onClick={() => window.location.reload()}>\r\n              åˆ·æ–°çŠ¶æ€\r\n            </SecondaryButton>\r\n            <PrimaryButton onClick={handleTestEventCreation}>\r\n              æµ‹è¯•äº‹ä»¶åˆ›å»º\r\n            </PrimaryButton>\r\n          </Flex>\r\n        </Flex>\r\n        \r\n        {/* æœåŠ¡çŠ¶æ€è¯¦æƒ… */}\r\n        {healthData && (\r\n          <Box padding={space.s} backgroundColor={colors.soap100} borderRadius=\"4px\">\r\n            <Text fontSize=\"small\" fontWeight=\"bold\">æœåŠ¡è¯¦æƒ…:</Text>\r\n            <Text fontSize=\"small\">â€¢ æœåŠ¡å: {healthData.service}</Text>\r\n            <Text fontSize=\"small\">â€¢ çŠ¶æ€: {healthData.status}</Text>\r\n            <Text fontSize=\"small\">â€¢ åŠŸèƒ½: {healthData.features?.join(', ')}</Text>\r\n            <Text fontSize=\"small\">â€¢ æ—¶é—´: {new Date(healthData.timestamp).toLocaleString('zh-CN')}</Text>\r\n          </Box>\r\n        )}\r\n      </Card>\r\n\r\n      {/* æœç´¢å’Œæ“ä½œæ  */}\r\n      <Card marginBottom={space.l} padding={space.m}>\r\n        <Flex alignItems=\"center\" justifyContent=\"space-between\">\r\n          <Box flex=\"1\" marginRight={space.m}>\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>\r\n              æœç´¢ç»„ç»‡\r\n            </Text>\r\n            <TextInput\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              placeholder=\"è¾“å…¥ç»„ç»‡åç§°æˆ–ä»£ç ...\"\r\n            />\r\n          </Box>\r\n\r\n          <Box>\r\n            <PrimaryButton onClick={() => alert('æ–°å¢ç»„ç»‡åŠŸèƒ½æ¼”ç¤º\\n\\nå®é™…åœºæ™¯ä¸­è¿™é‡Œä¼šæ‰“å¼€æ–°å¢ç»„ç»‡å¯¹è¯æ¡†')}>\r\n              æ–°å¢ç»„ç»‡\r\n            </PrimaryButton>\r\n          </Box>\r\n        </Flex>\r\n      </Card>\r\n\r\n      {/* ç»„ç»‡åˆ—è¡¨ */}\r\n      <Card padding={space.m}>\r\n        <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n          ğŸ“‹ ç»„ç»‡åˆ—è¡¨ ({filteredOrganizations.length} ä¸ª)\r\n        </Text>\r\n\r\n        {filteredOrganizations.length === 0 ? (\r\n          <Box \r\n            padding={space.l} \r\n            textAlign=\"center\" \r\n            backgroundColor={colors.soap100}\r\n          >\r\n            <Text>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç»„ç»‡</Text>\r\n          </Box>\r\n        ) : (\r\n          <div style={{ overflowX: 'auto' }}>\r\n            <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n              <thead>\r\n                <tr style={{ backgroundColor: colors.soap100 }}>\r\n                  <th style={{ padding: '12px 8px', textAlign: 'left', borderBottom: '2px solid #dee2e6' }}>ç»„ç»‡ä»£ç </th>\r\n                  <th style={{ padding: '12px 8px', textAlign: 'left', borderBottom: '2px solid #dee2e6' }}>ç»„ç»‡åç§°</th>\r\n                  <th style={{ padding: '12px 8px', textAlign: 'left', borderBottom: '2px solid #dee2e6' }}>ç±»å‹</th>\r\n                  <th style={{ padding: '12px 8px', textAlign: 'left', borderBottom: '2px solid #dee2e6' }}>çŠ¶æ€</th>\r\n                  <th style={{ padding: '12px 8px', textAlign: 'left', borderBottom: '2px solid #dee2e6' }}>å±‚çº§</th>\r\n                  <th style={{ padding: '12px 8px', textAlign: 'left', borderBottom: '2px solid #dee2e6' }}>ç”Ÿæ•ˆæ—¥æœŸ</th>\r\n                  <th style={{ padding: '12px 8px', textAlign: 'left', borderBottom: '2px solid #dee2e6' }}>æ“ä½œ</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {filteredOrganizations.map((org, index) => (\r\n                  <tr \r\n                    key={org.code} \r\n                    style={{ \r\n                      borderBottom: '1px solid #f8f9fa',\r\n                      backgroundColor: index % 2 === 0 ? 'transparent' : colors.soap50\r\n                    }}\r\n                  >\r\n                    <td style={{ padding: '12px 8px', fontFamily: 'monospace', fontWeight: 'bold' }}>\r\n                      {org.code}\r\n                    </td>\r\n                    <td style={{ padding: '12px 8px', fontWeight: '500' }}>\r\n                      {org.name}\r\n                    </td>\r\n                    <td style={{ padding: '12px 8px' }}>\r\n                      {getTypeLabel(org.unit_type)}\r\n                    </td>\r\n                    <td style={{ padding: '12px 8px' }}>\r\n                      <SimpleBadge variant={getStatusVariant(org.status)} size=\"small\">\r\n                        {getStatusLabel(org.status)}\r\n                      </SimpleBadge>\r\n                    </td>\r\n                    <td style={{ padding: '12px 8px' }}>\r\n                      <span style={{ \r\n                        backgroundColor: colors.blueberry100, \r\n                        padding: '2px 6px', \r\n                        borderRadius: '3px',\r\n                        fontSize: '11px'\r\n                      }}>\r\n                        L{org.level}\r\n                      </span>\r\n                    </td>\r\n                    <td style={{ padding: '12px 8px', fontSize: '14px' }}>\r\n                      {new Date(org.effective_date).toLocaleDateString('zh-CN')}\r\n                    </td>\r\n                    <td style={{ padding: '12px 8px' }}>\r\n                      <SecondaryButton\r\n                        size=\"small\"\r\n                        onClick={() => handleViewDetails(org.code)}\r\n                      >\r\n                        ğŸ” æŸ¥çœ‹è¯¦æƒ…\r\n                      </SecondaryButton>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </Card>\r\n\r\n      {/* éªŒè¯ç»“æœæ€»ç»“ */}\r\n      <Card marginTop={space.l} padding={space.m} backgroundColor={colors.frenchVanilla100}>\r\n        <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n          âœ… å‰ç«¯é¡µé¢éªŒè¯æˆåŠŸ\r\n        </Text>\r\n        \r\n        <Box as=\"ul\" marginLeft={space.m}>\r\n          <Box as=\"li\" marginBottom={space.s}>\r\n            <Text fontSize=\"small\">\r\n              <strong>âœ… é¡µé¢åŠ è½½</strong>: æ—¶æ€ç®¡ç†å‰ç«¯ç•Œé¢æˆåŠŸåŠ è½½ï¼Œæ— ä¾èµ–é”™è¯¯\r\n            </Text>\r\n          </Box>\r\n          <Box as=\"li\" marginBottom={space.s}>\r\n            <Text fontSize=\"small\">\r\n              <strong>âœ… æœåŠ¡è¿æ¥</strong>: è‡ªåŠ¨æ£€æµ‹æ—¶æ€æœåŠ¡å¥åº·çŠ¶æ€ (ç«¯å£9091)\r\n            </Text>\r\n          </Box>\r\n          <Box as=\"li\" marginBottom={space.s}>\r\n            <Text fontSize=\"small\">\r\n              <strong>âœ… æ•°æ®å±•ç¤º</strong>: ç»„ç»‡åˆ—è¡¨æ•°æ®æ­£ç¡®æ˜¾ç¤ºï¼Œæ”¯æŒæœç´¢åŠŸèƒ½\r\n            </Text>\r\n          </Box>\r\n          <Box as=\"li\" marginBottom={space.s}>\r\n            <Text fontSize=\"small\">\r\n              <strong>âœ… äº¤äº’åŠŸèƒ½</strong>: æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®å¯è§¦å‘æ—¶æ€APIæŸ¥è¯¢\r\n            </Text>\r\n          </Box>\r\n          <Box as=\"li\">\r\n            <Text fontSize=\"small\">\r\n              <strong>âœ… äº‹ä»¶åˆ›å»º</strong>: æ”¯æŒæµ‹è¯•æ—¶æ€äº‹ä»¶åˆ›å»ºåŠŸèƒ½ (UPDATEäº‹ä»¶)\r\n            </Text>\r\n          </Box>\r\n        </Box>\r\n\r\n        <Box marginTop={space.m} padding={space.s} backgroundColor=\"white\" borderRadius=\"4px\" border=\"1px solid #e3e3e3\">\r\n          <Text fontSize=\"small\" fontWeight=\"bold\" color={colors.greenApple600}>\r\n            ğŸ‰ éªŒè¯ç»“è®º: æ—¶æ€ç®¡ç†å‰ç«¯é¡µé¢å·²æˆåŠŸå®ç°å¹¶å¯æ­£å¸¸ä½¿ç”¨!\r\n          </Text>\r\n        </Box>\r\n      </Card>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default TemporalVerificationPage;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/DateTimePicker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SystemIcon' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'updateCustomInput'. Either include it or remove the dependency array.","line":136,"column":6,"nodeType":"ArrayExpression","endLine":136,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [selectedTime, updateCustomInput]","fix":{"range":[3829,3843],"text":"[selectedTime, updateCustomInput]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'updateCustomInput'. Either include it or remove the dependency array.","line":142,"column":6,"nodeType":"ArrayExpression","endLine":142,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [selectedDate, updateCustomInput]","fix":{"range":[3999,4013],"text":"[selectedDate, updateCustomInput]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶é—´æ—¥æœŸé€‰æ‹©å™¨ç»„ä»¶\r\n * ç”¨äºé€‰æ‹©å†å²æŸ¥çœ‹æ—¶ç‚¹å’Œæ—¶é—´èŒƒå›´\r\n */\r\nimport React, { useState, useCallback, useEffect } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { Modal } from '@workday/canvas-kit-react/modal';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { SystemIcon } from '@workday/canvas-kit-react/icon';\r\nimport { colors, space, borderRadius } from '@workday/canvas-kit-react/tokens';\r\n\r\nexport interface DateTimePickerProps {\r\n  /** æ˜¯å¦æ˜¾ç¤ºå¼¹çª— */\r\n  isOpen: boolean;\r\n  /** å…³é—­å›è°ƒ */\r\n  onClose: () => void;\r\n  /** æ—¥æœŸé€‰æ‹©å›è°ƒ */\r\n  onSelect: (dateTime: string) => void;\r\n  /** é»˜è®¤æ—¥æœŸ */\r\n  defaultDate?: string;\r\n  /** æ ‡é¢˜ */\r\n  title?: string;\r\n  /** æ˜¯å¦æ˜¾ç¤ºæ—¶é—´é€‰æ‹© */\r\n  showTime?: boolean;\r\n  /** æ˜¯å¦æ˜¾ç¤ºé¢„è®¾é€‰é¡¹ */\r\n  showPresets?: boolean;\r\n  /** æœ€å°æ—¥æœŸ */\r\n  minDate?: string;\r\n  /** æœ€å¤§æ—¥æœŸ */\r\n  maxDate?: string;\r\n}\r\n\r\n/**\r\n * æ—¶é—´æ—¥æœŸé€‰æ‹©å™¨ç»„ä»¶\r\n */\r\nexport const DateTimePicker: React.FC<DateTimePickerProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onSelect,\r\n  defaultDate,\r\n  title = 'é€‰æ‹©æ—¥æœŸæ—¶é—´',\r\n  showTime = true,\r\n  showPresets = true,\r\n  minDate,\r\n  maxDate\r\n}) => {\r\n  const [selectedDate, setSelectedDate] = useState('');\r\n  const [selectedTime, setSelectedTime] = useState('');\r\n  const [customInput, setCustomInput] = useState('');\r\n\r\n  // åˆå§‹åŒ–æ—¥æœŸæ—¶é—´\r\n  useEffect(() => {\r\n    if (defaultDate) {\r\n      try {\r\n        const date = new Date(defaultDate);\r\n        setSelectedDate(date.toISOString().split('T')[0]);\r\n        setSelectedTime(date.toTimeString().slice(0, 5));\r\n        setCustomInput(defaultDate);\r\n      } catch {\r\n        // å¦‚æœé»˜è®¤æ—¥æœŸæ— æ•ˆï¼Œä½¿ç”¨å½“å‰æ—¶é—´\r\n        const now = new Date();\r\n        setSelectedDate(now.toISOString().split('T')[0]);\r\n        setSelectedTime(now.toTimeString().slice(0, 5));\r\n      }\r\n    } else {\r\n      const now = new Date();\r\n      setSelectedDate(now.toISOString().split('T')[0]);\r\n      setSelectedTime(now.toTimeString().slice(0, 5));\r\n    }\r\n  }, [defaultDate]);\r\n\r\n  // é¢„è®¾é€‰é¡¹\r\n  const presetOptions = [\r\n    {\r\n      label: 'ç°åœ¨',\r\n      value: () => new Date().toISOString(),\r\n      description: 'å½“å‰æ—¶é—´'\r\n    },\r\n    {\r\n      label: 'ä»Šå¤©å¼€å§‹',\r\n      value: () => {\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        return today.toISOString();\r\n      },\r\n      description: 'ä»Šå¤© 00:00'\r\n    },\r\n    {\r\n      label: '1å°æ—¶å‰',\r\n      value: () => new Date(Date.now() - 60 * 60 * 1000).toISOString(),\r\n      description: '1å°æ—¶å‰'\r\n    },\r\n    {\r\n      label: '1å¤©å‰',\r\n      value: () => new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),\r\n      description: 'æ˜¨å¤©æ­¤æ—¶'\r\n    },\r\n    {\r\n      label: '1å‘¨å‰',\r\n      value: () => new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),\r\n      description: 'ä¸Šå‘¨æ­¤æ—¶'\r\n    },\r\n    {\r\n      label: '1ä¸ªæœˆå‰',\r\n      value: () => new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),\r\n      description: 'ä¸Šä¸ªæœˆæ­¤æ—¶'\r\n    },\r\n    {\r\n      label: '3ä¸ªæœˆå‰',\r\n      value: () => new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString(),\r\n      description: '3ä¸ªæœˆå‰æ­¤æ—¶'\r\n    },\r\n    {\r\n      label: '1å¹´å‰',\r\n      value: () => new Date(Date.now() - 365 * 24 * 60 * 60 * 1000).toISOString(),\r\n      description: 'å»å¹´æ­¤æ—¶'\r\n    }\r\n  ];\r\n\r\n  // å¤„ç†é¢„è®¾é€‰é¡¹ç‚¹å‡»\r\n  const handlePresetClick = useCallback((preset: typeof presetOptions[0]) => {\r\n    const dateTime = preset.value();\r\n    const date = new Date(dateTime);\r\n    setSelectedDate(date.toISOString().split('T')[0]);\r\n    setSelectedTime(date.toTimeString().slice(0, 5));\r\n    setCustomInput(dateTime);\r\n  }, []);\r\n\r\n  // å¤„ç†æ—¥æœŸå˜æ›´\r\n  const handleDateChange = useCallback((date: string) => {\r\n    setSelectedDate(date);\r\n    updateCustomInput(date, selectedTime);\r\n  }, [selectedTime]);\r\n\r\n  // å¤„ç†æ—¶é—´å˜æ›´\r\n  const handleTimeChange = useCallback((time: string) => {\r\n    setSelectedTime(time);\r\n    updateCustomInput(selectedDate, time);\r\n  }, [selectedDate]);\r\n\r\n  // æ›´æ–°è‡ªå®šä¹‰è¾“å…¥\r\n  const updateCustomInput = useCallback((date: string, time: string) => {\r\n    if (date) {\r\n      const dateTime = showTime && time ? `${date}T${time}:00.000Z` : `${date}T00:00:00.000Z`;\r\n      setCustomInput(dateTime);\r\n    }\r\n  }, [showTime]);\r\n\r\n  // å¤„ç†è‡ªå®šä¹‰è¾“å…¥å˜æ›´\r\n  const handleCustomInputChange = useCallback((value: string) => {\r\n    setCustomInput(value);\r\n    \r\n    // å°è¯•è§£ææ—¥æœŸæ—¶é—´\r\n    try {\r\n      const date = new Date(value);\r\n      if (!isNaN(date.getTime())) {\r\n        setSelectedDate(date.toISOString().split('T')[0]);\r\n        setSelectedTime(date.toTimeString().slice(0, 5));\r\n      }\r\n    } catch {\r\n      // å¿½ç•¥è§£æé”™è¯¯\r\n    }\r\n  }, []);\r\n\r\n  // å¤„ç†ç¡®è®¤é€‰æ‹©\r\n  const handleConfirm = useCallback(() => {\r\n    try {\r\n      let dateTime: string;\r\n      \r\n      if (customInput) {\r\n        // éªŒè¯è‡ªå®šä¹‰è¾“å…¥\r\n        const date = new Date(customInput);\r\n        if (isNaN(date.getTime())) {\r\n          throw new Error('æ— æ•ˆçš„æ—¥æœŸæ—¶é—´æ ¼å¼');\r\n        }\r\n        dateTime = date.toISOString();\r\n      } else {\r\n        // ä»é€‰æ‹©çš„æ—¥æœŸæ—¶é—´æ„å»º\r\n        const dateTimeStr = showTime && selectedTime \r\n          ? `${selectedDate}T${selectedTime}:00.000Z`\r\n          : `${selectedDate}T00:00:00.000Z`;\r\n        dateTime = new Date(dateTimeStr).toISOString();\r\n      }\r\n\r\n      // éªŒè¯æ—¥æœŸèŒƒå›´\r\n      if (minDate && new Date(dateTime) < new Date(minDate)) {\r\n        throw new Error('é€‰æ‹©çš„æ—¥æœŸæ—¶é—´æ—©äºæœ€å°å…è®¸æ—¥æœŸ');\r\n      }\r\n      \r\n      if (maxDate && new Date(dateTime) > new Date(maxDate)) {\r\n        throw new Error('é€‰æ‹©çš„æ—¥æœŸæ—¶é—´æ™šäºæœ€å¤§å…è®¸æ—¥æœŸ');\r\n      }\r\n\r\n      onSelect(dateTime);\r\n    } catch (error) {\r\n      alert(error instanceof Error ? error.message : 'æ—¥æœŸæ—¶é—´é€‰æ‹©é”™è¯¯');\r\n    }\r\n  }, [customInput, selectedDate, selectedTime, showTime, minDate, maxDate, onSelect]);\r\n\r\n  // æ ¼å¼åŒ–æ˜¾ç¤ºæ—¶é—´\r\n  const formatPreviewTime = (dateTimeStr: string) => {\r\n    try {\r\n      const date = new Date(dateTimeStr);\r\n      return date.toLocaleString('zh-CN', {\r\n        year: 'numeric',\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        second: '2-digit'\r\n      });\r\n    } catch {\r\n      return dateTimeStr;\r\n    }\r\n  };\r\n\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Modal onClose={onClose}>\r\n      <Card \r\n        padding={space.l}\r\n        minWidth=\"500px\"\r\n        maxWidth=\"600px\"\r\n      >\r\n        <Box marginBottom={space.m}>\r\n          <Text fontSize=\"large\" fontWeight=\"bold\">\r\n            {title}\r\n          </Text>\r\n        </Box>\r\n\r\n        <Flex gap={space.l}>\r\n          {/* é¢„è®¾é€‰é¡¹ */}\r\n          {showPresets && (\r\n            <Box flex=\"1\">\r\n              <Text fontSize=\"medium\" fontWeight=\"medium\" marginBottom={space.s}>\r\n                å¿«é€Ÿé€‰æ‹©\r\n              </Text>\r\n              <Box\r\n                backgroundColor={colors.soap100}\r\n                borderRadius={borderRadius.m}\r\n                padding={space.s}\r\n                maxHeight=\"300px\"\r\n                overflow=\"auto\"\r\n              >\r\n                {presetOptions.map((preset, index) => (\r\n                  <SecondaryButton\r\n                    key={index}\r\n                    variant=\"plain\"\r\n                    size=\"small\"\r\n                    onClick={() => handlePresetClick(preset)}\r\n                    style={{\r\n                      display: 'block',\r\n                      width: '100%',\r\n                      textAlign: 'left',\r\n                      marginBottom: space.xxxs,\r\n                      padding: space.xs\r\n                    }}\r\n                  >\r\n                    <Flex justifyContent=\"space-between\" alignItems=\"center\">\r\n                      <Text fontSize=\"small\" fontWeight=\"medium\">\r\n                        {preset.label}\r\n                      </Text>\r\n                      <Text fontSize=\"small\" color={colors.licorice500}>\r\n                        {preset.description}\r\n                      </Text>\r\n                    </Flex>\r\n                  </SecondaryButton>\r\n                ))}\r\n              </Box>\r\n            </Box>\r\n          )}\r\n\r\n          <Divider orientation=\"vertical\" />\r\n\r\n          {/* è‡ªå®šä¹‰é€‰æ‹© */}\r\n          <Box flex=\"1\">\r\n            <Text fontSize=\"medium\" fontWeight=\"medium\" marginBottom={space.s}>\r\n              è‡ªå®šä¹‰é€‰æ‹©\r\n            </Text>\r\n            \r\n            <Box marginBottom={space.m}>\r\n              <Text fontSize=\"small\" marginBottom={space.xs}>\r\n                ğŸ“… æ—¥æœŸ\r\n              </Text>\r\n              <TextInput\r\n                type=\"date\"\r\n                value={selectedDate}\r\n                onChange={(e) => handleDateChange(e.target.value)}\r\n                min={minDate?.split('T')[0]}\r\n                max={maxDate?.split('T')[0]}\r\n              />\r\n            </Box>\r\n\r\n            {showTime && (\r\n              <Box marginBottom={space.m}>\r\n                <Text fontSize=\"small\" marginBottom={space.xs}>\r\n                  ğŸ•°ï¸ æ—¶é—´\r\n                </Text>\r\n                <TextInput\r\n                  type=\"time\"\r\n                  value={selectedTime}\r\n                  onChange={(e) => handleTimeChange(e.target.value)}\r\n                />\r\n              </Box>\r\n            )}\r\n\r\n            <Box marginBottom={space.m}>\r\n              <Text fontSize=\"small\" marginBottom={space.xs}>\r\n                ISO 8601 æ ¼å¼ (é«˜çº§)\r\n              </Text>\r\n              <TextInput\r\n                value={customInput}\r\n                onChange={(e) => handleCustomInputChange(e.target.value)}\r\n                placeholder=\"2024-01-01T12:00:00.000Z\"\r\n              />\r\n            </Box>\r\n\r\n            {/* é¢„è§ˆ */}\r\n            {customInput && (\r\n              <Box\r\n                backgroundColor={colors.soap100}\r\n                borderRadius={borderRadius.s}\r\n                padding={space.s}\r\n                marginBottom={space.m}\r\n              >\r\n                <Text fontSize=\"small\" color={colors.licorice600}>\r\n                  é¢„è§ˆ: {formatPreviewTime(customInput)}\r\n                </Text>\r\n              </Box>\r\n            )}\r\n          </Box>\r\n        </Flex>\r\n\r\n        {/* æ“ä½œæŒ‰é’® */}\r\n        <Flex justifyContent=\"flex-end\" gap={space.s} marginTop={space.l}>\r\n          <SecondaryButton variant=\"secondary\" onClick={onClose}>\r\n            å–æ¶ˆ\r\n          </SecondaryButton>\r\n          <PrimaryButton onClick={handleConfirm}>\r\n            ç¡®è®¤é€‰æ‹©\r\n          </PrimaryButton>\r\n        </Flex>\r\n      </Card>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default DateTimePicker;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/InlineNewVersionForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/OrganizationDetailForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'borderRadius' is defined but never used.","line":14,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[969,972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[969,972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * ç»„ç»‡è¯¦æƒ…è¡¨å•ç»„ä»¶ (çº¯æ—¥æœŸç”Ÿæ•ˆæ¨¡å‹)\r\n * ç”¨äºæŸ¥çœ‹å’Œç¼–è¾‘ç»„ç»‡çš„è¯¦ç»†ä¿¡æ¯\r\n */\r\nimport React from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { TextArea } from '@workday/canvas-kit-react/text-area';\r\nimport { Select } from '@workday/canvas-kit-react/select';\r\nimport { Checkbox } from '@workday/canvas-kit-react/checkbox';\r\nimport { Badge } from '../../../shared/components/Badge';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { colors, space, borderRadius } from '@workday/canvas-kit-react/tokens';\r\nimport type { TemporalOrganizationRecord } from '../../../shared/hooks/useTemporalAPI';\r\n\r\nexport interface OrganizationDetailFormProps {\r\n  /** ç»„ç»‡è®°å½• */\r\n  record: TemporalOrganizationRecord;\r\n  /** æ˜¯å¦å¤„äºç¼–è¾‘æ¨¡å¼ */\r\n  isEditing: boolean;\r\n  /** å­—æ®µå˜æ›´å›è°ƒ */\r\n  onFieldChange: (field: keyof TemporalOrganizationRecord, value: any) => void;\r\n}\r\n\r\n/**\r\n * ç»„ç»‡è¯¦æƒ…è¡¨å•ç»„ä»¶\r\n */\r\nexport const OrganizationDetailForm: React.FC<OrganizationDetailFormProps> = ({\r\n  record,\r\n  isEditing,\r\n  onFieldChange\r\n}) => {\r\n  // ç»„ç»‡ç±»å‹é€‰é¡¹\r\n  const unitTypeOptions = [\r\n    { value: 'COMPANY', label: 'å…¬å¸' },\r\n    { value: 'DEPARTMENT', label: 'éƒ¨é—¨' },\r\n    { value: 'COST_CENTER', label: 'æˆæœ¬ä¸­å¿ƒ' },\r\n    { value: 'PROJECT_TEAM', label: 'é¡¹ç›®å›¢é˜Ÿ' },\r\n  ];\r\n\r\n  // çŠ¶æ€é€‰é¡¹\r\n  const statusOptions = [\r\n    { value: 'ACTIVE', label: 'å¯ç”¨' },\r\n    { value: 'INACTIVE', label: 'åœç”¨' },\r\n    { value: 'PLANNED', label: 'è®¡åˆ’ä¸­' },\r\n  ];\r\n\r\n  // è·å–çŠ¶æ€å¯¹åº”çš„é¢œè‰²\r\n  const getStatusBadgeVariant = (status: string) => {\r\n    switch (status) {\r\n      case 'ACTIVE': return 'positive';\r\n      case 'PLANNED': return 'caution';\r\n      case 'INACTIVE': return 'neutral';\r\n      default: return 'neutral';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box>\r\n      {/* åŸºç¡€ä¿¡æ¯å¡ç‰‡ */}\r\n      <Card marginBottom={space.l} padding={space.m}>\r\n        <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n          ğŸ“‹ åŸºç¡€ä¿¡æ¯\r\n        </Text>\r\n\r\n        <Box display=\"grid\" gridTemplateColumns=\"1fr 1fr\" gap={space.m} marginBottom={space.m}>\r\n          {/* ç»„ç»‡ä»£ç  */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              ç»„ç»‡ä»£ç \r\n            </Text>\r\n            <TextInput\r\n              value={record.code}\r\n              disabled={true}\r\n              backgroundColor={colors.soap200}\r\n            />\r\n            <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n              ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œä¸å¯ä¿®æ”¹\r\n            </Text>\r\n          </Box>\r\n\r\n          {/* ç§Ÿæˆ·ID */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              ç§Ÿæˆ·ID\r\n            </Text>\r\n            <TextInput\r\n              value={record.tenant_id}\r\n              disabled={true}\r\n              backgroundColor={colors.soap200}\r\n            />\r\n            <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n              ç³»ç»Ÿåˆ†é…çš„ç§Ÿæˆ·æ ‡è¯†\r\n            </Text>\r\n          </Box>\r\n        </Box>\r\n\r\n        <Box display=\"grid\" gridTemplateColumns=\"2fr 1fr 1fr\" gap={space.m} marginBottom={space.m}>\r\n          {/* ç»„ç»‡åç§° */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              ç»„ç»‡åç§° *\r\n            </Text>\r\n            <TextInput\r\n              value={record.name}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('name', e.target.value)}\r\n              placeholder=\"è¯·è¾“å…¥ç»„ç»‡åç§°\"\r\n            />\r\n            {isEditing && (\r\n              <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n                å¿…å¡«å­—æ®µï¼Œå»ºè®®ä½¿ç”¨ç®€æ´æ˜ç¡®çš„åç§°\r\n              </Text>\r\n            )}\r\n          </Box>\r\n\r\n          {/* ç»„ç»‡ç±»å‹ */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              ç»„ç»‡ç±»å‹ *\r\n            </Text>\r\n            <Select\r\n              value={record.unit_type}\r\n              disabled={!isEditing}\r\n              onChange={(value) => isEditing && onFieldChange('unit_type', value)}\r\n            >\r\n              {unitTypeOptions.map(option => (\r\n                <option key={option.value} value={option.value}>\r\n                  {option.label}\r\n                </option>\r\n              ))}\r\n            </Select>\r\n          </Box>\r\n\r\n          {/* çŠ¶æ€ */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              çŠ¶æ€ *\r\n            </Text>\r\n            {isEditing ? (\r\n              <Select\r\n                value={record.status}\r\n                onChange={(value) => onFieldChange('status', value)}\r\n              >\r\n                {statusOptions.map(option => (\r\n                  <option key={option.value} value={option.value}>\r\n                    {option.label}\r\n                  </option>\r\n                ))}\r\n              </Select>\r\n            ) : (\r\n              <Box paddingTop={space.xs}>\r\n                <Badge variant={getStatusBadgeVariant(record.status)}>\r\n                  {statusOptions.find(opt => opt.value === record.status)?.label || record.status}\r\n                </Badge>\r\n              </Box>\r\n            )}\r\n          </Box>\r\n        </Box>\r\n\r\n        <Box display=\"grid\" gridTemplateColumns=\"1fr 1fr 1fr\" gap={space.m} marginBottom={space.m}>\r\n          {/* å±‚çº§ */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              ç»„ç»‡å±‚çº§\r\n            </Text>\r\n            <TextInput\r\n              type=\"number\"\r\n              value={record.level.toString()}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('level', parseInt(e.target.value) || 0)}\r\n              min=\"0\"\r\n              max=\"10\"\r\n            />\r\n          </Box>\r\n\r\n          {/* æ’åºé¡ºåº */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              æ’åºé¡ºåº\r\n            </Text>\r\n            <TextInput\r\n              type=\"number\"\r\n              value={record.sort_order.toString()}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('sort_order', parseInt(e.target.value) || 0)}\r\n              min=\"0\"\r\n            />\r\n          </Box>\r\n\r\n          {/* ç»„ç»‡è·¯å¾„ */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              ç»„ç»‡è·¯å¾„\r\n            </Text>\r\n            <TextInput\r\n              value={record.path}\r\n              disabled={true}\r\n              backgroundColor={colors.soap200}\r\n            />\r\n            <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n              ç³»ç»Ÿè‡ªåŠ¨ç»´æŠ¤çš„å±‚çº§è·¯å¾„\r\n            </Text>\r\n          </Box>\r\n        </Box>\r\n\r\n        {/* æè¿° */}\r\n        <Box>\r\n          <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n            æè¿°\r\n          </Text>\r\n          <TextArea\r\n            value={record.description || ''}\r\n            disabled={!isEditing}\r\n            onChange={(e) => isEditing && onFieldChange('description', e.target.value)}\r\n            rows={3}\r\n            placeholder=\"è¯·è¾“å…¥ç»„ç»‡æè¿°ä¿¡æ¯...\"\r\n          />\r\n          {isEditing && (\r\n            <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n              å¯é€‰å­—æ®µï¼Œç”¨äºè¯´æ˜è¯¥ç»„ç»‡çš„èŒè´£å’ŒåŠŸèƒ½\r\n            </Text>\r\n          )}\r\n        </Box>\r\n      </Card>\r\n\r\n      {/* æ—¶æ€ç®¡ç†ä¿¡æ¯å¡ç‰‡ */}\r\n      <Card marginBottom={space.l} padding={space.m}>\r\n        <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n          â° æ—¶æ€ç®¡ç†ä¿¡æ¯\r\n        </Text>\r\n\r\n        <Box display=\"grid\" gridTemplateColumns=\"1fr 1fr\" gap={space.m} marginBottom={space.m}>\r\n          {/* ç”Ÿæ•ˆæ—¥æœŸ */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              ç”Ÿæ•ˆæ—¥æœŸ *\r\n            </Text>\r\n            <TextInput\r\n              type=\"date\"\r\n              value={record.effective_date?.slice(0, 10) || ''}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('effective_date', e.target.value + 'T00:00:00Z')}\r\n            />\r\n            <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n              è¯¥è®°å½•å¼€å§‹ç”Ÿæ•ˆçš„æ—¥æœŸ\r\n            </Text>\r\n          </Box>\r\n\r\n          {/* ç»“æŸæ—¥æœŸ */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              ç»“æŸæ—¥æœŸ\r\n            </Text>\r\n            <TextInput\r\n              type=\"date\"\r\n              value={record.end_date?.slice(0, 10) || ''}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('end_date', e.target.value ? e.target.value + 'T00:00:00Z' : undefined)}\r\n            />\r\n            <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n              å¯é€‰ï¼Œç•™ç©ºè¡¨ç¤ºæŒç»­æœ‰æ•ˆ\r\n            </Text>\r\n          </Box>\r\n        </Box>\r\n\r\n        {/* å½“å‰æœ‰æ•ˆçŠ¶æ€ */}\r\n        <Box marginBottom={space.m}>\r\n          <Flex alignItems=\"center\" gap={space.s}>\r\n            <Checkbox\r\n              checked={record.is_current}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('is_current', e.target.checked)}\r\n              label=\"å½“å‰æœ‰æ•ˆè®°å½•\"\r\n            />\r\n            \r\n            {record.is_current && (\r\n              <Badge variant=\"positive\" size=\"small\">\r\n                å½“å‰ç”Ÿæ•ˆ\r\n              </Badge>\r\n            )}\r\n          </Flex>\r\n          <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n            æ ‡è¯†è¯¥è®°å½•æ˜¯å¦ä¸ºå½“å‰æœ‰æ•ˆçš„ç‰ˆæœ¬\r\n          </Text>\r\n        </Box>\r\n\r\n        {/* å˜æ›´åŸå›  */}\r\n        <Box>\r\n          <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n            å˜æ›´åŸå› \r\n          </Text>\r\n          <TextArea\r\n            value={record.change_reason || ''}\r\n            disabled={!isEditing}\r\n            onChange={(e) => isEditing && onFieldChange('change_reason', e.target.value)}\r\n            rows={2}\r\n            placeholder=\"è¯·è¾“å…¥å˜æ›´åŸå› ...\"\r\n          />\r\n          <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n            è®°å½•æœ¬æ¬¡å˜æ›´çš„å…·ä½“åŸå› ï¼Œä¾¿äºåç»­å®¡è®¡è¿½è¸ª\r\n          </Text>\r\n        </Box>\r\n      </Card>\r\n\r\n      {/* ç³»ç»Ÿä¿¡æ¯å¡ç‰‡ */}\r\n      <Card marginBottom={space.l} padding={space.m}>\r\n        <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n          ğŸ” ç³»ç»Ÿä¿¡æ¯\r\n        </Text>\r\n\r\n        <Box display=\"grid\" gridTemplateColumns=\"1fr 1fr\" gap={space.m} marginBottom={space.m}>\r\n          {/* åˆ›å»ºæ—¶é—´ */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              åˆ›å»ºæ—¶é—´\r\n            </Text>\r\n            <TextInput\r\n              value={record.created_at ? new Date(record.created_at).toLocaleString('zh-CN') : ''}\r\n              disabled={true}\r\n              backgroundColor={colors.soap200}\r\n            />\r\n          </Box>\r\n\r\n          {/* æ›´æ–°æ—¶é—´ */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              æœ€åæ›´æ–°æ—¶é—´\r\n            </Text>\r\n            <TextInput\r\n              value={record.updated_at ? new Date(record.updated_at).toLocaleString('zh-CN') : ''}\r\n              disabled={true}\r\n              backgroundColor={colors.soap200}\r\n            />\r\n          </Box>\r\n        </Box>\r\n\r\n        <Box display=\"grid\" gridTemplateColumns=\"1fr 1fr\" gap={space.m}>\r\n          {/* æ‰¹å‡†äºº */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              æ‰¹å‡†äºº\r\n            </Text>\r\n            <TextInput\r\n              value={record.approved_by || 'æš‚æ— '}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('approved_by', e.target.value)}\r\n              placeholder=\"è¯·è¾“å…¥æ‰¹å‡†äºº\"\r\n            />\r\n          </Box>\r\n\r\n          {/* æ‰¹å‡†æ—¶é—´ */}\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs} fontWeight=\"medium\">\r\n              æ‰¹å‡†æ—¶é—´\r\n            </Text>\r\n            <TextInput\r\n              type=\"datetime-local\"\r\n              value={record.approved_at ? new Date(record.approved_at).toISOString().slice(0, 16) : ''}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('approved_at', e.target.value ? new Date(e.target.value).toISOString() : undefined)}\r\n            />\r\n          </Box>\r\n        </Box>\r\n      </Card>\r\n\r\n      {/* æ•°æ®æœ‰æ•ˆæ€§éªŒè¯æç¤º */}\r\n      {isEditing && (\r\n        <Card padding={space.m} backgroundColor={colors.blueberry50}>\r\n          <Text fontSize=\"small\" fontWeight=\"bold\" marginBottom={space.xs}>\r\n            ğŸ’¡ ç¼–è¾‘æç¤º\r\n          </Text>\r\n          <Box as=\"ul\" marginLeft={space.m}>\r\n            <Box as=\"li\" marginBottom={space.xs}>\r\n              <Text fontSize=\"small\">\r\n                å¸¦ * çš„å­—æ®µä¸ºå¿…å¡«é¡¹ï¼Œè¯·ç¡®ä¿å¡«å†™å®Œæ•´\r\n              </Text>\r\n            </Box>\r\n            <Box as=\"li\" marginBottom={space.xs}>\r\n              <Text fontSize=\"small\">\r\n                ç”Ÿæ•ˆæ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸ\r\n              </Text>\r\n            </Box>\r\n            <Box as=\"li\" marginBottom={space.xs}>\r\n              <Text fontSize=\"small\">\r\n                åŒä¸€ç»„ç»‡åœ¨åŒä¸€æ—¶é—´ç‚¹åªèƒ½æœ‰ä¸€ä¸ªæœ‰æ•ˆè®°å½•\r\n              </Text>\r\n            </Box>\r\n            <Box as=\"li\">\r\n              <Text fontSize=\"small\">\r\n                å˜æ›´åŸå› å°†æ˜¾ç¤ºåœ¨æ—¶é—´è½´ä¸­ï¼Œå»ºè®®å¡«å†™æ¸…æ™°çš„è¯´æ˜\r\n              </Text>\r\n            </Box>\r\n          </Box>\r\n        </Card>\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default OrganizationDetailForm;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/OrganizationDetailPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TextInput' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TextArea' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Select' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Checkbox' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":216,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6905,6908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6905,6908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * é›†æˆæ—¶æ€åŠŸèƒ½çš„ç»„ç»‡è¯¦æƒ…é¢æ¿ (çº¯æ—¥æœŸç”Ÿæ•ˆæ¨¡å‹)\r\n * å·¦ä¾§æ—¶é—´è½´ + å³ä¾§è¯¦æƒ…ç¼–è¾‘çš„å®Œæ•´éƒ¨é—¨è¯¦æƒ…é¢æ¿\r\n */\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton, TertiaryButton } from '@workday/canvas-kit-react/button';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { TextArea } from '@workday/canvas-kit-react/text-area';\r\nimport { Select } from '@workday/canvas-kit-react/select';\r\nimport { Checkbox } from '@workday/canvas-kit-react/checkbox';\r\nimport { Badge } from '../../../shared/components/Badge';\r\nimport { Tooltip } from '@workday/canvas-kit-react/tooltip';\r\nimport { colors, space, borderRadius } from '@workday/canvas-kit-react/tokens';\r\nimport { \r\n  useTemporalDateRangeQuery, \r\n  useTemporalAsOfDateQuery, \r\n  useTemporalHealth,\r\n  TemporalDateUtils,\r\n  type TemporalOrganizationRecord \r\n} from '../../../shared/hooks/useTemporalAPI';\r\nimport { OrganizationDetailForm } from './OrganizationDetailForm';\r\n\r\nexport interface OrganizationDetailPanelProps {\r\n  /** ç»„ç»‡ä»£ç  */\r\n  organizationCode: string;\r\n  /** æ˜¯å¦æ˜¾ç¤ºé¢æ¿ */\r\n  isOpen: boolean;\r\n  /** å…³é—­å›è°ƒ */\r\n  onClose: () => void;\r\n  /** ä¿å­˜å›è°ƒ */\r\n  onSave: (record: TemporalOrganizationRecord) => Promise<void>;\r\n  /** åˆ é™¤å›è°ƒ */\r\n  onDelete?: (organizationCode: string) => Promise<void>;\r\n}\r\n\r\n// æ—¶é—´è½´èŠ‚ç‚¹ç±»å‹\r\ninterface TimelineNode {\r\n  date: string;\r\n  displayDate: string;\r\n  type: 'current' | 'historical' | 'planned';\r\n  label: string;\r\n  record?: TemporalOrganizationRecord;\r\n  changeType?: 'created' | 'modified' | 'planned' | 'activated' | 'deactivated';\r\n}\r\n\r\n// è§†å›¾æ¨¡å¼\r\ntype ViewMode = 'view' | 'edit' | 'timeline';\r\n\r\n/**\r\n * ç»„ç»‡è¯¦æƒ…é¢æ¿ - é›†æˆæ—¶æ€æŸ¥è¯¢åŠŸèƒ½\r\n */\r\nexport const OrganizationDetailPanel: React.FC<OrganizationDetailPanelProps> = ({\r\n  organizationCode,\r\n  isOpen,\r\n  onClose,\r\n  onSave,\r\n  onDelete\r\n}) => {\r\n  // çŠ¶æ€ç®¡ç†\r\n  const [selectedDate, setSelectedDate] = useState<string>(TemporalDateUtils.today());\r\n  const [selectedRecord, setSelectedRecord] = useState<TemporalOrganizationRecord | null>(null);\r\n  const [viewMode, setViewMode] = useState<ViewMode>('view');\r\n  const [editingRecord, setEditingRecord] = useState<TemporalOrganizationRecord | null>(null);\r\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\r\n  const [isTimelineCollapsed, setIsTimelineCollapsed] = useState(false);\r\n\r\n  // æ—¶æ€æœåŠ¡å¥åº·æ£€æŸ¥\r\n  const { data: healthData } = useTemporalHealth();\r\n\r\n  // æŸ¥è¯¢è¿‡å»12ä¸ªæœˆåˆ°æœªæ¥6ä¸ªæœˆçš„æ—¶é—´èŒƒå›´\r\n  const twelveMonthsAgo = new Date();\r\n  twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);\r\n  const sixMonthsLater = new Date();\r\n  sixMonthsLater.setMonth(sixMonthsLater.getMonth() + 6);\r\n\r\n  // è·å–æ—¶é—´èŒƒå›´å†…çš„æ‰€æœ‰è®°å½•\r\n  const { data: rangeData, isLoading: isRangeLoading, error: rangeError } = useTemporalDateRangeQuery(\r\n    organizationCode,\r\n    twelveMonthsAgo.toISOString().slice(0, 10),\r\n    sixMonthsLater.toISOString().slice(0, 10),\r\n    isOpen\r\n  );\r\n\r\n  // è·å–å½“å‰é€‰ä¸­æ—¥æœŸçš„è¯¦ç»†è®°å½•\r\n  const { data: selectedData, isLoading: isSelectedLoading } = useTemporalAsOfDateQuery(\r\n    organizationCode,\r\n    selectedDate,\r\n    isOpen && !!selectedDate\r\n  );\r\n\r\n  // ç”Ÿæˆæ—¶é—´è½´èŠ‚ç‚¹\r\n  const generateTimelineNodes = useCallback((): TimelineNode[] => {\r\n    const nodes: TimelineNode[] = [];\r\n    const today = new Date();\r\n    \r\n    if (rangeData?.organizations) {\r\n      // ä¸ºæ¯ä¸ªè®°å½•åˆ›å»ºæ—¶é—´è½´èŠ‚ç‚¹\r\n      rangeData.organizations.forEach(record => {\r\n        const effectiveDate = new Date(record.effective_date);\r\n        const dateStr = record.effective_date.slice(0, 10);\r\n        \r\n        let type: 'current' | 'historical' | 'planned';\r\n        let changeType: TimelineNode['changeType'] = 'modified';\r\n        \r\n        if (effectiveDate > today) {\r\n          type = 'planned';\r\n          changeType = 'planned';\r\n        } else if (record.is_current) {\r\n          type = 'current';\r\n          changeType = record.status === 'ACTIVE' ? 'activated' : 'modified';\r\n        } else {\r\n          type = 'historical';\r\n          changeType = record.status === 'INACTIVE' ? 'deactivated' : 'modified';\r\n        }\r\n\r\n        // åˆ¤æ–­æ˜¯å¦æ˜¯åˆ›å»ºè®°å½•\r\n        if (!record.change_reason && record.created_at === record.effective_date) {\r\n          changeType = 'created';\r\n        }\r\n\r\n        nodes.push({\r\n          date: dateStr,\r\n          displayDate: formatTimelineDate(effectiveDate, today),\r\n          type,\r\n          label: record.change_reason || getDefaultLabel(changeType),\r\n          record,\r\n          changeType\r\n        });\r\n      });\r\n    }\r\n\r\n    // æ·»åŠ å½“å‰æ—¥æœŸèŠ‚ç‚¹ï¼ˆå¦‚æœæ²¡æœ‰å¯¹åº”è®°å½•ï¼‰\r\n    const todayStr = TemporalDateUtils.today();\r\n    if (!nodes.find(n => n.date === todayStr)) {\r\n      nodes.push({\r\n        date: todayStr,\r\n        displayDate: 'ä»Šå¤©',\r\n        type: 'current',\r\n        label: 'å½“å‰çŠ¶æ€',\r\n        changeType: 'modified'\r\n      });\r\n    }\r\n\r\n    // æŒ‰æ—¥æœŸå€’åºæ’åºï¼ˆæœ€æ–°çš„åœ¨ä¸Šé¢ï¼‰\r\n    return nodes.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n  }, [rangeData]);\r\n\r\n  const timelineNodes = generateTimelineNodes();\r\n\r\n  // å½“é€‰ä¸­æ—¥æœŸå˜åŒ–æ—¶ï¼Œæ›´æ–°é€‰ä¸­çš„è®°å½•\r\n  useEffect(() => {\r\n    if (selectedData?.organizations && selectedData.organizations.length > 0) {\r\n      const record = selectedData.organizations[0];\r\n      setSelectedRecord(record);\r\n      setEditingRecord({ ...record });\r\n      setHasUnsavedChanges(false);\r\n    }\r\n  }, [selectedData]);\r\n\r\n  // å¤„ç†æ—¶é—´è½´èŠ‚ç‚¹ç‚¹å‡»\r\n  const handleTimelineNodeClick = useCallback((node: TimelineNode) => {\r\n    if (hasUnsavedChanges) {\r\n      const confirmed = window.confirm('æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦åˆ‡æ¢åˆ°å…¶ä»–æ—¶é—´ç‚¹å—ï¼Ÿ');\r\n      if (!confirmed) return;\r\n    }\r\n\r\n    setSelectedDate(node.date);\r\n    setViewMode('view');\r\n    setHasUnsavedChanges(false);\r\n    \r\n    if (node.record) {\r\n      setSelectedRecord(node.record);\r\n      setEditingRecord({ ...node.record });\r\n    }\r\n  }, [hasUnsavedChanges]);\r\n\r\n  // å¤„ç†ç¼–è¾‘æ¨¡å¼åˆ‡æ¢\r\n  const handleEditModeToggle = useCallback(() => {\r\n    if (viewMode === 'edit') {\r\n      if (hasUnsavedChanges) {\r\n        const confirmed = window.confirm('æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦å–æ¶ˆç¼–è¾‘å—ï¼Ÿ');\r\n        if (!confirmed) return;\r\n      }\r\n      setViewMode('view');\r\n      setHasUnsavedChanges(false);\r\n      if (selectedRecord) {\r\n        setEditingRecord({ ...selectedRecord });\r\n      }\r\n    } else {\r\n      setViewMode('edit');\r\n    }\r\n  }, [viewMode, hasUnsavedChanges, selectedRecord]);\r\n\r\n  // å¤„ç†ä¿å­˜\r\n  const handleSave = useCallback(async () => {\r\n    if (!editingRecord) return;\r\n\r\n    try {\r\n      await onSave(editingRecord);\r\n      setSelectedRecord(editingRecord);\r\n      setViewMode('view');\r\n      setHasUnsavedChanges(false);\r\n      \r\n      // åˆ·æ–°æ—¶é—´è½´æ•°æ®\r\n      // TODO: è¿™é‡Œåº”è¯¥è§¦å‘æ•°æ®é‡æ–°è·å–\r\n    } catch (error) {\r\n      console.error('ä¿å­˜å¤±è´¥:', error);\r\n      alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');\r\n    }\r\n  }, [editingRecord, onSave]);\r\n\r\n  // å¤„ç†å­—æ®µå˜æ›´\r\n  const handleFieldChange = useCallback((field: keyof TemporalOrganizationRecord, value: any) => {\r\n    if (!editingRecord) return;\r\n    \r\n    setEditingRecord(prev => prev ? { ...prev, [field]: value } : null);\r\n    setHasUnsavedChanges(true);\r\n  }, [editingRecord]);\r\n\r\n  // å¤„ç†åˆ é™¤\r\n  const handleDelete = useCallback(async () => {\r\n    if (!onDelete || !selectedRecord) return;\r\n    \r\n    const confirmed = window.confirm(`ç¡®å®šè¦åˆ é™¤ç»„ç»‡ \"${selectedRecord.name}\" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`);\r\n    if (!confirmed) return;\r\n\r\n    try {\r\n      await onDelete(organizationCode);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('åˆ é™¤å¤±è´¥:', error);\r\n      alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');\r\n    }\r\n  }, [onDelete, selectedRecord, organizationCode, onClose]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <Box\r\n      position=\"fixed\"\r\n      top=\"0\"\r\n      left=\"0\"\r\n      right=\"0\"\r\n      bottom=\"0\"\r\n      backgroundColor=\"rgba(0, 0, 0, 0.5)\"\r\n      zIndex=\"1000\"\r\n      display=\"flex\"\r\n      alignItems=\"center\"\r\n      justifyContent=\"center\"\r\n    >\r\n      <Card\r\n        width=\"1400px\"\r\n        height=\"90vh\"\r\n        maxHeight=\"900px\"\r\n        overflow=\"hidden\"\r\n        padding=\"0\"\r\n      >\r\n        {/* æ ‡é¢˜æ  */}\r\n        <Box\r\n          padding={space.m}\r\n          backgroundColor={colors.soap200}\r\n          borderBottom={`1px solid ${colors.soap400}`}\r\n        >\r\n          <Flex alignItems=\"center\" justifyContent=\"space-between\">\r\n            <Flex alignItems=\"center\" gap={space.s}>\r\n              <Text fontSize=\"large\" fontWeight=\"bold\">\r\n                ç»„ç»‡è¯¦æƒ… - {organizationCode}\r\n              </Text>\r\n              \r\n              {/* æ—¶æ€æœåŠ¡çŠ¶æ€ */}\r\n              {healthData && (\r\n                <Badge\r\n                  variant={healthData.status === 'healthy' ? 'positive' : 'negative'}\r\n                  size=\"small\"\r\n                >\r\n                  {healthData.status === 'healthy' ? 'æ—¶æ€æœåŠ¡æ­£å¸¸' : 'æ—¶æ€æœåŠ¡å¼‚å¸¸'}\r\n                </Badge>\r\n              )}\r\n\r\n              {/* è§†å›¾æ¨¡å¼æŒ‡ç¤ºå™¨ */}\r\n              <Badge\r\n                variant={viewMode === 'edit' ? 'caution' : 'neutral'}\r\n                size=\"small\"\r\n              >\r\n                {viewMode === 'edit' ? 'ç¼–è¾‘æ¨¡å¼' : 'æŸ¥çœ‹æ¨¡å¼'}\r\n              </Badge>\r\n\r\n              {hasUnsavedChanges && (\r\n                <Badge variant=\"caution\" size=\"small\">\r\n                  æœ‰æœªä¿å­˜æ›´æ”¹\r\n                </Badge>\r\n              )}\r\n            </Flex>\r\n\r\n            <Flex alignItems=\"center\" gap={space.s}>\r\n              {/* æ—¶é—´è½´æŠ˜å æŒ‰é’® */}\r\n              <TertiaryButton\r\n                onClick={() => setIsTimelineCollapsed(!isTimelineCollapsed)}\r\n                size=\"small\"\r\n              >\r\n                {isTimelineCollapsed ? 'æ˜¾ç¤ºæ—¶é—´è½´' : 'éšè—æ—¶é—´è½´'}\r\n              </TertiaryButton>\r\n\r\n              <SecondaryButton onClick={onClose}>\r\n                å…³é—­\r\n              </SecondaryButton>\r\n            </Flex>\r\n          </Flex>\r\n        </Box>\r\n\r\n        {/* ä¸»å†…å®¹åŒºåŸŸ */}\r\n        <Flex height=\"calc(100% - 80px)\">\r\n          {/* å·¦ä¾§æ—¶é—´è½´ */}\r\n          {!isTimelineCollapsed && (\r\n            <Box\r\n              width=\"320px\"\r\n              backgroundColor={colors.frenchVanilla100}\r\n              borderRight={`1px solid ${colors.soap400}`}\r\n              overflow=\"auto\"\r\n              padding={space.m}\r\n            >\r\n              <Flex alignItems=\"center\" justifyContent=\"space-between\" marginBottom={space.m}>\r\n                <Text fontSize=\"medium\" fontWeight=\"bold\">\r\n                  æ—¶é—´è½´\r\n                </Text>\r\n                <Text fontSize=\"small\" color={colors.licorice600}>\r\n                  {timelineNodes.length} ä¸ªè®°å½•\r\n                </Text>\r\n              </Flex>\r\n\r\n              {isRangeLoading ? (\r\n                <Box display=\"flex\" alignItems=\"center\" justifyContent=\"center\" padding={space.l}>\r\n                  <Text>åŠ è½½æ—¶é—´è½´...</Text>\r\n                </Box>\r\n              ) : rangeError ? (\r\n                <Box padding={space.m} backgroundColor={colors.cinnamon100} borderRadius={borderRadius.m}>\r\n                  <Text fontSize=\"small\" color={colors.cinnamon600}>\r\n                    æ—¶é—´è½´åŠ è½½å¤±è´¥ï¼š{rangeError.message}\r\n                  </Text>\r\n                </Box>\r\n              ) : (\r\n                <Box>\r\n                  {timelineNodes.map((node, index) => (\r\n                    <TimelineNodeComponent\r\n                      key={node.date}\r\n                      node={node}\r\n                      isSelected={selectedDate === node.date}\r\n                      isLast={index === timelineNodes.length - 1}\r\n                      onClick={() => handleTimelineNodeClick(node)}\r\n                    />\r\n                  ))}\r\n                  \r\n                  {timelineNodes.length === 0 && (\r\n                    <Box \r\n                      padding={space.l} \r\n                      textAlign=\"center\"\r\n                      backgroundColor={colors.soap100}\r\n                      borderRadius={borderRadius.m}\r\n                    >\r\n                      <Text fontSize=\"small\" color={colors.licorice600}>\r\n                        æš‚æ— æ—¶é—´è½´è®°å½•\r\n                      </Text>\r\n                    </Box>\r\n                  )}\r\n                </Box>\r\n              )}\r\n            </Box>\r\n          )}\r\n\r\n          {/* å³ä¾§è¯¦æƒ…ç¼–è¾‘åŒº */}\r\n          <Box \r\n            flex=\"1\" \r\n            padding={space.l} \r\n            overflow=\"auto\"\r\n            backgroundColor=\"white\"\r\n          >\r\n            {isSelectedLoading ? (\r\n              <Box display=\"flex\" alignItems=\"center\" justifyContent=\"center\" height=\"100%\">\r\n                <Text>åŠ è½½è¯¦æƒ…ä¸­...</Text>\r\n              </Box>\r\n            ) : selectedRecord ? (\r\n              <Box>\r\n                {/* è¯¦æƒ…å¤´éƒ¨æ“ä½œæ  */}\r\n                <Flex alignItems=\"center\" justifyContent=\"space-between\" marginBottom={space.l}>\r\n                  <Box>\r\n                    <Text fontSize=\"large\" fontWeight=\"bold\">\r\n                      {selectedRecord.name}\r\n                    </Text>\r\n                    <Flex alignItems=\"center\" gap={space.s} marginTop={space.xs}>\r\n                      <Text fontSize=\"small\" color={colors.licorice600}>\r\n                        ç”Ÿæ•ˆæ—¥æœŸ: {new Date(selectedRecord.effective_date).toLocaleDateString('zh-CN')}\r\n                      </Text>\r\n                      \r\n                      {selectedRecord.end_date && (\r\n                        <Text fontSize=\"small\" color={colors.licorice600}>\r\n                          ç»“æŸæ—¥æœŸ: {new Date(selectedRecord.end_date).toLocaleDateString('zh-CN')}\r\n                        </Text>\r\n                      )}\r\n\r\n                      <Badge\r\n                        variant={selectedRecord.is_current ? 'positive' : 'neutral'}\r\n                        size=\"small\"\r\n                      >\r\n                        {selectedRecord.is_current ? 'å½“å‰æœ‰æ•ˆ' : 'å†å²è®°å½•'}\r\n                      </Badge>\r\n                    </Flex>\r\n                  </Box>\r\n\r\n                  <Flex gap={space.s}>\r\n                    {viewMode !== 'edit' ? (\r\n                      <>\r\n                        <SecondaryButton onClick={handleEditModeToggle}>\r\n                          ç¼–è¾‘\r\n                        </SecondaryButton>\r\n                        \r\n                        {onDelete && (\r\n                          <SecondaryButton \r\n                            onClick={handleDelete}\r\n                            variant=\"destructive\"\r\n                          >\r\n                            åˆ é™¤\r\n                          </SecondaryButton>\r\n                        )}\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <SecondaryButton onClick={handleEditModeToggle}>\r\n                          å–æ¶ˆ\r\n                        </SecondaryButton>\r\n                        <PrimaryButton \r\n                          onClick={handleSave}\r\n                          disabled={!hasUnsavedChanges}\r\n                        >\r\n                          ä¿å­˜\r\n                        </PrimaryButton>\r\n                      </>\r\n                    )}\r\n                  </Flex>\r\n                </Flex>\r\n\r\n                {/* è¯¦æƒ…è¡¨å• */}\r\n                <OrganizationDetailForm\r\n                  record={editingRecord || selectedRecord}\r\n                  isEditing={viewMode === 'edit'}\r\n                  onFieldChange={handleFieldChange}\r\n                />\r\n              </Box>\r\n            ) : (\r\n              <Box display=\"flex\" alignItems=\"center\" justifyContent=\"center\" height=\"100%\">\r\n                <Box textAlign=\"center\">\r\n                  <Text fontSize=\"medium\" marginBottom={space.s}>\r\n                    é€‰æ‹©æ—¶é—´è½´ä¸Šçš„èŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ…\r\n                  </Text>\r\n                  <Text fontSize=\"small\" color={colors.licorice600}>\r\n                    å·¦ä¾§æ—¶é—´è½´æ˜¾ç¤ºäº†è¯¥ç»„ç»‡çš„å†å²å˜æ›´è®°å½•\r\n                  </Text>\r\n                </Box>\r\n              </Box>\r\n            )}\r\n          </Box>\r\n        </Flex>\r\n      </Card>\r\n    </Box>\r\n  );\r\n};\r\n\r\n// æ—¶é—´è½´èŠ‚ç‚¹ç»„ä»¶\r\ninterface TimelineNodeComponentProps {\r\n  node: TimelineNode;\r\n  isSelected: boolean;\r\n  isLast: boolean;\r\n  onClick: () => void;\r\n}\r\n\r\nconst TimelineNodeComponent: React.FC<TimelineNodeComponentProps> = ({\r\n  node,\r\n  isSelected,\r\n  isLast,\r\n  onClick\r\n}) => {\r\n  const getNodeColor = (type: TimelineNode['type']) => {\r\n    switch (type) {\r\n      case 'current': return colors.blueberry400;\r\n      case 'planned': return colors.peach400;\r\n      case 'historical': return colors.licorice400;\r\n      default: return colors.soap600;\r\n    }\r\n  };\r\n\r\n  const getNodeBackgroundColor = (type: TimelineNode['type'], selected: boolean) => {\r\n    if (selected) {\r\n      switch (type) {\r\n        case 'current': return colors.blueberry50;\r\n        case 'planned': return colors.peach50;\r\n        case 'historical': return colors.soap100;\r\n      }\r\n    }\r\n    return 'transparent';\r\n  };\r\n\r\n  const getChangeTypeIcon = (changeType?: TimelineNode['changeType']) => {\r\n    switch (changeType) {\r\n      case 'created': return 'ğŸ†•';\r\n      case 'activated': return 'âœ…';\r\n      case 'deactivated': return 'âŒ';\r\n      case 'planned': return 'ğŸ“…';\r\n      default: return 'âœï¸';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box position=\"relative\" marginBottom={space.m}>\r\n      {/* è¿æ¥çº¿ */}\r\n      {!isLast && (\r\n        <Box\r\n          position=\"absolute\"\r\n          left=\"15px\"\r\n          top=\"32px\"\r\n          width=\"2px\"\r\n          height=\"40px\"\r\n          backgroundColor={colors.soap400}\r\n        />\r\n      )}\r\n\r\n      {/* èŠ‚ç‚¹å†…å®¹ */}\r\n      <Tooltip title={`ç‚¹å‡»æŸ¥çœ‹ ${node.displayDate} çš„è¯¦æƒ…`}>\r\n        <Flex\r\n          alignItems=\"flex-start\"\r\n          cursor=\"pointer\"\r\n          padding={space.s}\r\n          borderRadius={borderRadius.m}\r\n          backgroundColor={getNodeBackgroundColor(node.type, isSelected)}\r\n          border={isSelected ? `2px solid ${getNodeColor(node.type)}` : '2px solid transparent'}\r\n          onClick={onClick}\r\n          _hover={{\r\n            backgroundColor: getNodeBackgroundColor(node.type, true),\r\n            border: `2px solid ${getNodeColor(node.type)}`\r\n          }}\r\n        >\r\n          {/* æ—¶é—´è½´åœ†ç‚¹ */}\r\n          <Box\r\n            width=\"32px\"\r\n            height=\"32px\"\r\n            borderRadius=\"50%\"\r\n            backgroundColor={getNodeColor(node.type)}\r\n            marginRight={space.s}\r\n            marginTop=\"2px\"\r\n            flexShrink={0}\r\n            display=\"flex\"\r\n            alignItems=\"center\"\r\n            justifyContent=\"center\"\r\n            border={`2px solid white`}\r\n          >\r\n            <Text fontSize=\"small\">\r\n              {getChangeTypeIcon(node.changeType)}\r\n            </Text>\r\n          </Box>\r\n\r\n          {/* èŠ‚ç‚¹ä¿¡æ¯ */}\r\n          <Box flex=\"1\" minWidth=\"0\">\r\n            <Text fontSize=\"small\" fontWeight=\"medium\">\r\n              {node.displayDate}\r\n            </Text>\r\n            <Text fontSize=\"small\" color={colors.licorice600} marginBottom={space.xs}>\r\n              {node.label}\r\n            </Text>\r\n            \r\n            {node.record && (\r\n              <>\r\n                <Text fontSize=\"small\" color={colors.licorice700} fontWeight=\"medium\">\r\n                  {node.record.name}\r\n                </Text>\r\n                \r\n                <Flex alignItems=\"center\" gap={space.xs} marginTop={space.xs}>\r\n                  <Badge\r\n                    variant={\r\n                      node.record.status === 'ACTIVE' ? 'positive' :\r\n                      node.record.status === 'PLANNED' ? 'caution' : 'neutral'\r\n                    }\r\n                    size=\"small\"\r\n                  >\r\n                    {node.record.status === 'ACTIVE' ? 'å¯ç”¨' :\r\n                     node.record.status === 'PLANNED' ? 'è®¡åˆ’' : 'åœç”¨'}\r\n                  </Badge>\r\n                  \r\n                  <Text fontSize=\"small\" color={colors.licorice500}>\r\n                    {node.record.unit_type}\r\n                  </Text>\r\n                </Flex>\r\n              </>\r\n            )}\r\n          </Box>\r\n        </Flex>\r\n      </Tooltip>\r\n    </Box>\r\n  );\r\n};\r\n\r\n// å·¥å…·å‡½æ•°\r\nfunction formatTimelineDate(date: Date, today: Date): string {\r\n  const diffTime = date.getTime() - today.getTime();\r\n  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n  \r\n  if (diffDays === 0) return 'ä»Šå¤©';\r\n  if (diffDays === -1) return 'æ˜¨å¤©';\r\n  if (diffDays === 1) return 'æ˜å¤©';\r\n  if (diffDays > 1 && diffDays <= 7) return `${diffDays}å¤©å`;\r\n  if (diffDays < -1 && diffDays >= -7) return `${Math.abs(diffDays)}å¤©å‰`;\r\n  \r\n  return date.toLocaleDateString('zh-CN', {\r\n    year: 'numeric',\r\n    month: '2-digit',\r\n    day: '2-digit'\r\n  });\r\n}\r\n\r\nfunction getDefaultLabel(changeType: TimelineNode['changeType']): string {\r\n  switch (changeType) {\r\n    case 'created': return 'ç»„ç»‡åˆ›å»º';\r\n    case 'activated': return 'çŠ¶æ€æ¿€æ´»';\r\n    case 'deactivated': return 'çŠ¶æ€åœç”¨';\r\n    case 'planned': return 'è®¡åˆ’å˜æ›´';\r\n    case 'modified': return 'ä¿¡æ¯ä¿®æ”¹';\r\n    default: return 'çŠ¶æ€å˜æ›´';\r\n  }\r\n}\r\n\r\nexport default OrganizationDetailPanel;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/PlannedOrganizationForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TemporalStatusSelector' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TemporalStatus' is defined but never used.","line":10,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback } from 'react';\r\nimport { Modal } from '@workday/canvas-kit-react/modal';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { TextArea } from '@workday/canvas-kit-react/text-area';\r\nimport { FormField } from '@workday/canvas-kit-react/form-field';\r\nimport { Flex } from '@workday/canvas-kit-react/layout';\r\nimport { TemporalDatePicker, validateTemporalDate } from './TemporalDatePicker';\r\nimport { TemporalStatusSelector } from './TemporalStatusSelector';\r\nimport type { TemporalStatus } from './TemporalStatusSelector';\r\nimport { UnitTypeSelector, UnitType } from '../../organizations/components/OrganizationForm/FormFields';\r\n\r\nexport interface PlannedOrganizationData {\r\n  name: string;\r\n  unit_type: UnitType;\r\n  description?: string;\r\n  effective_date: string;\r\n  end_date?: string;\r\n  change_reason: string;\r\n  parent_code?: string;\r\n}\r\n\r\nexport interface PlannedOrganizationFormProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSubmit: (data: PlannedOrganizationData) => Promise<void>;\r\n  loading?: boolean;\r\n  parentOrganization?: {\r\n    code: string;\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface FormErrors {\r\n  name?: string;\r\n  unit_type?: string;\r\n  effective_date?: string;\r\n  end_date?: string;\r\n  change_reason?: string;\r\n  general?: string;\r\n}\r\n\r\nexport const PlannedOrganizationForm: React.FC<PlannedOrganizationFormProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onSubmit,\r\n  loading = false,\r\n  parentOrganization,\r\n}) => {\r\n  const [formData, setFormData] = useState<PlannedOrganizationData>({\r\n    name: '',\r\n    unit_type: 'DEPARTMENT',\r\n    description: '',\r\n    effective_date: '',\r\n    end_date: '',\r\n    change_reason: '',\r\n    parent_code: parentOrganization?.code,\r\n  });\r\n\r\n  const [errors, setErrors] = useState<FormErrors>({});\r\n\r\n  // é‡ç½®è¡¨å•\r\n  const resetForm = useCallback(() => {\r\n    setFormData({\r\n      name: '',\r\n      unit_type: 'DEPARTMENT',\r\n      description: '',\r\n      effective_date: '',\r\n      end_date: '',\r\n      change_reason: '',\r\n      parent_code: parentOrganization?.code,\r\n    });\r\n    setErrors({});\r\n  }, [parentOrganization?.code]);\r\n\r\n  // è¡¨å•éªŒè¯\r\n  const validateForm = (): boolean => {\r\n    const newErrors: FormErrors = {};\r\n\r\n    // åç§°éªŒè¯\r\n    if (!formData.name.trim()) {\r\n      newErrors.name = 'ç»„ç»‡åç§°ä¸èƒ½ä¸ºç©º';\r\n    } else if (formData.name.length < 2) {\r\n      newErrors.name = 'ç»„ç»‡åç§°è‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦';\r\n    } else if (formData.name.length > 100) {\r\n      newErrors.name = 'ç»„ç»‡åç§°ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦';\r\n    }\r\n\r\n    // ç»„ç»‡ç±»å‹éªŒè¯\r\n    if (!formData.unit_type) {\r\n      newErrors.unit_type = 'è¯·é€‰æ‹©ç»„ç»‡ç±»å‹';\r\n    }\r\n\r\n    // ç”Ÿæ•ˆæ—¥æœŸéªŒè¯\r\n    if (!formData.effective_date) {\r\n      newErrors.effective_date = 'ç”Ÿæ•ˆæ—¥æœŸä¸èƒ½ä¸ºç©º';\r\n    } else if (!validateTemporalDate.isValidDate(formData.effective_date)) {\r\n      newErrors.effective_date = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ—¥æœŸæ ¼å¼';\r\n    } else if (!validateTemporalDate.isFutureDate(formData.effective_date)) {\r\n      newErrors.effective_date = 'è®¡åˆ’ç»„ç»‡çš„ç”Ÿæ•ˆæ—¥æœŸå¿…é¡»åœ¨å½“å‰æ—¥æœŸä¹‹å';\r\n    }\r\n\r\n    // ç»“æŸæ—¥æœŸéªŒè¯\r\n    if (formData.end_date) {\r\n      if (!validateTemporalDate.isValidDate(formData.end_date)) {\r\n        newErrors.end_date = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ—¥æœŸæ ¼å¼';\r\n      } else if (formData.effective_date && !validateTemporalDate.isEndDateAfterStartDate(formData.effective_date, formData.end_date)) {\r\n        newErrors.end_date = 'ç»“æŸæ—¥æœŸå¿…é¡»åœ¨ç”Ÿæ•ˆæ—¥æœŸä¹‹å';\r\n      }\r\n    }\r\n\r\n    // å˜æ›´åŸå› éªŒè¯\r\n    if (!formData.change_reason.trim()) {\r\n      newErrors.change_reason = 'å˜æ›´åŸå› ä¸èƒ½ä¸ºç©º';\r\n    } else if (formData.change_reason.length < 5) {\r\n      newErrors.change_reason = 'å˜æ›´åŸå› è‡³å°‘éœ€è¦5ä¸ªå­—ç¬¦';\r\n    } else if (formData.change_reason.length > 500) {\r\n      newErrors.change_reason = 'å˜æ›´åŸå› ä¸èƒ½è¶…è¿‡500ä¸ªå­—ç¬¦';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  // å¤„ç†å­—æ®µå˜æ›´\r\n  const handleFieldChange = useCallback((field: keyof PlannedOrganizationData, value: string) => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [field]: value,\r\n    }));\r\n\r\n    // æ¸…é™¤ç›¸å…³é”™è¯¯\r\n    if (errors[field as keyof FormErrors]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [field]: undefined,\r\n      }));\r\n    }\r\n  }, [errors]);\r\n\r\n  // æäº¤å¤„ç†\r\n  const handleSubmit = async () => {\r\n    if (!validateForm()) return;\r\n\r\n    try {\r\n      await onSubmit(formData);\r\n      resetForm();\r\n      onClose();\r\n    } catch (error) {\r\n      setErrors({\r\n        general: error instanceof Error ? error.message : 'åˆ›å»ºè®¡åˆ’ç»„ç»‡å¤±è´¥',\r\n      });\r\n    }\r\n  };\r\n\r\n  // å–æ¶ˆå¤„ç†\r\n  const handleCancel = () => {\r\n    resetForm();\r\n    onClose();\r\n  };\r\n\r\n  const minDate = validateTemporalDate.getTodayString();\r\n\r\n  return (\r\n    <Modal isOpen={isOpen} onClose={handleCancel}>\r\n      <Modal.Card style={{ width: '600px', maxWidth: '90vw' }}>\r\n        <Modal.CloseIcon onClick={handleCancel} />\r\n        \r\n        <Modal.Heading>åˆ›å»ºè®¡åˆ’ç»„ç»‡</Modal.Heading>\r\n        \r\n        <Modal.Body>\r\n          <Flex flexDirection=\"column\" gap=\"m\">\r\n            {parentOrganization && (\r\n              <FormField label=\"ä¸Šçº§ç»„ç»‡\" hintText={`å°†åœ¨ ${parentOrganization.name} ä¸‹åˆ›å»ºè®¡åˆ’ç»„ç»‡`}>\r\n                <TextInput value={parentOrganization.name} disabled />\r\n              </FormField>\r\n            )}\r\n\r\n            <FormField\r\n              label=\"ç»„ç»‡åç§°\"\r\n              required\r\n              error={errors.name ? FormField.ErrorType.Error : undefined}\r\n              hintText={errors.name}\r\n            >\r\n              <TextInput\r\n                value={formData.name}\r\n                onChange={(e) => handleFieldChange('name', e.target.value)}\r\n                placeholder=\"è¯·è¾“å…¥ç»„ç»‡åç§°\"\r\n              />\r\n            </FormField>\r\n\r\n            <UnitTypeSelector\r\n              value={formData.unit_type}\r\n              onChange={(value) => handleFieldChange('unit_type', value)}\r\n              error={errors.unit_type}\r\n              required\r\n            />\r\n\r\n            <FormField\r\n              label=\"ç»„ç»‡æè¿°\"\r\n              hintText=\"å¯é€‰ï¼Œæè¿°ç»„ç»‡çš„èŒèƒ½å’Œç›®çš„\"\r\n            >\r\n              <TextArea\r\n                value={formData.description}\r\n                onChange={(e) => handleFieldChange('description', e.target.value)}\r\n                placeholder=\"è¯·è¾“å…¥ç»„ç»‡æè¿°\"\r\n                rows={3}\r\n              />\r\n            </FormField>\r\n\r\n            <TemporalDatePicker\r\n              label=\"ç”Ÿæ•ˆæ—¥æœŸ\"\r\n              value={formData.effective_date}\r\n              onChange={(value) => handleFieldChange('effective_date', value)}\r\n              error={errors.effective_date}\r\n              required\r\n              minDate={minDate}\r\n              helperText=\"è®¡åˆ’ç»„ç»‡å¿…é¡»è®¾ç½®æœªæ¥çš„ç”Ÿæ•ˆæ—¥æœŸ\"\r\n            />\r\n\r\n            <TemporalDatePicker\r\n              label=\"ç»“æŸæ—¥æœŸ\"\r\n              value={formData.end_date}\r\n              onChange={(value) => handleFieldChange('end_date', value)}\r\n              error={errors.end_date}\r\n              minDate={formData.effective_date || minDate}\r\n              helperText=\"å¯é€‰ï¼Œè®¾ç½®ç»„ç»‡çš„è®¡åˆ’ç»“æŸæ—¶é—´\"\r\n            />\r\n\r\n            <FormField\r\n              label=\"å˜æ›´åŸå› \"\r\n              required\r\n              error={errors.change_reason ? FormField.ErrorType.Error : undefined}\r\n              hintText={errors.change_reason || 'è¯·è¯´æ˜åˆ›å»ºæ­¤è®¡åˆ’ç»„ç»‡çš„åŸå› '}\r\n            >\r\n              <TextArea\r\n                value={formData.change_reason}\r\n                onChange={(e) => handleFieldChange('change_reason', e.target.value)}\r\n                placeholder=\"ä¾‹å¦‚ï¼šä¸šåŠ¡æ‰©å±•éœ€è¦ã€ç»„ç»‡æ¶æ„è°ƒæ•´ã€æ–°é¡¹ç›®å¯åŠ¨ç­‰\"\r\n                rows={3}\r\n              />\r\n            </FormField>\r\n\r\n            {errors.general && (\r\n              <div style={{ color: '#D73502', fontSize: '14px', marginTop: '8px' }}>\r\n                {errors.general}\r\n              </div>\r\n            )}\r\n          </Flex>\r\n        </Modal.Body>\r\n        \r\n        <Modal.Footer>\r\n          <Flex gap=\"s\" justifyContent=\"flex-end\">\r\n            <SecondaryButton onClick={handleCancel} disabled={loading}>\r\n              å–æ¶ˆ\r\n            </SecondaryButton>\r\n            <PrimaryButton onClick={handleSubmit} disabled={loading}>\r\n              {loading ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºè®¡åˆ’ç»„ç»‡'}\r\n            </PrimaryButton>\r\n          </Flex>\r\n        </Modal.Footer>\r\n      </Modal.Card>\r\n    </Modal>\r\n  );\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/SimpleTimelineVisualization.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'space' is defined but never used.","line":11,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'borderRadius' is defined but never used.","line":11,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[725,728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[725,728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadTimeline'. Either include it or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [loadTimeline, organizationCode]","fix":{"range":[3009,3027],"text":"[loadTimeline, organizationCode]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7063,7066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7063,7066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * ç®€åŒ–çš„æ—¶æ€æ•°æ®å¯è§†åŒ–ç»„ä»¶\r\n * å±•ç¤ºç»„ç»‡æ¶æ„æ—¶é—´çº¿äº‹ä»¶\r\n */\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text, Heading } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { Badge } from '../../../shared/components/Badge';\r\nimport { colors, space, borderRadius } from '@workday/canvas-kit-react/tokens';\r\n\r\n// ç®€åŒ–çš„æ—¶é—´çº¿äº‹ä»¶ç±»å‹\r\ninterface TimelineEvent {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  event_type: string;\r\n  event_date: string;\r\n  effective_date: string;\r\n  status: string;\r\n  metadata?: Record<string, any>;\r\n  triggered_by?: string;\r\n}\r\n\r\ninterface SimpleTimelineVisualizationProps {\r\n  organizationCode: string;\r\n  onRefresh?: () => void;\r\n}\r\n\r\nexport const SimpleTimelineVisualization: React.FC<SimpleTimelineVisualizationProps> = ({\r\n  organizationCode,\r\n  onRefresh\r\n}) => {\r\n  const [events, setEvents] = useState<TimelineEvent[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [expandedEvent, setExpandedEvent] = useState<string | null>(null);\r\n\r\n  // è·å–äº‹ä»¶ç±»å‹æ ·å¼\r\n  const getEventTypeStyle = (eventType: string) => {\r\n    const styles = {\r\n      create: { color: colors.greenFresca600, bgColor: '#E8F5E8', icon: 'ğŸ—ï¸' },\r\n      update: { color: colors.blueberry600, bgColor: '#E3F2FD', icon: 'âœï¸' },\r\n      delete: { color: colors.cinnamon600, bgColor: '#FFEBEE', icon: 'ğŸ—‘ï¸' },\r\n      activate: { color: colors.greenFresca600, bgColor: '#E8F5E8', icon: 'âœ…' },\r\n      deactivate: { color: '#666666', bgColor: '#F5F5F5', icon: 'ğŸš«' },\r\n      restructure: { color: colors.peach600, bgColor: '#FFF3E0', icon: 'ğŸ”„' },\r\n      dissolve: { color: colors.cinnamon600, bgColor: '#FFEBEE', icon: 'ğŸ’¥' }\r\n    };\r\n    return styles[eventType as keyof typeof styles] || styles.update;\r\n  };\r\n\r\n  // æ ¼å¼åŒ–æ—¶é—´\r\n  const formatDate = (dateStr: string) => {\r\n    try {\r\n      const date = new Date(dateStr);\r\n      return date.toLocaleDateString('zh-CN', {\r\n        year: 'numeric',\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    } catch {\r\n      return dateStr;\r\n    }\r\n  };\r\n\r\n  // åŠ è½½æ—¶é—´çº¿æ•°æ®\r\n  const loadTimeline = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      \r\n      const response = await fetch(\r\n        `http://localhost:9091/api/v1/organization-units/${organizationCode}/timeline?limit=50`\r\n      );\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      setEvents(data.timeline || []);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'åŠ è½½æ—¶é—´çº¿å¤±è´¥');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadTimeline();\r\n  }, [organizationCode]);\r\n\r\n  const handleRefresh = () => {\r\n    loadTimeline();\r\n    onRefresh?.();\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <Card padding=\"l\">\r\n        <Flex justifyContent=\"center\" alignItems=\"center\" minHeight=\"200px\">\r\n          <Text>ğŸ”„ åŠ è½½æ—¶é—´çº¿æ•°æ®...</Text>\r\n        </Flex>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Card padding=\"l\">\r\n        <Flex justifyContent=\"center\" alignItems=\"center\" flexDirection=\"column\" minHeight=\"200px\" gap=\"m\">\r\n          <Text color={colors.cinnamon600}>âŒ {error}</Text>\r\n          <PrimaryButton size=\"small\" onClick={handleRefresh}>\r\n            é‡è¯•\r\n          </PrimaryButton>\r\n        </Flex>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (events.length === 0) {\r\n    return (\r\n      <Card padding=\"l\">\r\n        <Flex justifyContent=\"center\" alignItems=\"center\" flexDirection=\"column\" minHeight=\"200px\" gap=\"m\">\r\n          <Text color=\"#666666\">ğŸ“­ æš‚æ— æ—¶é—´çº¿äº‹ä»¶</Text>\r\n          <SecondaryButton size=\"small\" onClick={handleRefresh}>\r\n            åˆ·æ–°\r\n          </SecondaryButton>\r\n        </Flex>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Box>\r\n      {/* æ ‡é¢˜å’Œæ§åˆ¶ */}\r\n      <Flex justifyContent=\"space-between\" alignItems=\"center\" marginBottom=\"l\">\r\n        <Box>\r\n          <Heading size=\"medium\" marginBottom=\"s\">\r\n            ç»„ç»‡æ—¶é—´çº¿å¯è§†åŒ–\r\n          </Heading>\r\n          <Text color=\"#666666\" fontSize=\"small\">\r\n            ç»„ç»‡ä»£ç : {organizationCode} Â· å…± {events.length} ä¸ªäº‹ä»¶\r\n          </Text>\r\n        </Box>\r\n        \r\n        <SecondaryButton size=\"small\" onClick={handleRefresh}>\r\n          ğŸ”„ åˆ·æ–°\r\n        </SecondaryButton>\r\n      </Flex>\r\n\r\n      {/* æ—¶é—´çº¿å®¹å™¨ */}\r\n      <Card padding=\"l\">\r\n        <Box position=\"relative\">\r\n          {/* æ—¶é—´çº¿ä¸»è½´ */}\r\n          <Box\r\n            position=\"absolute\"\r\n            left=\"20px\"\r\n            top=\"20px\"\r\n            bottom=\"20px\"\r\n            width=\"2px\"\r\n            backgroundColor=\"#E0E0E0\"\r\n            zIndex={0}\r\n          />\r\n\r\n          {/* äº‹ä»¶åˆ—è¡¨ */}\r\n          {events.map((event, index) => {\r\n            const eventStyle = getEventTypeStyle(event.event_type);\r\n            const isExpanded = expandedEvent === event.id;\r\n            const isLast = index === events.length - 1;\r\n\r\n            return (\r\n              <Box\r\n                key={event.id}\r\n                position=\"relative\"\r\n                marginBottom={isLast ? \"0\" : \"l\"}\r\n                zIndex={1}\r\n              >\r\n                {/* äº‹ä»¶èŠ‚ç‚¹ */}\r\n                <Flex alignItems=\"flex-start\" gap=\"m\">\r\n                  {/* æ—¶é—´è½´ç‚¹ */}\r\n                  <Box\r\n                    width=\"40px\"\r\n                    height=\"40px\"\r\n                    borderRadius=\"50%\"\r\n                    backgroundColor={eventStyle.bgColor}\r\n                    border={`2px solid ${eventStyle.color}`}\r\n                    display=\"flex\"\r\n                    alignItems=\"center\"\r\n                    justifyContent=\"center\"\r\n                    fontSize=\"18px\"\r\n                    flexShrink={0}\r\n                  >\r\n                    {eventStyle.icon}\r\n                  </Box>\r\n\r\n                  {/* äº‹ä»¶å†…å®¹ */}\r\n                  <Card\r\n                    flex=\"1\"\r\n                    padding=\"m\"\r\n                    cursor=\"pointer\"\r\n                    onClick={() => setExpandedEvent(isExpanded ? null : event.id)}\r\n                    style={{\r\n                      backgroundColor: isExpanded ? '#F8F9FA' : 'white',\r\n                      border: isExpanded ? '2px solid #2196F3' : '1px solid #E9ECEF',\r\n                      transition: 'all 0.2s ease'\r\n                    }}\r\n                  >\r\n                    {/* äº‹ä»¶æ ‡é¢˜ */}\r\n                    <Flex justifyContent=\"space-between\" alignItems=\"flex-start\" marginBottom=\"s\">\r\n                      <Box flex=\"1\">\r\n                        <Text fontWeight=\"medium\" marginBottom=\"xs\">\r\n                          {event.title}\r\n                        </Text>\r\n                        <Flex alignItems=\"center\" gap=\"s\">\r\n                          <Badge color={eventStyle.color.replace('#', '') as any} size=\"small\">\r\n                            {event.event_type}\r\n                          </Badge>\r\n                          <Badge variant=\"outline\" size=\"small\">\r\n                            {event.status}\r\n                          </Badge>\r\n                        </Flex>\r\n                      </Box>\r\n                    </Flex>\r\n\r\n                    {/* äº‹ä»¶æ—¶é—´ */}\r\n                    <Box marginBottom=\"s\">\r\n                      <Text fontSize=\"small\" color=\"#666666\">\r\n                        ğŸ• äº‹ä»¶æ—¶é—´: {formatDate(event.event_date)}\r\n                      </Text>\r\n                      <Text fontSize=\"small\" color=\"#666666\">\r\n                        ğŸ“… ç”Ÿæ•ˆæ—¶é—´: {formatDate(event.effective_date)}\r\n                      </Text>\r\n                    </Box>\r\n\r\n                    {/* äº‹ä»¶æè¿° */}\r\n                    <Text fontSize=\"small\" color=\"#666666\" marginBottom=\"s\">\r\n                      {event.description || 'æ— æè¿°'}\r\n                    </Text>\r\n\r\n                    {/* å±•å¼€çš„è¯¦æƒ… */}\r\n                    {isExpanded && event.metadata && (\r\n                      <Box marginTop=\"m\" padding=\"m\" backgroundColor=\"#F0F0F0\" borderRadius=\"4px\">\r\n                        <Text fontSize=\"small\" fontWeight=\"medium\" marginBottom=\"s\">\r\n                          è¯¦ç»†ä¿¡æ¯:\r\n                        </Text>\r\n                        {Object.entries(event.metadata).map(([key, value]) => (\r\n                          <Text key={key} fontSize=\"small\" marginBottom=\"xs\">\r\n                            â€¢ {key}: {String(value)}\r\n                          </Text>\r\n                        ))}\r\n                        {event.triggered_by && (\r\n                          <Text fontSize=\"small\" marginTop=\"s\" color=\"#999999\">\r\n                            è§¦å‘è€…: {event.triggered_by}\r\n                          </Text>\r\n                        )}\r\n                      </Box>\r\n                    )}\r\n\r\n                    {/* ç‚¹å‡»æç¤º */}\r\n                    <Text fontSize=\"small\" color=\"#999999\" marginTop=\"s\">\r\n                      {isExpanded ? 'ç‚¹å‡»æ”¶èµ·' : 'ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…'}\r\n                    </Text>\r\n                  </Card>\r\n                </Flex>\r\n              </Box>\r\n            );\r\n          })}\r\n        </Box>\r\n      </Card>\r\n\r\n      {/* ç»Ÿè®¡ä¿¡æ¯ */}\r\n      <Box marginTop=\"m\">\r\n        <Card padding=\"m\">\r\n          <Flex justifyContent=\"space-between\" alignItems=\"center\">\r\n            <Text fontSize=\"small\" color=\"#666666\">\r\n              æ—¶é—´çº¿ç»Ÿè®¡: æœ€æ–°äº‹ä»¶ {formatDate(events[0]?.event_date || '')}\r\n            </Text>\r\n            <Text fontSize=\"small\" color=\"#666666\">\r\n              æ•°æ®æ¥æº: æ—¶æ€ç®¡ç†æœåŠ¡ (ç«¯å£9091)\r\n            </Text>\r\n          </Flex>\r\n        </Card>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default SimpleTimelineVisualization;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TemporalDatePicker.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":57,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":57,"endColumn":34}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { FormField } from '@workday/canvas-kit-react/form-field';\r\n\r\nexport interface TemporalDatePickerProps {\r\n  label: string;\r\n  value?: string;\r\n  onChange: (value: string) => void;\r\n  error?: string;\r\n  required?: boolean;\r\n  minDate?: string;\r\n  maxDate?: string;\r\n  placeholder?: string;\r\n  disabled?: boolean;\r\n  helperText?: string;\r\n}\r\n\r\nexport const TemporalDatePicker: React.FC<TemporalDatePickerProps> = ({\r\n  label,\r\n  value = '',\r\n  onChange,\r\n  error,\r\n  required = false,\r\n  minDate,\r\n  maxDate,\r\n  placeholder = 'YYYY-MM-DD',\r\n  disabled = false,\r\n  helperText,\r\n}) => {\r\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    onChange(event.target.value);\r\n  };\r\n\r\n  const inputProps = {\r\n    type: 'date',\r\n    value,\r\n    onChange: handleChange,\r\n    min: minDate,\r\n    max: maxDate,\r\n    disabled,\r\n    placeholder,\r\n  };\r\n\r\n  return (\r\n    <FormField\r\n      label={label}\r\n      required={required}\r\n      error={error ? FormField.ErrorType.Error : undefined}\r\n      hintText={error || helperText}\r\n    >\r\n      <TextInput {...inputProps} />\r\n    </FormField>\r\n  );\r\n};\r\n\r\n// æ—¶æ€æ—¥æœŸéªŒè¯å·¥å…·å‡½æ•°\r\nexport const validateTemporalDate = {\r\n  // éªŒè¯æ—¥æœŸæ ¼å¼\r\n  isValidDate: (dateString: string): boolean => {\r\n    const date = new Date(dateString);\r\n    return date instanceof Date && !isNaN(date.getTime()) && dateString === date.toISOString().split('T')[0];\r\n  },\r\n\r\n  // éªŒè¯æœªæ¥æ—¥æœŸ (ç”¨äºè®¡åˆ’ç»„ç»‡)\r\n  isFutureDate: (dateString: string): boolean => {\r\n    const date = new Date(dateString);\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n    return date > today;\r\n  },\r\n\r\n  // éªŒè¯æ—¥æœŸèŒƒå›´\r\n  isDateInRange: (dateString: string, startDate?: string, endDate?: string): boolean => {\r\n    if (!startDate && !endDate) return true;\r\n    \r\n    const date = new Date(dateString);\r\n    \r\n    if (startDate && date < new Date(startDate)) return false;\r\n    if (endDate && date > new Date(endDate)) return false;\r\n    \r\n    return true;\r\n  },\r\n\r\n  // éªŒè¯ç»“æŸæ—¥æœŸåœ¨å¼€å§‹æ—¥æœŸä¹‹å\r\n  isEndDateAfterStartDate: (startDate: string, endDate: string): boolean => {\r\n    return new Date(endDate) > new Date(startDate);\r\n  },\r\n\r\n  // è·å–ä»Šå¤©çš„æ—¥æœŸå­—ç¬¦ä¸²\r\n  getTodayString: (): string => {\r\n    return new Date().toISOString().split('T')[0];\r\n  },\r\n\r\n  // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º\r\n  formatDateDisplay: (dateString: string): string => {\r\n    if (!dateString) return '';\r\n    const date = new Date(dateString);\r\n    return date.toLocaleDateString('zh-CN', {\r\n      year: 'numeric',\r\n      month: 'long', \r\n      day: 'numeric'\r\n    });\r\n  }\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TemporalEditForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Card' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'colors' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":16}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€ç®¡ç†ç¼–è¾‘è¡¨å•ç»„ä»¶\r\n * æ”¯æŒåˆ›å»ºå’Œç¼–è¾‘æ—¶æ€ç‰ˆæœ¬\r\n */\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text, Heading } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { FormField } from '@workday/canvas-kit-react/form-field';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { TextArea } from '@workday/canvas-kit-react/text-area';\r\nimport { Select } from '@workday/canvas-kit-react/select';\r\nimport { Modal } from '@workday/canvas-kit-react/modal';\r\nimport { colors } from '@workday/canvas-kit-react/tokens';\r\n\r\nexport interface TemporalEditFormData {\r\n  name: string;\r\n  unit_type: string;\r\n  status: string;\r\n  description?: string;\r\n  effective_date: string;\r\n  change_reason: string;\r\n  event_type: 'UPDATE' | 'RESTRUCTURE' | 'DISSOLVE';\r\n}\r\n\r\nexport interface TemporalVersion {\r\n  code: string;\r\n  name: string;\r\n  unit_type: string;\r\n  status: string;\r\n  description?: string;\r\n  effective_date: string;\r\n  change_reason?: string;\r\n}\r\n\r\nexport interface TemporalEditFormProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSubmit: (data: TemporalEditFormData) => Promise<void>;\r\n  organizationCode: string;\r\n  initialData?: TemporalVersion | null;\r\n  mode: 'create' | 'edit';\r\n  isSubmitting?: boolean;\r\n}\r\n\r\nconst unitTypeOptions = [\r\n  { label: 'å…¬å¸', value: 'COMPANY' },\r\n  { label: 'éƒ¨é—¨', value: 'DEPARTMENT' },\r\n  { label: 'æˆæœ¬ä¸­å¿ƒ', value: 'COST_CENTER' },\r\n  { label: 'é¡¹ç›®å›¢é˜Ÿ', value: 'PROJECT_TEAM' },\r\n];\r\n\r\nconst statusOptions = [\r\n  { label: 'å¯ç”¨', value: 'ACTIVE' },\r\n  { label: 'è®¡åˆ’ä¸­', value: 'PLANNED' },\r\n  { label: 'åœç”¨', value: 'INACTIVE' },\r\n];\r\n\r\nconst eventTypeOptions = [\r\n  { label: 'æ›´æ–°', value: 'UPDATE' },\r\n  { label: 'é‡ç»„', value: 'RESTRUCTURE' },\r\n  { label: 'æ’¤é”€', value: 'DISSOLVE' },\r\n];\r\n\r\nexport const TemporalEditForm: React.FC<TemporalEditFormProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onSubmit,\r\n  organizationCode,\r\n  initialData,\r\n  mode,\r\n  isSubmitting = false\r\n}) => {\r\n  const [formData, setFormData] = useState<TemporalEditFormData>({\r\n    name: '',\r\n    unit_type: 'DEPARTMENT',\r\n    status: 'PLANNED',\r\n    description: '',\r\n    effective_date: new Date().toISOString().split('T')[0], // é»˜è®¤ä»Šå¤©\r\n    change_reason: '',\r\n    event_type: 'UPDATE'\r\n  });\r\n\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n\r\n  // åˆå§‹åŒ–è¡¨å•æ•°æ®\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      if (mode === 'edit' && initialData) {\r\n        setFormData({\r\n          name: initialData.name,\r\n          unit_type: initialData.unit_type,\r\n          status: initialData.status,\r\n          description: initialData.description || '',\r\n          effective_date: new Date(initialData.effective_date).toISOString().split('T')[0],\r\n          change_reason: initialData.change_reason || '',\r\n          event_type: 'UPDATE'\r\n        });\r\n      } else {\r\n        // åˆ›å»ºæ¨¡å¼ - ä½¿ç”¨é»˜è®¤å€¼\r\n        const tomorrow = new Date();\r\n        tomorrow.setDate(tomorrow.getDate() + 1);\r\n        setFormData({\r\n          name: '',\r\n          unit_type: 'DEPARTMENT',\r\n          status: 'PLANNED',\r\n          description: '',\r\n          effective_date: tomorrow.toISOString().split('T')[0], // é»˜è®¤æ˜å¤©ç”Ÿæ•ˆ\r\n          change_reason: '',\r\n          event_type: 'RESTRUCTURE'\r\n        });\r\n      }\r\n      setErrors({});\r\n    }\r\n  }, [isOpen, mode, initialData]);\r\n\r\n  const handleInputChange = (field: keyof TemporalEditFormData) => (\r\n    event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>\r\n  ) => {\r\n    const value = event.target.value;\r\n    setFormData(prev => ({ ...prev, [field]: value }));\r\n    \r\n    // æ¸…é™¤è¯¥å­—æ®µçš„é”™è¯¯\r\n    if (errors[field]) {\r\n      setErrors(prev => ({ ...prev, [field]: '' }));\r\n    }\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const newErrors: Record<string, string> = {};\r\n    \r\n    if (!formData.name.trim()) {\r\n      newErrors.name = 'ç»„ç»‡åç§°æ˜¯å¿…å¡«é¡¹';\r\n    }\r\n    \r\n    if (!formData.effective_date) {\r\n      newErrors.effective_date = 'ç”Ÿæ•ˆæ—¥æœŸæ˜¯å¿…å¡«é¡¹';\r\n    } else {\r\n      const effectiveDate = new Date(formData.effective_date);\r\n      const today = new Date();\r\n      today.setHours(0, 0, 0, 0);\r\n      \r\n      if (effectiveDate < today) {\r\n        newErrors.effective_date = 'ç”Ÿæ•ˆæ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©';\r\n      }\r\n    }\r\n    \r\n    if (!formData.change_reason.trim()) {\r\n      newErrors.change_reason = 'å˜æ›´åŸå› æ˜¯å¿…å¡«é¡¹';\r\n    }\r\n    \r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (event: React.FormEvent) => {\r\n    event.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      await onSubmit(formData);\r\n    } catch (error) {\r\n      console.error('æäº¤è¡¨å•å¤±è´¥:', error);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    if (!isSubmitting) {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  // åªåœ¨isOpenä¸ºtrueæ—¶æ‰æ¸²æŸ“Modal\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Modal onClose={handleClose} heading={mode === 'create' ? 'æ–°å¢æ—¶æ€ç‰ˆæœ¬' : 'ç¼–è¾‘æ—¶æ€ç‰ˆæœ¬'}>\r\n      <Box padding=\"l\" width=\"600px\">\r\n        <form onSubmit={handleSubmit}>\r\n          <Box marginBottom=\"l\">\r\n            <Text typeLevel=\"body.small\" color=\"hint\">\r\n              ç»„ç»‡ç¼–ç : {organizationCode}\r\n            </Text>\r\n          </Box>\r\n\r\n          {/* åŸºæœ¬ä¿¡æ¯ */}\r\n          <Box marginBottom=\"l\">\r\n            <Heading size=\"small\" marginBottom=\"s\">åŸºæœ¬ä¿¡æ¯</Heading>\r\n            \r\n            <FormField label=\"ç»„ç»‡åç§°\" required error={errors.name}>\r\n              <TextInput\r\n                value={formData.name}\r\n                onChange={handleInputChange('name')}\r\n                placeholder=\"è¯·è¾“å…¥ç»„ç»‡åç§°\"\r\n                disabled={isSubmitting}\r\n              />\r\n            </FormField>\r\n\r\n            <FormField label=\"ç»„ç»‡ç±»å‹\" required>\r\n              <Select\r\n                value={formData.unit_type}\r\n                onChange={handleInputChange('unit_type')}\r\n                disabled={isSubmitting}\r\n              >\r\n                {unitTypeOptions.map(option => (\r\n                  <option key={option.value} value={option.value}>\r\n                    {option.label}\r\n                  </option>\r\n                ))}\r\n              </Select>\r\n            </FormField>\r\n\r\n            <FormField label=\"ç»„ç»‡çŠ¶æ€\" required>\r\n              <Select\r\n                value={formData.status}\r\n                onChange={handleInputChange('status')}\r\n                disabled={isSubmitting}\r\n              >\r\n                {statusOptions.map(option => (\r\n                  <option key={option.value} value={option.value}>\r\n                    {option.label}\r\n                  </option>\r\n                ))}\r\n              </Select>\r\n            </FormField>\r\n\r\n            <FormField label=\"æè¿°ä¿¡æ¯\">\r\n              <TextArea\r\n                value={formData.description}\r\n                onChange={handleInputChange('description')}\r\n                placeholder=\"è¯·è¾“å…¥ç»„ç»‡æè¿°ä¿¡æ¯\"\r\n                disabled={isSubmitting}\r\n                rows={3}\r\n              />\r\n            </FormField>\r\n          </Box>\r\n\r\n          {/* æ—¶æ€ä¿¡æ¯ */}\r\n          <Box marginBottom=\"l\">\r\n            <Heading size=\"small\" marginBottom=\"s\">æ—¶æ€ä¿¡æ¯</Heading>\r\n\r\n            <FormField label=\"ç”Ÿæ•ˆæ—¥æœŸ\" required error={errors.effective_date}>\r\n              <TextInput\r\n                type=\"date\"\r\n                value={formData.effective_date}\r\n                onChange={handleInputChange('effective_date')}\r\n                disabled={isSubmitting}\r\n              />\r\n            </FormField>\r\n\r\n            <FormField label=\"äº‹ä»¶ç±»å‹\" required>\r\n              <Select\r\n                value={formData.event_type}\r\n                onChange={handleInputChange('event_type')}\r\n                disabled={isSubmitting}\r\n              >\r\n                {eventTypeOptions.map(option => (\r\n                  <option key={option.value} value={option.value}>\r\n                    {option.label}\r\n                  </option>\r\n                ))}\r\n              </Select>\r\n            </FormField>\r\n\r\n            <FormField label=\"å˜æ›´åŸå› \" required error={errors.change_reason}>\r\n              <TextArea\r\n                value={formData.change_reason}\r\n                onChange={handleInputChange('change_reason')}\r\n                placeholder=\"è¯·è¯´æ˜æ­¤æ¬¡å˜æ›´çš„åŸå› \"\r\n                disabled={isSubmitting}\r\n                rows={2}\r\n              />\r\n            </FormField>\r\n          </Box>\r\n\r\n          {/* æ“ä½œæŒ‰é’® */}\r\n          <Flex gap=\"s\" justifyContent=\"flex-end\">\r\n            <SecondaryButton \r\n              onClick={handleClose}\r\n              disabled={isSubmitting}\r\n            >\r\n              å–æ¶ˆ\r\n            </SecondaryButton>\r\n            <PrimaryButton \r\n              type=\"submit\"\r\n              disabled={isSubmitting}\r\n            >\r\n              {isSubmitting ? 'æäº¤ä¸­...' : mode === 'create' ? 'åˆ›å»º' : 'æ›´æ–°'}\r\n            </PrimaryButton>\r\n          </Flex>\r\n        </form>\r\n      </Box>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport type { TemporalEditFormData };\r\nexport default TemporalEditForm;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TemporalHistoryViewer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Select' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'searchIcon' is defined but never used.","line":31,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TimelineEvent' is defined but never used.","line":45,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'latestRecord' is assigned a value but never used.","line":84,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":84,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'currentRecord' is assigned a value but never used.","line":85,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'historicalRecords' is assigned a value but never used.","line":86,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":86,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'invalidateHistoryCache' is assigned a value but never used.","line":108,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isLast' is assigned a value but never used.","line":181,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":181,"endColumn":23}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€å†å²æŸ¥çœ‹å™¨ç»„ä»¶ - åŸºäºGraphQLæ—¶æ€æŸ¥è¯¢\r\n * å±•ç¤ºç»„ç»‡çš„å®Œæ•´å†å²è®°å½•å’Œæ—¶é—´ç‚¹æŸ¥è¯¢åŠŸèƒ½\r\n */\r\nimport React, { useState, useMemo, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { FormField } from '@workday/canvas-kit-react/form-field';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { Select } from '@workday/canvas-kit-react/select';\r\nimport { LoadingDots } from '@workday/canvas-kit-react/loading-dots';\r\nimport { \r\n  colors, \r\n  space, \r\n  borderRadius\r\n} from '@workday/canvas-kit-react/tokens';\r\n\r\n// ç®€åŒ–å­—ä½“å¤§å°å®šä¹‰\r\nconst fontSizes = {\r\n  body: {\r\n    small: '12px',\r\n    medium: '14px',\r\n    large: '16px'\r\n  },\r\n  caption: '11px'\r\n};\r\nimport {\r\n  calendarIcon,\r\n  searchIcon,\r\n  filterIcon\r\n} from '@workday/canvas-system-icons-web';\r\nimport { SystemIcon } from '@workday/canvas-kit-react/icon';\r\n\r\n// ä½¿ç”¨æ–°çš„GraphQLæ—¶æ€æŸ¥è¯¢é’©å­\r\nimport { \r\n  useOrganizationHistory,\r\n  useOrganizationAsOfDate,\r\n  useTemporalQueryUtils,\r\n  useTemporalCacheManager\r\n} from '../../../shared/hooks/useTemporalGraphQL';\r\nimport type { \r\n  TemporalOrganizationUnit,\r\n  TimelineEvent\r\n} from '../../../shared/types/temporal';\r\n\r\ninterface TemporalHistoryViewerProps {\r\n  organizationCode: string;\r\n  onRecordSelect?: (record: TemporalOrganizationUnit) => void;\r\n  onTimePointQuery?: (date: string, result: TemporalOrganizationUnit | null) => void;\r\n  showTimePointQuery?: boolean;\r\n  showFilters?: boolean;\r\n  maxHeight?: string;\r\n}\r\n\r\nexport const TemporalHistoryViewer: React.FC<TemporalHistoryViewerProps> = ({\r\n  organizationCode,\r\n  onRecordSelect,\r\n  onTimePointQuery,\r\n  showTimePointQuery = true,\r\n  showFilters = true,\r\n  maxHeight = '600px'\r\n}) => {\r\n  // æ—¶é—´èŒƒå›´è¿‡æ»¤çŠ¶æ€\r\n  const [dateRange, setDateRange] = useState({\r\n    fromDate: '2020-01-01',\r\n    toDate: '2050-01-01'\r\n  });\r\n  \r\n  // æ—¶é—´ç‚¹æŸ¥è¯¢çŠ¶æ€\r\n  const [asOfDate, setAsOfDate] = useState(() => {\r\n    return new Date().toISOString().split('T')[0];\r\n  });\r\n\r\n  // GraphQLæŸ¥è¯¢é’©å­\r\n  const {\r\n    data: historyRecords = [],\r\n    isLoading: isHistoryLoading,\r\n    error: historyError,\r\n    refetch: refetchHistory,\r\n    hasHistory,\r\n    historyCount,\r\n    latestRecord,\r\n    currentRecord,\r\n    historicalRecords\r\n  } = useOrganizationHistory(organizationCode, {\r\n    fromDate: dateRange.fromDate,\r\n    toDate: dateRange.toDate\r\n  });\r\n\r\n  const {\r\n    data: asOfDateRecord,\r\n    isLoading: isAsOfDateLoading,\r\n    error: asOfDateError,\r\n    refetch: refetchAsOfDate,\r\n    hasData: hasAsOfDateData,\r\n    isHistoricalRecord\r\n  } = useOrganizationAsOfDate(organizationCode, asOfDate, {\r\n    enabled: showTimePointQuery,\r\n    onSuccess: (data) => {\r\n      onTimePointQuery?.(asOfDate, data);\r\n    }\r\n  });\r\n\r\n  // å·¥å…·é’©å­\r\n  const { getCommonDatePoints, formatTemporalRecord, compareRecords } = useTemporalQueryUtils();\r\n  const { clearAllTemporalCache, invalidateHistoryCache } = useTemporalCacheManager();\r\n\r\n  // å¸¸ç”¨æ—¶é—´ç‚¹\r\n  const commonDates = useMemo(() => getCommonDatePoints(), [getCommonDatePoints]);\r\n\r\n  // å¤„ç†æ—¶é—´èŒƒå›´å˜æ›´\r\n  const handleDateRangeChange = useCallback((field: 'fromDate' | 'toDate', value: string) => {\r\n    setDateRange(prev => ({ ...prev, [field]: value }));\r\n  }, []);\r\n\r\n  // å¤„ç†æ—¶é—´ç‚¹æŸ¥è¯¢\r\n  const handleAsOfDateQuery = useCallback(() => {\r\n    refetchAsOfDate();\r\n  }, [refetchAsOfDate]);\r\n\r\n  // å¤„ç†è®°å½•é€‰æ‹©\r\n  const handleRecordSelect = useCallback((record: TemporalOrganizationUnit) => {\r\n    onRecordSelect?.(record);\r\n  }, [onRecordSelect]);\r\n\r\n  // åˆ·æ–°æ‰€æœ‰æ•°æ®\r\n  const handleRefreshAll = useCallback(async () => {\r\n    await Promise.all([\r\n      refetchHistory(),\r\n      showTimePointQuery ? refetchAsOfDate() : Promise.resolve()\r\n    ]);\r\n  }, [refetchHistory, refetchAsOfDate, showTimePointQuery]);\r\n\r\n  // æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°\r\n  const handleClearCacheAndRefresh = useCallback(async () => {\r\n    await clearAllTemporalCache();\r\n    await handleRefreshAll();\r\n  }, [clearAllTemporalCache, handleRefreshAll]);\r\n\r\n  // æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨\r\n  const renderHistoryRecords = () => {\r\n    if (isHistoryLoading) {\r\n      return (\r\n        <Box padding={space.m}>\r\n          <LoadingDots />\r\n          <Text marginTop={space.xs}>æ­£åœ¨åŠ è½½å†å²è®°å½•...</Text>\r\n        </Box>\r\n      );\r\n    }\r\n\r\n    if (historyError) {\r\n      return (\r\n        <Box padding={space.m}>\r\n          <Text color={colors.cinnamon600}>\r\n            åŠ è½½å†å²è®°å½•å¤±è´¥: {historyError.message}\r\n          </Text>\r\n          <SecondaryButton onClick={() => refetchHistory()} marginTop={space.xs}>\r\n            é‡è¯•\r\n          </SecondaryButton>\r\n        </Box>\r\n      );\r\n    }\r\n\r\n    if (!hasHistory) {\r\n      return (\r\n        <Box padding={space.m}>\r\n          <Text color={colors.licorice300}>\r\n            è¯¥ç»„ç»‡æ²¡æœ‰å†å²è®°å½•\r\n          </Text>\r\n        </Box>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <Box>\r\n        {historyRecords.map((record, index) => {\r\n          const formatted = formatTemporalRecord(record);\r\n          const isFirst = index === 0;\r\n          const isLast = index === historyRecords.length - 1;\r\n          \r\n          return (\r\n            <Card\r\n              key={`${record.code}-${record.effective_date}`}\r\n              padding={space.s}\r\n              marginBottom={space.xs}\r\n              border={`1px solid ${colors.soap400}`}\r\n              borderRadius={borderRadius.m}\r\n              backgroundColor={record.is_current ? colors.blueberry100 : colors.frenchVanilla100}\r\n              cursor=\"pointer\"\r\n              onClick={() => handleRecordSelect(record)}\r\n            >\r\n              <Flex justifyContent=\"space-between\" alignItems=\"flex-start\">\r\n                <Box flex={1}>\r\n                  <Flex alignItems=\"center\" marginBottom={space.xs}>\r\n                    <Text \r\n                      fontWeight=\"medium\" \r\n                      fontSize={fontSizes.body.medium}\r\n                      color={colors.licorice500}\r\n                    >\r\n                      {record.name}\r\n                    </Text>\r\n                    {record.is_current && (\r\n                      <Box marginLeft={space.xs}>\r\n                        <Box\r\n                          backgroundColor={colors.greenApple400}\r\n                          color={colors.frenchVanilla100}\r\n                          paddingX={space.xxxs}\r\n                          paddingY=\"2px\"\r\n                          borderRadius={borderRadius.s}\r\n                          fontSize={fontSizes.caption}\r\n                          fontWeight=\"medium\"\r\n                        >\r\n                          å½“å‰\r\n                        </Box>\r\n                      </Box>\r\n                    )}\r\n                    {isFirst && !record.is_current && (\r\n                      <Box marginLeft={space.xs}>\r\n                        <Box\r\n                          backgroundColor={colors.cinnamon400}\r\n                          color={colors.frenchVanilla100}\r\n                          paddingX={space.xxxs}\r\n                          paddingY=\"2px\"\r\n                          borderRadius={borderRadius.s}\r\n                          fontSize={fontSizes.caption}\r\n                          fontWeight=\"medium\"\r\n                        >\r\n                          æœ€æ–°\r\n                        </Box>\r\n                      </Box>\r\n                    )}\r\n                  </Flex>\r\n                  \r\n                  <Box marginBottom={space.xs}>\r\n                    <Text fontSize={fontSizes.body.small} color={colors.licorice300}>\r\n                      <strong>ç”Ÿæ•ˆæœŸé—´:</strong> {formatted.effectivePeriod}\r\n                    </Text>\r\n                    <Text fontSize={fontSizes.body.small} color={colors.licorice300}>\r\n                      <strong>ç»„ç»‡ç±»å‹:</strong> {formatted.organizationType} | \r\n                      <strong> çŠ¶æ€:</strong> {formatted.organizationStatus}\r\n                    </Text>\r\n                  </Box>\r\n\r\n                  {record.change_reason && (\r\n                    <Text \r\n                      fontSize={fontSizes.body.small} \r\n                      color={colors.licorice400}\r\n                      fontStyle=\"italic\"\r\n                    >\r\n                      å˜æ›´åŸå› : {record.change_reason}\r\n                    </Text>\r\n                  )}\r\n\r\n                  {/* æ˜¾ç¤ºä¸å‰ä¸€ä¸ªè®°å½•çš„å·®å¼‚ */}\r\n                  {index > 0 && (() => {\r\n                    const changes = compareRecords(historyRecords[index - 1], record);\r\n                    if (changes.length > 0) {\r\n                      return (\r\n                        <Box marginTop={space.xs}>\r\n                          <Text \r\n                            fontSize={fontSizes.body.small} \r\n                            color={colors.blueberry500}\r\n                            fontWeight=\"medium\"\r\n                          >\r\n                            ä¸»è¦å˜æ›´:\r\n                          </Text>\r\n                          {changes.slice(0, 3).map(change => (\r\n                            <Text \r\n                              key={change.field}\r\n                              fontSize={fontSizes.caption}\r\n                              color={colors.licorice400}\r\n                              display=\"block\"\r\n                            >\r\n                              â€¢ {change.displayName}: {change.oldValue} â†’ {change.newValue}\r\n                            </Text>\r\n                          ))}\r\n                          {changes.length > 3 && (\r\n                            <Text \r\n                              fontSize={fontSizes.caption}\r\n                              color={colors.licorice300}\r\n                            >\r\n                              ...è¿˜æœ‰ {changes.length - 3} é¡¹å˜æ›´\r\n                            </Text>\r\n                          )}\r\n                        </Box>\r\n                      );\r\n                    }\r\n                    return null;\r\n                  })()}\r\n                </Box>\r\n\r\n                <Box>\r\n                  <Text \r\n                    fontSize={fontSizes.caption} \r\n                    color={colors.licorice300}\r\n                    textAlign=\"right\"\r\n                  >\r\n                    {record.effective_date}\r\n                  </Text>\r\n                </Box>\r\n              </Flex>\r\n            </Card>\r\n          );\r\n        })}\r\n      </Box>\r\n    );\r\n  };\r\n\r\n  // æ¸²æŸ“æ—¶é—´ç‚¹æŸ¥è¯¢éƒ¨åˆ†\r\n  const renderAsOfDateQuery = () => {\r\n    if (!showTimePointQuery) return null;\r\n\r\n    return (\r\n      <Card padding={space.m} marginBottom={space.m}>\r\n        <Flex alignItems=\"center\" marginBottom={space.s}>\r\n          <SystemIcon icon={calendarIcon} size={20} />\r\n          <Text \r\n            marginLeft={space.xs} \r\n            fontWeight=\"medium\"\r\n            fontSize={fontSizes.body.medium}\r\n          >\r\n            æ—¶é—´ç‚¹æŸ¥è¯¢\r\n          </Text>\r\n        </Flex>\r\n\r\n        <Flex alignItems=\"flex-end\" gap={space.s} marginBottom={space.m}>\r\n          <FormField label=\"æŸ¥è¯¢æ—¥æœŸ\">\r\n            <TextInput\r\n              type=\"date\"\r\n              value={asOfDate}\r\n              onChange={(e) => setAsOfDate(e.target.value)}\r\n            />\r\n          </FormField>\r\n          \r\n          <PrimaryButton onClick={handleAsOfDateQuery} disabled={isAsOfDateLoading}>\r\n            {isAsOfDateLoading ? 'æŸ¥è¯¢ä¸­...' : 'æŸ¥è¯¢'}\r\n          </PrimaryButton>\r\n        </Flex>\r\n\r\n        {/* å¿«é€Ÿæ—¥æœŸé€‰æ‹© */}\r\n        <Flex gap={space.xs} marginBottom={space.m} flexWrap=\"wrap\">\r\n          <Text fontSize={fontSizes.body.small} color={colors.licorice400}>\r\n            å¿«é€Ÿé€‰æ‹©:\r\n          </Text>\r\n          {Object.entries(commonDates).map(([label, date]) => (\r\n            <SecondaryButton\r\n              key={label}\r\n              size=\"small\"\r\n              onClick={() => setAsOfDate(date)}\r\n            >\r\n              {label === 'today' ? 'ä»Šå¤©' :\r\n               label === 'yesterday' ? 'æ˜¨å¤©' :\r\n               label === 'lastWeek' ? 'ä¸€å‘¨å‰' :\r\n               label === 'lastMonth' ? 'ä¸€æœˆå‰' :\r\n               label === 'yearStart' ? 'å¹´åˆ' :\r\n               label === 'lastYearEnd' ? 'å»å¹´åº•' : label}\r\n            </SecondaryButton>\r\n          ))}\r\n        </Flex>\r\n\r\n        {/* æŸ¥è¯¢ç»“æœæ˜¾ç¤º */}\r\n        {isAsOfDateLoading && (\r\n          <Box padding={space.s}>\r\n            <LoadingDots />\r\n            <Text marginLeft={space.xs}>æ­£åœ¨æŸ¥è¯¢ {asOfDate} çš„ç»„ç»‡çŠ¶æ€...</Text>\r\n          </Box>\r\n        )}\r\n\r\n        {asOfDateError && (\r\n          <Box padding={space.s} backgroundColor={colors.cinnamon100}>\r\n            <Text color={colors.cinnamon600}>\r\n              æŸ¥è¯¢å¤±è´¥: {asOfDateError.message}\r\n            </Text>\r\n          </Box>\r\n        )}\r\n\r\n        {!isAsOfDateLoading && hasAsOfDateData && asOfDateRecord && (\r\n          <Card padding={space.s} backgroundColor={isHistoricalRecord ? colors.peach100 : colors.blueberry100}>\r\n            <Flex justifyContent=\"space-between\" alignItems=\"flex-start\">\r\n              <Box>\r\n                <Text fontWeight=\"medium\" fontSize={fontSizes.body.medium}>\r\n                  {asOfDateRecord.name}\r\n                </Text>\r\n                <Text fontSize={fontSizes.body.small} color={colors.licorice300}>\r\n                  {formatTemporalRecord(asOfDateRecord).effectivePeriod}\r\n                </Text>\r\n                <Text fontSize={fontSizes.body.small} color={colors.licorice300}>\r\n                  {formatTemporalRecord(asOfDateRecord).organizationType} | \r\n                  {formatTemporalRecord(asOfDateRecord).organizationStatus}\r\n                </Text>\r\n              </Box>\r\n              <Box\r\n                backgroundColor={isHistoricalRecord ? colors.peach400 : colors.blueberry400}\r\n                color={colors.frenchVanilla100}\r\n                paddingX={space.xs}\r\n                paddingY={space.xxxs}\r\n                borderRadius={borderRadius.s}\r\n                fontSize={fontSizes.caption}\r\n              >\r\n                {isHistoricalRecord ? 'å†å²è®°å½•' : 'å½“å‰è®°å½•'}\r\n              </Box>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n\r\n        {!isAsOfDateLoading && !hasAsOfDateData && (\r\n          <Box padding={space.s} backgroundColor={colors.licorice100}>\r\n            <Text color={colors.licorice400}>\r\n              åœ¨ {asOfDate} æ—¶é—´ç‚¹æ²¡æœ‰æ‰¾åˆ°è¯¥ç»„ç»‡çš„è®°å½•\r\n            </Text>\r\n          </Box>\r\n        )}\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Box>\r\n      {/* æ ‡é¢˜å’Œæ“ä½œæ  */}\r\n      <Flex justifyContent=\"space-between\" alignItems=\"center\" marginBottom={space.m}>\r\n        <Flex alignItems=\"center\">\r\n          <Text \r\n            marginLeft={space.s} \r\n            fontWeight=\"medium\"\r\n            fontSize={fontSizes.body.large}\r\n          >\r\n            æ—¶æ€å†å²è®°å½• ({historyCount} æ¡)\r\n          </Text>\r\n        </Flex>\r\n        \r\n        <Flex gap={space.s}>\r\n          <SecondaryButton onClick={handleRefreshAll}>\r\n            åˆ·æ–°\r\n          </SecondaryButton>\r\n          <SecondaryButton onClick={handleClearCacheAndRefresh}>\r\n            æ¸…é™¤ç¼“å­˜\r\n          </SecondaryButton>\r\n        </Flex>\r\n      </Flex>\r\n\r\n      {/* æ—¶é—´ç‚¹æŸ¥è¯¢ */}\r\n      {renderAsOfDateQuery()}\r\n\r\n      {/* æ—¥æœŸèŒƒå›´è¿‡æ»¤ */}\r\n      {showFilters && (\r\n        <Card padding={space.m} marginBottom={space.m}>\r\n          <Flex alignItems=\"center\" marginBottom={space.s}>\r\n            <SystemIcon icon={filterIcon} size={16} />\r\n            <Text marginLeft={space.xs} fontWeight=\"medium\">\r\n              æ—¶é—´èŒƒå›´è¿‡æ»¤\r\n            </Text>\r\n          </Flex>\r\n          \r\n          <Flex gap={space.s}>\r\n            <FormField label=\"èµ·å§‹æ—¥æœŸ\">\r\n              <TextInput\r\n                type=\"date\"\r\n                value={dateRange.fromDate}\r\n                onChange={(e) => handleDateRangeChange('fromDate', e.target.value)}\r\n              />\r\n            </FormField>\r\n            <FormField label=\"ç»“æŸæ—¥æœŸ\">\r\n              <TextInput\r\n                type=\"date\"\r\n                value={dateRange.toDate}\r\n                onChange={(e) => handleDateRangeChange('toDate', e.target.value)}\r\n              />\r\n            </FormField>\r\n          </Flex>\r\n        </Card>\r\n      )}\r\n\r\n      {/* å†å²è®°å½•åˆ—è¡¨ */}\r\n      <Box \r\n        maxHeight={maxHeight} \r\n        overflowY=\"auto\"\r\n        border={`1px solid ${colors.soap400}`}\r\n        borderRadius={borderRadius.m}\r\n        padding={space.s}\r\n        backgroundColor={colors.frenchVanilla100}\r\n      >\r\n        {renderHistoryRecords()}\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default TemporalHistoryViewer;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TemporalInfoDisplay.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Box' is defined but never used.","line":2,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Flex, Box } from '@workday/canvas-kit-react/layout';\r\n// import { Badge } from '../../../shared/components/Badge';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { \r\n  temporalStatusUtils \r\n} from './TemporalStatusSelector';\r\nimport type { TemporalStatus } from './TemporalStatusSelector';\r\nimport { validateTemporalDate } from './TemporalDatePicker';\r\n\r\nexport interface TemporalInfo {\r\n  effective_date?: string;\r\n  end_date?: string;\r\n  status?: TemporalStatus;\r\n  is_temporal?: boolean;\r\n  change_reason?: string;\r\n  version?: number;\r\n}\r\n\r\nexport interface TemporalInfoDisplayProps {\r\n  temporalInfo: TemporalInfo;\r\n  variant?: 'default' | 'compact' | 'detailed';\r\n  showChangeReason?: boolean;\r\n  showVersion?: boolean;\r\n}\r\n\r\n// ç®€å•çš„Badgeå®ç°\r\nconst SimpleBadge: React.FC<{ \r\n  children: React.ReactNode; \r\n  variant?: string;\r\n  color?: string;\r\n  style?: React.CSSProperties;\r\n}> = ({ children, style = {}, color = '#666666' }) => (\r\n  <span \r\n    style={{\r\n      display: 'inline-block',\r\n      padding: '2px 8px',\r\n      borderRadius: '12px',\r\n      fontSize: '12px',\r\n      fontWeight: '500',\r\n      backgroundColor: color,\r\n      color: 'white',\r\n      ...style\r\n    }}\r\n  >\r\n    {children}\r\n  </span>\r\n);\r\n\r\nexport const TemporalInfoDisplay: React.FC<TemporalInfoDisplayProps> = ({\r\n  temporalInfo,\r\n  variant = 'default',\r\n  showChangeReason = false,\r\n  showVersion = false,\r\n}) => {\r\n  const {\r\n    effective_date,\r\n    end_date,\r\n    status,\r\n    is_temporal,\r\n    change_reason,\r\n    version,\r\n  } = temporalInfo;\r\n\r\n  // å¦‚æœä¸æ˜¯æ—¶æ€ç»„ç»‡ï¼Œæ˜¾ç¤ºç®€å•çŠ¶æ€\r\n  if (!is_temporal && !effective_date && !end_date) {\r\n    return (\r\n      <SimpleBadge style={{ backgroundColor: '#999999' }}>\r\n        æ ‡å‡†ç»„ç»‡\r\n      </SimpleBadge>\r\n    );\r\n  }\r\n\r\n  // è®¡ç®—å®é™…çŠ¶æ€\r\n  const actualStatus = status || temporalStatusUtils.calculateStatus(effective_date, end_date);\r\n  const statusColor = temporalStatusUtils.getStatusColor(actualStatus);\r\n  const statusIcon = temporalStatusUtils.getStatusIcon(actualStatus);\r\n  const statusLabel = temporalStatusUtils.getStatusLabel(actualStatus);\r\n\r\n  // ç´§å‡‘æ¨¡å¼\r\n  if (variant === 'compact') {\r\n    return (\r\n      <Flex alignItems=\"center\" gap=\"xs\">\r\n        <SimpleBadge style={{ backgroundColor: statusColor }}>\r\n          {statusIcon} {statusLabel}\r\n        </SimpleBadge>\r\n        {effective_date && (\r\n          <Text as=\"span\" typeLevel=\"subtext.large\" color=\"licorice300\">\r\n            {validateTemporalDate.formatDateDisplay(effective_date)}\r\n          </Text>\r\n        )}\r\n      </Flex>\r\n    );\r\n  }\r\n\r\n  // è¯¦ç»†æ¨¡å¼\r\n  if (variant === 'detailed') {\r\n    return (\r\n      <Card padding=\"s\">\r\n        <Flex flexDirection=\"column\" gap=\"xs\">\r\n          <Flex alignItems=\"center\" gap=\"xs\">\r\n            <SimpleBadge style={{ backgroundColor: statusColor }}>\r\n              {statusIcon} {statusLabel}\r\n            </SimpleBadge>\r\n            {version && showVersion && (\r\n              <Text as=\"span\" typeLevel=\"subtext.large\" color=\"licorice300\">\r\n                ç‰ˆæœ¬ {version}\r\n              </Text>\r\n            )}\r\n          </Flex>\r\n\r\n          <Flex flexDirection=\"column\" gap=\"xxs\">\r\n            {effective_date && (\r\n              <Text as=\"div\" typeLevel=\"subtext.large\">\r\n                <strong>ç”Ÿæ•ˆæ—¥æœŸï¼š</strong>\r\n                {validateTemporalDate.formatDateDisplay(effective_date)}\r\n              </Text>\r\n            )}\r\n            {end_date && (\r\n              <Text as=\"div\" typeLevel=\"subtext.large\">\r\n                <strong>ç»“æŸæ—¥æœŸï¼š</strong>\r\n                {validateTemporalDate.formatDateDisplay(end_date)}\r\n              </Text>\r\n            )}\r\n            {change_reason && showChangeReason && (\r\n              <Text as=\"div\" typeLevel=\"subtext.large\" color=\"licorice300\">\r\n                <strong>å˜æ›´åŸå› ï¼š</strong>\r\n                {change_reason}\r\n              </Text>\r\n            )}\r\n          </Flex>\r\n        </Flex>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // é»˜è®¤æ¨¡å¼\r\n  return (\r\n    <Flex alignItems=\"center\" gap=\"s\">\r\n      <SimpleBadge \r\n        style={{ \r\n          backgroundColor: `${statusColor}15`,\r\n          color: statusColor,\r\n          border: `1px solid ${statusColor}`\r\n        }}\r\n      >\r\n        {statusIcon} {statusLabel}\r\n      </SimpleBadge>\r\n      \r\n      <Flex flexDirection=\"column\" gap=\"xxs\">\r\n        {effective_date && (\r\n          <Text as=\"span\" typeLevel=\"subtext.large\" color=\"licorice500\">\r\n            ç”Ÿæ•ˆ: {validateTemporalDate.formatDateDisplay(effective_date)}\r\n          </Text>\r\n        )}\r\n        {end_date && (\r\n          <Text as=\"span\" typeLevel=\"subtext.large\" color=\"licorice500\">\r\n            ç»“æŸ: {validateTemporalDate.formatDateDisplay(end_date)}\r\n          </Text>\r\n        )}\r\n      </Flex>\r\n    </Flex>\r\n  );\r\n};\r\n\r\n// æ—¶æ€çŠ¶æ€å¾½ç« ç»„ä»¶\r\nexport interface TemporalStatusBadgeProps {\r\n  status: TemporalStatus;\r\n  size?: 'small' | 'medium' | 'large';\r\n  showIcon?: boolean;\r\n}\r\n\r\nexport const TemporalStatusBadge: React.FC<TemporalStatusBadgeProps> = ({\r\n  status,\r\n  size = 'medium',\r\n  showIcon = true,\r\n}) => {\r\n  const statusColor = temporalStatusUtils.getStatusColor(status);\r\n  const statusIcon = temporalStatusUtils.getStatusIcon(status);\r\n  const statusLabel = temporalStatusUtils.getStatusLabel(status);\r\n\r\n  const padding = size === 'small' ? '2px 6px' : size === 'large' ? '6px 12px' : '4px 8px';\r\n  const fontSize = size === 'small' ? '11px' : size === 'large' ? '14px' : '12px';\r\n\r\n  return (\r\n    <SimpleBadge \r\n      style={{\r\n        backgroundColor: statusColor,\r\n        padding,\r\n        fontSize\r\n      }}\r\n    >\r\n      {showIcon && statusIcon} {statusLabel}\r\n    </SimpleBadge>\r\n  );\r\n};\r\n\r\n// æ—¶æ€æ—¥æœŸèŒƒå›´æ˜¾ç¤ºç»„ä»¶\r\nexport interface TemporalDateRangeProps {\r\n  effectiveDate?: string;\r\n  endDate?: string;\r\n  format?: 'short' | 'long';\r\n  separator?: string;\r\n}\r\n\r\nexport const TemporalDateRange: React.FC<TemporalDateRangeProps> = ({\r\n  effectiveDate,\r\n  endDate,\r\n  format = 'short',\r\n  separator = ' - ',\r\n}) => {\r\n  const formatDate = format === 'long' \r\n    ? validateTemporalDate.formatDateDisplay\r\n    : (date: string) => date;\r\n\r\n  if (!effectiveDate && !endDate) {\r\n    return <Text as=\"span\" typeLevel=\"subtext.large\" color=\"licorice300\">æ— æ—¶æ€é™åˆ¶</Text>;\r\n  }\r\n\r\n  if (effectiveDate && !endDate) {\r\n    return (\r\n      <Text as=\"span\" typeLevel=\"subtext.large\" color=\"licorice500\">\r\n        {formatDate(effectiveDate)} èµ·ç”Ÿæ•ˆ\r\n      </Text>\r\n    );\r\n  }\r\n\r\n  if (!effectiveDate && endDate) {\r\n    return (\r\n      <Text as=\"span\" typeLevel=\"subtext.large\" color=\"licorice500\">\r\n        è‡³ {formatDate(endDate)} ç»“æŸ\r\n      </Text>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Text as=\"span\" typeLevel=\"subtext.large\" color=\"licorice500\">\r\n      {formatDate(effectiveDate!)}{separator}{formatDate(endDate!)}\r\n    </Text>\r\n  );\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TemporalMasterDetailView.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'space' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'index' is defined but never used.","line":161,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":161,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6565,6568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6565,6568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":339,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10843,10846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10843,10846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€ç®¡ç†ä¸»ä»è§†å›¾ç»„ä»¶\r\n * å·¦ä¾§ï¼šå‚ç›´äº¤äº’å¼æ—¶é—´è½´å¯¼èˆª\r\n * å³ä¾§ï¼šåŠ¨æ€ç‰ˆæœ¬è¯¦æƒ…å¡ç‰‡\r\n * å®ç°å¼ºåˆ¶æ—¶é—´è¿ç»­æ€§çš„å®Œæ•´ç”¨æˆ·ä½“éªŒ\r\n */\r\nimport React, { useState, useCallback, useEffect } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text, Heading } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton, TertiaryButton, ToolbarIconButton as IconButton } from '@workday/canvas-kit-react/button';\r\nimport { Badge } from '../../../shared/components/Badge';\r\nimport { Tooltip } from '@workday/canvas-kit-react/tooltip';\r\nimport { Modal } from '@workday/canvas-kit-react/modal';\r\nimport TemporalEditForm, { type TemporalEditFormData } from './TemporalEditForm';\r\nimport { InlineNewVersionForm } from './InlineNewVersionForm';\r\nimport { SimpleTimelineVisualization } from './SimpleTimelineVisualization';\r\nimport { LoadingDots } from '@workday/canvas-kit-react/loading-dots';\r\nimport { \r\n  colors, \r\n  space, \r\n  borderRadius \r\n} from '@workday/canvas-kit-react/tokens';\r\n// æš‚æ—¶ä½¿ç”¨æ–‡æœ¬å›¾æ ‡æ›¿ä»£\r\n// import {\r\n//   addIcon,\r\n//   editIcon,\r\n//   deleteIcon,\r\n//   moreVerticalIcon,\r\n//   calendarIcon,\r\n//   infoIcon,\r\n//   warningIcon\r\n// } from '@workday/canvas-system-icons-web';\r\n\r\n// Types\r\nexport interface TemporalVersion {\r\n  code: string;\r\n  name: string;\r\n  unit_type: string;\r\n  status: string;\r\n  effective_date: string;\r\n  end_date?: string | null;\r\n  change_reason?: string;\r\n  is_current: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n  description?: string;\r\n  level: number;\r\n  path: string;\r\n  parent_code?: string;\r\n  sort_order: number;\r\n}\r\n\r\nexport interface TemporalMasterDetailViewProps {\r\n  organizationCode: string;\r\n  onBack?: () => void;\r\n  readonly?: boolean;\r\n}\r\n\r\n/**\r\n * å·¦ä¾§å‚ç›´æ—¶é—´è½´å¯¼èˆªåŒº\r\n */\r\ninterface TimelineNavigationProps {\r\n  versions: TemporalVersion[];\r\n  selectedVersion: TemporalVersion | null;\r\n  onVersionSelect: (version: TemporalVersion) => void;\r\n  onAddVersion?: () => void;\r\n  onDeleteVersion?: (version: TemporalVersion) => void;\r\n  isLoading: boolean;\r\n  readonly?: boolean;\r\n}\r\n\r\nconst TimelineNavigation: React.FC<TimelineNavigationProps> = ({\r\n  versions,\r\n  selectedVersion,\r\n  onVersionSelect,\r\n  onAddVersion,\r\n  onDeleteVersion,\r\n  isLoading,\r\n  readonly = false\r\n}) => {\r\n  // è·å–ç‰ˆæœ¬çŠ¶æ€æŒ‡ç¤ºå™¨\r\n  const getVersionStatusIndicator = (version: TemporalVersion) => {\r\n    const today = new Date();\r\n    const effectiveDate = new Date(version.effective_date);\r\n    const endDate = version.end_date ? new Date(version.end_date) : null;\r\n    \r\n    if (version.is_current) {\r\n      return { color: '#2ECC71', icon: 'ğŸŸ¢', label: 'ç”Ÿæ•ˆä¸­' }; // ç»¿è‰²\r\n    } else if (effectiveDate > today) {\r\n      return { color: '#3498DB', icon: 'ğŸ”µ', label: 'è®¡åˆ’ä¸­' }; // è“è‰²\r\n    } else if (endDate && endDate < today) {\r\n      return { color: '#95A5A6', icon: 'âš«', label: 'å·²ç»“æŸ' }; // ç°è‰²\r\n    } else {\r\n      return { color: '#E74C3C', icon: 'ğŸ”´', label: 'å·²ä½œåºŸ' }; // çº¢è‰²\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateStr: string) => {\r\n    return new Date(dateStr).toLocaleDateString('zh-CN');\r\n  };\r\n\r\n  const formatDateRange = (startDate: string, endDate?: string | null) => {\r\n    const start = formatDate(startDate);\r\n    if (!endDate) return `${start} ~ è‡³ä»Š`;\r\n    return `${start} ~ ${formatDate(endDate)}`;\r\n  };\r\n\r\n  return (\r\n    <Box\r\n      width=\"350px\"\r\n      height=\"calc(100vh - 200px)\"\r\n      backgroundColor=\"#F8F9FA\"\r\n      borderRadius={borderRadius.m}\r\n      border=\"1px solid #E9ECEF\"\r\n      padding=\"m\"\r\n      overflowY=\"auto\"\r\n    >\r\n      {/* æ“ä½œåŒºåŸŸ */}\r\n      <Box marginBottom=\"m\">\r\n        <Flex justifyContent=\"space-between\" alignItems=\"center\" marginBottom=\"s\">\r\n          <Heading size=\"small\">æ—¶é—´è½´å¯¼èˆª</Heading>\r\n          {!readonly && onAddVersion && (\r\n            <Tooltip title=\"æ–°å¢ç‰ˆæœ¬\">\r\n              <IconButton\r\n                aria-label=\"æ–°å¢ç‰ˆæœ¬\"\r\n                size=\"small\"\r\n                variant=\"square\"\r\n                onClick={onAddVersion}\r\n              >\r\n                â•\r\n              </IconButton>\r\n            </Tooltip>\r\n          )}\r\n        </Flex>\r\n        <Text typeLevel=\"subtext.small\" color=\"hint\">\r\n          ç‚¹å‡»ç‰ˆæœ¬èŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ…\r\n        </Text>\r\n      </Box>\r\n\r\n      {/* æ—¶é—´è½´èŠ‚ç‚¹åˆ—è¡¨ */}\r\n      {isLoading ? (\r\n        <Box textAlign=\"center\" padding=\"l\">\r\n          <LoadingDots />\r\n          <Text marginTop=\"s\" typeLevel=\"subtext.small\">åŠ è½½ä¸­...</Text>\r\n        </Box>\r\n      ) : (\r\n        <Box position=\"relative\">\r\n          {/* æ—¶é—´çº¿è¿æ¥çº¿ */}\r\n          <Box\r\n            position=\"absolute\"\r\n            left=\"15px\"\r\n            top=\"20px\"\r\n            bottom=\"20px\"\r\n            width=\"2px\"\r\n            backgroundColor=\"#DEE2E6\"\r\n            zIndex={0}\r\n          />\r\n\r\n          {/* ç‰ˆæœ¬èŠ‚ç‚¹ */}\r\n          {versions.map((version, index) => {\r\n            const statusInfo = getVersionStatusIndicator(version);\r\n            const isSelected = selectedVersion?.effective_date === version.effective_date;\r\n            \r\n            return (\r\n              <Box\r\n                key={`${version.code}-${version.effective_date}`}\r\n                position=\"relative\"\r\n                marginBottom=\"m\"\r\n                zIndex={1}\r\n              >\r\n                {/* èŠ‚ç‚¹åœ†ç‚¹ */}\r\n                <Box\r\n                  position=\"absolute\"\r\n                  left=\"-4px\"\r\n                  top=\"8px\"\r\n                  width=\"12px\"\r\n                  height=\"12px\"\r\n                  borderRadius=\"50%\"\r\n                  backgroundColor={statusInfo.color}\r\n                  border=\"2px solid white\"\r\n                  boxShadow=\"0 2px 4px rgba(0,0,0,0.1)\"\r\n                />\r\n\r\n                {/* èŠ‚ç‚¹å†…å®¹å¡ç‰‡ */}\r\n                <Box marginLeft=\"32px\">\r\n                  <Card\r\n                    padding=\"s\"\r\n                    style={{\r\n                      backgroundColor: isSelected ? '#E3F2FD' : 'white',\r\n                      border: isSelected ? '2px solid #2196F3' : '1px solid #E9ECEF',\r\n                      cursor: 'pointer',\r\n                      transition: 'all 0.2s ease'\r\n                    }}\r\n                    onClick={() => onVersionSelect(version)}\r\n                  >\r\n                    {/* èŠ‚ç‚¹å¤´éƒ¨ */}\r\n                    <Flex justifyContent=\"space-between\" alignItems=\"flex-start\" marginBottom=\"xs\">\r\n                      <Box flex=\"1\">\r\n                        <Text typeLevel=\"subtext.medium\" fontWeight=\"bold\">\r\n                          {formatDate(version.effective_date)}\r\n                        </Text>\r\n                        <Badge \r\n                          color={statusInfo.color.replace('#', '') as any}\r\n                          size=\"small\"\r\n                        >\r\n                          {statusInfo.label}\r\n                        </Badge>\r\n                      </Box>\r\n                      \r\n                      {!readonly && onDeleteVersion && !version.is_current && (\r\n                        <Tooltip title=\"ä½œåºŸç‰ˆæœ¬\">\r\n                          <IconButton\r\n                            aria-label=\"ä½œåºŸç‰ˆæœ¬\"\r\n                            size=\"small\"\r\n                            variant=\"square\"\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              onDeleteVersion(version);\r\n                            }}\r\n                          >\r\n                            ğŸ—‘ï¸\r\n                          </IconButton>\r\n                        </Tooltip>\r\n                      )}\r\n                    </Flex>\r\n\r\n                    {/* ç‰ˆæœ¬åç§° */}\r\n                    <Text \r\n                      typeLevel=\"body.small\" \r\n                      fontWeight=\"medium\"\r\n                      marginBottom=\"xs\"\r\n                      style={{ \r\n                        whiteSpace: 'nowrap',\r\n                        overflow: 'hidden',\r\n                        textOverflow: 'ellipsis'\r\n                      }}\r\n                    >\r\n                      {version.name}\r\n                    </Text>\r\n\r\n                    {/* å˜æ›´æ‘˜è¦ */}\r\n                    {version.change_reason && (\r\n                      <Text \r\n                        typeLevel=\"subtext.small\" \r\n                        color=\"hint\"\r\n                        style={{ \r\n                          whiteSpace: 'nowrap',\r\n                          overflow: 'hidden',\r\n                          textOverflow: 'ellipsis'\r\n                        }}\r\n                      >\r\n                        {version.change_reason}\r\n                      </Text>\r\n                    )}\r\n\r\n                    {/* æ—¶é—´èŒƒå›´ */}\r\n                    <Text typeLevel=\"subtext.small\" color=\"hint\" marginTop=\"xs\">\r\n                      {formatDateRange(version.effective_date, version.end_date)}\r\n                    </Text>\r\n                  </Card>\r\n                </Box>\r\n              </Box>\r\n            );\r\n          })}\r\n\r\n          {versions.length === 0 && (\r\n            <Box textAlign=\"center\" padding=\"l\">\r\n              <Text color=\"hint\">æš‚æ— ç‰ˆæœ¬è®°å½•</Text>\r\n            </Box>\r\n          )}\r\n        </Box>\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\n/**\r\n * å³ä¾§åŠ¨æ€ç‰ˆæœ¬è¯¦æƒ…å¡ç‰‡åŒº\r\n */\r\ninterface VersionDetailCardProps {\r\n  version: TemporalVersion | null;\r\n  onEdit?: (version: TemporalVersion) => void;\r\n  onDelete?: (version: TemporalVersion) => void;\r\n  isLoading?: boolean;\r\n  readonly?: boolean;\r\n}\r\n\r\nconst VersionDetailCard: React.FC<VersionDetailCardProps> = ({\r\n  version,\r\n  onEdit,\r\n  onDelete,\r\n  isLoading = false,\r\n  readonly = false\r\n}) => {\r\n  if (!version) {\r\n    return (\r\n      <Box\r\n        flex=\"1\"\r\n        padding=\"l\"\r\n        display=\"flex\"\r\n        alignItems=\"center\"\r\n        justifyContent=\"center\"\r\n        backgroundColor=\"#F8F9FA\"\r\n        borderRadius={borderRadius.m}\r\n        border=\"1px solid #E9ECEF\"\r\n      >\r\n        <Box textAlign=\"center\">\r\n          <img src=\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiPjxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjIwIiBmaWxsPSIjQ0NDIi8+PC9zdmc+\" width={48} height={48} alt=\"Calendar\" />\r\n          <Text typeLevel=\"subtext.large\" color=\"hint\" marginTop=\"m\">\r\n            è¯·é€‰æ‹©å·¦ä¾§æ—¶é—´è½´èŠ‚ç‚¹æŸ¥çœ‹ç‰ˆæœ¬è¯¦æƒ…\r\n          </Text>\r\n        </Box>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  const getUnitTypeName = (unitType: string) => {\r\n    const typeNames = {\r\n      'COMPANY': 'å…¬å¸',\r\n      'DEPARTMENT': 'éƒ¨é—¨', \r\n      'COST_CENTER': 'æˆæœ¬ä¸­å¿ƒ',\r\n      'PROJECT_TEAM': 'é¡¹ç›®å›¢é˜Ÿ'\r\n    };\r\n    return typeNames[unitType as keyof typeof typeNames] || unitType;\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const statusConfig = {\r\n      'ACTIVE': { label: 'å¯ç”¨', color: 'greenFresca600' },\r\n      'INACTIVE': { label: 'åœç”¨', color: 'cinnamon600' },\r\n      'PLANNED': { label: 'è®¡åˆ’ä¸­', color: 'blueberry600' }\r\n    };\r\n    \r\n    const config = statusConfig[status as keyof typeof statusConfig] || { \r\n      label: status, \r\n      color: 'licorice400' \r\n    };\r\n    return <Badge color={config.color as any}>{config.label}</Badge>;\r\n  };\r\n\r\n  // æ™ºèƒ½æ“ä½œæŒ‰é’®é€»è¾‘\r\n  const getButtonState = () => {\r\n    const today = new Date();\r\n    const effectiveDate = new Date(version.effective_date);\r\n    const endDate = version.end_date ? new Date(version.end_date) : null;\r\n    \r\n    if (endDate && endDate < today) {\r\n      // å†å²è®°å½•\r\n      return { \r\n        edit: 'disabled', \r\n        delete: 'disabled', \r\n        tooltip: 'å†å²è®°å½•ä¸å¯ä¿®æ”¹' \r\n      };\r\n    } else if (version.is_current) {\r\n      // å½“å‰ç‰ˆæœ¬\r\n      return { \r\n        edit: 'limited', \r\n        delete: 'confirm-as-invalid', \r\n        tooltip: 'å½“å‰ç‰ˆæœ¬éœ€è°¨æ…æ“ä½œ' \r\n      };\r\n    } else if (effectiveDate > today) {\r\n      // æœªæ¥ç‰ˆæœ¬\r\n      return { \r\n        edit: 'enabled', \r\n        delete: 'enabled', \r\n        tooltip: 'å¯è‡ªç”±ç¼–è¾‘è®¡åˆ’ç‰ˆæœ¬' \r\n      };\r\n    }\r\n    \r\n    return { edit: 'enabled', delete: 'enabled', tooltip: '' };\r\n  };\r\n\r\n  const buttonState = getButtonState();\r\n\r\n  return (\r\n    <Box flex=\"1\" padding=\"m\">\r\n      <Card padding=\"l\">\r\n        {/* åŠ¨æ€æ ‡é¢˜ */}\r\n        <Flex justifyContent=\"space-between\" alignItems=\"flex-start\" marginBottom=\"l\">\r\n          <Box>\r\n            <Heading size=\"medium\" marginBottom=\"s\">\r\n              ç‰ˆæœ¬è¯¦æƒ… (ç”Ÿæ•ˆäº: {new Date(version.effective_date).toLocaleDateString('zh-CN')})\r\n            </Heading>\r\n            <Flex alignItems=\"center\" gap=\"s\">\r\n              {getStatusBadge(version.status)}\r\n              {version.is_current && (\r\n                <Badge color=\"greenFresca600\">å½“å‰ç‰ˆæœ¬</Badge>\r\n              )}\r\n            </Flex>\r\n          </Box>\r\n\r\n          {/* æ™ºèƒ½æ“ä½œæŒ‰é’® */}\r\n          {!readonly && (\r\n            <Flex gap=\"s\">\r\n              <Tooltip title={buttonState.edit === 'disabled' ? buttonState.tooltip : 'ç¼–è¾‘ç‰ˆæœ¬'}>\r\n                <PrimaryButton\r\n                  size=\"small\"\r\n                  disabled={buttonState.edit === 'disabled' || isLoading}\r\n                  onClick={() => onEdit?.(version)}\r\n                >\r\n                  âœï¸ ç¼–è¾‘\r\n                </PrimaryButton>\r\n              </Tooltip>\r\n              \r\n              <Tooltip title={buttonState.delete === 'disabled' ? buttonState.tooltip : 'ä½œåºŸç‰ˆæœ¬'}>\r\n                <SecondaryButton\r\n                  size=\"small\"\r\n                  disabled={buttonState.delete === 'disabled' || isLoading}\r\n                  onClick={() => onDelete?.(version)}\r\n                >\r\n                  ğŸ—‘ï¸ ä½œåºŸ\r\n                </SecondaryButton>\r\n              </Tooltip>\r\n            </Flex>\r\n          )}\r\n        </Flex>\r\n\r\n        {/* ç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯ */}\r\n        <Box display=\"grid\" gridTemplateColumns=\"repeat(auto-fit, minmax(250px, 1fr))\" gap=\"m\">\r\n          {/* åŸºæœ¬ä¿¡æ¯ */}\r\n          <Box>\r\n            <Text typeLevel=\"subtext.medium\" fontWeight=\"bold\" marginBottom=\"s\" color={colors.blueberry600}>\r\n              ğŸ“‹ åŸºæœ¬ä¿¡æ¯\r\n            </Text>\r\n            <Box marginLeft=\"m\">\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>ç»„ç»‡åç§°:</strong> {version.name}\r\n              </Text>\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>ç»„ç»‡ç¼–ç :</strong> {version.code}\r\n              </Text>\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>ç»„ç»‡ç±»å‹:</strong> {getUnitTypeName(version.unit_type)}\r\n              </Text>\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>å½“å‰çŠ¶æ€:</strong> {version.status}\r\n              </Text>\r\n            </Box>\r\n          </Box>\r\n\r\n          {/* å±‚çº§ä¿¡æ¯ */}\r\n          <Box>\r\n            <Text typeLevel=\"subtext.medium\" fontWeight=\"bold\" marginBottom=\"s\" color={colors.peach600}>\r\n              ğŸ—ï¸ å±‚çº§ç»“æ„\r\n            </Text>\r\n            <Box marginLeft=\"m\">\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>å±‚çº§:</strong> ç¬¬ {version.level} çº§\r\n              </Text>\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>ä¸Šçº§ç»„ç»‡:</strong> {version.parent_code || 'æ— '}\r\n              </Text>\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>è·¯å¾„:</strong> {version.path}\r\n              </Text>\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>æ’åº:</strong> {version.sort_order}\r\n              </Text>\r\n            </Box>\r\n          </Box>\r\n\r\n          {/* æ—¶æ€ä¿¡æ¯ */}\r\n          <Box>\r\n            <Text typeLevel=\"subtext.medium\" fontWeight=\"bold\" marginBottom=\"s\" color={colors.greenFresca600}>\r\n              â° ç”Ÿæ•ˆæœŸé—´\r\n            </Text>\r\n            <Box marginLeft=\"m\">\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>ç”Ÿæ•ˆæ—¥æœŸ:</strong> {new Date(version.effective_date).toLocaleDateString('zh-CN')}\r\n              </Text>\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>å¤±æ•ˆæ—¥æœŸ:</strong> {\r\n                  version.end_date \r\n                    ? new Date(version.end_date).toLocaleDateString('zh-CN')\r\n                    : 'æ— é™æœŸæœ‰æ•ˆ'\r\n                }\r\n              </Text>\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>å˜æ›´åŸå› :</strong> {version.change_reason || 'æ— '}\r\n              </Text>\r\n            </Box>\r\n          </Box>\r\n\r\n          {/* ç³»ç»Ÿä¿¡æ¯ */}\r\n          <Box>\r\n            <Text typeLevel=\"subtext.medium\" fontWeight=\"bold\" marginBottom=\"s\" color={colors.cantaloupe600}>\r\n              ğŸ”§ ç³»ç»Ÿä¿¡æ¯\r\n            </Text>\r\n            <Box marginLeft=\"m\">\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>åˆ›å»ºæ—¶é—´:</strong> {new Date(version.created_at).toLocaleString('zh-CN')}\r\n              </Text>\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>æ›´æ–°æ—¶é—´:</strong> {new Date(version.updated_at).toLocaleString('zh-CN')}\r\n              </Text>\r\n              <Text typeLevel=\"body.small\" marginBottom=\"xs\">\r\n                <strong>æ˜¯å¦å½“å‰:</strong> {version.is_current ? 'æ˜¯' : 'å¦'}\r\n              </Text>\r\n            </Box>\r\n          </Box>\r\n        </Box>\r\n\r\n        {/* æè¿°ä¿¡æ¯ */}\r\n        {version.description && (\r\n          <Box marginTop=\"m\" padding=\"m\" backgroundColor={colors.soap300} borderRadius={borderRadius.s}>\r\n            <Text typeLevel=\"subtext.medium\" fontWeight=\"bold\" marginBottom=\"s\">\r\n              ğŸ“ æè¿°ä¿¡æ¯\r\n            </Text>\r\n            <Text typeLevel=\"body.medium\">\r\n              {version.description}\r\n            </Text>\r\n          </Box>\r\n        )}\r\n      </Card>\r\n    </Box>\r\n  );\r\n};\r\n\r\n/**\r\n * æ—¶æ€ç®¡ç†ä¸»ä»è§†å›¾ä¸»ç»„ä»¶\r\n */\r\nexport const TemporalMasterDetailView: React.FC<TemporalMasterDetailViewProps> = ({\r\n  organizationCode,\r\n  onBack,\r\n  readonly = false\r\n}) => {\r\n  // çŠ¶æ€ç®¡ç†\r\n  const [versions, setVersions] = useState<TemporalVersion[]>([]);\r\n  const [selectedVersion, setSelectedVersion] = useState<TemporalVersion | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState<TemporalVersion | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  \r\n  // ç¼–è¾‘è¡¨å•çŠ¶æ€\r\n  const [showEditForm, setShowEditForm] = useState(false);\r\n  const [editMode, setEditMode] = useState<'create' | 'edit'>('create');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  \r\n  // è§†å›¾é€‰é¡¹å¡çŠ¶æ€\r\n  const [activeTab, setActiveTab] = useState<'details' | 'timeline' | 'new-version'>('details');\r\n\r\n  // åŠ è½½æ—¶æ€ç‰ˆæœ¬æ•°æ®\r\n  const loadVersions = useCallback(async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const response = await fetch(\r\n        `http://localhost:9091/api/v1/organization-units/${organizationCode}/temporal?include_history=true&include_future=true`,\r\n        {\r\n          method: 'GET',\r\n          headers: { 'Content-Type': 'application/json' }\r\n        }\r\n      );\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const sortedVersions = data.organizations.sort((a: TemporalVersion, b: TemporalVersion) => \r\n          new Date(b.effective_date).getTime() - new Date(a.effective_date).getTime()\r\n        );\r\n        setVersions(sortedVersions);\r\n        \r\n        // é»˜è®¤é€‰ä¸­å½“å‰ç‰ˆæœ¬\r\n        const currentVersion = sortedVersions.find((v: TemporalVersion) => v.is_current);\r\n        if (currentVersion) {\r\n          setSelectedVersion(currentVersion);\r\n        } else if (sortedVersions.length > 0) {\r\n          setSelectedVersion(sortedVersions[0]);\r\n        }\r\n      } else {\r\n        console.error('Failed to load temporal versions:', response.statusText);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading temporal versions:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [organizationCode]);\r\n\r\n  // ä½œåºŸç‰ˆæœ¬å¤„ç†\r\n  const handleDeleteVersion = useCallback(async (version: TemporalVersion) => {\r\n    if (!version || isDeleting) return;\r\n    \r\n    try {\r\n      setIsDeleting(true);\r\n      \r\n      // ä½¿ç”¨DEACTIVATEäº‹ä»¶è€Œä¸æ˜¯DELETEè¯·æ±‚\r\n      const response = await fetch(\r\n        `http://localhost:9091/api/v1/organization-units/${organizationCode}/events`,\r\n        {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            event_type: 'DEACTIVATE',\r\n            effective_date: version.effective_date,\r\n            change_reason: 'é€šè¿‡æ—¶æ€ç®¡ç†é¡µé¢ä½œåºŸç‰ˆæœ¬'\r\n          })\r\n        }\r\n      );\r\n      \r\n      if (response.ok) {\r\n        // åˆ·æ–°æ•°æ®\r\n        await loadVersions();\r\n        setShowDeleteConfirm(null);\r\n        \r\n        // å¦‚æœä½œåºŸçš„æ˜¯é€‰ä¸­çš„ç‰ˆæœ¬ï¼Œé‡æ–°é€‰æ‹©\r\n        if (selectedVersion?.effective_date === version.effective_date) {\r\n          setSelectedVersion(null);\r\n        }\r\n      } else {\r\n        console.error('Failed to deactivate version:', response.statusText);\r\n        alert('ä½œåºŸå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deactivating version:', error);\r\n      alert('ä½œåºŸå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  }, [organizationCode, selectedVersion, isDeleting, loadVersions]);\r\n\r\n  // ç¼–è¾‘åŠŸèƒ½å¤„ç†\r\n  const handleCreateVersion = useCallback(() => {\r\n    setEditMode('create');\r\n    setSelectedVersion(null);\r\n    setActiveTab('new-version'); // åˆ‡æ¢åˆ°æ–°å¢ç‰ˆæœ¬é€‰é¡¹å¡ï¼Œè€Œä¸æ˜¯æ‰“å¼€Modal\r\n  }, []);\r\n\r\n  const handleEditVersion = useCallback((version: TemporalVersion) => {\r\n    setEditMode('edit');\r\n    setSelectedVersion(version);\r\n    setShowEditForm(true);\r\n  }, []);\r\n\r\n  const handleFormSubmit = useCallback(async (formData: TemporalEditFormData) => {\r\n    setIsSubmitting(true);\r\n    try {\r\n      const response = await fetch(\r\n        `http://localhost:9091/api/v1/organization-units/${organizationCode}/events`,\r\n        {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            event_type: formData.event_type,\r\n            effective_date: new Date(formData.effective_date + 'T00:00:00Z').toISOString(),\r\n            change_data: {\r\n              name: formData.name,\r\n              unit_type: formData.unit_type,\r\n              status: formData.status,\r\n              description: formData.description\r\n            },\r\n            change_reason: formData.change_reason\r\n          })\r\n        }\r\n      );\r\n      \r\n      if (response.ok) {\r\n        // åˆ·æ–°æ•°æ®\r\n        await loadVersions();\r\n        setActiveTab('details'); // åˆ›å»ºæˆåŠŸååˆ‡æ¢å›è¯¦æƒ…é€‰é¡¹å¡\r\n        alert('æ—¶æ€ç‰ˆæœ¬åˆ›å»ºæˆåŠŸï¼');\r\n      } else {\r\n        const errorData = await response.json();\r\n        console.error('åˆ›å»ºå¤±è´¥:', errorData);\r\n        alert(`åˆ›å»ºå¤±è´¥: ${errorData.message}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('åˆ›å»ºæ—¶æ€ç‰ˆæœ¬å¤±è´¥:', error);\r\n      alert('åˆ›å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  }, [organizationCode, loadVersions]);\r\n\r\n  const handleFormClose = useCallback(() => {\r\n    if (!isSubmitting) {\r\n      setActiveTab('details'); // å–æ¶ˆæ—¶åˆ‡æ¢å›è¯¦æƒ…é€‰é¡¹å¡\r\n      setSelectedVersion(null);\r\n    }\r\n  }, [isSubmitting]);\r\n\r\n  // ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®\r\n  useEffect(() => {\r\n    loadVersions();\r\n  }, [loadVersions]);\r\n\r\n  return (\r\n    <Box padding=\"l\">\r\n      {/* é¡µé¢å¤´éƒ¨ */}\r\n      <Flex justifyContent=\"space-between\" alignItems=\"center\" marginBottom=\"l\">\r\n        <Box>\r\n          <Heading size=\"large\">æ—¶æ€ç®¡ç† - {organizationCode}</Heading>\r\n          <Text typeLevel=\"subtext.medium\" color=\"hint\">\r\n            å¼ºåˆ¶æ—¶é—´è¿ç»­æ€§çš„ç»„ç»‡æ¶æ„ç®¡ç†\r\n          </Text>\r\n        </Box>\r\n        \r\n        <Flex gap=\"s\">\r\n          <SecondaryButton onClick={loadVersions} disabled={isLoading}>\r\n            ğŸ”„ åˆ·æ–°\r\n          </SecondaryButton>\r\n          {onBack && (\r\n            <TertiaryButton onClick={onBack}>\r\n              â† è¿”å›\r\n            </TertiaryButton>\r\n          )}\r\n        </Flex>\r\n      </Flex>\r\n\r\n      {/* ä¸»ä»è§†å›¾å¸ƒå±€ */}\r\n      <Flex gap=\"l\" height=\"calc(100vh - 220px)\">\r\n        {/* å·¦ä¾§ï¼šå‚ç›´äº¤äº’å¼æ—¶é—´è½´å¯¼èˆª */}\r\n        <TimelineNavigation\r\n          versions={versions}\r\n          selectedVersion={selectedVersion}\r\n          onVersionSelect={setSelectedVersion}\r\n          onAddVersion={readonly ? undefined : handleCreateVersion}\r\n          onDeleteVersion={readonly ? undefined : (version) => setShowDeleteConfirm(version)}\r\n          isLoading={isLoading}\r\n          readonly={readonly}\r\n        />\r\n\r\n        {/* å³ä¾§ï¼šé€‰é¡¹å¡è§†å›¾ */}\r\n        <Box flex=\"1\">\r\n          {/* é€‰é¡¹å¡å¤´éƒ¨ */}\r\n          <Flex marginBottom=\"m\" gap=\"s\">\r\n            <SecondaryButton\r\n              size=\"small\"\r\n              onClick={() => setActiveTab('details')}\r\n              variant={activeTab === 'details' ? 'primary' : 'secondary'}\r\n              style={{\r\n                backgroundColor: activeTab === 'details' ? colors.blueberry600 : 'transparent',\r\n                color: activeTab === 'details' ? 'white' : colors.blueberry600\r\n              }}\r\n            >\r\n              ğŸ“‹ ç‰ˆæœ¬è¯¦æƒ…\r\n            </SecondaryButton>\r\n            <SecondaryButton\r\n              size=\"small\"\r\n              onClick={() => setActiveTab('timeline')}\r\n              variant={activeTab === 'timeline' ? 'primary' : 'secondary'}\r\n              style={{\r\n                backgroundColor: activeTab === 'timeline' ? colors.blueberry600 : 'transparent',\r\n                color: activeTab === 'timeline' ? 'white' : colors.blueberry600\r\n              }}\r\n            >\r\n              ğŸ“Š æ—¶é—´çº¿å¯è§†åŒ–\r\n            </SecondaryButton>\r\n            <SecondaryButton\r\n              size=\"small\"\r\n              onClick={() => setActiveTab('new-version')}\r\n              variant={activeTab === 'new-version' ? 'primary' : 'secondary'}\r\n              style={{\r\n                backgroundColor: activeTab === 'new-version' ? colors.greenFresca600 : 'transparent',\r\n                color: activeTab === 'new-version' ? 'white' : colors.greenFresca600\r\n              }}\r\n            >\r\n              â• æ–°å¢ç‰ˆæœ¬\r\n            </SecondaryButton>\r\n          </Flex>\r\n\r\n          {/* é€‰é¡¹å¡å†…å®¹ */}\r\n          {activeTab === 'details' ? (\r\n            <VersionDetailCard\r\n              version={selectedVersion}\r\n              onEdit={readonly ? undefined : handleEditVersion}\r\n              onDelete={readonly ? undefined : (version) => setShowDeleteConfirm(version)}\r\n              isLoading={isLoading}\r\n              readonly={readonly}\r\n            />\r\n          ) : activeTab === 'timeline' ? (\r\n            <SimpleTimelineVisualization\r\n              organizationCode={organizationCode}\r\n              onRefresh={loadVersions}\r\n            />\r\n          ) : (\r\n            <InlineNewVersionForm\r\n              organizationCode={organizationCode}\r\n              onSubmit={handleFormSubmit}\r\n              onCancel={handleFormClose}\r\n              isSubmitting={isSubmitting}\r\n            />\r\n          )}\r\n        </Box>\r\n      </Flex>\r\n\r\n      {/* ä½œåºŸç¡®è®¤å¯¹è¯æ¡† */}\r\n      {showDeleteConfirm && (\r\n        <Modal\r\n          onClose={() => setShowDeleteConfirm(null)}\r\n          heading=\"ç¡®è®¤ä½œåºŸç‰ˆæœ¬\"\r\n        >\r\n          <Box padding=\"l\">\r\n            <Flex alignItems=\"flex-start\" gap=\"m\" marginBottom=\"l\">\r\n              <Box fontSize=\"24px\" color={colors.cinnamon600}>âš ï¸</Box>\r\n              <Box>\r\n                <Text typeLevel=\"body.medium\" marginBottom=\"s\">\r\n                  ç¡®å®šè¦ä½œåºŸç”Ÿæ•ˆæ—¥æœŸä¸º <strong>{new Date(showDeleteConfirm.effective_date).toLocaleDateString('zh-CN')}</strong> çš„ç‰ˆæœ¬å—ï¼Ÿ\r\n                </Text>\r\n                <Text typeLevel=\"subtext.small\" color=\"hint\" marginBottom=\"s\">\r\n                  ç‰ˆæœ¬åç§°: {showDeleteConfirm.name}\r\n                </Text>\r\n                <Text typeLevel=\"subtext.small\" color={colors.cinnamon600}>\r\n                  âš ï¸ ä½œåºŸåå°†è‡ªåŠ¨å¡«è¡¥æ—¶é—´ç©ºæ´ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€\r\n                </Text>\r\n              </Box>\r\n            </Flex>\r\n            \r\n            <Flex gap=\"s\" justifyContent=\"flex-end\">\r\n              <SecondaryButton \r\n                onClick={() => setShowDeleteConfirm(null)}\r\n                disabled={isDeleting}\r\n              >\r\n                å–æ¶ˆ\r\n              </SecondaryButton>\r\n              <PrimaryButton \r\n                onClick={() => handleDeleteVersion(showDeleteConfirm)}\r\n                disabled={isDeleting}\r\n              >\r\n                {isDeleting ? 'ä½œåºŸä¸­...' : 'ç¡®è®¤ä½œåºŸ'}\r\n              </PrimaryButton>\r\n            </Flex>\r\n          </Box>\r\n        </Modal>\r\n      )}\r\n\r\n      {/* ç¼–è¾‘è¡¨å• - ä¿ç•™ç”¨äºç¼–è¾‘ç°æœ‰ç‰ˆæœ¬ */}\r\n      {editMode === 'edit' && (\r\n        <TemporalEditForm\r\n          isOpen={showEditForm}\r\n          onClose={handleFormClose}\r\n          onSubmit={handleFormSubmit}\r\n          organizationCode={organizationCode}\r\n          initialData={selectedVersion}\r\n          mode={editMode}\r\n          isSubmitting={isSubmitting}\r\n        />\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default TemporalMasterDetailView;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TemporalNavbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PrimaryButton' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isHistorical' is assigned a value but never used.","line":49,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isPlanning' is assigned a value but never used.","line":50,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'switchToHistorical'. Either exclude it or remove the dependency array.","line":78,"column":6,"nodeType":"ArrayExpression","endLine":78,"endColumn":85,"suggestions":[{"desc":"Update the dependencies array to be: [switchToCurrent, switchToPlanning, setError, onModeChange]","fix":{"range":[2435,2514],"text":"[switchToCurrent, switchToPlanning, setError, onModeChange]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€å¯¼èˆªæ ç»„ä»¶\r\n * æä¾›æ—¶æ€æ¨¡å¼åˆ‡æ¢ã€æ—¶é—´ç‚¹é€‰æ‹©ç­‰æ ¸å¿ƒåŠŸèƒ½\r\n */\r\nimport React, { useState, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Tooltip } from '@workday/canvas-kit-react/tooltip';\r\nimport { colors, space, borderRadius } from '@workday/canvas-kit-react/tokens';\r\nimport { useTemporalMode, useTemporalQueryState } from '../../../shared/hooks/useTemporalQuery';\r\nimport { useTemporalActions, temporalSelectors } from '../../../shared/stores/temporalStore';\r\nimport type { TemporalMode } from '../../../shared/types/temporal';\r\nimport { DateTimePicker } from './DateTimePicker';\r\nimport { TemporalSettings } from './TemporalSettings';\r\n\r\nexport interface TemporalNavbarProps {\r\n  /** æ˜¯å¦æ˜¾ç¤ºé«˜çº§è®¾ç½® */\r\n  showAdvancedSettings?: boolean;\r\n  /** æ˜¯å¦ç´§å‡‘æ¨¡å¼ */\r\n  compact?: boolean;\r\n  /** è‡ªå®šä¹‰æ ·å¼ç±»å */\r\n  className?: string;\r\n  /** æ¨¡å¼åˆ‡æ¢å›è°ƒ */\r\n  onModeChange?: (mode: TemporalMode) => void;\r\n}\r\n\r\n/**\r\n * æ—¶æ€å¯¼èˆªæ ç»„ä»¶\r\n */\r\nexport const TemporalNavbar: React.FC<TemporalNavbarProps> = ({\r\n  showAdvancedSettings = true,\r\n  compact = false,\r\n  className,\r\n  onModeChange\r\n}) => {\r\n  const [showDatePicker, setShowDatePicker] = useState(false);\r\n  const [settingsOpen, setSettingsOpen] = useState(false);\r\n  const openSettings = () => setSettingsOpen(true);\r\n  const closeSettings = () => setSettingsOpen(false);\r\n\r\n  // æ—¶æ€çŠ¶æ€å’Œæ“ä½œ\r\n  const { \r\n    mode, \r\n    switchToCurrent, \r\n    switchToHistorical, \r\n    switchToPlanning,\r\n    isCurrent,\r\n    isHistorical,\r\n    isPlanning\r\n  } = useTemporalMode();\r\n  \r\n  const { loading, error, context, cacheStats, refreshCache } = useTemporalQueryState();\r\n  const { setError } = useTemporalActions();\r\n  const queryParams = temporalSelectors.useQueryParams();\r\n\r\n  // æ¨¡å¼åˆ‡æ¢å¤„ç†\r\n  const handleModeChange = useCallback(async (newMode: TemporalMode) => {\r\n    try {\r\n      setError(null);\r\n      \r\n      switch (newMode) {\r\n        case 'current':\r\n          await switchToCurrent();\r\n          break;\r\n        case 'historical':\r\n          setShowDatePicker(true);\r\n          return; // ç­‰å¾…ç”¨æˆ·é€‰æ‹©æ—¥æœŸ\r\n        case 'planning':\r\n          await switchToPlanning();\r\n          break;\r\n      }\r\n      \r\n      onModeChange?.(newMode);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to switch mode');\r\n    }\r\n  }, [switchToCurrent, switchToHistorical, switchToPlanning, setError, onModeChange]);\r\n\r\n  // å†å²æ¨¡å¼æ—¥æœŸé€‰æ‹©\r\n  const handleHistoricalDateSelect = useCallback(async (date: string) => {\r\n    try {\r\n      setError(null);\r\n      await switchToHistorical(date);\r\n      setShowDatePicker(false);\r\n      onModeChange?.('historical');\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to set historical date');\r\n    }\r\n  }, [switchToHistorical, setError, onModeChange]);\r\n\r\n  // åˆ·æ–°ç¼“å­˜\r\n  const handleRefreshCache = useCallback(async () => {\r\n    try {\r\n      setError(null);\r\n      await refreshCache();\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to refresh cache');\r\n    }\r\n  }, [refreshCache, setError]);\r\n\r\n  // æ ¼å¼åŒ–æ˜¾ç¤ºæ—¶é—´\r\n  const formatDisplayTime = (dateStr: string) => {\r\n    try {\r\n      const date = new Date(dateStr);\r\n      return date.toLocaleDateString('zh-CN', {\r\n        year: 'numeric',\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    } catch {\r\n      return dateStr;\r\n    }\r\n  };\r\n\r\n  // è·å–æ¨¡å¼æ˜¾ç¤ºä¿¡æ¯\r\n  const getModeDisplay = () => {\r\n    switch (mode) {\r\n      case 'current':\r\n        return {\r\n          label: 'å½“å‰è§†å›¾',\r\n          color: colors.greenFresca600,\r\n          icon: \"â°\",\r\n          description: 'æ˜¾ç¤ºå½“å‰æœ‰æ•ˆçš„ç»„ç»‡æ¶æ„'\r\n        };\r\n      case 'historical':\r\n        return {\r\n          label: 'å†å²è§†å›¾',\r\n          color: colors.blueberry600,\r\n          icon: \"ğŸ“œ\",\r\n          description: `æ˜¾ç¤º ${formatDisplayTime(context.asOfDate)} æ—¶çš„ç»„ç»‡æ¶æ„`\r\n        };\r\n      case 'planning':\r\n        return {\r\n          label: 'è§„åˆ’è§†å›¾',\r\n          color: colors.peach600,\r\n          icon: \"ğŸ“…\",\r\n          description: 'æ˜¾ç¤ºæœªæ¥è§„åˆ’çš„ç»„ç»‡æ¶æ„å˜æ›´'\r\n        };\r\n    }\r\n  };\r\n\r\n  const modeDisplay = getModeDisplay();\r\n\r\n  return (\r\n    <Box\r\n      className={className}\r\n      backgroundColor={colors.soap200}\r\n      padding={compact ? space.s : space.m}\r\n      borderRadius={borderRadius.m}\r\n      boxShadow=\"0 2px 4px rgba(0,0,0,0.1)\"\r\n    >\r\n      <Flex alignItems=\"center\" gap={space.m}>\r\n        {/* æ¨¡å¼åˆ‡æ¢æŒ‰é’®ç»„ */}\r\n        <Flex gap={space.xs}>\r\n          <Tooltip title=\"å½“å‰æœ‰æ•ˆçš„ç»„ç»‡æ¶æ„\">\r\n            <SecondaryButton\r\n              variant={isCurrent ? 'primary' : 'secondary'}\r\n              size={compact ? 'small' : 'medium'}\r\n              onClick={() => handleModeChange('current')}\r\n              disabled={loading.organizations}\r\n            >\r\n              â°\r\n              {!compact && 'å½“å‰'}\r\n            </SecondaryButton>\r\n          </Tooltip>\r\n          \r\n          <Tooltip title=\"æŸ¥çœ‹å†å²æ—¶ç‚¹çš„ç»„ç»‡æ¶æ„\">\r\n            <SecondaryButton\r\n              size={compact ? 'small' : 'medium'}\r\n              onClick={() => handleModeChange('historical')}\r\n              disabled={loading.organizations}\r\n            >\r\n              ğŸ“œ\r\n              {!compact && 'å†å²'}\r\n            </SecondaryButton>\r\n          </Tooltip>\r\n          \r\n          <Tooltip title=\"æŸ¥çœ‹æœªæ¥è§„åˆ’çš„ç»„ç»‡å˜æ›´\">\r\n            <SecondaryButton\r\n              size={compact ? 'small' : 'medium'}\r\n              onClick={() => handleModeChange('planning')}\r\n              disabled={loading.organizations}\r\n            >\r\n              ğŸ“…\r\n              {!compact && 'è§„åˆ’'}\r\n            </SecondaryButton>\r\n          </Tooltip>\r\n        </Flex>\r\n\r\n        {/* å½“å‰æ¨¡å¼çŠ¶æ€æ˜¾ç¤º */}\r\n        <Flex alignItems=\"center\" gap={space.s}>\r\n          <Flex alignItems=\"center\" gap={space.s}>\r\n            <Text fontSize=\"small\">{modeDisplay.icon}</Text>\r\n            <Text\r\n              fontSize=\"small\"\r\n              color={modeDisplay.color}\r\n              fontWeight=\"medium\"\r\n            >\r\n              {modeDisplay.label}\r\n            </Text>\r\n          </Flex>\r\n          \r\n          {!compact && (\r\n            <Text fontSize=\"small\" color={colors.licorice500}>\r\n              {modeDisplay.description}\r\n            </Text>\r\n          )}\r\n        </Flex>\r\n\r\n        {/* æ“ä½œæŒ‰é’®åŒºåŸŸ */}\r\n        <Flex marginLeft=\"auto\" alignItems=\"center\" gap={space.s}>\r\n          {/* ç¼“å­˜çŠ¶æ€æŒ‡ç¤ºå™¨ */}\r\n          {!compact && cacheStats.totalCacheSize > 0 && (\r\n            <Tooltip title={`ç¼“å­˜: ${cacheStats.organizationsCount} ç»„ç»‡, ${cacheStats.timelinesCount} æ—¶é—´çº¿`}>\r\n              <Flex alignItems=\"center\" gap={space.xs}>\r\n                <Text fontSize=\"small\">ğŸ’¾</Text>\r\n                <Text fontSize=\"small\" color={colors.licorice400}>\r\n                  {cacheStats.totalCacheSize}\r\n                </Text>\r\n              </Flex>\r\n            </Tooltip>\r\n          )}\r\n\r\n          {/* åˆ·æ–°æŒ‰é’® */}\r\n          <Tooltip title=\"åˆ·æ–°æ•°æ®ç¼“å­˜\">\r\n            <SecondaryButton\r\n              variant=\"plain\"\r\n              size={compact ? 'small' : 'medium'}\r\n              onClick={handleRefreshCache}\r\n              disabled={loading.organizations || loading.timeline}\r\n            >\r\n              ğŸ”„\r\n            </SecondaryButton>\r\n          </Tooltip>\r\n\r\n          {/* é«˜çº§è®¾ç½®æŒ‰é’® */}\r\n          {showAdvancedSettings && (\r\n            <Tooltip title=\"æ—¶æ€æŸ¥è¯¢è®¾ç½®\">\r\n              <SecondaryButton\r\n                variant=\"plain\"\r\n                size={compact ? 'small' : 'medium'}\r\n                onClick={openSettings}\r\n              >\r\n                âš™ï¸\r\n              </SecondaryButton>\r\n            </Tooltip>\r\n          )}\r\n        </Flex>\r\n      </Flex>\r\n\r\n      {/* é”™è¯¯æç¤º */}\r\n      {error && (\r\n        <Box marginTop={space.s}>\r\n          <Text color={colors.cinnamon600} fontSize=\"small\">\r\n            âš ï¸ {error}\r\n          </Text>\r\n        </Box>\r\n      )}\r\n\r\n      {/* åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ */}\r\n      {(loading.organizations || loading.timeline) && (\r\n        <Box marginTop={space.s}>\r\n          <Text color={colors.blueberry600} fontSize=\"small\">\r\n            ğŸ”„ {loading.organizations ? 'åŠ è½½ç»„ç»‡æ•°æ®...' : 'åŠ è½½æ—¶é—´çº¿æ•°æ®...'}\r\n          </Text>\r\n        </Box>\r\n      )}\r\n\r\n      {/* æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨å¼¹çª— */}\r\n      {showDatePicker && (\r\n        <DateTimePicker\r\n          isOpen={showDatePicker}\r\n          onClose={() => setShowDatePicker(false)}\r\n          onSelect={handleHistoricalDateSelect}\r\n          defaultDate={context.asOfDate}\r\n          title=\"é€‰æ‹©å†å²æŸ¥çœ‹æ—¶ç‚¹\"\r\n        />\r\n      )}\r\n\r\n      {/* é«˜çº§è®¾ç½®å¼¹çª— */}\r\n      {settingsOpen && (\r\n        <TemporalSettings\r\n          isOpen={settingsOpen}\r\n          onClose={closeSettings}\r\n          queryParams={queryParams}\r\n        />\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default TemporalNavbar;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TemporalOrganizationEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5325,5328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5325,5328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":406,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":406,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12333,12336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12333,12336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€ç»„ç»‡ç¼–è¾‘å™¨ç»„ä»¶ (çº¯æ—¥æœŸç”Ÿæ•ˆæ¨¡å‹)\r\n * å·¦ä¾§æ—¶é—´è½´ + å³ä¾§è¯¦æƒ…ç¼–è¾‘çš„å¸ƒå±€è®¾è®¡\r\n */\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { TextArea } from '@workday/canvas-kit-react/text-area';\r\nimport { Select } from '@workday/canvas-kit-react/select';\r\nimport { colors, space, borderRadius } from '@workday/canvas-kit-react/tokens';\r\nimport { useTemporalDateRangeQuery, useTemporalAsOfDateQuery, TemporalDateUtils } from '../../../shared/hooks/useTemporalAPI';\r\nimport type { TemporalOrganizationRecord } from '../../../shared/hooks/useTemporalAPI';\r\n\r\nexport interface TemporalOrganizationEditorProps {\r\n  /** ç»„ç»‡ä»£ç  */\r\n  organizationCode: string;\r\n  /** æ˜¯å¦æ˜¾ç¤ºå¼¹çª— */\r\n  isOpen: boolean;\r\n  /** å…³é—­å›è°ƒ */\r\n  onClose: () => void;\r\n  /** ä¿å­˜å›è°ƒ */\r\n  onSave: (record: TemporalOrganizationRecord) => Promise<void>;\r\n}\r\n\r\n// æ—¶é—´è½´èŠ‚ç‚¹ç±»å‹\r\ninterface TimelineNode {\r\n  date: string;\r\n  displayDate: string;\r\n  type: 'current' | 'historical' | 'planned';\r\n  label: string;\r\n  record?: TemporalOrganizationRecord;\r\n}\r\n\r\n/**\r\n * æ—¶æ€ç»„ç»‡ç¼–è¾‘å™¨ç»„ä»¶\r\n */\r\nexport const TemporalOrganizationEditor: React.FC<TemporalOrganizationEditorProps> = ({\r\n  organizationCode,\r\n  isOpen,\r\n  onClose,\r\n  onSave\r\n}) => {\r\n  // çŠ¶æ€ç®¡ç†\r\n  const [selectedDate, setSelectedDate] = useState<string>(TemporalDateUtils.today());\r\n  const [selectedRecord, setSelectedRecord] = useState<TemporalOrganizationRecord | null>(null);\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [editingRecord, setEditingRecord] = useState<TemporalOrganizationRecord | null>(null);\r\n\r\n  // æŸ¥è¯¢è¿‡å»6ä¸ªæœˆåˆ°æœªæ¥3ä¸ªæœˆçš„æ—¶é—´èŒƒå›´\r\n  const sixMonthsAgo = new Date();\r\n  sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\r\n  const threeMonthsLater = new Date();\r\n  threeMonthsLater.setMonth(threeMonthsLater.getMonth() + 3);\r\n\r\n  // è·å–æ—¶é—´èŒƒå›´å†…çš„æ‰€æœ‰è®°å½•\r\n  const { data: rangeData, isLoading: isRangeLoading } = useTemporalDateRangeQuery(\r\n    organizationCode,\r\n    sixMonthsAgo.toISOString().slice(0, 10),\r\n    threeMonthsLater.toISOString().slice(0, 10),\r\n    isOpen\r\n  );\r\n\r\n  // è·å–å½“å‰é€‰ä¸­æ—¥æœŸçš„è¯¦ç»†è®°å½•\r\n  const { data: selectedData, isLoading: isSelectedLoading } = useTemporalAsOfDateQuery(\r\n    organizationCode,\r\n    selectedDate,\r\n    isOpen && !!selectedDate\r\n  );\r\n\r\n  // ç”Ÿæˆæ—¶é—´è½´èŠ‚ç‚¹\r\n  const generateTimelineNodes = useCallback((): TimelineNode[] => {\r\n    const nodes: TimelineNode[] = [];\r\n    const today = new Date();\r\n    \r\n    if (rangeData?.organizations) {\r\n      // ä¸ºæ¯ä¸ªè®°å½•åˆ›å»ºæ—¶é—´è½´èŠ‚ç‚¹\r\n      rangeData.organizations.forEach(record => {\r\n        const effectiveDate = new Date(record.effective_date);\r\n        const dateStr = record.effective_date.slice(0, 10);\r\n        \r\n        let type: 'current' | 'historical' | 'planned';\r\n        if (effectiveDate > today) {\r\n          type = 'planned';\r\n        } else if (record.is_current) {\r\n          type = 'current';\r\n        } else {\r\n          type = 'historical';\r\n        }\r\n\r\n        nodes.push({\r\n          date: dateStr,\r\n          displayDate: effectiveDate.toLocaleDateString('zh-CN', {\r\n            year: 'numeric',\r\n            month: '2-digit',\r\n            day: '2-digit'\r\n          }),\r\n          type,\r\n          label: record.change_reason || getDefaultLabel(type),\r\n          record\r\n        });\r\n      });\r\n    }\r\n\r\n    // æ·»åŠ å½“å‰æ—¥æœŸèŠ‚ç‚¹ï¼ˆå¦‚æœæ²¡æœ‰è®°å½•ï¼‰\r\n    const todayStr = TemporalDateUtils.today();\r\n    if (!nodes.find(n => n.date === todayStr)) {\r\n      nodes.push({\r\n        date: todayStr,\r\n        displayDate: 'ä»Šå¤©',\r\n        type: 'current',\r\n        label: 'å½“å‰çŠ¶æ€',\r\n      });\r\n    }\r\n\r\n    // æŒ‰æ—¥æœŸæ’åº\r\n    return nodes.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n  }, [rangeData]);\r\n\r\n  const timelineNodes = generateTimelineNodes();\r\n\r\n  // å½“é€‰ä¸­æ—¥æœŸå˜åŒ–æ—¶ï¼Œæ›´æ–°é€‰ä¸­çš„è®°å½•\r\n  useEffect(() => {\r\n    if (selectedData?.organizations && selectedData.organizations.length > 0) {\r\n      setSelectedRecord(selectedData.organizations[0]);\r\n      setEditingRecord({ ...selectedData.organizations[0] });\r\n    }\r\n  }, [selectedData]);\r\n\r\n  // å¤„ç†æ—¶é—´è½´èŠ‚ç‚¹ç‚¹å‡»\r\n  const handleTimelineNodeClick = useCallback((node: TimelineNode) => {\r\n    setSelectedDate(node.date);\r\n    setIsEditing(false);\r\n    if (node.record) {\r\n      setSelectedRecord(node.record);\r\n      setEditingRecord({ ...node.record });\r\n    }\r\n  }, []);\r\n\r\n  // å¤„ç†å¼€å§‹ç¼–è¾‘\r\n  const handleStartEdit = useCallback(() => {\r\n    setIsEditing(true);\r\n    if (selectedRecord) {\r\n      setEditingRecord({ ...selectedRecord });\r\n    }\r\n  }, [selectedRecord]);\r\n\r\n  // å¤„ç†å–æ¶ˆç¼–è¾‘\r\n  const handleCancelEdit = useCallback(() => {\r\n    setIsEditing(false);\r\n    if (selectedRecord) {\r\n      setEditingRecord({ ...selectedRecord });\r\n    }\r\n  }, [selectedRecord]);\r\n\r\n  // å¤„ç†ä¿å­˜ç¼–è¾‘\r\n  const handleSaveEdit = useCallback(async () => {\r\n    if (!editingRecord) return;\r\n\r\n    try {\r\n      await onSave(editingRecord);\r\n      setSelectedRecord(editingRecord);\r\n      setIsEditing(false);\r\n    } catch (error) {\r\n      console.error('ä¿å­˜å¤±è´¥:', error);\r\n    }\r\n  }, [editingRecord, onSave]);\r\n\r\n  // å¤„ç†å­—æ®µå˜æ›´\r\n  const handleFieldChange = useCallback((field: keyof TemporalOrganizationRecord, value: any) => {\r\n    if (!editingRecord) return;\r\n    setEditingRecord(prev => prev ? { ...prev, [field]: value } : null);\r\n  }, [editingRecord]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <Box\r\n      position=\"fixed\"\r\n      top=\"0\"\r\n      left=\"0\"\r\n      right=\"0\"\r\n      bottom=\"0\"\r\n      backgroundColor=\"rgba(0, 0, 0, 0.5)\"\r\n      zIndex=\"1000\"\r\n      display=\"flex\"\r\n      alignItems=\"center\"\r\n      justifyContent=\"center\"\r\n    >\r\n      <Card\r\n        width=\"1200px\"\r\n        height=\"80vh\"\r\n        maxHeight=\"800px\"\r\n        overflow=\"hidden\"\r\n        padding=\"0\"\r\n      >\r\n        {/* æ ‡é¢˜æ  */}\r\n        <Box\r\n          padding={space.m}\r\n          backgroundColor={colors.soap200}\r\n          borderBottom={`1px solid ${colors.soap400}`}\r\n        >\r\n          <Flex alignItems=\"center\" justifyContent=\"space-between\">\r\n            <Text fontSize=\"large\" fontWeight=\"bold\">\r\n              æ—¶æ€ç»„ç»‡ç¼–è¾‘å™¨ - {organizationCode}\r\n            </Text>\r\n            <SecondaryButton onClick={onClose}>\r\n              å…³é—­\r\n            </SecondaryButton>\r\n          </Flex>\r\n        </Box>\r\n\r\n        {/* ä¸»å†…å®¹åŒºåŸŸ */}\r\n        <Flex height=\"calc(100% - 80px)\">\r\n          {/* å·¦ä¾§æ—¶é—´è½´ */}\r\n          <Box\r\n            width=\"300px\"\r\n            backgroundColor={colors.frenchVanilla100}\r\n            borderRight={`1px solid ${colors.soap400}`}\r\n            overflow=\"auto\"\r\n            padding={space.m}\r\n          >\r\n            <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n              æ—¶é—´è½´\r\n            </Text>\r\n\r\n            {isRangeLoading ? (\r\n              <Text>åŠ è½½ä¸­...</Text>\r\n            ) : (\r\n              <Box>\r\n                {timelineNodes.map((node, index) => (\r\n                  <TimelineNodeComponent\r\n                    key={node.date}\r\n                    node={node}\r\n                    isSelected={selectedDate === node.date}\r\n                    isLast={index === timelineNodes.length - 1}\r\n                    onClick={() => handleTimelineNodeClick(node)}\r\n                  />\r\n                ))}\r\n              </Box>\r\n            )}\r\n          </Box>\r\n\r\n          {/* å³ä¾§è¯¦æƒ…ç¼–è¾‘åŒº */}\r\n          <Box flex=\"1\" padding={space.l} overflow=\"auto\">\r\n            {isSelectedLoading ? (\r\n              <Box display=\"flex\" alignItems=\"center\" justifyContent=\"center\" height=\"100%\">\r\n                <Text>åŠ è½½è¯¦æƒ…ä¸­...</Text>\r\n              </Box>\r\n            ) : selectedRecord ? (\r\n              <Box>\r\n                {/* è®°å½•ä¿¡æ¯å¤´éƒ¨ */}\r\n                <Flex alignItems=\"center\" justifyContent=\"space-between\" marginBottom={space.l}>\r\n                  <Box>\r\n                    <Text fontSize=\"large\" fontWeight=\"bold\">\r\n                      {isEditing ? 'ç¼–è¾‘æ¨¡å¼' : 'æŸ¥çœ‹æ¨¡å¼'}\r\n                    </Text>\r\n                    <Text fontSize=\"small\" color={colors.licorice600}>\r\n                      ç”Ÿæ•ˆæ—¥æœŸ: {new Date(selectedRecord.effective_date).toLocaleDateString('zh-CN')}\r\n                    </Text>\r\n                  </Box>\r\n                  <Box>\r\n                    {!isEditing ? (\r\n                      <PrimaryButton onClick={handleStartEdit}>\r\n                        ç¼–è¾‘\r\n                      </PrimaryButton>\r\n                    ) : (\r\n                      <Flex gap={space.s}>\r\n                        <SecondaryButton onClick={handleCancelEdit}>\r\n                          å–æ¶ˆ\r\n                        </SecondaryButton>\r\n                        <PrimaryButton onClick={handleSaveEdit}>\r\n                          ä¿å­˜\r\n                        </PrimaryButton>\r\n                      </Flex>\r\n                    )}\r\n                  </Box>\r\n                </Flex>\r\n\r\n                {/* è¯¦æƒ…è¡¨å• */}\r\n                <OrganizationDetailForm\r\n                  record={editingRecord || selectedRecord}\r\n                  isEditing={isEditing}\r\n                  onFieldChange={handleFieldChange}\r\n                />\r\n              </Box>\r\n            ) : (\r\n              <Box display=\"flex\" alignItems=\"center\" justifyContent=\"center\" height=\"100%\">\r\n                <Text>é€‰æ‹©æ—¶é—´è½´ä¸Šçš„èŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ…</Text>\r\n              </Box>\r\n            )}\r\n          </Box>\r\n        </Flex>\r\n      </Card>\r\n    </Box>\r\n  );\r\n};\r\n\r\n// æ—¶é—´è½´èŠ‚ç‚¹ç»„ä»¶\r\ninterface TimelineNodeComponentProps {\r\n  node: TimelineNode;\r\n  isSelected: boolean;\r\n  isLast: boolean;\r\n  onClick: () => void;\r\n}\r\n\r\nconst TimelineNodeComponent: React.FC<TimelineNodeComponentProps> = ({\r\n  node,\r\n  isSelected,\r\n  isLast,\r\n  onClick\r\n}) => {\r\n  const getNodeColor = (type: TimelineNode['type']) => {\r\n    switch (type) {\r\n      case 'current': return colors.blueberry400;\r\n      case 'planned': return colors.peach400;\r\n      case 'historical': return colors.licorice400;\r\n      default: return colors.soap600;\r\n    }\r\n  };\r\n\r\n  const getNodeBackgroundColor = (type: TimelineNode['type'], selected: boolean) => {\r\n    if (selected) {\r\n      switch (type) {\r\n        case 'current': return colors.blueberry50;\r\n        case 'planned': return colors.peach50;\r\n        case 'historical': return colors.soap100;\r\n      }\r\n    }\r\n    return 'transparent';\r\n  };\r\n\r\n  return (\r\n    <Box position=\"relative\" marginBottom={space.m}>\r\n      {/* è¿æ¥çº¿ */}\r\n      {!isLast && (\r\n        <Box\r\n          position=\"absolute\"\r\n          left=\"11px\"\r\n          top=\"24px\"\r\n          width=\"2px\"\r\n          height=\"32px\"\r\n          backgroundColor={colors.soap400}\r\n        />\r\n      )}\r\n\r\n      {/* èŠ‚ç‚¹å†…å®¹ */}\r\n      <Flex\r\n        alignItems=\"flex-start\"\r\n        cursor=\"pointer\"\r\n        padding={space.s}\r\n        borderRadius={borderRadius.m}\r\n        backgroundColor={getNodeBackgroundColor(node.type, isSelected)}\r\n        border={isSelected ? `2px solid ${getNodeColor(node.type)}` : '2px solid transparent'}\r\n        onClick={onClick}\r\n        _hover={{\r\n          backgroundColor: getNodeBackgroundColor(node.type, true)\r\n        }}\r\n      >\r\n        {/* æ—¶é—´è½´åœ†ç‚¹ */}\r\n        <Box\r\n          width=\"24px\"\r\n          height=\"24px\"\r\n          borderRadius=\"50%\"\r\n          backgroundColor={getNodeColor(node.type)}\r\n          marginRight={space.s}\r\n          marginTop=\"2px\"\r\n          flexShrink={0}\r\n          display=\"flex\"\r\n          alignItems=\"center\"\r\n          justifyContent=\"center\"\r\n        >\r\n          <Box\r\n            width=\"8px\"\r\n            height=\"8px\"\r\n            borderRadius=\"50%\"\r\n            backgroundColor=\"white\"\r\n          />\r\n        </Box>\r\n\r\n        {/* èŠ‚ç‚¹ä¿¡æ¯ */}\r\n        <Box flex=\"1\" minWidth=\"0\">\r\n          <Text fontSize=\"small\" fontWeight=\"medium\">\r\n            {node.displayDate}\r\n          </Text>\r\n          <Text fontSize=\"small\" color={colors.licorice600}>\r\n            {node.label}\r\n          </Text>\r\n          {node.record && (\r\n            <Text fontSize=\"small\" color={colors.licorice500}>\r\n              {node.record.name}\r\n            </Text>\r\n          )}\r\n        </Box>\r\n      </Flex>\r\n    </Box>\r\n  );\r\n};\r\n\r\n// ç»„ç»‡è¯¦æƒ…è¡¨å•ç»„ä»¶\r\ninterface OrganizationDetailFormProps {\r\n  record: TemporalOrganizationRecord;\r\n  isEditing: boolean;\r\n  onFieldChange: (field: keyof TemporalOrganizationRecord, value: any) => void;\r\n}\r\n\r\nconst OrganizationDetailForm: React.FC<OrganizationDetailFormProps> = ({\r\n  record,\r\n  isEditing,\r\n  onFieldChange\r\n}) => {\r\n  return (\r\n    <Box>\r\n      {/* åŸºç¡€ä¿¡æ¯ */}\r\n      <Box marginBottom={space.l}>\r\n        <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n          åŸºç¡€ä¿¡æ¯\r\n        </Text>\r\n\r\n        <Box display=\"grid\" gridTemplateColumns=\"1fr 1fr\" gap={space.m} marginBottom={space.m}>\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>ç»„ç»‡ä»£ç </Text>\r\n            <TextInput\r\n              value={record.code}\r\n              disabled={true}\r\n              backgroundColor={colors.soap200}\r\n            />\r\n          </Box>\r\n\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>ç»„ç»‡åç§°</Text>\r\n            <TextInput\r\n              value={record.name}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('name', e.target.value)}\r\n            />\r\n          </Box>\r\n        </Box>\r\n\r\n        <Box display=\"grid\" gridTemplateColumns=\"1fr 1fr\" gap={space.m} marginBottom={space.m}>\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>ç»„ç»‡ç±»å‹</Text>\r\n            <Select\r\n              value={record.unit_type}\r\n              disabled={!isEditing}\r\n              onChange={(value) => isEditing && onFieldChange('unit_type', value)}\r\n            >\r\n              <option value=\"COMPANY\">å…¬å¸</option>\r\n              <option value=\"DEPARTMENT\">éƒ¨é—¨</option>\r\n              <option value=\"COST_CENTER\">æˆæœ¬ä¸­å¿ƒ</option>\r\n              <option value=\"PROJECT_TEAM\">é¡¹ç›®å›¢é˜Ÿ</option>\r\n            </Select>\r\n          </Box>\r\n\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>çŠ¶æ€</Text>\r\n            <Select\r\n              value={record.status}\r\n              disabled={!isEditing}\r\n              onChange={(value) => isEditing && onFieldChange('status', value)}\r\n            >\r\n              <option value=\"ACTIVE\">å¯ç”¨</option>\r\n              <option value=\"INACTIVE\">åœç”¨</option>\r\n              <option value=\"PLANNED\">è®¡åˆ’ä¸­</option>\r\n            </Select>\r\n          </Box>\r\n        </Box>\r\n\r\n        <Box>\r\n          <Text fontSize=\"small\" marginBottom={space.xs}>æè¿°</Text>\r\n          <TextArea\r\n            value={record.description || ''}\r\n            disabled={!isEditing}\r\n            onChange={(e) => isEditing && onFieldChange('description', e.target.value)}\r\n            rows={3}\r\n          />\r\n        </Box>\r\n      </Box>\r\n\r\n      {/* æ—¶æ€ä¿¡æ¯ */}\r\n      <Box marginBottom={space.l}>\r\n        <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n          æ—¶æ€ä¿¡æ¯\r\n        </Text>\r\n\r\n        <Box display=\"grid\" gridTemplateColumns=\"1fr 1fr\" gap={space.m} marginBottom={space.m}>\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>ç”Ÿæ•ˆæ—¥æœŸ</Text>\r\n            <TextInput\r\n              type=\"date\"\r\n              value={record.effective_date?.slice(0, 10) || ''}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('effective_date', e.target.value + 'T00:00:00Z')}\r\n            />\r\n          </Box>\r\n\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>ç»“æŸæ—¥æœŸ</Text>\r\n            <TextInput\r\n              type=\"date\"\r\n              value={record.end_date?.slice(0, 10) || ''}\r\n              disabled={!isEditing}\r\n              onChange={(e) => isEditing && onFieldChange('end_date', e.target.value ? e.target.value + 'T00:00:00Z' : undefined)}\r\n            />\r\n          </Box>\r\n        </Box>\r\n\r\n        <Box>\r\n          <Text fontSize=\"small\" marginBottom={space.xs}>å˜æ›´åŸå› </Text>\r\n          <TextArea\r\n            value={record.change_reason || ''}\r\n            disabled={!isEditing}\r\n            onChange={(e) => isEditing && onFieldChange('change_reason', e.target.value)}\r\n            rows={2}\r\n          />\r\n        </Box>\r\n      </Box>\r\n\r\n      {/* å®¡æ‰¹ä¿¡æ¯ */}\r\n      <Box>\r\n        <Text fontSize=\"medium\" fontWeight=\"bold\" marginBottom={space.m}>\r\n          å®¡æ‰¹ä¿¡æ¯\r\n        </Text>\r\n\r\n        <Box display=\"grid\" gridTemplateColumns=\"1fr 1fr\" gap={space.m}>\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>æ‰¹å‡†äºº</Text>\r\n            <TextInput\r\n              value={record.approved_by || ''}\r\n              disabled={true}\r\n              backgroundColor={colors.soap200}\r\n            />\r\n          </Box>\r\n\r\n          <Box>\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>æ‰¹å‡†æ—¶é—´</Text>\r\n            <TextInput\r\n              value={record.approved_at ? new Date(record.approved_at).toLocaleString('zh-CN') : ''}\r\n              disabled={true}\r\n              backgroundColor={colors.soap200}\r\n            />\r\n          </Box>\r\n        </Box>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\n// å·¥å…·å‡½æ•°\r\nfunction getDefaultLabel(type: TimelineNode['type']): string {\r\n  switch (type) {\r\n    case 'current': return 'å½“å‰çŠ¶æ€';\r\n    case 'planned': return 'è®¡åˆ’å˜æ›´';\r\n    case 'historical': return 'å†å²è®°å½•';\r\n    default: return 'æœªçŸ¥çŠ¶æ€';\r\n  }\r\n}\r\n\r\nexport default TemporalOrganizationEditor;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TemporalSettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useModalModel' is defined but never used.","line":8,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SystemIcon' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'borderRadius' is defined but never used.","line":15,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":37}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€è®¾ç½®ç»„ä»¶\r\n * æä¾›æ—¶æ€æŸ¥è¯¢çš„é«˜çº§è®¾ç½®å’Œé…ç½®é€‰é¡¹\r\n */\r\nimport React, { useState, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Modal, useModalModel } from '@workday/canvas-kit-react/modal';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { Select } from '@workday/canvas-kit-react/select';\r\nimport { Checkbox } from '@workday/canvas-kit-react/checkbox';\r\nimport { SystemIcon } from '@workday/canvas-kit-react/icon';\r\nimport { colors, space, borderRadius } from '@workday/canvas-kit-react/tokens';\r\nimport { useTemporalActions } from '../../../shared/stores/temporalStore';\r\nimport type { TemporalQueryParams, EventType } from '../../shared/types/temporal';\r\n\r\nexport interface TemporalSettingsProps {\r\n  /** æ˜¯å¦æ˜¾ç¤ºå¼¹çª— */\r\n  isOpen: boolean;\r\n  /** å…³é—­å›è°ƒ */\r\n  onClose: () => void;\r\n  /** å½“å‰æŸ¥è¯¢å‚æ•° */\r\n  queryParams: TemporalQueryParams;\r\n}\r\n\r\n/**\r\n * æ—¶æ€è®¾ç½®ç»„ä»¶\r\n */\r\nexport const TemporalSettings: React.FC<TemporalSettingsProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  queryParams\r\n}) => {\r\n  // æœ¬åœ°çŠ¶æ€\r\n  const [localParams, setLocalParams] = useState<TemporalQueryParams>(queryParams);\r\n  const [hasChanges, setHasChanges] = useState(false);\r\n\r\n  // æ—¶æ€æ“ä½œ\r\n  const { setQueryParams, clearCache } = useTemporalActions();\r\n\r\n  // äº‹ä»¶ç±»å‹é€‰é¡¹\r\n  const eventTypeOptions: { value: EventType; label: string }[] = [\r\n    { value: 'create', label: 'åˆ›å»º' },\r\n    { value: 'update', label: 'æ›´æ–°' },\r\n    { value: 'delete', label: 'åˆ é™¤' },\r\n    { value: 'activate', label: 'æ¿€æ´»' },\r\n    { value: 'deactivate', label: 'åœç”¨' },\r\n    { value: 'restructure', label: 'é‡ç»„' },\r\n    { value: 'merge', label: 'åˆå¹¶' },\r\n    { value: 'split', label: 'æ‹†åˆ†' },\r\n    { value: 'transfer', label: 'è½¬ç§»' },\r\n    { value: 'rename', label: 'é‡å‘½å' }\r\n  ];\r\n\r\n  // æ›´æ–°æœ¬åœ°å‚æ•°\r\n  const updateLocalParams = useCallback((updates: Partial<TemporalQueryParams>) => {\r\n    setLocalParams(prev => ({ ...prev, ...updates }));\r\n    setHasChanges(true);\r\n  }, []);\r\n\r\n  // å¤„ç†æ—¥æœŸèŒƒå›´å˜æ›´\r\n  const handleDateRangeChange = useCallback((field: 'start' | 'end', value: string) => {\r\n    const currentRange = localParams.dateRange || { start: '', end: '' };\r\n    updateLocalParams({\r\n      dateRange: {\r\n        ...currentRange,\r\n        [field]: value\r\n      }\r\n    });\r\n  }, [localParams.dateRange, updateLocalParams]);\r\n\r\n  // å¤„ç†äº‹ä»¶ç±»å‹é€‰æ‹©\r\n  const handleEventTypeToggle = useCallback((eventType: EventType) => {\r\n    const currentTypes = localParams.eventTypes || [];\r\n    const newTypes = currentTypes.includes(eventType)\r\n      ? currentTypes.filter(t => t !== eventType)\r\n      : [...currentTypes, eventType];\r\n    \r\n    updateLocalParams({ eventTypes: newTypes });\r\n  }, [localParams.eventTypes, updateLocalParams]);\r\n\r\n  // åº”ç”¨è®¾ç½®\r\n  const handleApply = useCallback(async () => {\r\n    try {\r\n      setQueryParams(localParams);\r\n      setHasChanges(false);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to apply settings:', error);\r\n    }\r\n  }, [localParams, setQueryParams, onClose]);\r\n\r\n  // é‡ç½®è®¾ç½®\r\n  const handleReset = useCallback(() => {\r\n    const defaultParams: TemporalQueryParams = {\r\n      mode: 'current',\r\n      asOfDate: new Date().toISOString(),\r\n      dateRange: {\r\n        start: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),\r\n        end: new Date().toISOString()\r\n      },\r\n      limit: 50,\r\n      includeInactive: false,\r\n      eventTypes: []\r\n    };\r\n    \r\n    setLocalParams(defaultParams);\r\n    setHasChanges(true);\r\n  }, []);\r\n\r\n  // æ¸…é™¤ç¼“å­˜\r\n  const handleClearCache = useCallback(async () => {\r\n    try {\r\n      await clearCache();\r\n      alert('ç¼“å­˜å·²æ¸…é™¤');\r\n    } catch (error) {\r\n      console.error('Failed to clear cache:', error);\r\n      alert('æ¸…é™¤ç¼“å­˜å¤±è´¥');\r\n    }\r\n  }, [clearCache]);\r\n\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Modal onClose={onClose}>\r\n      <Card \r\n        padding={space.l}\r\n        minWidth=\"600px\"\r\n        maxWidth=\"800px\"\r\n        maxHeight=\"80vh\"\r\n        overflow=\"auto\"\r\n      >\r\n        {/* æ ‡é¢˜ */}\r\n        <Flex alignItems=\"center\" gap={space.s} marginBottom={space.l}>\r\n          âš™ï¸\r\n          <Text fontSize=\"large\" fontWeight=\"bold\">\r\n            æ—¶æ€æŸ¥è¯¢è®¾ç½®\r\n          </Text>\r\n          {hasChanges && (\r\n            <Text color=\"peach600\">\r\n              æœ‰æœªä¿å­˜çš„æ›´æ”¹\r\n            </Text>\r\n          )}\r\n        </Flex>\r\n\r\n        {/* åŸºç¡€è®¾ç½® */}\r\n        <Box marginBottom={space.l}>\r\n          <Text fontSize=\"medium\" fontWeight=\"medium\" marginBottom={space.m}>\r\n            åŸºç¡€è®¾ç½®\r\n          </Text>\r\n\r\n          {/* æŸ¥è¯¢æ—¶é—´ç‚¹ */}\r\n          <Box marginBottom={space.m}>\r\n            <Text fontSize=\"small\" marginBottom={space.s}>\r\n              æŸ¥è¯¢æ—¶é—´ç‚¹ (As Of Date)\r\n            </Text>\r\n            <TextInput\r\n              type=\"date\"\r\n              value={localParams.asOfDate ? \r\n                localParams.asOfDate.slice(0, 10) : \r\n                ''\r\n              }\r\n              onChange={(e) => updateLocalParams({ \r\n                asOfDate: e.target.value ? e.target.value : undefined \r\n              })}\r\n            />\r\n            <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n              åœ¨å†å²æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºæ­¤æ—¶é—´ç‚¹æœ‰æ•ˆçš„æ•°æ®\r\n            </Text>\r\n          </Box>\r\n\r\n          {/* æŸ¥è¯¢é™åˆ¶ */}\r\n          <Box marginBottom={space.m}>\r\n            <Text fontSize=\"small\" marginBottom={space.s}>\r\n              æŸ¥è¯¢ç»“æœé™åˆ¶\r\n            </Text>\r\n            <Select\r\n              value={String(localParams.limit || 50)}\r\n              onChange={(value) => updateLocalParams({ limit: parseInt(value) })}\r\n            >\r\n              <MenuItem value=\"10\">10 æ¡</MenuItem>\r\n              <MenuItem value=\"20\">20 æ¡</MenuItem>\r\n              <MenuItem value=\"50\">50 æ¡</MenuItem>\r\n              <MenuItem value=\"100\">100 æ¡</MenuItem>\r\n              <MenuItem value=\"200\">200 æ¡</MenuItem>\r\n            </Select>\r\n          </Box>\r\n\r\n          {/* åŒ…å«åœç”¨æ•°æ® */}\r\n          <Box marginBottom={space.m}>\r\n            <Checkbox\r\n              checked={localParams.includeInactive || false}\r\n              onChange={(e) => updateLocalParams({ includeInactive: e.target.checked })}\r\n            >\r\n              åŒ…å«åœç”¨/å¤±æ•ˆçš„ç»„ç»‡æ•°æ®\r\n            </Checkbox>\r\n            <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.xs}>\r\n              å‹¾é€‰åå°†æ˜¾ç¤ºå·²åœç”¨æˆ–å¤±æ•ˆçš„ç»„ç»‡å•å…ƒ\r\n            </Text>\r\n          </Box>\r\n        </Box>\r\n\r\n        <Divider />\r\n\r\n        {/* æ—¶é—´èŒƒå›´è®¾ç½® */}\r\n        <Box marginBottom={space.l}>\r\n          <Text fontSize=\"medium\" fontWeight=\"medium\" marginBottom={space.m}>\r\n            æ—¶é—´èŒƒå›´ç­›é€‰\r\n          </Text>\r\n\r\n          <Flex gap={space.m}>\r\n            <Box flex=\"1\">\r\n              <Text fontSize=\"small\" marginBottom={space.s}>\r\n                å¼€å§‹æ—¶é—´\r\n              </Text>\r\n              <TextInput\r\n                type=\"date\"\r\n                value={localParams.dateRange?.start ? \r\n                  localParams.dateRange.start.slice(0, 10) : \r\n                  ''\r\n                }\r\n                onChange={(e) => handleDateRangeChange('start', \r\n                  e.target.value ? e.target.value : ''\r\n                )}\r\n              />\r\n            </Box>\r\n\r\n            <Box flex=\"1\">\r\n              <Text fontSize=\"small\" marginBottom={space.s}>\r\n                ç»“æŸæ—¶é—´\r\n              </Text>\r\n              <TextInput\r\n                type=\"date\"\r\n                value={localParams.dateRange?.end ? \r\n                  localParams.dateRange.end.slice(0, 10) : \r\n                  ''\r\n                }\r\n                onChange={(e) => handleDateRangeChange('end', \r\n                  e.target.value ? e.target.value : ''\r\n                )}\r\n              />\r\n            </Box>\r\n          </Flex>\r\n\r\n          <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.s}>\r\n            ç”¨äºç­›é€‰æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„å†å²è®°å½•å’Œæ—¶é—´çº¿äº‹ä»¶\r\n          </Text>\r\n        </Box>\r\n\r\n        <Divider />\r\n\r\n        {/* äº‹ä»¶ç±»å‹ç­›é€‰ */}\r\n        <Box marginBottom={space.l}>\r\n          <Text fontSize=\"medium\" fontWeight=\"medium\" marginBottom={space.m}>\r\n            äº‹ä»¶ç±»å‹ç­›é€‰\r\n          </Text>\r\n\r\n          <Text fontSize=\"small\" color={colors.licorice600} marginBottom={space.s}>\r\n            é€‰æ‹©è¦æ˜¾ç¤ºçš„æ—¶é—´çº¿äº‹ä»¶ç±»å‹:\r\n          </Text>\r\n\r\n          <Box\r\n            display=\"grid\"\r\n            gridTemplateColumns=\"repeat(auto-fit, minmax(150px, 1fr))\"\r\n            gap={space.s}\r\n          >\r\n            {eventTypeOptions.map(option => (\r\n              <Checkbox\r\n                key={option.value}\r\n                checked={(localParams.eventTypes || []).includes(option.value)}\r\n                onChange={() => handleEventTypeToggle(option.value)}\r\n              >\r\n                {option.label}\r\n              </Checkbox>\r\n            ))}\r\n          </Box>\r\n\r\n          <Text fontSize=\"small\" color={colors.licorice500} marginTop={space.s}>\r\n            æœªé€‰æ‹©ä»»ä½•ç±»å‹æ—¶ï¼Œå°†æ˜¾ç¤ºæ‰€æœ‰äº‹ä»¶ç±»å‹\r\n          </Text>\r\n        </Box>\r\n\r\n        <Divider />\r\n\r\n        {/* ç¼“å­˜ç®¡ç† */}\r\n        <Box marginBottom={space.l}>\r\n          <Text fontSize=\"medium\" fontWeight=\"medium\" marginBottom={space.m}>\r\n            ç¼“å­˜ç®¡ç†\r\n          </Text>\r\n\r\n          <Flex alignItems=\"center\" gap={space.s}>\r\n            <SecondaryButton\r\n              variant=\"secondary\"\r\n              size=\"small\"\r\n              onClick={handleClearCache}\r\n            >\r\n              æ¸…é™¤æ‰€æœ‰ç¼“å­˜\r\n            </SecondaryButton>\r\n            <Text fontSize=\"small\" color={colors.licorice500}>\r\n              æ¸…é™¤ç¼“å­˜ä¼šå¼ºåˆ¶é‡æ–°åŠ è½½æ‰€æœ‰æ•°æ®\r\n            </Text>\r\n          </Flex>\r\n        </Box>\r\n\r\n        {/* æ“ä½œæŒ‰é’® */}\r\n        <Flex justifyContent=\"space-between\" alignItems=\"center\">\r\n          <SecondaryButton\r\n            onClick={handleReset}\r\n          >\r\n            ğŸ”„ é‡ç½®ä¸ºé»˜è®¤\r\n          </SecondaryButton>\r\n\r\n          <Flex gap={space.s}>\r\n            <SecondaryButton onClick={onClose}>\r\n              å–æ¶ˆ\r\n            </SecondaryButton>\r\n            <PrimaryButton \r\n              onClick={handleApply}\r\n              disabled={!hasChanges}\r\n            >\r\n              åº”ç”¨è®¾ç½®\r\n            </PrimaryButton>\r\n          </Flex>\r\n        </Flex>\r\n      </Card>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default TemporalSettings;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TemporalStatusSelector.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":13,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":13,"endColumn":61},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":100,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":100,"endColumn":33}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n// import { Select, SelectOption } from '@workday/canvas-kit-react/select';\r\nimport { FormField } from '@workday/canvas-kit-react/form-field';\r\n\r\nexport type TemporalStatus = 'ACTIVE' | 'PLANNED' | 'INACTIVE';\r\n\r\nexport interface TemporalStatusOption {\r\n  value: TemporalStatus;\r\n  label: string;\r\n  description: string;\r\n}\r\n\r\nexport const TEMPORAL_STATUS_OPTIONS: TemporalStatusOption[] = [\r\n  {\r\n    value: 'ACTIVE',\r\n    label: 'å¯ç”¨',\r\n    description: 'å½“å‰ç”Ÿæ•ˆçš„ç»„ç»‡'\r\n  },\r\n  {\r\n    value: 'PLANNED', \r\n    label: 'è®¡åˆ’',\r\n    description: 'è®¡åˆ’åœ¨æœªæ¥ç”Ÿæ•ˆçš„ç»„ç»‡'\r\n  },\r\n  {\r\n    value: 'INACTIVE',\r\n    label: 'åœç”¨',\r\n    description: 'å·²å¤±æ•ˆæˆ–åœç”¨çš„ç»„ç»‡'\r\n  }\r\n];\r\n\r\nexport interface TemporalStatusSelectorProps {\r\n  label?: string;\r\n  value?: TemporalStatus;\r\n  onChange: (value: TemporalStatus) => void;\r\n  error?: string;\r\n  required?: boolean;\r\n  disabled?: boolean;\r\n  placeholder?: string;\r\n  includeAll?: boolean;\r\n  helperText?: string;\r\n}\r\n\r\nexport const TemporalStatusSelector: React.FC<TemporalStatusSelectorProps> = ({\r\n  label = 'æ—¶æ€çŠ¶æ€',\r\n  value,\r\n  onChange,\r\n  error,\r\n  required = false,\r\n  disabled = false,\r\n  placeholder = 'è¯·é€‰æ‹©çŠ¶æ€',\r\n  includeAll = false,\r\n  helperText,\r\n}) => {\r\n  const options = includeAll \r\n    ? [{ value: '', label: 'å…¨éƒ¨çŠ¶æ€', description: 'æ˜¾ç¤ºæ‰€æœ‰æ—¶æ€çŠ¶æ€çš„ç»„ç»‡' }, ...TEMPORAL_STATUS_OPTIONS]\r\n    : TEMPORAL_STATUS_OPTIONS;\r\n\r\n  const handleChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\r\n    const selectedValue = event.target.value;\r\n    if (selectedValue && selectedValue !== '') {\r\n      onChange(selectedValue as TemporalStatus);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <FormField\r\n      label={label}\r\n      required={required}\r\n      error={error ? FormField.ErrorType.Error : undefined}\r\n      hintText={error || helperText}\r\n    >\r\n      <select\r\n        value={value || ''}\r\n        onChange={handleChange}\r\n        disabled={disabled}\r\n        style={{ \r\n          width: '100%', \r\n          padding: '8px', \r\n          borderRadius: '4px', \r\n          border: '1px solid #ddd', \r\n          fontSize: '14px' \r\n        }}\r\n      >\r\n        <option value=\"\" disabled>{placeholder}</option>\r\n        {options.map((option) => (\r\n          <option \r\n            key={option.value} \r\n            value={option.value}\r\n            title={option.description}\r\n          >\r\n            {option.label}\r\n          </option>\r\n        ))}\r\n      </select>\r\n    </FormField>\r\n  );\r\n};\r\n\r\n// æ—¶æ€çŠ¶æ€å·¥å…·å‡½æ•°\r\nexport const temporalStatusUtils = {\r\n  // è·å–çŠ¶æ€æ ‡ç­¾\r\n  getStatusLabel: (status: TemporalStatus): string => {\r\n    const option = TEMPORAL_STATUS_OPTIONS.find(opt => opt.value === status);\r\n    return option?.label || status;\r\n  },\r\n\r\n  // è·å–çŠ¶æ€æè¿°\r\n  getStatusDescription: (status: TemporalStatus): string => {\r\n    const option = TEMPORAL_STATUS_OPTIONS.find(opt => opt.value === status);\r\n    return option?.description || '';\r\n  },\r\n\r\n  // æ ¹æ®æ—¥æœŸè®¡ç®—çŠ¶æ€\r\n  calculateStatus: (effectiveDate?: string, endDate?: string): TemporalStatus => {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    \r\n    // å¦‚æœæ²¡æœ‰ç”Ÿæ•ˆæ—¥æœŸï¼Œé»˜è®¤ä¸ºå¯ç”¨\r\n    if (!effectiveDate) return 'ACTIVE';\r\n    \r\n    // å¦‚æœç”Ÿæ•ˆæ—¥æœŸåœ¨æœªæ¥ï¼Œä¸ºè®¡åˆ’çŠ¶æ€\r\n    if (effectiveDate > today) return 'PLANNED';\r\n    \r\n    // å¦‚æœæœ‰ç»“æŸæ—¥æœŸä¸”å·²è¿‡æœŸï¼Œä¸ºåœç”¨çŠ¶æ€\r\n    if (endDate && endDate < today) return 'INACTIVE';\r\n    \r\n    // å…¶ä»–æƒ…å†µä¸ºå¯ç”¨çŠ¶æ€\r\n    return 'ACTIVE';\r\n  },\r\n\r\n  // åˆ¤æ–­æ˜¯å¦ä¸ºæ—¶æ€ç»„ç»‡\r\n  isTemporal: (effectiveDate?: string, endDate?: string): boolean => {\r\n    return !!(effectiveDate || endDate);\r\n  },\r\n\r\n  // è·å–çŠ¶æ€é¢œè‰²\r\n  getStatusColor: (status: TemporalStatus): string => {\r\n    switch (status) {\r\n      case 'ACTIVE': return '#00A844'; // ç»¿è‰²\r\n      case 'PLANNED': return '#0875E1'; // è“è‰²  \r\n      case 'INACTIVE': return '#999999'; // ç°è‰²\r\n      default: return '#333333';\r\n    }\r\n  },\r\n\r\n  // è·å–çŠ¶æ€å›¾æ ‡\r\n  getStatusIcon: (status: TemporalStatus): string => {\r\n    switch (status) {\r\n      case 'ACTIVE': return 'âœ“';\r\n      case 'PLANNED': return 'ğŸ“…';\r\n      case 'INACTIVE': return 'â¸ï¸';\r\n      default: return 'â€¢';\r\n    }\r\n  }\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TemporalTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PrimaryButton' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'organization' is defined but never used.","line":70,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€æ„ŸçŸ¥æ•°æ®è¡¨æ ¼ç»„ä»¶\r\n * æ”¯æŒæ—¶æ€æ¨¡å¼çš„ç»„ç»‡æ¶æ„æ•°æ®å±•ç¤ºå’Œæ“ä½œ\r\n */\r\nimport React, { useState, useMemo, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Table } from '@workday/canvas-kit-react/table';\r\nimport { PrimaryButton, SecondaryButton, ToolbarIconButton as IconButton } from '@workday/canvas-kit-react/button';\r\nimport { Badge } from '../../../shared/components/Badge';\r\nimport { Tooltip } from '@workday/canvas-kit-react/tooltip';\r\nimport { Checkbox } from '@workday/canvas-kit-react/checkbox';\r\nimport { \r\n  colors, \r\n  space, \r\n  borderRadius \r\n} from '@workday/canvas-kit-react/tokens';\r\nimport {\r\n  EditIcon,\r\n  DeleteIcon,\r\n  HistoryIcon,\r\n  TimelineIcon,\r\n  InfoIcon,\r\n  CompareIcon,\r\n  FilterIcon\r\n} from '@workday/canvas-kit-react/icon';\r\nimport { useTemporalOrganizations } from '../../shared/hooks/useTemporalQuery';\r\nimport { temporalSelectors } from '../../shared/stores/temporalStore';\r\nimport type { OrganizationUnit, OrganizationQueryParams } from '../../shared/types/organization';\r\nimport type { TemporalMode } from '../../shared/types/temporal';\r\n\r\nexport interface TemporalTableProps {\r\n  /** æŸ¥è¯¢å‚æ•° */\r\n  queryParams?: OrganizationQueryParams;\r\n  /** æ˜¯å¦æ˜¾ç¤ºæ—¶æ€æŒ‡ç¤ºå™¨ */\r\n  showTemporalIndicators?: boolean;\r\n  /** æ˜¯å¦æ˜¾ç¤ºæ“ä½œåˆ— */\r\n  showActions?: boolean;\r\n  /** æ˜¯å¦æ˜¾ç¤ºé€‰æ‹©åˆ— */\r\n  showSelection?: boolean;\r\n  /** æ˜¯å¦ç´§å‡‘æ¨¡å¼ */\r\n  compact?: boolean;\r\n  /** æ¯é¡µæ˜¾ç¤ºæ•°é‡ */\r\n  pageSize?: number;\r\n  /** è¡Œç‚¹å‡»å›è°ƒ */\r\n  onRowClick?: (organization: OrganizationUnit) => void;\r\n  /** ç¼–è¾‘å›è°ƒ */\r\n  onEdit?: (organization: OrganizationUnit) => void;\r\n  /** åˆ é™¤å›è°ƒ */\r\n  onDelete?: (organization: OrganizationUnit) => void;\r\n  /** æŸ¥çœ‹å†å²å›è°ƒ */\r\n  onViewHistory?: (organization: OrganizationUnit) => void;\r\n  /** æŸ¥çœ‹æ—¶é—´çº¿å›è°ƒ */\r\n  onViewTimeline?: (organization: OrganizationUnit) => void;\r\n  /** é€‰æ‹©å˜æ›´å›è°ƒ */\r\n  onSelectionChange?: (selectedOrganizations: OrganizationUnit[]) => void;\r\n}\r\n\r\n/**\r\n * æ—¶æ€çŠ¶æ€æŒ‡ç¤ºå™¨ç»„ä»¶\r\n */\r\ninterface TemporalIndicatorProps {\r\n  mode: TemporalMode;\r\n  organization: OrganizationUnit;\r\n  compact: boolean;\r\n}\r\n\r\nconst TemporalIndicator: React.FC<TemporalIndicatorProps> = ({\r\n  mode,\r\n  organization,\r\n  compact\r\n}) => {\r\n  const getIndicatorStyle = () => {\r\n    switch (mode) {\r\n      case 'current':\r\n        return {\r\n          color: colors.greenFresca600,\r\n          bgColor: colors.greenFresca100,\r\n          label: 'å½“å‰',\r\n          icon: 'ğŸŸ¢'\r\n        };\r\n      case 'historical':\r\n        return {\r\n          color: colors.blueberry600,\r\n          bgColor: colors.blueberry100,\r\n          label: 'å†å²',\r\n          icon: 'ğŸ”µ'\r\n        };\r\n      case 'planning':\r\n        return {\r\n          color: colors.peach600,\r\n          bgColor: colors.peach100,\r\n          label: 'è§„åˆ’',\r\n          icon: 'ğŸŸ '\r\n        };\r\n    }\r\n  };\r\n\r\n  const style = getIndicatorStyle();\r\n  \r\n  if (compact) {\r\n    return (\r\n      <Tooltip title={`${style.label}æ¨¡å¼`}>\r\n        <Box\r\n          width=\"8px\"\r\n          height=\"8px\"\r\n          borderRadius=\"50%\"\r\n          backgroundColor={style.color}\r\n        />\r\n      </Tooltip>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Badge\r\n      color={style.color}\r\n      variant=\"outline\"\r\n      size=\"small\"\r\n    >\r\n      {style.icon} {style.label}\r\n    </Badge>\r\n  );\r\n};\r\n\r\n/**\r\n * æ—¶æ€å­—æ®µæ˜¾ç¤ºç»„ä»¶\r\n */\r\ninterface TemporalFieldProps {\r\n  organization: OrganizationUnit;\r\n  field: keyof OrganizationUnit;\r\n  mode: TemporalMode;\r\n}\r\n\r\nconst TemporalField: React.FC<TemporalFieldProps> = ({\r\n  organization,\r\n  field,\r\n  mode\r\n}) => {\r\n  const value = organization[field];\r\n  const isTemporalField = field === 'effective_from' || field === 'effective_to';\r\n  \r\n  // æ ¼å¼åŒ–æ˜¾ç¤ºå€¼\r\n  const formatValue = (val: unknown) => {\r\n    if (val === null || val === undefined) return '-';\r\n    if (typeof val === 'boolean') return val ? 'æ˜¯' : 'å¦';\r\n    if (field === 'created_at' || field === 'updated_at' || isTemporalField) {\r\n      try {\r\n        return new Date(val as string).toLocaleDateString('zh-CN');\r\n      } catch {\r\n        return String(val);\r\n      }\r\n    }\r\n    return String(val);\r\n  };\r\n\r\n  // è·å–çŠ¶æ€æ ·å¼\r\n  const getStatusStyle = (status: string) => {\r\n    switch (status) {\r\n      case 'ACTIVE':\r\n        return { color: colors.greenFresca600, label: 'å¯ç”¨' };\r\n      case 'INACTIVE':\r\n        return { color: colors.licorice400, label: 'åœç”¨' };\r\n      case 'PLANNED':\r\n        return { color: colors.peach600, label: 'è§„åˆ’' };\r\n      default:\r\n        return { color: colors.licorice600, label: status };\r\n    }\r\n  };\r\n\r\n  // ç‰¹æ®Šå­—æ®µå¤„ç†\r\n  if (field === 'status') {\r\n    const statusStyle = getStatusStyle(String(value));\r\n    return (\r\n      <Badge color={statusStyle.color} variant=\"outline\" size=\"small\">\r\n        {statusStyle.label}\r\n      </Badge>\r\n    );\r\n  }\r\n\r\n  if (field === 'unit_type') {\r\n    const typeLabels = {\r\n      'COMPANY': 'å…¬å¸',\r\n      'DEPARTMENT': 'éƒ¨é—¨',\r\n      'COST_CENTER': 'æˆæœ¬ä¸­å¿ƒ',\r\n      'PROJECT_TEAM': 'é¡¹ç›®ç»„'\r\n    };\r\n    return <Text>{typeLabels[value as keyof typeof typeLabels] || value}</Text>;\r\n  }\r\n\r\n  // æ—¶æ€å­—æ®µé«˜äº®æ˜¾ç¤º\r\n  if (isTemporalField && mode !== 'current' && value) {\r\n    return (\r\n      <Text color={colors.blueberry600} fontWeight=\"medium\">\r\n        {formatValue(value)}\r\n      </Text>\r\n    );\r\n  }\r\n\r\n  return <Text>{formatValue(value)}</Text>;\r\n};\r\n\r\n/**\r\n * æ—¶æ€æ„ŸçŸ¥æ•°æ®è¡¨æ ¼ç»„ä»¶\r\n */\r\nexport const TemporalTable: React.FC<TemporalTableProps> = ({\r\n  queryParams,\r\n  showTemporalIndicators = true,\r\n  showActions = true,\r\n  showSelection = false,\r\n  compact = false,\r\n  pageSize = 20,\r\n  onRowClick,\r\n  onEdit,\r\n  onDelete,\r\n  onViewHistory,\r\n  onViewTimeline,\r\n  onSelectionChange\r\n}) => {\r\n  const [selectedRows, setSelectedRows] = useState<Set<string>>(new Set());\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n\r\n  // æ—¶æ€çŠ¶æ€\r\n  const temporalContext = temporalSelectors.useContext();\r\n  const isHistorical = temporalContext.mode === 'historical';\r\n  const isPlanning = temporalContext.mode === 'planning';\r\n\r\n  // è·å–ç»„ç»‡æ•°æ®\r\n  const {\r\n    data: organizations = [],\r\n    isLoading,\r\n    isError,\r\n    error,\r\n    temporalContext: queryContext\r\n  } = useTemporalOrganizations({\r\n    ...queryParams,\r\n    page: currentPage,\r\n    pageSize\r\n  });\r\n\r\n  // è¡¨æ ¼åˆ—å®šä¹‰\r\n  const columns = useMemo(() => {\r\n    const baseColumns = [\r\n      {\r\n        key: 'code' as keyof OrganizationUnit,\r\n        label: 'ç»„ç»‡ä»£ç ',\r\n        width: '120px',\r\n        sortable: true\r\n      },\r\n      {\r\n        key: 'name' as keyof OrganizationUnit,\r\n        label: 'ç»„ç»‡åç§°',\r\n        width: 'auto',\r\n        sortable: true\r\n      },\r\n      {\r\n        key: 'unit_type' as keyof OrganizationUnit,\r\n        label: 'ç±»å‹',\r\n        width: '100px',\r\n        sortable: true\r\n      },\r\n      {\r\n        key: 'status' as keyof OrganizationUnit,\r\n        label: 'çŠ¶æ€',\r\n        width: '80px',\r\n        sortable: true\r\n      },\r\n      {\r\n        key: 'level' as keyof OrganizationUnit,\r\n        label: 'å±‚çº§',\r\n        width: '60px',\r\n        sortable: true\r\n      }\r\n    ];\r\n\r\n    // æ—¶æ€æ¨¡å¼ä¸‹æ·»åŠ æ—¶æ€ç›¸å…³åˆ—\r\n    if (isHistorical || isPlanning) {\r\n      baseColumns.push(\r\n        {\r\n          key: 'effective_from' as keyof OrganizationUnit,\r\n          label: 'ç”Ÿæ•ˆæ—¶é—´',\r\n          width: '120px',\r\n          sortable: true\r\n        },\r\n        {\r\n          key: 'effective_to' as keyof OrganizationUnit,\r\n          label: 'å¤±æ•ˆæ—¶é—´',\r\n          width: '120px',\r\n          sortable: true\r\n        }\r\n      );\r\n    }\r\n\r\n    if (!compact) {\r\n      baseColumns.push({\r\n        key: 'updated_at' as keyof OrganizationUnit,\r\n        label: 'æ›´æ–°æ—¶é—´',\r\n        width: '120px',\r\n        sortable: true\r\n      });\r\n    }\r\n\r\n    return baseColumns;\r\n  }, [isHistorical, isPlanning, compact]);\r\n\r\n  // é€‰æ‹©å¤„ç†\r\n  const handleRowSelect = useCallback((orgCode: string, selected: boolean) => {\r\n    const newSelection = new Set(selectedRows);\r\n    if (selected) {\r\n      newSelection.add(orgCode);\r\n    } else {\r\n      newSelection.delete(orgCode);\r\n    }\r\n    setSelectedRows(newSelection);\r\n\r\n    // å›è°ƒé€‰ä¸­çš„ç»„ç»‡\r\n    if (onSelectionChange) {\r\n      const selectedOrgs = organizations.filter(org => newSelection.has(org.code));\r\n      onSelectionChange(selectedOrgs);\r\n    }\r\n  }, [selectedRows, organizations, onSelectionChange]);\r\n\r\n  // å…¨é€‰/å–æ¶ˆå…¨é€‰\r\n  const handleSelectAll = useCallback((selected: boolean) => {\r\n    if (selected) {\r\n      const allCodes = new Set(organizations.map(org => org.code));\r\n      setSelectedRows(allCodes);\r\n      onSelectionChange?.(organizations);\r\n    } else {\r\n      setSelectedRows(new Set());\r\n      onSelectionChange?.([]);\r\n    }\r\n  }, [organizations, onSelectionChange]);\r\n\r\n  // é¡µé¢å˜æ›´\r\n  const handlePageChange = useCallback((page: number) => {\r\n    setCurrentPage(page);\r\n    setSelectedRows(new Set()); // æ¸…ç©ºé€‰æ‹©\r\n  }, []);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <Box padding={space.m}>\r\n        <Text>ğŸ”„ åŠ è½½ç»„ç»‡æ•°æ®...</Text>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  if (isError) {\r\n    return (\r\n      <Box padding={space.m}>\r\n        <Text color={colors.cinnamon600}>\r\n          âŒ åŠ è½½æ•°æ®å¤±è´¥: {error?.message || 'æœªçŸ¥é”™è¯¯'}\r\n        </Text>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  const isAllSelected = selectedRows.size > 0 && selectedRows.size === organizations.length;\r\n  const isIndeterminate = selectedRows.size > 0 && selectedRows.size < organizations.length;\r\n\r\n  return (\r\n    <Box>\r\n      {/* è¡¨æ ¼å·¥å…·æ  */}\r\n      <Flex justifyContent=\"space-between\" alignItems=\"center\" marginBottom={space.m}>\r\n        <Flex alignItems=\"center\" gap={space.s}>\r\n          {/* æ—¶æ€æ¨¡å¼æŒ‡ç¤ºå™¨ */}\r\n          {showTemporalIndicators && (\r\n            <TemporalIndicator\r\n              mode={queryContext.mode}\r\n              organization={organizations[0]}\r\n              compact={compact}\r\n            />\r\n          )}\r\n\r\n          <Text fontSize=\"medium\" fontWeight=\"medium\">\r\n            ç»„ç»‡æ¶æ„ ({organizations.length})\r\n          </Text>\r\n\r\n          {/* é€‰æ‹©ç»Ÿè®¡ */}\r\n          {showSelection && selectedRows.size > 0 && (\r\n            <Badge color={colors.blueberry600} variant=\"solid\">\r\n              å·²é€‰æ‹© {selectedRows.size} é¡¹\r\n            </Badge>\r\n          )}\r\n        </Flex>\r\n\r\n        {/* æ‰¹é‡æ“ä½œæŒ‰é’® */}\r\n        {showSelection && selectedRows.size > 0 && (\r\n          <Flex gap={space.s}>\r\n            <SecondaryButton variant=\"secondary\" size=\"small\">\r\n              <CompareIcon /> æ‰¹é‡å¯¹æ¯”\r\n            </SecondaryButton>\r\n            <SecondaryButton variant=\"secondary\" size=\"small\">\r\n              <FilterIcon /> å¯¼å‡ºé€‰ä¸­\r\n            </SecondaryButton>\r\n          </Flex>\r\n        )}\r\n      </Flex>\r\n\r\n      {/* æ•°æ®è¡¨æ ¼ */}\r\n      <Box\r\n        border={`1px solid ${colors.soap300}`}\r\n        borderRadius={borderRadius.m}\r\n        overflow=\"hidden\"\r\n      >\r\n        <Table>\r\n          <Table.Head>\r\n            <Table.Row>\r\n              {/* é€‰æ‹©åˆ— */}\r\n              {showSelection && (\r\n                <Table.Header width=\"50px\">\r\n                  <Checkbox\r\n                    checked={isAllSelected}\r\n                    indeterminate={isIndeterminate}\r\n                    onChange={(e) => handleSelectAll(e.target.checked)}\r\n                  />\r\n                </Table.Header>\r\n              )}\r\n\r\n              {/* æ—¶æ€æŒ‡ç¤ºåˆ— */}\r\n              {showTemporalIndicators && (\r\n                <Table.Header width=\"40px\">\r\n                  <Tooltip title=\"æ—¶æ€çŠ¶æ€\">\r\n                    <InfoIcon size=\"small\" />\r\n                  </Tooltip>\r\n                </Table.Header>\r\n              )}\r\n\r\n              {/* æ•°æ®åˆ— */}\r\n              {columns.map(column => (\r\n                <Table.Header key={column.key} width={column.width}>\r\n                  {column.label}\r\n                </Table.Header>\r\n              ))}\r\n\r\n              {/* æ“ä½œåˆ— */}\r\n              {showActions && (\r\n                <Table.Header width=\"120px\">æ“ä½œ</Table.Header>\r\n              )}\r\n            </Table.Row>\r\n          </Table.Head>\r\n\r\n          <Table.Body>\r\n            {organizations.map((organization) => (\r\n              <Table.Row\r\n                key={organization.code}\r\n                style={{\r\n                  cursor: onRowClick ? 'pointer' : 'default'\r\n                }}\r\n                onClick={() => onRowClick?.(organization)}\r\n              >\r\n                {/* é€‰æ‹©åˆ— */}\r\n                {showSelection && (\r\n                  <Table.Cell>\r\n                    <Checkbox\r\n                      checked={selectedRows.has(organization.code)}\r\n                      onChange={(e) => {\r\n                        e.stopPropagation();\r\n                        handleRowSelect(organization.code, e.target.checked);\r\n                      }}\r\n                    />\r\n                  </Table.Cell>\r\n                )}\r\n\r\n                {/* æ—¶æ€æŒ‡ç¤ºåˆ— */}\r\n                {showTemporalIndicators && (\r\n                  <Table.Cell>\r\n                    <TemporalIndicator\r\n                      mode={queryContext.mode}\r\n                      organization={organization}\r\n                      compact={true}\r\n                    />\r\n                  </Table.Cell>\r\n                )}\r\n\r\n                {/* æ•°æ®åˆ— */}\r\n                {columns.map(column => (\r\n                  <Table.Cell key={column.key}>\r\n                    <TemporalField\r\n                      organization={organization}\r\n                      field={column.key}\r\n                      mode={queryContext.mode}\r\n                    />\r\n                  </Table.Cell>\r\n                ))}\r\n\r\n                {/* æ“ä½œåˆ— */}\r\n                {showActions && (\r\n                  <Table.Cell>\r\n                    <Flex gap={space.xs}>\r\n                      {/* ç¼–è¾‘æŒ‰é’® - å†å²æ¨¡å¼ä¸‹ç¦ç”¨ */}\r\n                      <Tooltip title={isHistorical ? 'å†å²æ¨¡å¼ä¸‹ä¸å¯ç¼–è¾‘' : 'ç¼–è¾‘ç»„ç»‡'}>\r\n                        <IconButton\r\n                          variant=\"plain\"\r\n                          size=\"small\"\r\n                          disabled={isHistorical}\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onEdit?.(organization);\r\n                          }}\r\n                        >\r\n                          <EditIcon />\r\n                        </IconButton>\r\n                      </Tooltip>\r\n\r\n                      {/* å†å²æŒ‰é’® */}\r\n                      {onViewHistory && (\r\n                        <Tooltip title=\"æŸ¥çœ‹å†å²ç‰ˆæœ¬\">\r\n                          <IconButton\r\n                            variant=\"plain\"\r\n                            size=\"small\"\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              onViewHistory(organization);\r\n                            }}\r\n                          >\r\n                            <HistoryIcon />\r\n                          </IconButton>\r\n                        </Tooltip>\r\n                      )}\r\n\r\n                      {/* æ—¶é—´çº¿æŒ‰é’® */}\r\n                      {onViewTimeline && (\r\n                        <Tooltip title=\"æŸ¥çœ‹æ—¶é—´çº¿\">\r\n                          <IconButton\r\n                            variant=\"plain\"\r\n                            size=\"small\"\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              onViewTimeline(organization);\r\n                            }}\r\n                          >\r\n                            <TimelineIcon />\r\n                          </IconButton>\r\n                        </Tooltip>\r\n                      )}\r\n\r\n                      {/* åˆ é™¤æŒ‰é’® - å†å²æ¨¡å¼ä¸‹ç¦ç”¨ */}\r\n                      {onDelete && (\r\n                        <Tooltip title={isHistorical ? 'å†å²æ¨¡å¼ä¸‹ä¸å¯åˆ é™¤' : 'åˆ é™¤ç»„ç»‡'}>\r\n                          <IconButton\r\n                            variant=\"plain\"\r\n                            size=\"small\"\r\n                            disabled={isHistorical}\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              onDelete(organization);\r\n                            }}\r\n                          >\r\n                            <DeleteIcon />\r\n                          </IconButton>\r\n                        </Tooltip>\r\n                      )}\r\n                    </Flex>\r\n                  </Table.Cell>\r\n                )}\r\n              </Table.Row>\r\n            ))}\r\n          </Table.Body>\r\n        </Table>\r\n\r\n        {/* ç©ºçŠ¶æ€ */}\r\n        {organizations.length === 0 && (\r\n          <Box padding={space.l} textAlign=\"center\">\r\n            <Text color={colors.licorice500}>\r\n              ğŸ“­ æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç»„ç»‡æ•°æ®\r\n            </Text>\r\n          </Box>\r\n        )}\r\n      </Box>\r\n\r\n      {/* åˆ†é¡µä¿¡æ¯ */}\r\n      {organizations.length > 0 && (\r\n        <Flex justifyContent=\"space-between\" alignItems=\"center\" marginTop=\"m\">\r\n          <Text typeLevel=\"subtext.small\" color=\"hint\">\r\n            æ˜¾ç¤ºç¬¬ {(currentPage - 1) * pageSize + 1} - {Math.min(currentPage * pageSize, organizations.length)} é¡¹ï¼Œ\r\n            å…± {organizations.length} é¡¹\r\n          </Text>\r\n          \r\n          <Flex gap=\"s\" alignItems=\"center\">\r\n            <SecondaryButton\r\n              size=\"small\"\r\n              disabled={currentPage <= 1}\r\n              onClick={() => handlePageChange(currentPage - 1)}\r\n            >\r\n              ä¸Šä¸€é¡µ\r\n            </SecondaryButton>\r\n            \r\n            <Text typeLevel=\"subtext.small\">\r\n              ç¬¬ {currentPage} é¡µ\r\n            </Text>\r\n            \r\n            <SecondaryButton\r\n              size=\"small\"\r\n              disabled={currentPage >= Math.ceil(organizations.length / pageSize)}\r\n              onClick={() => handlePageChange(currentPage + 1)}\r\n            >\r\n              ä¸‹ä¸€é¡µ\r\n            </SecondaryButton>\r\n          </Flex>\r\n        </Flex>\r\n      )}\r\n\r\n      {/* æ—¶æ€æ¨¡å¼æç¤º */}\r\n      {(isHistorical || isPlanning) && (\r\n        <Box marginTop={space.s}>\r\n          <Text fontSize=\"small\" color={colors.licorice500}>\r\n            â„¹ï¸ {isHistorical ? 'å½“å‰æ˜¾ç¤ºå†å²' : 'å½“å‰æ˜¾ç¤ºè§„åˆ’'}æ¨¡å¼æ•°æ®ï¼Œ\r\n            {isHistorical && 'ç¼–è¾‘å’Œåˆ é™¤åŠŸèƒ½å·²ç¦ç”¨'}\r\n            {isPlanning && 'æ˜¾ç¤ºæœªæ¥è§„åˆ’çš„ç»„ç»‡å˜æ›´'}\r\n          </Text>\r\n        </Box>\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default TemporalTable;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/TimePointQuery.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'label' is defined but never used.","line":97,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":65}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶é—´ç‚¹æŸ¥è¯¢ç»„ä»¶ - åŸºäºGraphQLæ—¶æ€æŸ¥è¯¢\r\n * æä¾›ç›´è§‚çš„æ—¶é—´ç‚¹æŸ¥è¯¢ç•Œé¢å’Œç»“æœå±•ç¤º\r\n */\r\nimport React, { useState, useMemo, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { FormField } from '@workday/canvas-kit-react/form-field';\r\nimport { TextInput } from '@workday/canvas-kit-react/text-input';\r\nimport { LoadingDots } from '@workday/canvas-kit-react/loading-dots';\r\nimport { \r\n  colors, \r\n  space, \r\n  borderRadius\r\n} from '@workday/canvas-kit-react/tokens';\r\nimport {\r\n  calendarIcon,\r\n  searchIcon,\r\n  infoIcon\r\n} from '@workday/canvas-system-icons-web';\r\nimport { SystemIcon } from '@workday/canvas-kit-react/icon';\r\n\r\n// ä½¿ç”¨æ–°çš„GraphQLæ—¶æ€æŸ¥è¯¢é’©å­\r\nimport { \r\n  useOrganizationAsOfDate,\r\n  useTemporalQueryUtils\r\n} from '../../../shared/hooks/useTemporalGraphQL';\r\nimport type { \r\n  TemporalOrganizationUnit\r\n} from '../../../shared/types/temporal';\r\n\r\n// ç®€åŒ–å­—ä½“å¤§å°å®šä¹‰\r\nconst fontSizes = {\r\n  body: {\r\n    small: '12px',\r\n    medium: '14px'\r\n  },\r\n  heading: {\r\n    medium: '16px'\r\n  }\r\n};\r\n\r\ninterface TimePointQueryProps {\r\n  organizationCode: string;\r\n  onQueryResult?: (date: string, result: TemporalOrganizationUnit | null) => void;\r\n  initialDate?: string;\r\n  showQuickDates?: boolean;\r\n  compact?: boolean;\r\n}\r\n\r\nexport const TimePointQuery: React.FC<TimePointQueryProps> = ({\r\n  organizationCode,\r\n  onQueryResult,\r\n  initialDate,\r\n  showQuickDates = true,\r\n  compact = false\r\n}) => {\r\n  const [queryDate, setQueryDate] = useState(() => {\r\n    return initialDate || new Date().toISOString().split('T')[0];\r\n  });\r\n\r\n  // GraphQLæŸ¥è¯¢é’©å­\r\n  const {\r\n    data: asOfDateRecord,\r\n    isLoading: isQuerying,\r\n    error: queryError,\r\n    refetch: executeQuery,\r\n    hasData,\r\n    isEmpty,\r\n    isHistoricalRecord\r\n  } = useOrganizationAsOfDate(organizationCode, queryDate, {\r\n    enabled: false, // æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢\r\n    onSuccess: (data) => {\r\n      onQueryResult?.(queryDate, data);\r\n    }\r\n  });\r\n\r\n  // å·¥å…·é’©å­\r\n  const { getCommonDatePoints, formatTemporalRecord } = useTemporalQueryUtils();\r\n\r\n  // å¸¸ç”¨æ—¶é—´ç‚¹\r\n  const commonDates = useMemo(() => getCommonDatePoints(), [getCommonDatePoints]);\r\n\r\n  // å¤„ç†æŸ¥è¯¢æ‰§è¡Œ\r\n  const handleExecuteQuery = useCallback(() => {\r\n    executeQuery();\r\n  }, [executeQuery]);\r\n\r\n  // å¤„ç†æ—¥æœŸå˜æ›´\r\n  const handleDateChange = useCallback((date: string) => {\r\n    setQueryDate(date);\r\n  }, []);\r\n\r\n  // å¤„ç†å¿«é€Ÿæ—¥æœŸé€‰æ‹©\r\n  const handleQuickDateSelect = useCallback((date: string, label: string) => {\r\n    setQueryDate(date);\r\n    // è‡ªåŠ¨æ‰§è¡ŒæŸ¥è¯¢\r\n    setTimeout(() => {\r\n      executeQuery();\r\n    }, 100);\r\n  }, [executeQuery]);\r\n\r\n  // æ¸²æŸ“æŸ¥è¯¢ç»“æœ\r\n  const renderQueryResult = () => {\r\n    if (isQuerying) {\r\n      return (\r\n        <Card padding={space.m} marginTop={space.s}>\r\n          <Flex alignItems=\"center\">\r\n            <LoadingDots />\r\n            <Text marginLeft={space.s}>æ­£åœ¨æŸ¥è¯¢ {queryDate} çš„ç»„ç»‡çŠ¶æ€...</Text>\r\n          </Flex>\r\n        </Card>\r\n      );\r\n    }\r\n\r\n    if (queryError) {\r\n      return (\r\n        <Card \r\n          padding={space.m} \r\n          marginTop={space.s}\r\n          backgroundColor={colors.cinnamon100}\r\n          border={`1px solid ${colors.cinnamon300}`}\r\n        >\r\n          <Flex alignItems=\"center\" marginBottom={space.s}>\r\n            <SystemIcon icon={infoIcon} size={16} color={colors.cinnamon600} />\r\n            <Text marginLeft={space.xs} color={colors.cinnamon600} fontWeight=\"medium\">\r\n              æŸ¥è¯¢å¤±è´¥\r\n            </Text>\r\n          </Flex>\r\n          <Text fontSize={fontSizes.body.small} color={colors.cinnamon600}>\r\n            {queryError.message}\r\n          </Text>\r\n          <SecondaryButton onClick={handleExecuteQuery} marginTop={space.s} size=\"small\">\r\n            é‡è¯•æŸ¥è¯¢\r\n          </SecondaryButton>\r\n        </Card>\r\n      );\r\n    }\r\n\r\n    if (isEmpty) {\r\n      return (\r\n        <Card \r\n          padding={space.m} \r\n          marginTop={space.s}\r\n          backgroundColor={colors.licorice100}\r\n          border={`1px solid ${colors.licorice300}`}\r\n        >\r\n          <Flex alignItems=\"center\" marginBottom={space.s}>\r\n            <SystemIcon icon={infoIcon} size={16} color={colors.licorice400} />\r\n            <Text marginLeft={space.xs} color={colors.licorice400} fontWeight=\"medium\">\r\n              æ— æŸ¥è¯¢ç»“æœ\r\n            </Text>\r\n          </Flex>\r\n          <Text fontSize={fontSizes.body.small} color={colors.licorice400}>\r\n            åœ¨ <strong>{queryDate}</strong> æ—¶é—´ç‚¹æ²¡æœ‰æ‰¾åˆ°ç»„ç»‡ <strong>{organizationCode}</strong> çš„è®°å½•\r\n          </Text>\r\n        </Card>\r\n      );\r\n    }\r\n\r\n    if (hasData && asOfDateRecord) {\r\n      const formatted = formatTemporalRecord(asOfDateRecord);\r\n      \r\n      return (\r\n        <Card \r\n          padding={space.m} \r\n          marginTop={space.s}\r\n          backgroundColor={isHistoricalRecord ? colors.peach100 : colors.blueberry100}\r\n          border={`1px solid ${isHistoricalRecord ? colors.peach300 : colors.blueberry300}`}\r\n        >\r\n          <Flex justifyContent=\"space-between\" alignItems=\"flex-start\" marginBottom={space.s}>\r\n            <Flex alignItems=\"center\">\r\n              <SystemIcon \r\n                icon={isHistoricalRecord ? infoIcon : infoIcon} \r\n                size={16} \r\n                color={isHistoricalRecord ? colors.peach600 : colors.blueberry600} \r\n              />\r\n              <Text \r\n                marginLeft={space.xs} \r\n                fontWeight=\"medium\"\r\n                color={isHistoricalRecord ? colors.peach600 : colors.blueberry600}\r\n              >\r\n                æŸ¥è¯¢ç»“æœ ({queryDate})\r\n              </Text>\r\n            </Flex>\r\n            <Box\r\n              backgroundColor={isHistoricalRecord ? colors.peach500 : colors.blueberry500}\r\n              color={colors.frenchVanilla100}\r\n              paddingX={space.xs}\r\n              paddingY={space.xxxs}\r\n              borderRadius={borderRadius.s}\r\n              fontSize={fontSizes.body.small}\r\n              fontWeight=\"medium\"\r\n            >\r\n              {isHistoricalRecord ? 'å†å²è®°å½•' : 'å½“å‰è®°å½•'}\r\n            </Box>\r\n          </Flex>\r\n\r\n          <Box>\r\n            <Text \r\n              fontSize={fontSizes.heading.medium} \r\n              fontWeight=\"medium\" \r\n              marginBottom={space.xs}\r\n              color={colors.licorice500}\r\n            >\r\n              {asOfDateRecord.name}\r\n            </Text>\r\n            \r\n            <Flex gap={space.l} flexWrap=\"wrap\" marginBottom={space.s}>\r\n              <Box>\r\n                <Text fontSize={fontSizes.body.small} color={colors.licorice400}>ç»„ç»‡ä»£ç </Text>\r\n                <Text fontSize={fontSizes.body.medium}>{asOfDateRecord.code}</Text>\r\n              </Box>\r\n              \r\n              <Box>\r\n                <Text fontSize={fontSizes.body.small} color={colors.licorice400}>ç”Ÿæ•ˆæœŸé—´</Text>\r\n                <Text fontSize={fontSizes.body.medium}>{formatted.effectivePeriod}</Text>\r\n              </Box>\r\n              \r\n              <Box>\r\n                <Text fontSize={fontSizes.body.small} color={colors.licorice400}>ç»„ç»‡ç±»å‹</Text>\r\n                <Text fontSize={fontSizes.body.medium}>{formatted.organizationType}</Text>\r\n              </Box>\r\n              \r\n              <Box>\r\n                <Text fontSize={fontSizes.body.small} color={colors.licorice400}>çŠ¶æ€</Text>\r\n                <Text fontSize={fontSizes.body.medium}>{formatted.organizationStatus}</Text>\r\n              </Box>\r\n            </Flex>\r\n\r\n            {asOfDateRecord.change_reason && (\r\n              <Box marginTop={space.s}>\r\n                <Text fontSize={fontSizes.body.small} color={colors.licorice400}>å˜æ›´åŸå› </Text>\r\n                <Text fontSize={fontSizes.body.medium} fontStyle=\"italic\">\r\n                  {asOfDateRecord.change_reason}\r\n                </Text>\r\n              </Box>\r\n            )}\r\n            \r\n            {asOfDateRecord.description && (\r\n              <Box marginTop={space.s}>\r\n                <Text fontSize={fontSizes.body.small} color={colors.licorice400}>æè¿°</Text>\r\n                <Text fontSize={fontSizes.body.medium}>\r\n                  {asOfDateRecord.description}\r\n                </Text>\r\n              </Box>\r\n            )}\r\n          </Box>\r\n        </Card>\r\n      );\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  // æ¸²æŸ“å¿«é€Ÿæ—¥æœŸé€‰æ‹©å™¨\r\n  const renderQuickDatePicker = () => {\r\n    if (!showQuickDates) return null;\r\n\r\n    const quickDateLabels = {\r\n      today: 'ä»Šå¤©',\r\n      yesterday: 'æ˜¨å¤©',\r\n      lastWeek: 'ä¸€å‘¨å‰',\r\n      lastMonth: 'ä¸€æœˆå‰',\r\n      yearStart: 'å¹´åˆ',\r\n      lastYearEnd: 'å»å¹´åº•'\r\n    };\r\n\r\n    return (\r\n      <Box marginTop={space.s}>\r\n        <Text fontSize={fontSizes.body.small} color={colors.licorice400} marginBottom={space.xs}>\r\n          å¿«é€Ÿé€‰æ‹©:\r\n        </Text>\r\n        <Flex gap={space.xs} flexWrap=\"wrap\">\r\n          {Object.entries(commonDates).map(([key, date]) => (\r\n            <SecondaryButton\r\n              key={key}\r\n              size=\"small\"\r\n              onClick={() => handleQuickDateSelect(date, quickDateLabels[key as keyof typeof quickDateLabels])}\r\n              variant={queryDate === date ? 'primary' : 'secondary'}\r\n            >\r\n              {quickDateLabels[key as keyof typeof quickDateLabels] || key}\r\n            </SecondaryButton>\r\n          ))}\r\n        </Flex>\r\n      </Box>\r\n    );\r\n  };\r\n\r\n  if (compact) {\r\n    return (\r\n      <Box>\r\n        <Flex alignItems=\"flex-end\" gap={space.s} marginBottom={space.s}>\r\n          <FormField label=\"æŸ¥è¯¢æ—¥æœŸ\">\r\n            <TextInput\r\n              type=\"date\"\r\n              value={queryDate}\r\n              onChange={(e) => handleDateChange(e.target.value)}\r\n            />\r\n          </FormField>\r\n          \r\n          <PrimaryButton onClick={handleExecuteQuery} disabled={isQuerying}>\r\n            {isQuerying ? 'æŸ¥è¯¢ä¸­...' : 'æŸ¥è¯¢'}\r\n          </PrimaryButton>\r\n        </Flex>\r\n        \r\n        {renderQuickDatePicker()}\r\n        {renderQueryResult()}\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Card padding={space.m}>\r\n      <Flex alignItems=\"center\" marginBottom={space.m}>\r\n        <SystemIcon icon={calendarIcon} size={20} />\r\n        <Text \r\n          marginLeft={space.s} \r\n          fontWeight=\"medium\"\r\n          fontSize={fontSizes.heading.medium}\r\n        >\r\n          æ—¶é—´ç‚¹æŸ¥è¯¢\r\n        </Text>\r\n      </Flex>\r\n\r\n      <Flex alignItems=\"flex-end\" gap={space.s} marginBottom={space.s}>\r\n        <FormField label=\"æŸ¥è¯¢æ—¥æœŸ\">\r\n          <TextInput\r\n            type=\"date\"\r\n            value={queryDate}\r\n            onChange={(e) => handleDateChange(e.target.value)}\r\n          />\r\n        </FormField>\r\n        \r\n        <FormField label=\"ç»„ç»‡ä»£ç \">\r\n          <TextInput\r\n            value={organizationCode}\r\n            disabled\r\n            placeholder=\"ç»„ç»‡ä»£ç \"\r\n          />\r\n        </FormField>\r\n        \r\n        <PrimaryButton onClick={handleExecuteQuery} disabled={isQuerying}>\r\n          <SystemIcon icon={searchIcon} size={16} />\r\n          {isQuerying ? 'æŸ¥è¯¢ä¸­...' : 'æŸ¥è¯¢'}\r\n        </PrimaryButton>\r\n      </Flex>\r\n\r\n      {renderQuickDatePicker()}\r\n      {renderQueryResult()}\r\n\r\n      {/* æŸ¥è¯¢è¯´æ˜ */}\r\n      <Box marginTop={space.l} padding={space.s} backgroundColor={colors.soap100}>\r\n        <Text fontSize={fontSizes.body.small} color={colors.licorice400} display=\"block\" marginBottom={space.xs}>\r\n          <strong>ä½¿ç”¨è¯´æ˜:</strong>\r\n        </Text>\r\n        <Text fontSize={fontSizes.body.small} color={colors.licorice400} display=\"block\" marginBottom={space.xs}>\r\n          â€¢ é€‰æ‹©æŸ¥è¯¢æ—¥æœŸï¼Œç³»ç»Ÿå°†è¿”å›è¯¥æ—¶é—´ç‚¹æœ‰æ•ˆçš„ç»„ç»‡è®°å½•\r\n        </Text>\r\n        <Text fontSize={fontSizes.body.small} color={colors.licorice400} display=\"block\" marginBottom={space.xs}>\r\n          â€¢ è“è‰²èƒŒæ™¯è¡¨ç¤ºå½“å‰æœ‰æ•ˆè®°å½•ï¼Œæ©™è‰²èƒŒæ™¯è¡¨ç¤ºå†å²è®°å½•\r\n        </Text>\r\n        <Text fontSize={fontSizes.body.small} color={colors.licorice400} display=\"block\">\r\n          â€¢ å¯ä½¿ç”¨å¿«é€Ÿé€‰æ‹©æŒ‰é’®å¿«é€Ÿè®¾ç½®å¸¸ç”¨æ—¥æœŸ\r\n        </Text>\r\n      </Box>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default TimePointQuery;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/Timeline.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'borderRadius' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'EditIcon' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DeleteIcon' is defined but never used.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isFirst' is defined but never used.","line":69,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleStatusFilter' is assigned a value but never used.","line":312,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":312,"endColumn":27}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶é—´çº¿å¯è§†åŒ–ç»„ä»¶\r\n * å±•ç¤ºç»„ç»‡æ¶æ„çš„æ—¶é—´çº¿äº‹ä»¶å’Œå†å²å˜æ›´\r\n */\r\nimport React, { useState, useMemo, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton, ToolbarIconButton as IconButton } from '@workday/canvas-kit-react/button';\r\nimport { Badge } from '../../../shared/components/Badge';\r\nimport { Tooltip } from '@workday/canvas-kit-react/tooltip';\r\nimport { Menu } from '@workday/canvas-kit-react/menu';\r\nimport { \r\n  colors, \r\n  space, \r\n  borderRadius,\r\n  fontSizes \r\n} from '@workday/canvas-kit-react/tokens';\r\nimport {\r\n  AddIcon,\r\n  EditIcon,\r\n  DeleteIcon,\r\n  MoreVerticalIcon,\r\n  FilterIcon,\r\n  ExpandIcon,\r\n  CollapseIcon\r\n} from '@workday/canvas-kit-react/icon';\r\nimport { useOrganizationTimeline } from '../../shared/hooks/useTemporalQuery';\r\nimport type { \r\n  TimelineEvent, \r\n  EventType, \r\n  EventStatus,\r\n  TemporalQueryParams\r\n} from '../../shared/types/temporal';\r\n\r\nexport interface TimelineProps {\r\n  /** ç»„ç»‡ä»£ç  */\r\n  organizationCode: string;\r\n  /** æ—¶é—´çº¿æŸ¥è¯¢å‚æ•° */\r\n  queryParams?: Partial<TemporalQueryParams>;\r\n  /** æ˜¯å¦ç´§å‡‘æ¨¡å¼ */\r\n  compact?: boolean;\r\n  /** æœ€å¤§æ˜¾ç¤ºäº‹ä»¶æ•° */\r\n  maxEvents?: number;\r\n  /** æ˜¯å¦æ˜¾ç¤ºç­›é€‰å™¨ */\r\n  showFilters?: boolean;\r\n  /** æ˜¯å¦æ˜¾ç¤ºæ“ä½œæŒ‰é’® */\r\n  showActions?: boolean;\r\n  /** äº‹ä»¶ç‚¹å‡»å›è°ƒ */\r\n  onEventClick?: (event: TimelineEvent) => void;\r\n  /** æ–°å¢äº‹ä»¶å›è°ƒ */\r\n  onAddEvent?: () => void;\r\n}\r\n\r\n/**\r\n * æ—¶é—´çº¿äº‹ä»¶é¡¹ç»„ä»¶\r\n */\r\ninterface TimelineEventItemProps {\r\n  event: TimelineEvent;\r\n  isFirst: boolean;\r\n  isLast: boolean;\r\n  compact: boolean;\r\n  showActions: boolean;\r\n  onEventClick?: (event: TimelineEvent) => void;\r\n}\r\n\r\nconst TimelineEventItem: React.FC<TimelineEventItemProps> = ({\r\n  event,\r\n  isFirst,\r\n  isLast,\r\n  compact,\r\n  showActions,\r\n  onEventClick\r\n}) => {\r\n  const [showMenu, setShowMenu] = useState(false);\r\n\r\n  // è·å–äº‹ä»¶ç±»å‹æ ·å¼\r\n  const getEventTypeStyle = (eventType: EventType) => {\r\n    const styles = {\r\n      create: { color: colors.greenFresca600, bgColor: colors.greenFresca100, icon: 'ğŸ—ï¸' },\r\n      update: { color: colors.blueberry600, bgColor: colors.blueberry100, icon: 'âœï¸' },\r\n      delete: { color: colors.cinnamon600, bgColor: colors.cinnamon100, icon: 'ğŸ—‘ï¸' },\r\n      activate: { color: colors.greenFresca600, bgColor: colors.greenFresca100, icon: 'âœ…' },\r\n      deactivate: { color: colors.licorice400, bgColor: colors.licorice100, icon: 'ğŸš«' },\r\n      restructure: { color: colors.peach600, bgColor: colors.peach100, icon: 'ğŸ”„' },\r\n      merge: { color: colors.plum600, bgColor: colors.plum100, icon: 'ğŸ”—' },\r\n      split: { color: colors.cantaloupe600, bgColor: colors.cantaloupe100, icon: 'âœ‚ï¸' },\r\n      transfer: { color: colors.blueberry600, bgColor: colors.blueberry100, icon: 'ğŸ“¤' },\r\n      rename: { color: colors.peach600, bgColor: colors.peach100, icon: 'ğŸ“' }\r\n    };\r\n    return styles[eventType] || styles.update;\r\n  };\r\n\r\n  // è·å–çŠ¶æ€æ ·å¼\r\n  const getStatusStyle = (status: EventStatus) => {\r\n    const styles = {\r\n      pending: { color: colors.cantaloupe600, label: 'å¾…å¤„ç†' },\r\n      approved: { color: colors.blueberry600, label: 'å·²æ‰¹å‡†' },\r\n      rejected: { color: colors.cinnamon600, label: 'å·²æ‹’ç»' },\r\n      completed: { color: colors.greenFresca600, label: 'å·²å®Œæˆ' },\r\n      cancelled: { color: colors.licorice400, label: 'å·²å–æ¶ˆ' }\r\n    };\r\n    return styles[status] || styles.pending;\r\n  };\r\n\r\n  const eventTypeStyle = getEventTypeStyle(event.eventType);\r\n  const statusStyle = getStatusStyle(event.status);\r\n\r\n  // æ ¼å¼åŒ–æ—¶é—´\r\n  const formatEventTime = (dateStr: string) => {\r\n    try {\r\n      const date = new Date(dateStr);\r\n      return date.toLocaleString('zh-CN', {\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    } catch {\r\n      return dateStr;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Flex alignItems=\"flex-start\" gap={space.s}>\r\n      {/* æ—¶é—´çº¿è¿æ¥çº¿ */}\r\n      <Box position=\"relative\" display=\"flex\" flexDirection=\"column\" alignItems=\"center\">\r\n        {/* äº‹ä»¶å›¾æ ‡ */}\r\n        <Box\r\n          width=\"32px\"\r\n          height=\"32px\"\r\n          borderRadius=\"50%\"\r\n          backgroundColor={eventTypeStyle.bgColor}\r\n          border={`2px solid ${eventTypeStyle.color}`}\r\n          display=\"flex\"\r\n          alignItems=\"center\"\r\n          justifyContent=\"center\"\r\n          fontSize={compact ? fontSizes.small : fontSizes.medium}\r\n        >\r\n          {eventTypeStyle.icon}\r\n        </Box>\r\n        \r\n        {/* è¿æ¥çº¿ */}\r\n        {!isLast && (\r\n          <Box\r\n            width=\"2px\"\r\n            height=\"40px\"\r\n            backgroundColor={colors.soap300}\r\n            marginTop={space.xs}\r\n          />\r\n        )}\r\n      </Box>\r\n\r\n      {/* äº‹ä»¶å†…å®¹ */}\r\n      <Card\r\n        flex=\"1\"\r\n        padding={compact ? space.s : space.m}\r\n        marginBottom={space.s}\r\n        cursor={onEventClick ? 'pointer' : 'default'}\r\n        onClick={() => onEventClick?.(event)}\r\n        _hover={onEventClick ? { backgroundColor: colors.soap100 } : {}}\r\n      >\r\n        <Flex justifyContent=\"space-between\" alignItems=\"flex-start\" marginBottom={space.xs}>\r\n          <Box flex=\"1\">\r\n            <Flex alignItems=\"center\" gap={space.s} marginBottom={space.xs}>\r\n              <Text fontWeight=\"medium\" fontSize={compact ? 'small' : 'medium'}>\r\n                {event.title}\r\n              </Text>\r\n              <Badge color={statusStyle.color} variant=\"outline\" size=\"small\">\r\n                {statusStyle.label}\r\n              </Badge>\r\n            </Flex>\r\n\r\n            <Text fontSize=\"small\" color={colors.licorice600} marginBottom={space.xs}>\r\n              {formatEventTime(event.eventDate)}\r\n              {event.effectiveDate && event.effectiveDate !== event.eventDate && (\r\n                <> â€¢ ç”Ÿæ•ˆæ—¶é—´: {formatEventTime(event.effectiveDate)}</>\r\n              )}\r\n            </Text>\r\n\r\n            {event.description && !compact && (\r\n              <Text fontSize=\"small\" color={colors.licorice500}>\r\n                {event.description}\r\n              </Text>\r\n            )}\r\n          </Box>\r\n\r\n          {/* æ“ä½œèœå• */}\r\n          {showActions && (\r\n            <Box position=\"relative\">\r\n              <IconButton\r\n                variant=\"plain\"\r\n                size=\"small\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  setShowMenu(!showMenu);\r\n                }}\r\n              >\r\n                <MoreVerticalIcon />\r\n              </IconButton>\r\n\r\n              {showMenu && (\r\n                <Menu onClose={() => setShowMenu(false)}>\r\n                  <Menu.Item onClick={() => console.log('æŸ¥çœ‹è¯¦æƒ…', event.id)}>\r\n                    æŸ¥çœ‹è¯¦æƒ…\r\n                  </Menu.Item>\r\n                  <Menu.Item onClick={() => console.log('ç¼–è¾‘äº‹ä»¶', event.id)}>\r\n                    ç¼–è¾‘äº‹ä»¶\r\n                  </Menu.Item>\r\n                  <Menu.Item onClick={() => console.log('åˆ é™¤äº‹ä»¶', event.id)}>\r\n                    åˆ é™¤äº‹ä»¶\r\n                  </Menu.Item>\r\n                </Menu>\r\n              )}\r\n            </Box>\r\n          )}\r\n        </Flex>\r\n\r\n        {/* å…ƒæ•°æ®ä¿¡æ¯ */}\r\n        {event.metadata && !compact && (\r\n          <Box marginTop={space.xs}>\r\n            <Text fontSize=\"small\" color={colors.licorice400}>\r\n              {typeof event.metadata === 'string' \r\n                ? event.metadata \r\n                : JSON.stringify(event.metadata, null, 2)\r\n              }\r\n            </Text>\r\n          </Box>\r\n        )}\r\n\r\n        {/* æ“ä½œè€…ä¿¡æ¯ */}\r\n        {(event.triggeredBy || event.approvedBy) && !compact && (\r\n          <Flex gap={space.m} marginTop={space.xs}>\r\n            {event.triggeredBy && (\r\n              <Text fontSize=\"small\" color={colors.licorice400}>\r\n                è§¦å‘è€…: {event.triggeredBy}\r\n              </Text>\r\n            )}\r\n            {event.approvedBy && (\r\n              <Text fontSize=\"small\" color={colors.licorice400}>\r\n                æ‰¹å‡†è€…: {event.approvedBy}\r\n              </Text>\r\n            )}\r\n          </Flex>\r\n        )}\r\n      </Card>\r\n    </Flex>\r\n  );\r\n};\r\n\r\n/**\r\n * æ—¶é—´çº¿å¯è§†åŒ–ç»„ä»¶\r\n */\r\nexport const Timeline: React.FC<TimelineProps> = ({\r\n  organizationCode,\r\n  queryParams,\r\n  compact = false,\r\n  maxEvents = 50,\r\n  showFilters = true,\r\n  showActions = false,\r\n  onEventClick,\r\n  onAddEvent\r\n}) => {\r\n  const [eventFilter, setEventFilter] = useState<EventType[]>([]);\r\n  const [statusFilter, setStatusFilter] = useState<EventStatus[]>([]);\r\n  const [expanded, setExpanded] = useState(!compact);\r\n\r\n  // è·å–æ—¶é—´çº¿æ•°æ®\r\n  const {\r\n    data: events = [],\r\n    isLoading,\r\n    isError,\r\n    error,\r\n    hasEvents,\r\n    eventCount,\r\n    latestEvent\r\n  } = useOrganizationTimeline(organizationCode, queryParams);\r\n\r\n  // ç­›é€‰äº‹ä»¶\r\n  const filteredEvents = useMemo(() => {\r\n    let filtered = events;\r\n\r\n    if (eventFilter.length > 0) {\r\n      filtered = filtered.filter(event => eventFilter.includes(event.eventType));\r\n    }\r\n\r\n    if (statusFilter.length > 0) {\r\n      filtered = filtered.filter(event => statusFilter.includes(event.status));\r\n    }\r\n\r\n    return filtered.slice(0, maxEvents);\r\n  }, [events, eventFilter, statusFilter, maxEvents]);\r\n\r\n  // è·å–äº‹ä»¶ç±»å‹ç»Ÿè®¡\r\n  const eventTypeStats = useMemo(() => {\r\n    const stats: Record<EventType, number> = {} as Record<EventType, number>;\r\n    events.forEach(event => {\r\n      stats[event.eventType] = (stats[event.eventType] || 0) + 1;\r\n    });\r\n    return stats;\r\n  }, [events]);\r\n\r\n  // å¤„ç†ç­›é€‰å™¨å˜æ›´\r\n  const handleEventTypeFilter = useCallback((eventType: EventType) => {\r\n    setEventFilter(prev => \r\n      prev.includes(eventType) \r\n        ? prev.filter(t => t !== eventType)\r\n        : [...prev, eventType]\r\n    );\r\n  }, []);\r\n\r\n  const handleStatusFilter = useCallback((status: EventStatus) => {\r\n    setStatusFilter(prev => \r\n      prev.includes(status) \r\n        ? prev.filter(s => s !== status)\r\n        : [...prev, status]\r\n    );\r\n  }, []);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <Card padding={space.m}>\r\n        <Text>ğŸ”„ åŠ è½½æ—¶é—´çº¿æ•°æ®...</Text>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (isError) {\r\n    return (\r\n      <Card padding={space.m}>\r\n        <Text color={colors.cinnamon600}>\r\n          âŒ åŠ è½½æ—¶é—´çº¿å¤±è´¥: {error?.message || 'æœªçŸ¥é”™è¯¯'}\r\n        </Text>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (!hasEvents) {\r\n    return (\r\n      <Card padding={space.m}>\r\n        <Flex justifyContent=\"center\" alignItems=\"center\" flexDirection=\"column\" gap={space.m}>\r\n          <Text color={colors.licorice500}>ğŸ“­ æš‚æ— æ—¶é—´çº¿äº‹ä»¶</Text>\r\n          {onAddEvent && (\r\n            <SecondaryButton size=\"small\" onClick={onAddEvent}>\r\n              <AddIcon /> æ·»åŠ äº‹ä»¶\r\n            </SecondaryButton>\r\n          )}\r\n        </Flex>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Box>\r\n      {/* æ—¶é—´çº¿æ ‡é¢˜å’Œæ“ä½œ */}\r\n      <Flex justifyContent=\"space-between\" alignItems=\"center\" marginBottom={space.m}>\r\n        <Flex alignItems=\"center\" gap={space.s}>\r\n          <Text fontSize=\"large\" fontWeight=\"medium\">\r\n            æ—¶é—´çº¿\r\n          </Text>\r\n          <Badge variant=\"outline\" color={colors.blueberry600}>\r\n            {eventCount} ä¸ªäº‹ä»¶\r\n          </Badge>\r\n        </Flex>\r\n\r\n        <Flex gap={space.s}>\r\n          {/* ç­›é€‰å™¨æŒ‰é’® */}\r\n          {showFilters && (\r\n            <Tooltip title=\"ç­›é€‰äº‹ä»¶\">\r\n              <IconButton variant=\"plain\" size=\"small\">\r\n                <FilterIcon />\r\n              </IconButton>\r\n            </Tooltip>\r\n          )}\r\n\r\n          {/* å±•å¼€/æ”¶èµ·æŒ‰é’® */}\r\n          <Tooltip title={expanded ? 'æ”¶èµ·æ—¶é—´çº¿' : 'å±•å¼€æ—¶é—´çº¿'}>\r\n            <IconButton \r\n              variant=\"plain\" \r\n              size=\"small\"\r\n              onClick={() => setExpanded(!expanded)}\r\n            >\r\n              {expanded ? <CollapseIcon /> : <ExpandIcon />}\r\n            </IconButton>\r\n          </Tooltip>\r\n\r\n          {/* æ·»åŠ äº‹ä»¶æŒ‰é’® */}\r\n          {onAddEvent && (\r\n            <Tooltip title=\"æ·»åŠ æ–°äº‹ä»¶\">\r\n              <SecondaryButton size=\"small\" onClick={onAddEvent}>\r\n                <AddIcon />\r\n                {!compact && 'æ·»åŠ äº‹ä»¶'}\r\n              </SecondaryButton>\r\n            </Tooltip>\r\n          )}\r\n        </Flex>\r\n      </Flex>\r\n\r\n      {/* æ—¶é—´çº¿å†…å®¹ */}\r\n      {expanded && (\r\n        <Card padding={space.m}>\r\n          {/* å¿«é€Ÿç­›é€‰æ ‡ç­¾ */}\r\n          {showFilters && (\r\n            <Box marginBottom={space.m}>\r\n              <Text fontSize=\"small\" marginBottom={space.xs} color={colors.licorice600}>\r\n                äº‹ä»¶ç±»å‹ç­›é€‰:\r\n              </Text>\r\n              <Flex gap={space.xs} flexWrap=\"wrap\">\r\n                {Object.entries(eventTypeStats).map(([eventType, count]) => (\r\n                  eventFilter.includes(eventType as EventType) ? (\r\n                    <PrimaryButton\r\n                      key={eventType}\r\n                      size=\"small\"\r\n                      onClick={() => handleEventTypeFilter(eventType as EventType)}\r\n                    >\r\n                      {eventType} ({count})\r\n                    </PrimaryButton>\r\n                  ) : (\r\n                    <SecondaryButton\r\n                      key={eventType}\r\n                      size=\"small\"\r\n                      onClick={() => handleEventTypeFilter(eventType as EventType)}\r\n                    >\r\n                      {eventType} ({count})\r\n                    </SecondaryButton>\r\n                  )\r\n                ))}\r\n              </Flex>\r\n            </Box>\r\n          )}\r\n\r\n          {/* æ—¶é—´çº¿äº‹ä»¶åˆ—è¡¨ */}\r\n          <Box>\r\n            {filteredEvents.length === 0 ? (\r\n              <Text color={colors.licorice500} textAlign=\"center\">\r\n                ğŸ“­ æ²¡æœ‰ç¬¦åˆç­›é€‰æ¡ä»¶çš„äº‹ä»¶\r\n              </Text>\r\n            ) : (\r\n              filteredEvents.map((event, index) => (\r\n                <TimelineEventItem\r\n                  key={event.id}\r\n                  event={event}\r\n                  isFirst={index === 0}\r\n                  isLast={index === filteredEvents.length - 1}\r\n                  compact={compact}\r\n                  showActions={showActions}\r\n                  onEventClick={onEventClick}\r\n                />\r\n              ))\r\n            )}\r\n          </Box>\r\n\r\n          {/* æ˜¾ç¤ºæ›´å¤šæŒ‰é’® */}\r\n          {events.length > filteredEvents.length && (\r\n            <Flex justifyContent=\"center\" marginTop={space.m}>\r\n              <Text fontSize=\"small\" color={colors.licorice500}>\r\n                æ˜¾ç¤º {filteredEvents.length} / {events.length} ä¸ªäº‹ä»¶\r\n              </Text>\r\n            </Flex>\r\n          )}\r\n        </Card>\r\n      )}\r\n\r\n      {/* æ”¶èµ·çŠ¶æ€çš„ç®€è¦ä¿¡æ¯ */}\r\n      {!expanded && latestEvent && (\r\n        <Card padding={space.s}>\r\n          <Flex alignItems=\"center\" gap={space.s}>\r\n            <Text fontSize=\"small\" color={colors.licorice600}>\r\n              æœ€æ–°: {latestEvent.title}\r\n            </Text>\r\n            <Badge variant=\"outline\" size=\"small\">\r\n              {new Date(latestEvent.eventDate).toLocaleDateString('zh-CN')}\r\n            </Badge>\r\n          </Flex>\r\n        </Card>\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default Timeline;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/VersionComparison.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PrimaryButton' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SecondaryButton' is defined but never used.","line":9,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeftIcon' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'field' is defined but never used.","line":64,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":8},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":321,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8806,8809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8806,8809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":322,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":322,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8859,8862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8859,8862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":323,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8910,8913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8910,8913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":323,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8947,8950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8947,8950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * å†å²ç‰ˆæœ¬å¯¹æ¯”ç»„ä»¶\r\n * å¯¹æ¯”å’Œå±•ç¤ºç»„ç»‡æ¶æ„çš„ä¸åŒå†å²ç‰ˆæœ¬\r\n */\r\nimport React, { useState, useMemo, useCallback } from 'react';\r\nimport { Box, Flex } from '@workday/canvas-kit-react/layout';\r\nimport { Text } from '@workday/canvas-kit-react/text';\r\nimport { Card } from '@workday/canvas-kit-react/card';\r\nimport { PrimaryButton, SecondaryButton } from '@workday/canvas-kit-react/button';\r\nimport { Badge } from '../../../shared/components/Badge';\r\nimport { Tooltip } from '@workday/canvas-kit-react/tooltip';\r\nimport { Select } from '@workday/canvas-kit-react/select';\r\nimport { Tabs } from '@workday/canvas-kit-react/tabs';\r\nimport { \r\n  colors, \r\n  space, \r\n  borderRadius,\r\n  fontSizes \r\n} from '@workday/canvas-kit-react/tokens';\r\nimport {\r\n  ArrowLeftIcon,\r\n  ArrowRightIcon,\r\n  CompareIcon,\r\n  HistoryIcon,\r\n  InfoIcon\r\n} from '@workday/canvas-kit-react/icon';\r\nimport { useOrganizationHistory } from '../../shared/hooks/useTemporalQuery';\r\nimport type { \r\n  TemporalOrganizationUnit,\r\n  TemporalQueryParams\r\n} from '../../shared/types/temporal';\r\n\r\nexport interface VersionComparisonProps {\r\n  /** ç»„ç»‡ä»£ç  */\r\n  organizationCode: string;\r\n  /** æŸ¥è¯¢å‚æ•° */\r\n  queryParams?: Partial<TemporalQueryParams>;\r\n  /** é¢„è®¾çš„ç‰ˆæœ¬1 */\r\n  version1?: TemporalOrganizationUnit;\r\n  /** é¢„è®¾çš„ç‰ˆæœ¬2 */\r\n  version2?: TemporalOrganizationUnit;\r\n  /** é»˜è®¤é€‰ä¸­çš„ç‰ˆæœ¬ç´¢å¼• */\r\n  defaultVersions?: [number, number];\r\n  /** æ˜¯å¦ç´§å‡‘æ¨¡å¼ */\r\n  compact?: boolean;\r\n  /** æ˜¯å¦æ˜¾ç¤ºå…ƒæ•°æ® */\r\n  showMetadata?: boolean;\r\n  /** ç‰ˆæœ¬é€‰æ‹©å›è°ƒ */\r\n  onVersionSelect?: (leftVersion: TemporalOrganizationUnit, rightVersion: TemporalOrganizationUnit) => void;\r\n}\r\n\r\n/**\r\n * å­—æ®µå·®å¼‚é¡¹ç»„ä»¶\r\n */\r\ninterface FieldDiffProps {\r\n  field: string;\r\n  fieldLabel: string;\r\n  leftValue: unknown;\r\n  rightValue: unknown;\r\n  compact: boolean;\r\n}\r\n\r\nconst FieldDiff: React.FC<FieldDiffProps> = ({\r\n  field,\r\n  fieldLabel,\r\n  leftValue,\r\n  rightValue,\r\n  compact\r\n}) => {\r\n  const hasChange = leftValue !== rightValue;\r\n  \r\n  const formatValue = (value: unknown) => {\r\n    if (value === null || value === undefined) {\r\n      return <Text color={colors.licorice400} fontStyle=\"italic\">ç©º</Text>;\r\n    }\r\n    if (typeof value === 'boolean') {\r\n      return value ? 'æ˜¯' : 'å¦';\r\n    }\r\n    if (typeof value === 'object') {\r\n      return JSON.stringify(value, null, 2);\r\n    }\r\n    return String(value);\r\n  };\r\n\r\n  const getChangeType = () => {\r\n    if (leftValue === null || leftValue === undefined) {\r\n      return 'added'; // æ–°å¢\r\n    }\r\n    if (rightValue === null || rightValue === undefined) {\r\n      return 'removed'; // åˆ é™¤\r\n    }\r\n    return 'modified'; // ä¿®æ”¹\r\n  };\r\n\r\n  const changeType = hasChange ? getChangeType() : null;\r\n  \r\n  const getChangeStyles = (type: string | null) => {\r\n    switch (type) {\r\n      case 'added':\r\n        return { \r\n          bgColor: colors.greenFresca100, \r\n          borderColor: colors.greenFresca300,\r\n          textColor: colors.greenFresca700\r\n        };\r\n      case 'removed':\r\n        return { \r\n          bgColor: colors.cinnamon100, \r\n          borderColor: colors.cinnamon300,\r\n          textColor: colors.cinnamon700\r\n        };\r\n      case 'modified':\r\n        return { \r\n          bgColor: colors.cantaloupe100, \r\n          borderColor: colors.cantaloupe300,\r\n          textColor: colors.cantaloupe700\r\n        };\r\n      default:\r\n        return { \r\n          bgColor: 'transparent', \r\n          borderColor: colors.soap300,\r\n          textColor: colors.licorice600\r\n        };\r\n    }\r\n  };\r\n\r\n  const changeStyles = getChangeStyles(changeType);\r\n\r\n  return (\r\n    <Box\r\n      padding={compact ? space.s : space.m}\r\n      backgroundColor={changeStyles.bgColor}\r\n      border={`1px solid ${changeStyles.borderColor}`}\r\n      borderRadius={borderRadius.s}\r\n      marginBottom={space.s}\r\n    >\r\n      <Flex alignItems=\"center\" justifyContent=\"space-between\" marginBottom={space.xs}>\r\n        <Text \r\n          fontWeight=\"medium\" \r\n          fontSize={compact ? 'small' : 'medium'}\r\n          color={changeStyles.textColor}\r\n        >\r\n          {fieldLabel}\r\n        </Text>\r\n        {hasChange && (\r\n          <Badge \r\n            color={changeStyles.textColor}\r\n            variant=\"outline\"\r\n            size=\"small\"\r\n          >\r\n            {changeType === 'added' ? 'æ–°å¢' : \r\n             changeType === 'removed' ? 'åˆ é™¤' : 'ä¿®æ”¹'}\r\n          </Badge>\r\n        )}\r\n      </Flex>\r\n\r\n      <Flex gap={space.m}>\r\n        {/* å·¦ä¾§ç‰ˆæœ¬å€¼ */}\r\n        <Box flex=\"1\">\r\n          <Text fontSize=\"small\" color={colors.licorice500} marginBottom={space.xxxs}>\r\n            æ—§ç‰ˆæœ¬\r\n          </Text>\r\n          <Box\r\n            padding={space.s}\r\n            backgroundColor={colors.soap100}\r\n            borderRadius={borderRadius.s}\r\n            fontSize={compact ? fontSizes.small : fontSizes.medium}\r\n          >\r\n            {formatValue(leftValue)}\r\n          </Box>\r\n        </Box>\r\n\r\n        {/* ç®­å¤´æŒ‡ç¤º */}\r\n        {hasChange && (\r\n          <Flex alignItems=\"center\" justifyContent=\"center\" paddingTop={space.l}>\r\n            <ArrowRightIcon size=\"small\" color={changeStyles.textColor} />\r\n          </Flex>\r\n        )}\r\n\r\n        {/* å³ä¾§ç‰ˆæœ¬å€¼ */}\r\n        <Box flex=\"1\">\r\n          <Text fontSize=\"small\" color={colors.licorice500} marginBottom={space.xxxs}>\r\n            æ–°ç‰ˆæœ¬\r\n          </Text>\r\n          <Box\r\n            padding={space.s}\r\n            backgroundColor={hasChange ? colors.soap100 : colors.soap50}\r\n            borderRadius={borderRadius.s}\r\n            fontSize={compact ? fontSizes.small : fontSizes.medium}\r\n          >\r\n            {formatValue(rightValue)}\r\n          </Box>\r\n        </Box>\r\n      </Flex>\r\n    </Box>\r\n  );\r\n};\r\n\r\n/**\r\n * ç‰ˆæœ¬ä¿¡æ¯å¡ç‰‡ç»„ä»¶\r\n */\r\ninterface VersionCardProps {\r\n  version: TemporalOrganizationUnit;\r\n  title: string;\r\n  color: string;\r\n  compact: boolean;\r\n}\r\n\r\nconst VersionCard: React.FC<VersionCardProps> = ({\r\n  version,\r\n  title,\r\n  color,\r\n  compact\r\n}) => {\r\n  const formatDate = (dateStr: string) => {\r\n    try {\r\n      return new Date(dateStr).toLocaleString('zh-CN');\r\n    } catch {\r\n      return dateStr;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card \r\n      padding={compact ? space.s : space.m}\r\n      border={`2px solid ${color}`}\r\n    >\r\n      <Flex alignItems=\"center\" gap={space.s} marginBottom={space.s}>\r\n        <Text fontWeight=\"bold\" color={color}>\r\n          {title}\r\n        </Text>\r\n        {version.version && (\r\n          <Badge color={color} variant=\"outline\">\r\n            v{version.version}\r\n          </Badge>\r\n        )}\r\n      </Flex>\r\n\r\n      <Box marginBottom={space.s}>\r\n        <Text fontWeight=\"medium\" fontSize={compact ? 'small' : 'medium'}>\r\n          {version.name}\r\n        </Text>\r\n        <Text fontSize=\"small\" color={colors.licorice500}>\r\n          {version.code}\r\n        </Text>\r\n      </Box>\r\n\r\n      <Flex gap={space.m} fontSize=\"small\" color={colors.licorice500}>\r\n        {version.effective_from && (\r\n          <Text>\r\n            ç”Ÿæ•ˆ: {formatDate(version.effective_from)}\r\n          </Text>\r\n        )}\r\n        {version.effective_to && (\r\n          <Text>\r\n            å¤±æ•ˆ: {formatDate(version.effective_to)}\r\n          </Text>\r\n        )}\r\n      </Flex>\r\n\r\n      {version.change_reason && !compact && (\r\n        <Box marginTop={space.s}>\r\n          <Text fontSize=\"small\" color={colors.licorice600}>\r\n            å˜æ›´åŸå› : {version.change_reason}\r\n          </Text>\r\n        </Box>\r\n      )}\r\n    </Card>\r\n  );\r\n};\r\n\r\n/**\r\n * å†å²ç‰ˆæœ¬å¯¹æ¯”ç»„ä»¶\r\n */\r\nexport const VersionComparison: React.FC<VersionComparisonProps> = ({\r\n  organizationCode,\r\n  queryParams,\r\n  defaultVersions = [0, 1],\r\n  compact = false,\r\n  onVersionSelect\r\n}) => {\r\n  const [selectedVersions, setSelectedVersions] = useState<[number, number]>(defaultVersions);\r\n  const [activeTab, setActiveTab] = useState('diff');\r\n\r\n  // è·å–å†å²ç‰ˆæœ¬æ•°æ®\r\n  const {\r\n    data: versions = [],\r\n    isLoading,\r\n    isError,\r\n    error,\r\n    hasHistory\r\n  } = useOrganizationHistory(organizationCode, queryParams);\r\n\r\n  // å½“å‰é€‰ä¸­çš„ä¸¤ä¸ªç‰ˆæœ¬\r\n  const [leftVersion, rightVersion] = useMemo(() => {\r\n    if (versions.length < 2) return [null, null];\r\n    return [\r\n      versions[selectedVersions[0]] || null,\r\n      versions[selectedVersions[1]] || null\r\n    ];\r\n  }, [versions, selectedVersions]);\r\n\r\n  // è®¡ç®—å­—æ®µå·®å¼‚\r\n  const fieldDiffs = useMemo(() => {\r\n    if (!leftVersion || !rightVersion) return [];\r\n\r\n    const fieldsToCompare = [\r\n      { key: 'name', label: 'åç§°' },\r\n      { key: 'unit_type', label: 'ç»„ç»‡ç±»å‹' },\r\n      { key: 'status', label: 'çŠ¶æ€' },\r\n      { key: 'level', label: 'å±‚çº§' },\r\n      { key: 'parent_code', label: 'ä¸Šçº§ç»„ç»‡' },\r\n      { key: 'sort_order', label: 'æ’åº' },\r\n      { key: 'description', label: 'æè¿°' },\r\n      { key: 'effective_from', label: 'ç”Ÿæ•ˆæ—¶é—´' },\r\n      { key: 'effective_to', label: 'å¤±æ•ˆæ—¶é—´' },\r\n      { key: 'change_reason', label: 'å˜æ›´åŸå› ' }\r\n    ];\r\n\r\n    return fieldsToCompare.map(field => ({\r\n      ...field,\r\n      leftValue: (leftVersion as any)[field.key],\r\n      rightValue: (rightVersion as any)[field.key],\r\n      hasChange: (leftVersion as any)[field.key] !== (rightVersion as any)[field.key]\r\n    }));\r\n  }, [leftVersion, rightVersion]);\r\n\r\n  // ç»Ÿè®¡å·®å¼‚æ•°é‡\r\n  const diffStats = useMemo(() => {\r\n    const totalFields = fieldDiffs.length;\r\n    const changedFields = fieldDiffs.filter(diff => diff.hasChange).length;\r\n    const unchangedFields = totalFields - changedFields;\r\n\r\n    return { totalFields, changedFields, unchangedFields };\r\n  }, [fieldDiffs]);\r\n\r\n  // å¤„ç†ç‰ˆæœ¬é€‰æ‹©\r\n  const handleVersionChange = useCallback((position: 'left' | 'right', versionIndex: number) => {\r\n    const newVersions: [number, number] = position === 'left' \r\n      ? [versionIndex, selectedVersions[1]]\r\n      : [selectedVersions[0], versionIndex];\r\n\r\n    setSelectedVersions(newVersions);\r\n\r\n    if (versions[newVersions[0]] && versions[newVersions[1]]) {\r\n      onVersionSelect?.(versions[newVersions[0]], versions[newVersions[1]]);\r\n    }\r\n  }, [selectedVersions, versions, onVersionSelect]);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <Card padding={space.m}>\r\n        <Text>ğŸ”„ åŠ è½½ç‰ˆæœ¬å†å²æ•°æ®...</Text>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (isError) {\r\n    return (\r\n      <Card padding={space.m}>\r\n        <Text color={colors.cinnamon600}>\r\n          âŒ åŠ è½½ç‰ˆæœ¬å†å²å¤±è´¥: {error?.message || 'æœªçŸ¥é”™è¯¯'}\r\n        </Text>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (!hasHistory || versions.length < 2) {\r\n    return (\r\n      <Card padding={space.m}>\r\n        <Flex justifyContent=\"center\" alignItems=\"center\" flexDirection=\"column\" gap={space.s}>\r\n          <HistoryIcon size=\"large\" color={colors.licorice400} />\r\n          <Text color={colors.licorice500}>\r\n            {versions.length === 0 ? 'ğŸ“­ æš‚æ— å†å²ç‰ˆæœ¬' : 'ğŸ“„ ä»…æœ‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ— æ³•å¯¹æ¯”'}\r\n          </Text>\r\n        </Flex>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Box>\r\n      {/* ç‰ˆæœ¬é€‰æ‹©å™¨ */}\r\n      <Box marginBottom={space.m}>\r\n        <Flex alignItems=\"center\" gap={space.m} marginBottom={space.s}>\r\n          <Text fontSize=\"large\" fontWeight=\"medium\">\r\n            <CompareIcon /> ç‰ˆæœ¬å¯¹æ¯”\r\n          </Text>\r\n          <Badge color={colors.blueberry600} variant=\"outline\">\r\n            {versions.length} ä¸ªç‰ˆæœ¬\r\n          </Badge>\r\n        </Flex>\r\n\r\n        <Flex gap={space.m} alignItems=\"center\">\r\n          {/* å·¦ä¾§ç‰ˆæœ¬é€‰æ‹© */}\r\n          <Box flex=\"1\">\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>åŸºå‡†ç‰ˆæœ¬ (æ—§)</Text>\r\n            <Select\r\n              value={selectedVersions[0].toString()}\r\n              onChange={(value) => handleVersionChange('left', parseInt(value))}\r\n            >\r\n              {versions.map((version, index) => (\r\n                <MenuItem key={index} value={index.toString()}>\r\n                  v{version.version || index + 1} - {version.name} \r\n                  {version.effective_from && ` (${new Date(version.effective_from).toLocaleDateString()})`}\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n          </Box>\r\n\r\n          <ArrowRightIcon color={colors.licorice400} />\r\n\r\n          {/* å³ä¾§ç‰ˆæœ¬é€‰æ‹© */}\r\n          <Box flex=\"1\">\r\n            <Text fontSize=\"small\" marginBottom={space.xs}>å¯¹æ¯”ç‰ˆæœ¬ (æ–°)</Text>\r\n            <Select\r\n              value={selectedVersions[1].toString()}\r\n              onChange={(value) => handleVersionChange('right', parseInt(value))}\r\n            >\r\n              {versions.map((version, index) => (\r\n                <MenuItem key={index} value={index.toString()}>\r\n                  v{version.version || index + 1} - {version.name}\r\n                  {version.effective_from && ` (${new Date(version.effective_from).toLocaleDateString()})`}\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n          </Box>\r\n        </Flex>\r\n      </Box>\r\n\r\n      {/* å¯¹æ¯”ç»Ÿè®¡ */}\r\n      <Box marginBottom={space.m}>\r\n        <Flex gap={space.s} alignItems=\"center\">\r\n          <Badge color={colors.cantaloupe600} variant=\"solid\">\r\n            {diffStats.changedFields} ä¸ªå·®å¼‚\r\n          </Badge>\r\n          <Badge color={colors.greenFresca600} variant=\"outline\">\r\n            {diffStats.unchangedFields} ä¸ªç›¸åŒ\r\n          </Badge>\r\n          <Tooltip title=\"æ€»å…±å¯¹æ¯”çš„å­—æ®µæ•°é‡\">\r\n            <Badge color={colors.licorice400} variant=\"outline\">\r\n              <InfoIcon size=\"small\" /> {diffStats.totalFields} å­—æ®µ\r\n            </Badge>\r\n          </Tooltip>\r\n        </Flex>\r\n      </Box>\r\n\r\n      {/* å¯¹æ¯”å†…å®¹æ ‡ç­¾é¡µ */}\r\n      <Tabs activeKey={activeTab} onSelectionChange={setActiveTab}>\r\n        <TabsList>\r\n          <Tab value=\"diff\">å­—æ®µå·®å¼‚</Tab>\r\n          <Tab value=\"cards\">ç‰ˆæœ¬å¡ç‰‡</Tab>\r\n          <Tab value=\"raw\">åŸå§‹æ•°æ®</Tab>\r\n        </TabsList>\r\n\r\n        {/* å­—æ®µå·®å¼‚è§†å›¾ */}\r\n        {activeTab === 'diff' && leftVersion && rightVersion && (\r\n          <Box marginTop={space.m}>\r\n            {fieldDiffs.length === 0 ? (\r\n              <Text>æ— å¯å¯¹æ¯”å­—æ®µ</Text>\r\n            ) : (\r\n              <Box>\r\n                {/* ä»…æ˜¾ç¤ºæœ‰å·®å¼‚çš„å­—æ®µ */}\r\n                <Box marginBottom={space.m}>\r\n                  <Text fontSize=\"medium\" fontWeight=\"medium\" marginBottom={space.s}>\r\n                    å˜æ›´å­—æ®µ ({diffStats.changedFields})\r\n                  </Text>\r\n                  {fieldDiffs.filter(diff => diff.hasChange).map(diff => (\r\n                    <FieldDiff\r\n                      key={diff.key}\r\n                      field={diff.key}\r\n                      fieldLabel={diff.label}\r\n                      leftValue={diff.leftValue}\r\n                      rightValue={diff.rightValue}\r\n                      compact={compact}\r\n                    />\r\n                  ))}\r\n                </Box>\r\n\r\n                {/* ç›¸åŒå­—æ®µï¼ˆå¯é€‰æ˜¾ç¤ºï¼‰ */}\r\n                {!compact && (\r\n                  <Box>\r\n                    <Text fontSize=\"medium\" fontWeight=\"medium\" marginBottom={space.s}>\r\n                      ç›¸åŒå­—æ®µ ({diffStats.unchangedFields})\r\n                    </Text>\r\n                    {fieldDiffs.filter(diff => !diff.hasChange).map(diff => (\r\n                      <FieldDiff\r\n                        key={diff.key}\r\n                        field={diff.key}\r\n                        fieldLabel={diff.label}\r\n                        leftValue={diff.leftValue}\r\n                        rightValue={diff.rightValue}\r\n                        compact={compact}\r\n                      />\r\n                    ))}\r\n                  </Box>\r\n                )}\r\n              </Box>\r\n            )}\r\n          </Box>\r\n        )}\r\n\r\n        {/* ç‰ˆæœ¬å¡ç‰‡è§†å›¾ */}\r\n        {activeTab === 'cards' && leftVersion && rightVersion && (\r\n          <Box marginTop={space.m}>\r\n            <Flex gap={space.m}>\r\n              <Box flex=\"1\">\r\n                <VersionCard\r\n                  version={leftVersion}\r\n                  title=\"åŸºå‡†ç‰ˆæœ¬\"\r\n                  color={colors.blueberry600}\r\n                  compact={compact}\r\n                />\r\n              </Box>\r\n              <Box flex=\"1\">\r\n                <VersionCard\r\n                  version={rightVersion}\r\n                  title=\"å¯¹æ¯”ç‰ˆæœ¬\"\r\n                  color={colors.peach600}\r\n                  compact={compact}\r\n                />\r\n              </Box>\r\n            </Flex>\r\n          </Box>\r\n        )}\r\n\r\n        {/* åŸå§‹æ•°æ®è§†å›¾ */}\r\n        {activeTab === 'raw' && leftVersion && rightVersion && (\r\n          <Box marginTop={space.m}>\r\n            <Flex gap={space.m}>\r\n              <Box flex=\"1\">\r\n                <Text fontSize=\"small\" fontWeight=\"medium\" marginBottom={space.s}>\r\n                  åŸºå‡†ç‰ˆæœ¬ JSON\r\n                </Text>\r\n                <Box\r\n                  as=\"pre\"\r\n                  padding={space.s}\r\n                  backgroundColor={colors.soap100}\r\n                  borderRadius={borderRadius.s}\r\n                  fontSize=\"small\"\r\n                  overflow=\"auto\"\r\n                  maxHeight=\"400px\"\r\n                >\r\n                  {JSON.stringify(leftVersion, null, 2)}\r\n                </Box>\r\n              </Box>\r\n              <Box flex=\"1\">\r\n                <Text fontSize=\"small\" fontWeight=\"medium\" marginBottom={space.s}>\r\n                  å¯¹æ¯”ç‰ˆæœ¬ JSON\r\n                </Text>\r\n                <Box\r\n                  as=\"pre\"\r\n                  padding={space.s}\r\n                  backgroundColor={colors.soap100}\r\n                  borderRadius={borderRadius.s}\r\n                  fontSize=\"small\"\r\n                  overflow=\"auto\"\r\n                  maxHeight=\"400px\"\r\n                >\r\n                  {JSON.stringify(rightVersion, null, 2)}\r\n                </Box>\r\n              </Box>\r\n            </Flex>\r\n          </Box>\r\n        )}\r\n      </Tabs>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default VersionComparison;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/__tests__/TemporalNavbar.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'mockUseTemporalStore' is assigned a value but never used.","line":14,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":27},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":65,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":65,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":66,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":66,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":73,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":73,"endColumn":52},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":76,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":76,"endColumn":52},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":99,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":99,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":126,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":126,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":148,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":148,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":159,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":159,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":174,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":174,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":189,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":189,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":200,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":200,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":216,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":216,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":232,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":232,"endColumn":54}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€å¯¼èˆªæ ç»„ä»¶å•å…ƒæµ‹è¯•\r\n */\r\nimport React from 'react';\r\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport { TemporalNavbar } from '../TemporalNavbar';\r\nimport { useTemporalStore } from '../../../shared/stores/temporalStore';\r\n\r\n// æ¨¡æ‹Ÿé’©å­\r\njest.mock('../../../shared/hooks/useTemporalQuery');\r\njest.mock('../../../shared/stores/temporalStore');\r\n\r\nconst mockUseTemporalStore = useTemporalStore as jest.MockedFunction<typeof useTemporalStore>;\r\n\r\n// åˆ›å»ºæµ‹è¯•åŒ…è£…å™¨\r\nconst createWrapper = () => {\r\n  const queryClient = new QueryClient({\r\n    defaultOptions: {\r\n      queries: { retry: false },\r\n    },\r\n  });\r\n\r\n  return ({ children }: { children: React.ReactNode }) => (\r\n    <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n  );\r\n};\r\n\r\n// æ¨¡æ‹Ÿé»˜è®¤çŠ¶æ€\r\nconst mockDefaultState = {\r\n  mode: 'current' as const,\r\n  switchToCurrent: jest.fn(),\r\n  switchToHistorical: jest.fn(),\r\n  switchToPlanning: jest.fn(),\r\n  isCurrent: true,\r\n  isHistorical: false,\r\n  isPlanning: false,\r\n  loading: {\r\n    organizations: false,\r\n    timeline: false,\r\n    history: false\r\n  },\r\n  error: null,\r\n  context: {\r\n    mode: 'current' as const,\r\n    asOfDate: '2024-08-10T00:00:00.000Z',\r\n    effectiveDate: '2024-08-10T00:00:00.000Z',\r\n    timezone: 'UTC',\r\n    version: 1\r\n  },\r\n  cacheStats: {\r\n    organizationsCount: 0,\r\n    timelinesCount: 0,\r\n    totalCacheSize: 0\r\n  },\r\n  refreshCache: jest.fn(),\r\n  setError: jest.fn()\r\n};\r\n\r\ndescribe('TemporalNavbar', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    \r\n    // æ¨¡æ‹Ÿé’©å­è¿”å›å€¼\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalMode.mockReturnValue(mockDefaultState);\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalQueryState.mockReturnValue({\r\n      loading: mockDefaultState.loading,\r\n      error: mockDefaultState.error,\r\n      context: mockDefaultState.context,\r\n      cacheStats: mockDefaultState.cacheStats,\r\n      refreshCache: mockDefaultState.refreshCache\r\n    });\r\n    require('../../../shared/stores/temporalStore').useTemporalActions.mockReturnValue({\r\n      setError: mockDefaultState.setError\r\n    });\r\n    require('../../../shared/stores/temporalStore').temporalSelectors.useQueryParams.mockReturnValue({\r\n      mode: 'current',\r\n      asOfDate: '2024-08-10T00:00:00.000Z'\r\n    });\r\n  });\r\n\r\n  it('should render temporal navbar with mode buttons', () => {\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('å½“å‰')).toBeInTheDocument();\r\n    expect(screen.getByText('å†å²')).toBeInTheDocument();\r\n    expect(screen.getByText('è§„åˆ’')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should show current mode as active', () => {\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    const currentButton = screen.getByRole('button', { name: /å½“å‰/ });\r\n    expect(currentButton).toHaveAttribute('aria-pressed', 'true');\r\n  });\r\n\r\n  it('should call switchToCurrent when current button is clicked', async () => {\r\n    const mockSwitchToCurrent = jest.fn();\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalMode.mockReturnValue({\r\n      ...mockDefaultState,\r\n      switchToCurrent: mockSwitchToCurrent\r\n    });\r\n\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    fireEvent.click(screen.getByText('å½“å‰'));\r\n\r\n    await waitFor(() => {\r\n      expect(mockSwitchToCurrent).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  it('should show date picker when historical button is clicked', async () => {\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    fireEvent.click(screen.getByText('å†å²'));\r\n\r\n    // åº”è¯¥æ˜¾ç¤ºæ—¥æœŸé€‰æ‹©å™¨å¼¹çª—\r\n    await waitFor(() => {\r\n      expect(screen.getByText('é€‰æ‹©å†å²æŸ¥çœ‹æ—¶ç‚¹')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('should call switchToPlanning when planning button is clicked', async () => {\r\n    const mockSwitchToPlanning = jest.fn();\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalMode.mockReturnValue({\r\n      ...mockDefaultState,\r\n      switchToPlanning: mockSwitchToPlanning\r\n    });\r\n\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    fireEvent.click(screen.getByText('è§„åˆ’'));\r\n\r\n    await waitFor(() => {\r\n      expect(mockSwitchToPlanning).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  it('should display current mode badge and description', () => {\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('å½“å‰è§†å›¾')).toBeInTheDocument();\r\n    expect(screen.getByText('æ˜¾ç¤ºå½“å‰æœ‰æ•ˆçš„ç»„ç»‡æ¶æ„')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display historical mode when in historical mode', () => {\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalMode.mockReturnValue({\r\n      ...mockDefaultState,\r\n      mode: 'historical',\r\n      isCurrent: false,\r\n      isHistorical: true,\r\n      context: {\r\n        ...mockDefaultState.context,\r\n        mode: 'historical',\r\n        asOfDate: '2024-06-01T00:00:00.000Z'\r\n      }\r\n    });\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalQueryState.mockReturnValue({\r\n      ...mockDefaultState,\r\n      context: {\r\n        ...mockDefaultState.context,\r\n        mode: 'historical',\r\n        asOfDate: '2024-06-01T00:00:00.000Z'\r\n      }\r\n    });\r\n\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('å†å²è§†å›¾')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should show loading indicator when loading', () => {\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalQueryState.mockReturnValue({\r\n      ...mockDefaultState,\r\n      loading: {\r\n        organizations: true,\r\n        timeline: false,\r\n        history: false\r\n      }\r\n    });\r\n\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('ğŸ”„ åŠ è½½ç»„ç»‡æ•°æ®...')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should show error message when there is an error', () => {\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalQueryState.mockReturnValue({\r\n      ...mockDefaultState,\r\n      error: 'Test error message'\r\n    });\r\n\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('âš ï¸ Test error message')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should show cache stats when cache has data', () => {\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalQueryState.mockReturnValue({\r\n      ...mockDefaultState,\r\n      cacheStats: {\r\n        organizationsCount: 5,\r\n        timelinesCount: 3,\r\n        totalCacheSize: 8\r\n      }\r\n    });\r\n\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('8')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call refreshCache when refresh button is clicked', async () => {\r\n    const mockRefreshCache = jest.fn();\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalQueryState.mockReturnValue({\r\n      ...mockDefaultState,\r\n      refreshCache: mockRefreshCache\r\n    });\r\n\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    const refreshButton = screen.getByRole('button', { name: /åˆ·æ–°æ•°æ®ç¼“å­˜/ });\r\n    fireEvent.click(refreshButton);\r\n\r\n    await waitFor(() => {\r\n      expect(mockRefreshCache).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  it('should disable buttons when loading', () => {\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalQueryState.mockReturnValue({\r\n      ...mockDefaultState,\r\n      loading: {\r\n        organizations: true,\r\n        timeline: false,\r\n        history: false\r\n      }\r\n    });\r\n\r\n    render(<TemporalNavbar />, { wrapper: createWrapper() });\r\n\r\n    const currentButton = screen.getByText('å½“å‰');\r\n    const historicalButton = screen.getByText('å†å²');\r\n    const planningButton = screen.getByText('è§„åˆ’');\r\n\r\n    expect(currentButton).toBeDisabled();\r\n    expect(historicalButton).toBeDisabled();\r\n    expect(planningButton).toBeDisabled();\r\n  });\r\n\r\n  it('should render in compact mode', () => {\r\n    render(<TemporalNavbar compact={true} />, { wrapper: createWrapper() });\r\n\r\n    // åœ¨ç´§å‡‘æ¨¡å¼ä¸‹ï¼Œä¸åº”è¯¥æ˜¾ç¤ºè¯¦ç»†æè¿°\r\n    expect(screen.queryByText('æ˜¾ç¤ºå½“å‰æœ‰æ•ˆçš„ç»„ç»‡æ¶æ„')).not.toBeInTheDocument();\r\n  });\r\n\r\n  it('should hide advanced settings when showAdvancedSettings is false', () => {\r\n    render(<TemporalNavbar showAdvancedSettings={false} />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.queryByRole('button', { name: /æ—¶æ€æŸ¥è¯¢è®¾ç½®/ })).not.toBeInTheDocument();\r\n  });\r\n\r\n  it('should call onModeChange when mode changes', async () => {\r\n    const mockOnModeChange = jest.fn();\r\n    \r\n    render(<TemporalNavbar onModeChange={mockOnModeChange} />, { wrapper: createWrapper() });\r\n\r\n    fireEvent.click(screen.getByText('è§„åˆ’'));\r\n\r\n    await waitFor(() => {\r\n      expect(mockOnModeChange).toHaveBeenCalledWith('planning');\r\n    });\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/__tests__/TemporalTable.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":59,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":59,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":70,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":70,"endColumn":52},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":198,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":198,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":212,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":212,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":226,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":226,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":254,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":254,"endColumn":52},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":261,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":261,"endColumn":54},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":279,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":279,"endColumn":52},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":286,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":286,"endColumn":54}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€è¡¨æ ¼ç»„ä»¶å•å…ƒæµ‹è¯•\r\n */\r\nimport React from 'react';\r\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport { TemporalTable } from '../TemporalTable';\r\nimport type { OrganizationUnit } from '../../../shared/types/organization';\r\n\r\n// æ¨¡æ‹Ÿé’©å­\r\njest.mock('../../../shared/hooks/useTemporalQuery');\r\njest.mock('../../../shared/stores/temporalStore');\r\n\r\n// æ¨¡æ‹Ÿæ•°æ®\r\nconst mockOrganizations: OrganizationUnit[] = [\r\n  {\r\n    code: '1000001',\r\n    name: 'æµ‹è¯•éƒ¨é—¨1',\r\n    unit_type: 'DEPARTMENT',\r\n    status: 'ACTIVE',\r\n    level: 1,\r\n    path: '/1000001',\r\n    sort_order: 1,\r\n    created_at: '2024-01-01T00:00:00Z',\r\n    updated_at: '2024-06-01T00:00:00Z'\r\n  },\r\n  {\r\n    code: '1000002',\r\n    name: 'æµ‹è¯•éƒ¨é—¨2',\r\n    unit_type: 'DEPARTMENT',\r\n    status: 'INACTIVE',\r\n    level: 2,\r\n    path: '/1000001/1000002',\r\n    sort_order: 2,\r\n    parent_code: '1000001',\r\n    created_at: '2024-02-01T00:00:00Z',\r\n    updated_at: '2024-07-01T00:00:00Z'\r\n  }\r\n];\r\n\r\n// åˆ›å»ºæµ‹è¯•åŒ…è£…å™¨\r\nconst createWrapper = () => {\r\n  const queryClient = new QueryClient({\r\n    defaultOptions: {\r\n      queries: { retry: false },\r\n    },\r\n  });\r\n\r\n  return ({ children }: { children: React.ReactNode }) => (\r\n    <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n  );\r\n};\r\n\r\ndescribe('TemporalTable', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    \r\n    // æ¨¡æ‹Ÿé’©å­è¿”å›å€¼\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalOrganizations.mockReturnValue({\r\n      data: mockOrganizations,\r\n      isLoading: false,\r\n      isError: false,\r\n      error: null,\r\n      temporalContext: {\r\n        mode: 'current',\r\n        asOfDate: '2024-08-10T00:00:00.000Z'\r\n      }\r\n    });\r\n\r\n    require('../../../shared/stores/temporalStore').temporalSelectors = {\r\n      useContext: jest.fn().mockReturnValue({\r\n        mode: 'current',\r\n        asOfDate: '2024-08-10T00:00:00.000Z'\r\n      })\r\n    };\r\n  });\r\n\r\n  it('should render table with organization data', () => {\r\n    render(<TemporalTable />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('ç»„ç»‡æ¶æ„ (2)')).toBeInTheDocument();\r\n    expect(screen.getByText('æµ‹è¯•éƒ¨é—¨1')).toBeInTheDocument();\r\n    expect(screen.getByText('æµ‹è¯•éƒ¨é—¨2')).toBeInTheDocument();\r\n    expect(screen.getByText('1000001')).toBeInTheDocument();\r\n    expect(screen.getByText('1000002')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display table headers correctly', () => {\r\n    render(<TemporalTable />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('ç»„ç»‡ä»£ç ')).toBeInTheDocument();\r\n    expect(screen.getByText('ç»„ç»‡åç§°')).toBeInTheDocument();\r\n    expect(screen.getByText('ç±»å‹')).toBeInTheDocument();\r\n    expect(screen.getByText('çŠ¶æ€')).toBeInTheDocument();\r\n    expect(screen.getByText('å±‚çº§')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should show temporal indicators when enabled', () => {\r\n    render(<TemporalTable showTemporalIndicators={true} />, { wrapper: createWrapper() });\r\n\r\n    // åº”è¯¥æœ‰æ—¶æ€çŠ¶æ€æŒ‡ç¤ºå™¨åˆ—\r\n    const indicators = screen.getAllByRole('columnheader');\r\n    expect(indicators.some(indicator => indicator.textContent?.includes('æ—¶æ€çŠ¶æ€'))).toBeTruthy();\r\n  });\r\n\r\n  it('should show selection column when enabled', () => {\r\n    render(<TemporalTable showSelection={true} />, { wrapper: createWrapper() });\r\n\r\n    // åº”è¯¥æœ‰é€‰æ‹©æ¡†åˆ—\r\n    const checkboxes = screen.getAllByRole('checkbox');\r\n    expect(checkboxes.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('should show action buttons when enabled', () => {\r\n    render(<TemporalTable showActions={true} />, { wrapper: createWrapper() });\r\n\r\n    // åº”è¯¥æ˜¾ç¤ºæ“ä½œåˆ—\r\n    expect(screen.getByText('æ“ä½œ')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call onRowClick when row is clicked', async () => {\r\n    const mockOnRowClick = jest.fn();\r\n    render(<TemporalTable onRowClick={mockOnRowClick} />, { wrapper: createWrapper() });\r\n\r\n    const firstRow = screen.getByText('æµ‹è¯•éƒ¨é—¨1').closest('tr');\r\n    if (firstRow) {\r\n      fireEvent.click(firstRow);\r\n    }\r\n\r\n    await waitFor(() => {\r\n      expect(mockOnRowClick).toHaveBeenCalledWith(mockOrganizations[0]);\r\n    });\r\n  });\r\n\r\n  it('should call onEdit when edit button is clicked', async () => {\r\n    const mockOnEdit = jest.fn();\r\n    render(\r\n      <TemporalTable showActions={true} onEdit={mockOnEdit} />, \r\n      { wrapper: createWrapper() }\r\n    );\r\n\r\n    const editButtons = screen.getAllByRole('button', { name: /ç¼–è¾‘ç»„ç»‡/ });\r\n    fireEvent.click(editButtons[0]);\r\n\r\n    await waitFor(() => {\r\n      expect(mockOnEdit).toHaveBeenCalledWith(mockOrganizations[0]);\r\n    });\r\n  });\r\n\r\n  it('should call onViewHistory when history button is clicked', async () => {\r\n    const mockOnViewHistory = jest.fn();\r\n    render(\r\n      <TemporalTable showActions={true} onViewHistory={mockOnViewHistory} />, \r\n      { wrapper: createWrapper() }\r\n    );\r\n\r\n    const historyButtons = screen.getAllByRole('button', { name: /æŸ¥çœ‹å†å²ç‰ˆæœ¬/ });\r\n    fireEvent.click(historyButtons[0]);\r\n\r\n    await waitFor(() => {\r\n      expect(mockOnViewHistory).toHaveBeenCalledWith(mockOrganizations[0]);\r\n    });\r\n  });\r\n\r\n  it('should handle selection changes correctly', async () => {\r\n    const mockOnSelectionChange = jest.fn();\r\n    render(\r\n      <TemporalTable showSelection={true} onSelectionChange={mockOnSelectionChange} />, \r\n      { wrapper: createWrapper() }\r\n    );\r\n\r\n    const checkboxes = screen.getAllByRole('checkbox');\r\n    // ç‚¹å‡»ç¬¬ä¸€ä¸ªæ•°æ®è¡Œçš„å¤é€‰æ¡†ï¼ˆè·³è¿‡è¡¨å¤´çš„å…¨é€‰å¤é€‰æ¡†ï¼‰\r\n    fireEvent.click(checkboxes[1]);\r\n\r\n    await waitFor(() => {\r\n      expect(mockOnSelectionChange).toHaveBeenCalledWith([mockOrganizations[0]]);\r\n    });\r\n  });\r\n\r\n  it('should handle select all functionality', async () => {\r\n    const mockOnSelectionChange = jest.fn();\r\n    render(\r\n      <TemporalTable showSelection={true} onSelectionChange={mockOnSelectionChange} />, \r\n      { wrapper: createWrapper() }\r\n    );\r\n\r\n    const checkboxes = screen.getAllByRole('checkbox');\r\n    // ç‚¹å‡»è¡¨å¤´çš„å…¨é€‰å¤é€‰æ¡†\r\n    fireEvent.click(checkboxes[0]);\r\n\r\n    await waitFor(() => {\r\n      expect(mockOnSelectionChange).toHaveBeenCalledWith(mockOrganizations);\r\n    });\r\n  });\r\n\r\n  it('should show loading state', () => {\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalOrganizations.mockReturnValue({\r\n      data: [],\r\n      isLoading: true,\r\n      isError: false,\r\n      error: null,\r\n      temporalContext: { mode: 'current' }\r\n    });\r\n\r\n    render(<TemporalTable />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('ğŸ”„ åŠ è½½ç»„ç»‡æ•°æ®...')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should show error state', () => {\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalOrganizations.mockReturnValue({\r\n      data: [],\r\n      isLoading: false,\r\n      isError: true,\r\n      error: { message: 'Test error' },\r\n      temporalContext: { mode: 'current' }\r\n    });\r\n\r\n    render(<TemporalTable />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText(/âŒ åŠ è½½æ•°æ®å¤±è´¥: Test error/)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should show empty state when no data', () => {\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalOrganizations.mockReturnValue({\r\n      data: [],\r\n      isLoading: false,\r\n      isError: false,\r\n      error: null,\r\n      temporalContext: { mode: 'current' }\r\n    });\r\n\r\n    render(<TemporalTable />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('ğŸ“­ æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç»„ç»‡æ•°æ®')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display status badges correctly', () => {\r\n    render(<TemporalTable />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('å¯ç”¨')).toBeInTheDocument();\r\n    expect(screen.getByText('åœç”¨')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display organization types correctly', () => {\r\n    render(<TemporalTable />, { wrapper: createWrapper() });\r\n\r\n    const departmentElements = screen.getAllByText('éƒ¨é—¨');\r\n    expect(departmentElements).toHaveLength(2);\r\n  });\r\n\r\n  it('should disable edit and delete buttons in historical mode', () => {\r\n    require('../../../shared/stores/temporalStore').temporalSelectors = {\r\n      useContext: jest.fn().mockReturnValue({\r\n        mode: 'historical',\r\n        asOfDate: '2024-06-01T00:00:00.000Z'\r\n      })\r\n    };\r\n\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalOrganizations.mockReturnValue({\r\n      data: mockOrganizations,\r\n      isLoading: false,\r\n      isError: false,\r\n      error: null,\r\n      temporalContext: {\r\n        mode: 'historical',\r\n        asOfDate: '2024-06-01T00:00:00.000Z'\r\n      }\r\n    });\r\n\r\n    render(<TemporalTable showActions={true} />, { wrapper: createWrapper() });\r\n\r\n    const editButtons = screen.getAllByRole('button', { name: /å†å²æ¨¡å¼ä¸‹ä¸å¯ç¼–è¾‘/ });\r\n    expect(editButtons[0]).toBeDisabled();\r\n  });\r\n\r\n  it('should show temporal fields in historical mode', () => {\r\n    require('../../../shared/stores/temporalStore').temporalSelectors = {\r\n      useContext: jest.fn().mockReturnValue({\r\n        mode: 'historical',\r\n        asOfDate: '2024-06-01T00:00:00.000Z'\r\n      })\r\n    };\r\n\r\n    require('../../../shared/hooks/useTemporalQuery').useTemporalOrganizations.mockReturnValue({\r\n      data: mockOrganizations,\r\n      isLoading: false,\r\n      isError: false,\r\n      error: null,\r\n      temporalContext: {\r\n        mode: 'historical',\r\n        asOfDate: '2024-06-01T00:00:00.000Z'\r\n      }\r\n    });\r\n\r\n    render(<TemporalTable />, { wrapper: createWrapper() });\r\n\r\n    expect(screen.getByText('ç”Ÿæ•ˆæ—¶é—´')).toBeInTheDocument();\r\n    expect(screen.getByText('å¤±æ•ˆæ—¶é—´')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render in compact mode', () => {\r\n    render(<TemporalTable compact={true} />, { wrapper: createWrapper() });\r\n\r\n    // åœ¨ç´§å‡‘æ¨¡å¼ä¸‹ï¼Œæ›´æ–°æ—¶é—´åˆ—åº”è¯¥è¢«éšè—\r\n    expect(screen.queryByText('æ›´æ–°æ—¶é—´')).not.toBeInTheDocument();\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/hooks/useTemporalAPI.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'queryClient' is assigned a value but never used.","line":42,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMutation, useQueryClient } from '@tanstack/react-query';\r\n// import { organizationsApi } from '../../shared/api/organizations-simplified';\r\nimport type { PlannedOrganizationData } from '../components/PlannedOrganizationForm';\r\n\r\n/**\r\n * åˆ›å»ºè®¡åˆ’ç»„ç»‡çš„é’©å­\r\n */\r\nexport const useCreatePlannedOrganization = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (data: PlannedOrganizationData) => {\r\n      // è°ƒç”¨è®¡åˆ’ç»„ç»‡ä¸“ç”¨APIç«¯ç‚¹\r\n      const response = await fetch('http://localhost:9090/api/v1/organization-units/planned', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(data),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || errorData.message || 'åˆ›å»ºè®¡åˆ’ç»„ç»‡å¤±è´¥');\r\n      }\r\n\r\n      return response.json();\r\n    },\r\n\r\n    onSuccess: () => {\r\n      // æˆåŠŸååˆ·æ–°ç»„ç»‡åˆ—è¡¨\r\n      queryClient.invalidateQueries({ queryKey: ['organizations'] });\r\n      queryClient.invalidateQueries({ queryKey: ['organizationStats'] });\r\n    },\r\n  });\r\n};\r\n\r\n/**\r\n * æ—¶æ€æŸ¥è¯¢é’©å­\r\n */\r\nexport const useTemporalQuery = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return {\r\n    // æŒ‰æ—¶é—´ç‚¹æŸ¥è¯¢ç»„ç»‡\r\n    queryByPointInTime: async (pointInTime: string) => {\r\n      const response = await fetch(`http://localhost:8090/graphql`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: `\r\n            query($pointInTime: String!) {\r\n              organizations(pointInTime: $pointInTime) {\r\n                code name status effective_date end_date\r\n              }\r\n            }\r\n          `,\r\n          variables: { pointInTime }\r\n        })\r\n      });\r\n      return response.json();\r\n    },\r\n\r\n    // æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢\r\n    queryByDateRange: async (effectiveDateFrom?: string, effectiveDateTo?: string) => {\r\n      const response = await fetch(`http://localhost:8090/graphql`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: `\r\n            query($effectiveDateFrom: String, $effectiveDateTo: String) {\r\n              organizations(effectiveDateFrom: $effectiveDateFrom, effectiveDateTo: $effectiveDateTo) {\r\n                code name status effective_date end_date\r\n              }\r\n            }\r\n          `,\r\n          variables: { effectiveDateFrom, effectiveDateTo }\r\n        })\r\n      });\r\n      return response.json();\r\n    },\r\n\r\n    // æŒ‰æ—¶æ€çŠ¶æ€æŸ¥è¯¢\r\n    queryByTemporalStatus: async (temporalStatus: string) => {\r\n      const response = await fetch(`http://localhost:8090/graphql`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: `\r\n            query($status: String!) {\r\n              organizations(status: $status) {\r\n                code name status effective_date end_date\r\n              }\r\n            }\r\n          `,\r\n          variables: { status: temporalStatus }\r\n        })\r\n      });\r\n      return response.json();\r\n    },\r\n\r\n    // ä»…æŸ¥è¯¢æ—¶æ€ç»„ç»‡\r\n    queryTemporalOnly: async () => {\r\n      const response = await fetch(`http://localhost:8090/graphql`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: `\r\n            query {\r\n              organizations(temporalOnly: true) {\r\n                code name status effective_date end_date is_temporal\r\n              }\r\n            }\r\n          `\r\n        })\r\n      });\r\n      return response.json();\r\n    },\r\n  };\r\n};\r\n\r\n/**\r\n * æ›´æ–°ç»„ç»‡æ—¶æ€ä¿¡æ¯çš„é’©å­\r\n */\r\nexport const useUpdateTemporalInfo = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ code, ...data }: { code: string } & Partial<PlannedOrganizationData>) => {\r\n      const response = await fetch(`http://localhost:9090/api/v1/organization-units/${code}`, {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(data),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || errorData.message || 'æ›´æ–°æ—¶æ€ä¿¡æ¯å¤±è´¥');\r\n      }\r\n\r\n      return response.json();\r\n    },\r\n\r\n    onSuccess: () => {\r\n      // æˆåŠŸååˆ·æ–°ç›¸å…³æŸ¥è¯¢\r\n      queryClient.invalidateQueries({ queryKey: ['organizations'] });\r\n      queryClient.invalidateQueries({ queryKey: ['organizationStats'] });\r\n    },\r\n  });\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/features/temporal/index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1549,1552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1549,1552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1679,1682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1679,1682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2206,2209],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2206,2209],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€åŠŸèƒ½æ¨¡å—å…¥å£æ–‡ä»¶\r\n */\r\n\r\n// ä¸»è¦ç»„ä»¶\r\nexport { default as TemporalDashboard } from './TemporalDashboard';\r\nexport type { TemporalDashboardProps } from './TemporalDashboard';\r\n\r\n// æ—¶æ€ç®¡ç†ç»„ä»¶\r\nexport { TemporalDatePicker, validateTemporalDate } from './components/TemporalDatePicker';\r\nexport { \r\n  TemporalStatusSelector, \r\n  temporalStatusUtils,\r\n  TEMPORAL_STATUS_OPTIONS \r\n} from './components/TemporalStatusSelector';\r\nexport type { TemporalStatus } from './components/TemporalStatusSelector';\r\nexport { PlannedOrganizationForm } from './components/PlannedOrganizationForm';\r\nexport { \r\n  TemporalInfoDisplay, \r\n  TemporalStatusBadge,\r\n  TemporalDateRange \r\n} from './components/TemporalInfoDisplay';\r\n\r\n// æ—¶æ€ç®¡ç†ç›¸å…³ç±»å‹\r\nexport type { PlannedOrganizationData } from './components/PlannedOrganizationForm';\r\nexport type { TemporalInfo } from './components/TemporalInfoDisplay';\r\n\r\n// å­ç»„ä»¶ï¼ˆåŸæœ‰ï¼‰\r\nexport * from './components';\r\n\r\n// å·¥å…·å‡½æ•°å’Œå¸¸é‡\r\nexport const TEMPORAL_CONSTANTS = {\r\n  CACHE_DURATION: 5 * 60 * 1000, // 5åˆ†é’Ÿ\r\n  MAX_HISTORY_VERSIONS: 50,\r\n  MAX_TIMELINE_EVENTS: 100,\r\n  DEFAULT_PAGE_SIZE: 20\r\n} as const;\r\n\r\n// å·¥å…·å‡½æ•°\r\nexport const temporalUtils = {\r\n  formatTemporalDate: (dateStr: string, options?: Intl.DateTimeFormatOptions) => {\r\n    try {\r\n      return new Date(dateStr).toLocaleString('zh-CN', {\r\n        year: 'numeric',\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        ...options\r\n      });\r\n    } catch {\r\n      return dateStr;\r\n    }\r\n  },\r\n\r\n  isTemporalOrganization: (org: any): boolean => {\r\n    return !!(org.effective_from || org.effective_to || org.is_temporal);\r\n  },\r\n\r\n  getTemporalStatus: (org: any, asOfDate?: string) => {\r\n    const now = asOfDate ? new Date(asOfDate) : new Date();\r\n    const effectiveFrom = org.effective_from ? new Date(org.effective_from) : null;\r\n    const effectiveTo = org.effective_to ? new Date(org.effective_to) : null;\r\n\r\n    if (effectiveFrom && now < effectiveFrom) {\r\n      return 'future'; // æœªæ¥ç”Ÿæ•ˆ\r\n    }\r\n    if (effectiveTo && now > effectiveTo) {\r\n      return 'expired'; // å·²å¤±æ•ˆ\r\n    }\r\n    return 'active'; // å½“å‰æœ‰æ•ˆ\r\n  },\r\n\r\n  buildTemporalQueryKey: (organizationCode: string, params: any) => {\r\n    return `temporal:${organizationCode}:${JSON.stringify(params)}`;\r\n  }\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/layout/AppShell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/layout/Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/layout/Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/layout/TopBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/setupTests.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[243,246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[243,246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'marginBottom' is assigned a value but never used.","line":8,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'paddingY' is assigned a value but never used.","line":8,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'borderBottom' is assigned a value but never used.","line":8,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'borderColor' is assigned a value but never used.","line":8,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'paddingTop' is assigned a value but never used.","line":8,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[562,565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[562,565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'marginRight' is assigned a value but never used.","line":15,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[779,782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[779,782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'marginRight' is assigned a value but never used.","line":19,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[997,1000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[997,1000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'marginRight' is assigned a value but never used.","line":23,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1256,1259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1256,1259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1362,1365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1362,1365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1546,1549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1546,1549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1664,1667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1664,1667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1773,1776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1773,1776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1968,1971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1968,1971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2086,2089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2086,2089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2195,2198],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2195,2198],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2303,2306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2303,2306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2410,2413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2410,2413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2518,2521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2518,2521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2702,2705],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2702,2705],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2877,2880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2877,2880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3070,3073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3070,3073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":26,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { vi } from 'vitest';\r\nimport '@testing-library/jest-dom';\r\n\r\n// Mock Canvas Kit components to avoid CSS issues in tests\r\nvi.mock('@workday/canvas-kit-react/layout', () => ({\r\n  Box: ({ children, ...props }: any) => {\r\n    const { marginBottom, paddingY, borderBottom, borderColor, paddingTop, ...cleanProps } = props;\r\n    return React.createElement('div', { 'data-testid': 'canvas-box', ...cleanProps }, children);\r\n  }\r\n}));\r\n\r\nvi.mock('@workday/canvas-kit-react/button', () => ({\r\n  PrimaryButton: ({ children, ...props }: any) => {\r\n    const { marginRight, ...cleanProps } = props;\r\n    return React.createElement('button', { 'data-testid': 'primary-button', ...cleanProps }, children);\r\n  },\r\n  SecondaryButton: ({ children, ...props }: any) => {\r\n    const { marginRight, ...cleanProps } = props;\r\n    return React.createElement('button', { 'data-testid': 'secondary-button', ...cleanProps }, children);\r\n  },\r\n  TertiaryButton: ({ children, ...props }: any) => {\r\n    const { marginRight, ...cleanProps } = props;\r\n    return React.createElement('button', { 'data-testid': 'tertiary-button', ...cleanProps }, children);\r\n  }\r\n}));\r\n\r\nvi.mock('@workday/canvas-kit-react/text', () => ({\r\n  Heading: ({ children }: any) => React.createElement('h1', { 'data-testid': 'canvas-heading' }, children),\r\n  Text: ({ children }: any) => React.createElement('span', { 'data-testid': 'canvas-text' }, children)\r\n}));\r\n\r\nvi.mock('@workday/canvas-kit-react/card', () => ({\r\n  Card: Object.assign(\r\n    ({ children }: any) => React.createElement('div', { 'data-testid': 'canvas-card' }, children),\r\n    {\r\n      Heading: ({ children }: any) => React.createElement('div', { 'data-testid': 'card-heading' }, children),\r\n      Body: ({ children }: any) => React.createElement('div', { 'data-testid': 'card-body' }, children)\r\n    }\r\n  )\r\n}));\r\n\r\nvi.mock('@workday/canvas-kit-react/table', () => ({\r\n  Table: Object.assign(\r\n    ({ children }: any) => React.createElement('table', { 'data-testid': 'canvas-table' }, children),\r\n    {\r\n      Head: ({ children }: any) => React.createElement('thead', { 'data-testid': 'table-head' }, children),\r\n      Body: ({ children }: any) => React.createElement('tbody', { 'data-testid': 'table-body' }, children),\r\n      Row: ({ children }: any) => React.createElement('tr', { 'data-testid': 'table-row' }, children),\r\n      Header: ({ children }: any) => React.createElement('th', { 'data-testid': 'table-header' }, children),\r\n      Cell: ({ children }: any) => React.createElement('td', { 'data-testid': 'table-cell' }, children)\r\n    }\r\n  )\r\n}));\r\n\r\nvi.mock('@workday/canvas-kit-react/side-panel', () => ({\r\n  SidePanel: ({ children }: any) => React.createElement('div', { 'data-testid': 'side-panel' }, children)\r\n}));\r\n\r\nvi.mock('@workday/canvas-kit-react/avatar', () => ({\r\n  Avatar: ({ children, altText }: any) => React.createElement('div', { 'data-testid': 'avatar', 'aria-label': altText }, children)\r\n}));\r\n\r\nvi.mock('@workday/canvas-kit-react/common', () => ({\r\n  CanvasProvider: ({ children }: any) => React.createElement('div', { 'data-testid': 'canvas-provider' }, children)\r\n}));","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/api/__tests__/type-guards.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'vi' is defined but never used.","line":1,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'beforeEach' is defined but never used.","line":1,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'validateUpdateOrganizationInput' is defined but never used.","line":5,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'validateGraphQLVariables' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'validateGraphQLOrganizationResponse' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5532,5535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5532,5535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport {\r\n  validateOrganizationUnit,\r\n  validateCreateOrganizationInput,\r\n  validateUpdateOrganizationInput,\r\n  validateGraphQLVariables,\r\n  validateGraphQLOrganizationResponse,\r\n  validateGraphQLOrganizationList,\r\n  isGraphQLError,\r\n  isGraphQLSuccessResponse,\r\n  isAPIError,\r\n  isValidationError,\r\n  isNetworkError,\r\n  safeTransformGraphQLToOrganizationUnit,\r\n  safeTransformCreateInputToAPI,\r\n  ValidationError\r\n} from '../type-guards';\r\n\r\ndescribe('Type Guards and Validators', () => {\r\n  describe('validateOrganizationUnit', () => {\r\n    it('should validate and return a valid organization unit', () => {\r\n      const validData = {\r\n        code: '1000001',\r\n        name: 'Test Department',\r\n        unit_type: 'DEPARTMENT',\r\n        status: 'ACTIVE',\r\n        level: 2,\r\n        parent_code: '1000000',\r\n        sort_order: 1,\r\n        description: 'Test description',\r\n        created_at: '2025-08-08T12:00:00Z',\r\n        updated_at: '2025-08-08T12:00:00Z',\r\n        path: '/1000000/1000001'\r\n      };\r\n\r\n      const result = validateOrganizationUnit(validData);\r\n      expect(result).toEqual(validData);\r\n    });\r\n\r\n    it('should throw ValidationError for invalid data', () => {\r\n      const invalidData = {\r\n        code: '123', // Invalid code\r\n        name: 'Test Department',\r\n        unit_type: 'DEPARTMENT',\r\n        status: 'ACTIVE',\r\n        level: 2\r\n      };\r\n\r\n      expect(() => validateOrganizationUnit(invalidData)).toThrow(ValidationError);\r\n    });\r\n  });\r\n\r\n  describe('validateCreateOrganizationInput', () => {\r\n    it('should validate and return valid create input', () => {\r\n      const validInput = {\r\n        name: 'New Department',\r\n        unit_type: 'DEPARTMENT',\r\n        status: 'ACTIVE',\r\n        level: 3,\r\n        parent_code: '1000001',\r\n        sort_order: 5,\r\n        description: 'New department description'\r\n      };\r\n\r\n      const result = validateCreateOrganizationInput(validInput);\r\n      expect(result.name).toBe('New Department');\r\n      expect(result.status).toBe('ACTIVE');\r\n    });\r\n\r\n    it('should apply default values', () => {\r\n      const minimalInput = {\r\n        name: 'New Department',\r\n        unit_type: 'DEPARTMENT',\r\n        level: 3\r\n      };\r\n\r\n      const result = validateCreateOrganizationInput(minimalInput);\r\n      expect(result.status).toBe('ACTIVE');\r\n      expect(result.sort_order).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('validateGraphQLOrganizationList', () => {\r\n    it('should validate an array of GraphQL organization responses', () => {\r\n      const validList = [\r\n        {\r\n          code: '1000001',\r\n          name: 'Department 1',\r\n          unitType: 'DEPARTMENT',\r\n          status: 'ACTIVE',\r\n          level: 2\r\n        },\r\n        {\r\n          code: '1000002',\r\n          name: 'Department 2',\r\n          unitType: 'DEPARTMENT',\r\n          status: 'ACTIVE',\r\n          level: 2\r\n        }\r\n      ];\r\n\r\n      const result = validateGraphQLOrganizationList(validList);\r\n      expect(result).toHaveLength(2);\r\n      expect(result[0].code).toBe('1000001');\r\n    });\r\n\r\n    it('should throw ValidationError with index information for invalid items', () => {\r\n      const invalidList = [\r\n        {\r\n          code: '1000001',\r\n          name: 'Department 1',\r\n          unitType: 'DEPARTMENT',\r\n          status: 'ACTIVE',\r\n          level: 2\r\n        },\r\n        {\r\n          code: '1000002',\r\n          // Missing required fields\r\n        }\r\n      ];\r\n\r\n      expect(() => validateGraphQLOrganizationList(invalidList))\r\n        .toThrow(/index 1/);\r\n    });\r\n  });\r\n\r\n  describe('Type Guard Functions', () => {\r\n    describe('isGraphQLError', () => {\r\n      it('should return true for valid GraphQL error response', () => {\r\n        const errorResponse = {\r\n          errors: [\r\n            {\r\n              message: 'Field error',\r\n              locations: [{ line: 1, column: 1 }],\r\n              path: ['organizations']\r\n            }\r\n          ]\r\n        };\r\n\r\n        expect(isGraphQLError(errorResponse)).toBe(true);\r\n      });\r\n\r\n      it('should return false for successful GraphQL response', () => {\r\n        const successResponse = {\r\n          data: {\r\n            organizations: []\r\n          }\r\n        };\r\n\r\n        expect(isGraphQLError(successResponse)).toBe(false);\r\n      });\r\n\r\n      it('should return false for empty errors array', () => {\r\n        const emptyErrorsResponse = {\r\n          errors: []\r\n        };\r\n\r\n        expect(isGraphQLError(emptyErrorsResponse)).toBe(false);\r\n      });\r\n    });\r\n\r\n    describe('isGraphQLSuccessResponse', () => {\r\n      it('should return true for valid success response', () => {\r\n        const successResponse = {\r\n          data: {\r\n            organizations: []\r\n          }\r\n        };\r\n\r\n        expect(isGraphQLSuccessResponse(successResponse)).toBe(true);\r\n      });\r\n\r\n      it('should return false for response with null data', () => {\r\n        const nullDataResponse = {\r\n          data: null\r\n        };\r\n\r\n        expect(isGraphQLSuccessResponse(nullDataResponse)).toBe(false);\r\n      });\r\n\r\n      it('should return false for response without data field', () => {\r\n        const noDataResponse = {\r\n          result: 'success'\r\n        };\r\n\r\n        expect(isGraphQLSuccessResponse(noDataResponse)).toBe(false);\r\n      });\r\n    });\r\n\r\n    describe('isAPIError', () => {\r\n      it('should return true for API error with status and statusText', () => {\r\n        const apiError = new Error('API failed') as any;\r\n        apiError.status = 404;\r\n        apiError.statusText = 'Not Found';\r\n\r\n        expect(isAPIError(apiError)).toBe(true);\r\n      });\r\n\r\n      it('should return false for regular Error', () => {\r\n        const regularError = new Error('Regular error');\r\n\r\n        expect(isAPIError(regularError)).toBe(false);\r\n      });\r\n    });\r\n\r\n    describe('isValidationError', () => {\r\n      it('should return true for ValidationError instance', () => {\r\n        const validationError = new ValidationError('Validation failed', []);\r\n\r\n        expect(isValidationError(validationError)).toBe(true);\r\n      });\r\n\r\n      it('should return false for regular Error', () => {\r\n        const regularError = new Error('Regular error');\r\n\r\n        expect(isValidationError(regularError)).toBe(false);\r\n      });\r\n    });\r\n\r\n    describe('isNetworkError', () => {\r\n      it('should return true for TypeError with fetch message', () => {\r\n        const networkError = new TypeError('fetch failed');\r\n\r\n        expect(isNetworkError(networkError)).toBe(true);\r\n      });\r\n\r\n      it('should return false for TypeError without fetch message', () => {\r\n        const typeError = new TypeError('type error');\r\n\r\n        expect(isNetworkError(typeError)).toBe(false);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Safe Transform Functions', () => {\r\n    describe('safeTransformGraphQLToOrganizationUnit', () => {\r\n      it('should transform GraphQL response to OrganizationUnit', () => {\r\n        const graphqlResponse = {\r\n          code: '1000001',\r\n          name: 'Test Department',\r\n          unitType: 'DEPARTMENT',\r\n          status: 'ACTIVE',\r\n          level: 2,\r\n          parentCode: '1000000',\r\n          path: '/1000000/1000001',\r\n          sortOrder: 1,\r\n          description: 'Test description',\r\n          createdAt: '2025-08-08T12:00:00Z',\r\n          updatedAt: '2025-08-08T12:00:00Z'\r\n        };\r\n\r\n        const result = safeTransformGraphQLToOrganizationUnit(graphqlResponse);\r\n\r\n        expect(result).toEqual({\r\n          code: '1000001',\r\n          parent_code: '1000000',\r\n          name: 'Test Department',\r\n          unit_type: 'DEPARTMENT',\r\n          status: 'ACTIVE',\r\n          level: 2,\r\n          path: '/1000000/1000001',\r\n          sort_order: 1,\r\n          description: 'Test description',\r\n          created_at: '2025-08-08T12:00:00Z',\r\n          updated_at: '2025-08-08T12:00:00Z'\r\n        });\r\n      });\r\n\r\n      it('should handle null/undefined optional fields', () => {\r\n        const graphqlResponse = {\r\n          code: '1000001',\r\n          name: 'Test Department',\r\n          unitType: 'DEPARTMENT',\r\n          status: 'ACTIVE',\r\n          level: 2,\r\n          parentCode: null,\r\n          sortOrder: null,\r\n          description: null,\r\n          createdAt: null,\r\n          updatedAt: null\r\n        };\r\n\r\n        const result = safeTransformGraphQLToOrganizationUnit(graphqlResponse);\r\n\r\n        expect(result.parent_code).toBe('');\r\n        expect(result.sort_order).toBe(0);\r\n        expect(result.description).toBe('');\r\n        expect(result.created_at).toBe('');\r\n        expect(result.updated_at).toBe('');\r\n      });\r\n    });\r\n\r\n    describe('safeTransformCreateInputToAPI', () => {\r\n      it('should transform create input to API payload', () => {\r\n        const createInput = {\r\n          code: '1000001',\r\n          name: 'New Department',\r\n          unit_type: 'DEPARTMENT' as const,\r\n          status: 'ACTIVE' as const,\r\n          level: 3,\r\n          parent_code: '1000000',\r\n          sort_order: 5,\r\n          description: 'New department description'\r\n        };\r\n\r\n        const result = safeTransformCreateInputToAPI(createInput);\r\n\r\n        expect(result).toEqual({\r\n          name: 'New Department',\r\n          unit_type: 'DEPARTMENT',\r\n          status: 'ACTIVE',\r\n          level: 3,\r\n          sort_order: 5,\r\n          description: 'New department description',\r\n          code: '1000001',\r\n          parent_code: '1000000'\r\n        });\r\n      });\r\n\r\n      it('should omit undefined optional fields', () => {\r\n        const minimalInput = {\r\n          name: 'New Department',\r\n          unit_type: 'DEPARTMENT' as const,\r\n          status: 'ACTIVE' as const,\r\n          level: 3,\r\n          sort_order: 0,\r\n          description: ''\r\n        };\r\n\r\n        const result = safeTransformCreateInputToAPI(minimalInput);\r\n\r\n        expect(result).toEqual({\r\n          name: 'New Department',\r\n          unit_type: 'DEPARTMENT',\r\n          status: 'ACTIVE',\r\n          level: 3,\r\n          sort_order: 0,\r\n          description: ''\r\n        });\r\n        expect(result).not.toHaveProperty('code');\r\n        expect(result).not.toHaveProperty('parent_code');\r\n      });\r\n\r\n      it('should not include empty string parent_code', () => {\r\n        const inputWithEmptyParent = {\r\n          name: 'New Department',\r\n          unit_type: 'DEPARTMENT' as const,\r\n          status: 'ACTIVE' as const,\r\n          level: 3,\r\n          parent_code: '',\r\n          sort_order: 0,\r\n          description: ''\r\n        };\r\n\r\n        const result = safeTransformCreateInputToAPI(inputWithEmptyParent);\r\n\r\n        expect(result).not.toHaveProperty('parent_code');\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('ValidationError Class', () => {\r\n    it('should create ValidationError with message and details', () => {\r\n      const details = [\r\n        { message: 'Invalid field', code: 'invalid', path: ['name'] }\r\n      ];\r\n      const error = new ValidationError('Validation failed', details);\r\n\r\n      expect(error.message).toBe('Validation failed');\r\n      expect(error.details).toEqual(details);\r\n      expect(error.code).toBe('VALIDATION_ERROR');\r\n      expect(error.name).toBe('ValidationError');\r\n    });\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/api/client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/api/error-handling.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'z' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ValidationError' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'errorInfo' is defined but never used.","line":77,"column":62,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":71},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2315,2318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2315,2318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":134,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3783,3786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3783,3786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4466,4469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4466,4469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { z } from 'zod';\r\nimport { ValidationError, isValidationError, isAPIError, isNetworkError } from './type-guards';\r\n\r\n// ç»Ÿä¸€é”™è¯¯å¤„ç†å™¨\r\nexport class ErrorHandler {\r\n  private static logError(context: string, error: unknown): void {\r\n    const timestamp = new Date().toISOString();\r\n    console.group(`[${timestamp}] Error in ${context}`);\r\n    console.error('Error details:', error);\r\n    \r\n    if (isValidationError(error)) {\r\n      console.error('Validation details:', error.details);\r\n    } else if (isAPIError(error)) {\r\n      console.error('API Error:', error.status, error.statusText);\r\n      console.error('Response:', error.response);\r\n    } else if (isNetworkError(error)) {\r\n      console.error('Network Error:', error.message);\r\n    }\r\n    \r\n    console.groupEnd();\r\n  }\r\n  \r\n  private static createUserMessage(error: unknown): string {\r\n    if (isValidationError(error)) {\r\n      return 'æ•°æ®éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥çš„ä¿¡æ¯æ ¼å¼æ˜¯å¦æ­£ç¡®';\r\n    } else if (isAPIError(error)) {\r\n      if (error.status >= 500) {\r\n        return 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';\r\n      } else if (error.status === 404) {\r\n        return 'è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨';\r\n      } else if (error.status === 403) {\r\n        return 'æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ';\r\n      } else if (error.status === 401) {\r\n        return 'èº«ä»½éªŒè¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•';\r\n      } else if (error.status >= 400) {\r\n        return 'è¯·æ±‚å‚æ•°æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥';\r\n      }\r\n    } else if (isNetworkError(error)) {\r\n      return 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';\r\n    }\r\n    \r\n    return 'å‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';\r\n  }\r\n  \r\n  // APIè°ƒç”¨é”™è¯¯å¤„ç†\r\n  static handleAPIError(context: string, error: unknown): never {\r\n    this.logError(context, error);\r\n    \r\n    if (isValidationError(error)) {\r\n      throw new UserFriendlyError(\r\n        this.createUserMessage(error),\r\n        'VALIDATION_ERROR',\r\n        error\r\n      );\r\n    } else if (isAPIError(error)) {\r\n      throw new UserFriendlyError(\r\n        this.createUserMessage(error),\r\n        'API_ERROR',\r\n        error\r\n      );\r\n    } else if (isNetworkError(error)) {\r\n      throw new UserFriendlyError(\r\n        this.createUserMessage(error),\r\n        'NETWORK_ERROR',\r\n        error\r\n      );\r\n    } else {\r\n      throw new UserFriendlyError(\r\n        this.createUserMessage(error),\r\n        'UNKNOWN_ERROR',\r\n        error\r\n      );\r\n    }\r\n  }\r\n  \r\n  // ç»„ä»¶é”™è¯¯è¾¹ç•Œå¤„ç†\r\n  static handleComponentError(context: string, error: Error, errorInfo?: any): void {\r\n    this.logError(context, error);\r\n    \r\n    // å‘é€é”™è¯¯æŠ¥å‘Šåˆ°ç›‘æ§æœåŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰\r\n    if (process.env.NODE_ENV === 'production') {\r\n      // è¿™é‡Œå¯ä»¥é›†æˆé”™è¯¯ç›‘æ§æœåŠ¡ï¼Œå¦‚ Sentry\r\n      console.warn('Error reporting not implemented');\r\n    }\r\n  }\r\n  \r\n  // è¡¨å•éªŒè¯é”™è¯¯å¤„ç†\r\n  static handleFormValidationError(error: unknown): FormValidationErrors {\r\n    if (!isValidationError(error)) {\r\n      return { _form: ['è¡¨å•éªŒè¯å¤±è´¥'] };\r\n    }\r\n    \r\n    const formErrors: FormValidationErrors = {};\r\n    \r\n    error.details.forEach(detail => {\r\n      const field = detail.path.join('.');\r\n      if (!formErrors[field]) {\r\n        formErrors[field] = [];\r\n      }\r\n      formErrors[field].push(detail.message);\r\n    });\r\n    \r\n    return formErrors;\r\n  }\r\n}\r\n\r\n// ç”¨æˆ·å‹å¥½çš„é”™è¯¯ç±»\r\nexport class UserFriendlyError extends Error {\r\n  public readonly code: string;\r\n  public readonly originalError: unknown;\r\n  public readonly timestamp: Date;\r\n  \r\n  constructor(message: string, code: string, originalError: unknown) {\r\n    super(message);\r\n    this.name = 'UserFriendlyError';\r\n    this.code = code;\r\n    this.originalError = originalError;\r\n    this.timestamp = new Date();\r\n  }\r\n}\r\n\r\n// è¡¨å•éªŒè¯é”™è¯¯ç±»å‹\r\nexport interface FormValidationErrors {\r\n  [field: string]: string[];\r\n  _form?: string[]; // é€šç”¨è¡¨å•é”™è¯¯\r\n}\r\n\r\n// é”™è¯¯ç±»å‹å®ˆå«\r\nexport const isUserFriendlyError = (error: unknown): error is UserFriendlyError => {\r\n  return error instanceof UserFriendlyError;\r\n};\r\n\r\n// å¼‚æ­¥æ“ä½œé”™è¯¯åŒ…è£…å™¨\r\nexport const withErrorHandling = <T extends any[], R>(\r\n  fn: (...args: T) => Promise<R>,\r\n  context: string\r\n) => {\r\n  return async (...args: T): Promise<R> => {\r\n    try {\r\n      return await fn(...args);\r\n    } catch (error) {\r\n      ErrorHandler.handleAPIError(context, error);\r\n    }\r\n  };\r\n};\r\n\r\n// React Hook é”™è¯¯å¤„ç†\r\nexport const useErrorHandler = () => {\r\n  const handleError = (context: string) => (error: unknown) => {\r\n    ErrorHandler.handleAPIError(context, error);\r\n  };\r\n  \r\n  const handleFormError = (error: unknown): FormValidationErrors => {\r\n    return ErrorHandler.handleFormValidationError(error);\r\n  };\r\n  \r\n  return { handleError, handleFormError };\r\n};\r\n\r\n// é€šç”¨é”™è¯¯æ¢å¤ç­–ç•¥\r\nexport const withRetry = <T extends any[], R>(\r\n  fn: (...args: T) => Promise<R>,\r\n  maxRetries: number = 3,\r\n  delay: number = 1000\r\n) => {\r\n  return async (...args: T): Promise<R> => {\r\n    let lastError: unknown;\r\n    \r\n    for (let i = 0; i <= maxRetries; i++) {\r\n      try {\r\n        return await fn(...args);\r\n      } catch (error) {\r\n        lastError = error;\r\n        \r\n        // ä¸é‡è¯•éªŒè¯é”™è¯¯å’Œ4xxé”™è¯¯\r\n        if (isValidationError(error) || (isAPIError(error) && error.status < 500)) {\r\n          throw error;\r\n        }\r\n        \r\n        if (i < maxRetries) {\r\n          await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));\r\n        }\r\n      }\r\n    }\r\n    \r\n    throw lastError;\r\n  };\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/api/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/api/monitoring.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'response' is assigned a value but never used.","line":96,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'temporalOperations' is assigned a value but never used.","line":266,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":266,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'redisMemory' is assigned a value but never used.","line":270,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":270,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'status' is assigned a value but never used.","line":377,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":377,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'i' is defined but never used.","line":479,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":479,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'i' is defined but never used.","line":487,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":487,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":495,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":495,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16536,16539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16536,16539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":502,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":502,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16770,16773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16770,16773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { SystemMetrics } from '../types/monitoring';\r\nimport { mockMetrics } from '../types/monitoring';\r\n\r\nexport class MonitoringService {\r\n  /**\r\n   * è·å–ç³»ç»Ÿç›‘æ§æŒ‡æ ‡æ•°æ®\r\n   * å®Œæ•´ç‰ˆæœ¬ï¼šçœŸå®æŒ‡æ ‡ + å¥åº·æ£€æŸ¥ + mockæ•°æ®fallback\r\n   */\r\n  static async getMetrics(): Promise<SystemMetrics> {\r\n    try {\r\n      // å°è¯•è·å–çœŸå®çš„PrometheusæŒ‡æ ‡\r\n      const response = await fetch('/api/metrics', {\r\n        method: 'GET',\r\n        headers: {\r\n          'Accept': 'text/plain'\r\n        }\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const rawMetrics = await response.text();\r\n        console.log('[MonitoringService] è·å–åˆ°çœŸå®æŒ‡æ ‡æ•°æ®:', rawMetrics.substring(0, 200) + '...');\r\n        \r\n        // è§£æPrometheusæŒ‡æ ‡\r\n        const parsedMetrics = this.parsePrometheusMetrics(rawMetrics);\r\n        \r\n        // åˆå¹¶çœŸå®æŒ‡æ ‡å’Œmockæ•°æ®\r\n        const finalMetrics = {\r\n          ...mockMetrics,\r\n          ...parsedMetrics,\r\n          lastUpdated: new Date().toLocaleString()\r\n        };\r\n        \r\n        // æ‰§è¡Œå¥åº·æ£€æŸ¥æ›´æ–°æœåŠ¡çŠ¶æ€\r\n        finalMetrics.services = await this.updateServicesWithHealthCheck(finalMetrics.services);\r\n        \r\n        console.log('[MonitoringService] è¿”å›æ··åˆæŒ‡æ ‡æ•°æ® (çœŸå®+å¥åº·æ£€æŸ¥)');\r\n        return finalMetrics;\r\n        \r\n      } else {\r\n        console.warn('[MonitoringService] æ— æ³•è·å–æŒ‡æ ‡æ•°æ®ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ® + å¥åº·æ£€æŸ¥');\r\n        \r\n        // å³ä½¿æ— æ³•è·å–æŒ‡æ ‡ï¼Œä¹Ÿæ‰§è¡Œå¥åº·æ£€æŸ¥\r\n        const metricsWithHealthCheck = {\r\n          ...mockMetrics,\r\n          lastUpdated: new Date().toLocaleString()\r\n        };\r\n        \r\n        metricsWithHealthCheck.services = await this.updateServicesWithHealthCheck(metricsWithHealthCheck.services);\r\n        return metricsWithHealthCheck;\r\n      }\r\n    } catch (error) {\r\n      console.warn('[MonitoringService] æŒ‡æ ‡è·å–å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ® + å¥åº·æ£€æŸ¥:', error);\r\n      \r\n      // é”™è¯¯æƒ…å†µä¸‹ä¹Ÿå°è¯•å¥åº·æ£€æŸ¥\r\n      const fallbackMetrics = {\r\n        ...mockMetrics,\r\n        lastUpdated: new Date().toLocaleString()\r\n      };\r\n      \r\n      try {\r\n        fallbackMetrics.services = await this.updateServicesWithHealthCheck(fallbackMetrics.services);\r\n      } catch (healthError) {\r\n        console.warn('[MonitoringService] å¥åº·æ£€æŸ¥ä¹Ÿå¤±è´¥äº†ï¼Œä½¿ç”¨çº¯æ¨¡æ‹Ÿæ•°æ®:', healthError);\r\n      }\r\n      \r\n      return fallbackMetrics;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ£€æŸ¥å•ä¸ªæœåŠ¡çš„å¥åº·çŠ¶æ€\r\n   */\r\n  static async checkServiceHealth(serviceUrl: string, serviceName?: string): Promise<boolean> {\r\n    try {\r\n      // æ•°æ®åº“æœåŠ¡éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå‡è®¾å®ƒä»¬éƒ½æ˜¯å¥åº·çš„\r\n      // å› ä¸ºå‰ç«¯æ— æ³•ç›´æ¥è¿æ¥æ•°æ®åº“è¿›è¡Œå¥åº·æ£€æŸ¥\r\n      if (serviceName === 'postgres' || serviceName === 'neo4j') {\r\n        // å¯¹äºæ•°æ®åº“ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒä»¬æ€»æ˜¯å¥åº·çš„\r\n        // å®é™…çš„å¥åº·çŠ¶æ€åº”è¯¥é€šè¿‡åç«¯APIæˆ–ä¸“é—¨çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹è·å–\r\n        console.log(`[HealthCheck] æ•°æ®åº“æœåŠ¡å‡è®¾ä¸ºå¥åº·: ${serviceName}`);\r\n        return true;\r\n      }\r\n      \r\n      // HTTPæœåŠ¡çš„å¥åº·æ£€æŸ¥\r\n      const healthEndpoints = [\r\n        `${serviceUrl}/health`,\r\n        `${serviceUrl}/ready`, \r\n        serviceUrl\r\n      ];\r\n      \r\n      for (const endpoint of healthEndpoints) {\r\n        try {\r\n          const controller = new AbortController();\r\n          const timeoutId = setTimeout(() => controller.abort(), 3000); // 3ç§’è¶…æ—¶\r\n          \r\n          const response = await fetch(endpoint, { \r\n            method: 'HEAD',\r\n            signal: controller.signal,\r\n            mode: 'no-cors' // é¿å…CORSé—®é¢˜\r\n          });\r\n          \r\n          clearTimeout(timeoutId);\r\n          \r\n          // å¯¹äºno-corsè¯·æ±‚ï¼ŒæˆåŠŸå‘é€è¯·æ±‚å°±è®¤ä¸ºæœåŠ¡æ­£å¸¸\r\n          console.log(`[HealthCheck] æœåŠ¡å¥åº·æ£€æŸ¥æˆåŠŸ: ${endpoint}`);\r\n          return true;\r\n          \r\n        } catch (error) {\r\n          // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªç«¯ç‚¹\r\n          console.log(`[HealthCheck] ç«¯ç‚¹æ£€æŸ¥å¤±è´¥: ${endpoint}`, error);\r\n        }\r\n      }\r\n      \r\n      return false;\r\n    } catch (error) {\r\n      console.warn(`[HealthCheck] æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥: ${serviceUrl}`, error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ‰¹é‡æ£€æŸ¥æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€\r\n   */\r\n  static async checkAllServicesHealth(): Promise<Record<string, boolean>> {\r\n    const services = [\r\n      { name: 'graphql-server', url: 'http://localhost:8090' },\r\n      { name: 'command-server', url: 'http://localhost:9090' },\r\n      { name: 'temporal-api', url: 'http://localhost:9091' }, // Phase 4: æ—¶æ€API\r\n      { name: 'frontend', url: 'http://localhost:3000' },\r\n      { name: 'metrics-server', url: 'http://localhost:9999' },\r\n      { name: 'postgres', url: 'http://localhost:5432' },\r\n      { name: 'neo4j', url: 'http://localhost:7474' },\r\n      { name: 'redis', url: 'http://localhost:6379' }, // Phase 4: Redisç¼“å­˜\r\n      { name: 'data-sync', url: 'http://localhost:8083/connectors/organization-postgres-connector/status' }\r\n    ];\r\n\r\n    const healthResults: Record<string, boolean> = {};\r\n    \r\n    // å¹¶è¡Œæ£€æŸ¥æ‰€æœ‰æœåŠ¡\r\n    const healthChecks = services.map(async (service) => {\r\n      let isHealthy = false;\r\n      \r\n      if (service.name === 'data-sync') {\r\n        // ç‰¹æ®Šå¤„ç†æ•°æ®åŒæ­¥æœåŠ¡ï¼šæ£€æŸ¥Debezium CDCçŠ¶æ€\r\n        isHealthy = await this.checkDataSyncHealth();\r\n      } else if (service.name === 'redis') {\r\n        // Phase 4: ç‰¹æ®Šå¤„ç†Redisç¼“å­˜æœåŠ¡\r\n        isHealthy = await this.checkRedisHealth();\r\n      } else {\r\n        isHealthy = await this.checkServiceHealth(service.url, service.name);\r\n      }\r\n      \r\n      healthResults[service.name] = isHealthy;\r\n      return { [service.name]: isHealthy };\r\n    });\r\n\r\n    await Promise.allSettled(healthChecks);\r\n    \r\n    console.log('[HealthCheck] æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€:', healthResults);\r\n    return healthResults;\r\n  }\r\n\r\n  /**\r\n   * æ£€æŸ¥Redisç¼“å­˜æœåŠ¡å¥åº·çŠ¶æ€ (Phase 4)\r\n   */\r\n  static async checkRedisHealth(): Promise<boolean> {\r\n    try {\r\n      // é€šè¿‡Redis Exporteræ£€æŸ¥RedisçŠ¶æ€\r\n      const response = await fetch('/api/redis/metrics', {\r\n        timeout: 3000\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const metricsText = await response.text();\r\n        // æ£€æŸ¥Redisæ˜¯å¦è¿æ¥æ­£å¸¸\r\n        const isConnected = metricsText.includes('redis_up 1');\r\n        console.log('[RedisHealth] Redisè¿æ¥çŠ¶æ€:', isConnected ? 'æ­£å¸¸' : 'å¼‚å¸¸');\r\n        return isConnected;\r\n      }\r\n      \r\n      return false;\r\n    } catch (error) {\r\n      console.warn('[RedisHealth] Rediså¥åº·æ£€æŸ¥å¤±è´¥:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ£€æŸ¥æ•°æ®åŒæ­¥æœåŠ¡å¥åº·çŠ¶æ€\r\n   */\r\n  static async checkDataSyncHealth(): Promise<boolean> {\r\n    try {\r\n      // é€šè¿‡Viteä»£ç†è®¿é—®Debezium CDCè¿æ¥å™¨çŠ¶æ€\r\n      const response = await fetch('/api/debezium/connectors/organization-postgres-connector/status', {\r\n        timeout: 3000\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const status = await response.json();\r\n        const isRunning = status.connector?.state === 'RUNNING';\r\n        console.log('[DataSyncHealth] CDCè¿æ¥å™¨çŠ¶æ€:', status.connector?.state);\r\n        return isRunning;\r\n      }\r\n      \r\n      return false;\r\n    } catch (error) {\r\n      console.warn('[DataSyncHealth] æ•°æ®åŒæ­¥æœåŠ¡æ£€æŸ¥å¤±è´¥:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ›´æ–°æœåŠ¡çŠ¶æ€åŸºäºå¥åº·æ£€æŸ¥ç»“æœ\r\n   */\r\n  static async updateServicesWithHealthCheck(services: ServiceStatus[]): Promise<ServiceStatus[]> {\r\n    const healthResults = await this.checkAllServicesHealth();\r\n    \r\n    return services.map(service => {\r\n      const serviceName = this.getServiceKey(service.name);\r\n      const isHealthy = healthResults[serviceName];\r\n      \r\n      return {\r\n        ...service,\r\n        status: isHealthy ? 'online' : 'offline'\r\n      } as ServiceStatus;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * æ ¹æ®æœåŠ¡æ˜¾ç¤ºåç§°è·å–æœåŠ¡é”®\r\n   */\r\n  private static getServiceKey(displayName: string): string {\r\n    const keyMap: Record<string, string> = {\r\n      'å‘½ä»¤APIæœåŠ¡': 'command-server',\r\n      'GraphQLæŸ¥è¯¢æœåŠ¡': 'graphql-server', \r\n      'æ—¶æ€ç®¡ç†API': 'temporal-api', // Phase 4\r\n      'å‰ç«¯åº”ç”¨': 'frontend',\r\n      'PostgreSQLæ•°æ®åº“': 'postgres',\r\n      'Neo4jå›¾æ•°æ®åº“': 'neo4j',\r\n      'Redisç¼“å­˜æœåŠ¡': 'redis', // Phase 4\r\n      'æŒ‡æ ‡æ”¶é›†æœåŠ¡': 'metrics-server',\r\n      'æ•°æ®åŒæ­¥æœåŠ¡': 'data-sync'\r\n    };\r\n    return keyMap[displayName] || displayName.toLowerCase();\r\n  }\r\n\r\n  /**\r\n   * è§£æPrometheusæ ¼å¼çš„æŒ‡æ ‡æ•°æ®\r\n   * å®Œæ•´ç‰ˆæœ¬ï¼šæå–å…³é”®æŒ‡æ ‡å¹¶æ›´æ–°SystemMetrics\r\n   */\r\n  private static parsePrometheusMetrics(rawMetrics: string): Partial<SystemMetrics> {\r\n    const lines = rawMetrics.split('\\n');\r\n    const parsedData: Partial<SystemMetrics> = {};\r\n    \r\n    // è§£æHTTPè¯·æ±‚æ€»æ•°\r\n    const httpRequestsTotal = this.parseMetricValues(lines, 'http_requests_total');\r\n    \r\n    // è§£æHTTPè¯·æ±‚å“åº”æ—¶é—´\r\n    const httpRequestDuration = this.parseMetricValues(lines, 'http_request_duration_seconds');\r\n    \r\n    // è§£æä¸šåŠ¡æ“ä½œæŒ‡æ ‡\r\n    const organizationOperations = this.parseMetricValues(lines, 'organization_operations_total');\r\n    \r\n    // Phase 4: è§£ææ—¶æ€APIæŒ‡æ ‡\r\n    const temporalQueryMetrics = this.parseMetricValues(lines, 'temporal_query_duration_seconds');\r\n    const temporalOperations = this.parseMetricValues(lines, 'temporal_operations_total');\r\n    \r\n    // Phase 4: è§£æç¼“å­˜æ€§èƒ½æŒ‡æ ‡\r\n    const cacheOperations = this.parseMetricValues(lines, 'cache_operations_total');\r\n    const redisMemory = this.parseMetricValues(lines, 'redis_memory_used_bytes');\r\n    \r\n    // å¦‚æœæ‰¾åˆ°çœŸå®æŒ‡æ ‡ï¼Œæ„å»ºæœåŠ¡çŠ¶æ€\r\n    if (httpRequestsTotal.length > 0 || organizationOperations.length > 0 || temporalQueryMetrics.length > 0) {\r\n      console.log('[MonitoringService] è§£æåˆ°çœŸå®æŒ‡æ ‡:', {\r\n        httpRequests: httpRequestsTotal.length,\r\n        operations: organizationOperations.length,\r\n        duration: httpRequestDuration.length,\r\n        temporalQueries: temporalQueryMetrics.length, // Phase 4\r\n        cacheOps: cacheOperations.length // Phase 4\r\n      });\r\n      \r\n      // æ„å»ºæœåŠ¡çŠ¶æ€ä¿¡æ¯\r\n      const services = this.buildServiceStatusFromMetrics(\r\n        httpRequestsTotal, \r\n        httpRequestDuration, \r\n        organizationOperations,\r\n        temporalQueryMetrics, // Phase 4\r\n        cacheOperations // Phase 4\r\n      );\r\n      \r\n      if (services.length > 0) {\r\n        parsedData.services = services;\r\n      }\r\n      \r\n      // æ„å»ºå›¾è¡¨æ•°æ®\r\n      const chartData = this.buildChartDataFromMetrics(\r\n        httpRequestsTotal,\r\n        httpRequestDuration,\r\n        temporalQueryMetrics, // Phase 4\r\n        cacheOperations // Phase 4\r\n      );\r\n      \r\n      if (chartData) {\r\n        parsedData.charts = chartData;\r\n      }\r\n    }\r\n    \r\n    return parsedData;\r\n  }\r\n\r\n  /**\r\n   * è§£æPrometheusæŒ‡æ ‡å€¼ï¼ˆæ”¯æŒæ ‡ç­¾ï¼‰\r\n   */\r\n  private static parseMetricValues(lines: string[], metricName: string): Array<{labels: Record<string, string>, value: number}> {\r\n    const results: Array<{labels: Record<string, string>, value: number}> = [];\r\n    \r\n    for (const line of lines) {\r\n      if (line.startsWith(metricName) && !line.startsWith('#')) {\r\n        // åŒ¹é…æ ¼å¼: metric_name{label1=\"value1\",label2=\"value2\"} 123.45\r\n        const match = line.match(/^([^{]+)(?:\\{([^}]+)\\})?\\s+([\\d.]+)$/);\r\n        if (match) {\r\n          const [, name, labelsStr, valueStr] = match;\r\n          if (name === metricName) {\r\n            const labels: Record<string, string> = {};\r\n            \r\n            // è§£ææ ‡ç­¾\r\n            if (labelsStr) {\r\n              const labelPairs = labelsStr.split(',');\r\n              for (const pair of labelPairs) {\r\n                const labelMatch = pair.trim().match(/^([^=]+)=\"([^\"]*)\"$/);\r\n                if (labelMatch) {\r\n                  labels[labelMatch[1]] = labelMatch[2];\r\n                }\r\n              }\r\n            }\r\n            \r\n            const value = parseFloat(valueStr);\r\n            if (!isNaN(value)) {\r\n              results.push({ labels, value });\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * ä»æŒ‡æ ‡æ•°æ®æ„å»ºæœåŠ¡çŠ¶æ€ (Phase 4 å¢å¼º)\r\n   */\r\n  private static buildServiceStatusFromMetrics(\r\n    httpRequests: Array<{labels: Record<string, string>, value: number}>,\r\n    httpDuration: Array<{labels: Record<string, string>, value: number}>,\r\n    operations: Array<{labels: Record<string, string>, value: number}>,\r\n    temporalQueries?: Array<{labels: Record<string, string>, value: number}>, // Phase 4\r\n    cacheOps?: Array<{labels: Record<string, string>, value: number}> // Phase 4\r\n  ): ServiceStatus[] {\r\n    const serviceMap = new Map<string, Partial<ServiceStatus>>();\r\n    \r\n    // é¦–å…ˆä»mockæ•°æ®å¤åˆ¶æ‰€æœ‰æœåŠ¡ä½œä¸ºåŸºç¡€\r\n    mockMetrics.services.forEach(service => {\r\n      const serviceName = this.getServiceKey(service.name);\r\n      serviceMap.set(serviceName, {\r\n        name: service.name,\r\n        port: service.port,\r\n        status: service.status,\r\n        requests: service.requests,\r\n        responseTime: service.responseTime,\r\n        uptime: service.uptime\r\n      });\r\n    });\r\n    \r\n    // å¤„ç†HTTPè¯·æ±‚æŒ‡æ ‡ï¼Œæ›´æ–°çœŸå®æ•°æ®\r\n    for (const req of httpRequests) {\r\n      const serviceName = req.labels.service || 'unknown';\r\n      const status = req.labels.status || 'unknown';\r\n      \r\n      if (serviceMap.has(serviceName)) {\r\n        const service = serviceMap.get(serviceName)!;\r\n        const currentRequests = parseInt(service.requests || '0');\r\n        service.requests = (currentRequests + req.value).toString();\r\n      }\r\n    }\r\n    \r\n    // å¤„ç†å“åº”æ—¶é—´æŒ‡æ ‡ï¼Œæ›´æ–°çœŸå®æ•°æ®\r\n    for (const duration of httpDuration) {\r\n      const serviceName = duration.labels.service || 'unknown';\r\n      if (serviceMap.has(serviceName)) {\r\n        const service = serviceMap.get(serviceName)!;\r\n        // ç®€åŒ–å¤„ç†ï¼šå–å¹³å‡å€¼ï¼ˆå®é™…åº”è¯¥æ ¹æ®histogramè®¡ç®—ï¼‰\r\n        service.responseTime = Math.round(duration.value * 1000) + 'ms';\r\n      }\r\n    }\r\n    \r\n    // Phase 4: å¤„ç†æ—¶æ€APIæŒ‡æ ‡\r\n    if (temporalQueries) {\r\n      for (const tq of temporalQueries) {\r\n        const serviceName = 'temporal-api';\r\n        if (!serviceMap.has(serviceName)) {\r\n          serviceMap.set(serviceName, {\r\n            name: 'æ—¶æ€ç®¡ç†API',\r\n            port: '9091',\r\n            status: 'online',\r\n            requests: '0',\r\n            responseTime: '0ms',\r\n            uptime: '99.9%'\r\n          });\r\n        }\r\n        \r\n        const service = serviceMap.get(serviceName)!;\r\n        service.responseTime = Math.round(tq.value * 1000) + 'ms';\r\n      }\r\n    }\r\n    \r\n    // Phase 4: å¤„ç†ç¼“å­˜æ€§èƒ½æŒ‡æ ‡\r\n    if (cacheOps) {\r\n      for (const cache of cacheOps) {\r\n        const serviceName = 'redis';\r\n        if (!serviceMap.has(serviceName)) {\r\n          serviceMap.set(serviceName, {\r\n            name: 'Redisç¼“å­˜æœåŠ¡',\r\n            port: '6379', \r\n            status: 'online',\r\n            requests: '0',\r\n            responseTime: '1ms',\r\n            uptime: '99.8%'\r\n          });\r\n        }\r\n        \r\n        const service = serviceMap.get(serviceName)!;\r\n        const currentRequests = parseInt(service.requests || '0');\r\n        service.requests = (currentRequests + cache.value).toString();\r\n      }\r\n    }\r\n    \r\n    return Array.from(serviceMap.values()).filter(s => s.name && s.port) as ServiceStatus[];\r\n  }\r\n\r\n  /**\r\n   * ä»æŒ‡æ ‡æ•°æ®æ„å»ºå›¾è¡¨æ•°æ® (Phase 4 å¢å¼º)\r\n   */\r\n  private static buildChartDataFromMetrics(\r\n    httpRequests: Array<{labels: Record<string, string>, value: number}>,\r\n    httpDuration: Array<{labels: Record<string, string>, value: number}>,\r\n    temporalQueries?: Array<{labels: Record<string, string>, value: number}>, // Phase 4\r\n    cacheOps?: Array<{labels: Record<string, string>, value: number}> // Phase 4\r\n  ): ChartData | null {\r\n    const now = new Date();\r\n    const timePoints = [];\r\n    \r\n    // ç”Ÿæˆæ—¶é—´ç‚¹ï¼ˆæœ€è¿‘6ä¸ª5åˆ†é’Ÿé—´éš”ï¼‰\r\n    for (let i = 5; i >= 0; i--) {\r\n      const time = new Date(now.getTime() - i * 5 * 60 * 1000);\r\n      timePoints.push(time.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' }));\r\n    }\r\n    \r\n    // è®¡ç®—å¹³å‡å“åº”æ—¶é—´\r\n    const avgResponseTime = httpDuration.reduce((sum, d) => sum + d.value, 0) / httpDuration.length * 1000;\r\n    const baseResponseTime = isNaN(avgResponseTime) ? 45 : Math.round(avgResponseTime);\r\n    \r\n    // è®¡ç®—æ€»è¯·æ±‚é‡\r\n    const totalRequests = httpRequests.reduce((sum, r) => sum + r.value, 0);\r\n    const baseRequestVolume = Math.max(50, Math.round(totalRequests / 6));\r\n    \r\n    // Phase 4: è®¡ç®—æ—¶æ€APIå“åº”æ—¶é—´\r\n    const temporalAvgTime = temporalQueries && temporalQueries.length > 0 \r\n      ? temporalQueries.reduce((sum, t) => sum + t.value, 0) / temporalQueries.length * 1000\r\n      : null;\r\n    \r\n    // Phase 4: è®¡ç®—ç¼“å­˜å‘½ä¸­ç‡\r\n    const cacheHitRate = cacheOps && cacheOps.length > 0\r\n      ? (cacheOps.filter(c => c.labels.result === 'hit').reduce((sum, c) => sum + c.value, 0) /\r\n         cacheOps.reduce((sum, c) => sum + c.value, 0)) * 100\r\n      : null;\r\n    \r\n    // ç”Ÿæˆå›¾è¡¨æ•°æ®ï¼ˆåŸºäºçœŸå®æ•°æ®åŠ ä¸Šä¸€äº›å˜åŒ–ï¼‰\r\n    const baseChart = {\r\n      responseTime: timePoints.map((timestamp, i) => ({\r\n        timestamp,\r\n        value: baseResponseTime + Math.round((Math.random() - 0.5) * 20)\r\n      })),\r\n      errorRate: timePoints.map((timestamp) => ({\r\n        timestamp,\r\n        value: Math.random() * 0.2 // 0-0.2%é”™è¯¯ç‡\r\n      })),\r\n      requestVolume: timePoints.map((timestamp, i) => ({\r\n        timestamp,\r\n        value: baseRequestVolume + Math.round((Math.random() - 0.5) * 50)\r\n      }))\r\n    };\r\n    \r\n    // Phase 4: æ·»åŠ æ—¶æ€APIå’Œç¼“å­˜æ€§èƒ½æ•°æ®\r\n    if (temporalAvgTime !== null) {\r\n      (baseChart as any).temporalResponseTime = timePoints.map((timestamp) => ({\r\n        timestamp,\r\n        value: Math.round(temporalAvgTime + (Math.random() - 0.5) * 10)\r\n      }));\r\n    }\r\n    \r\n    if (cacheHitRate !== null) {\r\n      (baseChart as any).cacheHitRate = timePoints.map((timestamp) => ({\r\n        timestamp,\r\n        value: Math.max(85, Math.min(98, cacheHitRate + (Math.random() - 0.5) * 5))\r\n      }));\r\n    }\r\n    \r\n    return baseChart;\r\n  }\r\n\r\n  /**\r\n   * è·å–æœåŠ¡æ˜¾ç¤ºåç§°\r\n   */\r\n  private static getServiceDisplayName(serviceName: string): string {\r\n    const nameMap: Record<string, string> = {\r\n      'command-server': 'å‘½ä»¤APIæœåŠ¡',\r\n      'graphql-server': 'GraphQLæŸ¥è¯¢æœåŠ¡',\r\n      'frontend': 'å‰ç«¯åº”ç”¨',\r\n      'metrics-server': 'æŒ‡æ ‡æ”¶é›†æœåŠ¡'\r\n    };\r\n    return nameMap[serviceName] || serviceName;\r\n  }\r\n\r\n  /**\r\n   * è·å–æœåŠ¡ç«¯å£\r\n   */\r\n  private static getServicePort(serviceName: string): string {\r\n    const portMap: Record<string, string> = {\r\n      'command-server': '9090',\r\n      'graphql-server': '8090',\r\n      'frontend': '3000',\r\n      'metrics-server': '9999'\r\n    };\r\n    return portMap[serviceName] || '8080';\r\n  }\r\n\r\n  /**\r\n   * éšæœºæ›´æ–°æ¨¡æ‹Ÿæ•°æ®ï¼Œè®©MVPç‰ˆæœ¬çœ‹èµ·æ¥æ›´çœŸå®\r\n   */\r\n  static updateMockData(): SystemMetrics {\r\n    const updated = { ...mockMetrics };\r\n    \r\n    // éšæœºæ›´æ–°æœåŠ¡å“åº”æ—¶é—´\r\n    updated.services = updated.services.map(service => ({\r\n      ...service,\r\n      responseTime: (Math.random() * 50 + 10).toFixed(0) + 'ms',\r\n      requests: (Math.random() * 200 + 50).toFixed(0)\r\n    }));\r\n    \r\n    // æ›´æ–°æ—¶é—´æˆ³\r\n    updated.lastUpdated = new Date().toLocaleString();\r\n    \r\n    return updated;\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/api/organizations-simplified.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'OrganizationUnitType' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'OrganizationStatus' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":202,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":202,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5800,5803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5800,5803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":207,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5986,5989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5986,5989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":313,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9199,9202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9199,9202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":329,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9721,9724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9721,9724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":361,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10451,10454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10451,10454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":372,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":372,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10741,10744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10741,10744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":372,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":372,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10752,10755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10752,10755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":376,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10901,10904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10901,10904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":376,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10912,10915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10912,10915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":380,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11057,11060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11057,11060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":380,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11068,11071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11068,11071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":393,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":393,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11448,11451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11448,11451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":407,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11904,11907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11904,11907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":419,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":419,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12181,12184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12181,12184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":436,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":436,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12752,12755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12752,12755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":470,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":470,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13929,13932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13929,13932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":481,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":481,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14195,14198],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14195,14198],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":573,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":573,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16872,16875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16872,16875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":635,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":635,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18570,18573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18570,18573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":651,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":651,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19005,19008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19005,19008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":671,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":671,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19629,19632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19629,19632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":682,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":682,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19897,19900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19897,19900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":698,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":698,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20371,20374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20371,20374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":725,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":725,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21382,21385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21382,21385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":736,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":736,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21662,21665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21662,21665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":27,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { \r\n  OrganizationUnit, \r\n  OrganizationListResponse, \r\n  OrganizationStats,\r\n  GraphQLResponse,\r\n  OrganizationUnitType,\r\n  OrganizationStatus,\r\n  OrganizationQueryParams\r\n} from '../types';\r\nimport type { CreateOrganizationInput, UpdateOrganizationInput } from '../hooks/useOrganizationMutations';\r\nimport type { \r\n  TemporalQueryParams,\r\n  TemporalOrganizationUnit,\r\n  TimelineEvent\r\n} from '../types/temporal';\r\nimport { \r\n  validateOrganizationBasic,\r\n  validateOrganizationUpdate,\r\n  validateStatusUpdate,\r\n  safeTransform,\r\n  SimpleValidationError,\r\n  formatValidationErrors\r\n} from '../validation/simple-validation';\r\n\r\n// GraphQLå®¢æˆ·ç«¯ - ä½¿ç”¨æ­£ç¡®çš„ç«¯å£8090\r\nconst GRAPHQL_ENDPOINT = '/graphql';\r\n\r\nconst graphqlClient = {\r\n  async request<T>(query: string, variables?: Record<string, unknown>): Promise<T> {\r\n    const response = await fetch(GRAPHQL_ENDPOINT, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        query,\r\n        variables\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`GraphQL Error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    const result = await response.json() as GraphQLResponse<T>;\r\n    \r\n    if (result.errors && result.errors.length > 0) {\r\n      throw new Error(`GraphQL Error: ${result.errors[0].message}`);\r\n    }\r\n\r\n    if (!result.data) {\r\n      throw new Error('No data returned from GraphQL');\r\n    }\r\n\r\n    return result.data;\r\n  }\r\n};\r\n\r\n// REST APIå®¢æˆ·ç«¯ - ä½¿ç”¨å‘½ä»¤æœåŠ¡ç«¯å£9090\r\nconst REST_ENDPOINT = '/api/v1';\r\n\r\nconst restClient = {\r\n  async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\r\n    const url = `${REST_ENDPOINT}${endpoint}`;\r\n    \r\n    const response = await fetch(url, {\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-Tenant-ID': '3b99930c-4dc6-4cc9-8e4d-7d960a931cb9',\r\n        ...options.headers,\r\n      },\r\n      ...options,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`REST Error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n};\r\n\r\n// æ‰©å±•æŸ¥è¯¢å‚æ•°ä»¥æ”¯æŒæ—¶æ€æŸ¥è¯¢\r\ninterface ExtendedOrganizationQueryParams extends OrganizationQueryParams {\r\n  searchText?: string;\r\n  pageSize?: number;\r\n  temporalParams?: TemporalQueryParams;\r\n}\r\n\r\nexport const organizationAPI = {\r\n  // è·å–ç»„ç»‡å•å…ƒåˆ—è¡¨ - ä½¿ç”¨GraphQL (ä¿®å¤getByCodeé—®é¢˜)\r\n  getAll: async (params?: ExtendedOrganizationQueryParams): Promise<OrganizationListResponse> => {\r\n    try {\r\n      // è½»é‡çº§å‚æ•°éªŒè¯\r\n      if (params) {\r\n        // ç®€åŒ–çš„å‚æ•°éªŒè¯ï¼Œä¾èµ–åç«¯è¯¦ç»†éªŒè¯\r\n        if (params.page && params.page < 1) {\r\n          throw new SimpleValidationError('é¡µç å¿…é¡»å¤§äº0', [\r\n            { field: 'page', message: 'é¡µç å¿…é¡»å¤§äº0' }\r\n          ]);\r\n        }\r\n        if (params.pageSize && (params.pageSize < 1 || params.pageSize > 100)) {\r\n          throw new SimpleValidationError('é¡µé¢å¤§å°å¿…é¡»åœ¨1-100ä¹‹é—´', [\r\n            { field: 'pageSize', message: 'é¡µé¢å¤§å°å¿…é¡»åœ¨1-100ä¹‹é—´' }\r\n          ]);\r\n        }\r\n      }\r\n\r\n      // æ„å»ºGraphQLæŸ¥è¯¢å’Œå˜é‡ (åŸºç¡€ç‰ˆæœ¬ï¼Œä¸å«æ—¶æ€å‚æ•°)\r\n      const useTemporalQuery = params?.temporalParams && Object.keys(params.temporalParams).length > 0;\r\n      \r\n      let graphqlQuery, variables;\r\n      \r\n      if (useTemporalQuery) {\r\n        // æ—¶æ€æŸ¥è¯¢ç‰ˆæœ¬\r\n        graphqlQuery = `\r\n          query GetOrganizations(\r\n            $first: Int, \r\n            $offset: Int, \r\n            $searchText: String,\r\n            $asOfDate: String,\r\n            $effectiveFrom: String,\r\n            $effectiveTo: String,\r\n            $temporalMode: String\r\n          ) {\r\n            organizations(\r\n              first: $first, \r\n              offset: $offset, \r\n              searchText: $searchText,\r\n              asOfDate: $asOfDate,\r\n              effectiveFrom: $effectiveFrom,\r\n              effectiveTo: $effectiveTo,\r\n              temporalMode: $temporalMode\r\n            ) {\r\n              code\r\n              name\r\n              unit_type\r\n              status\r\n              level\r\n              path\r\n              sort_order\r\n              description\r\n              parent_code\r\n              created_at\r\n              updated_at\r\n              effective_date\r\n              end_date\r\n              is_temporal\r\n            }\r\n            organizationStats {\r\n              totalCount\r\n            }\r\n          }\r\n        `;\r\n        variables = {\r\n          first: params?.pageSize || 50,\r\n          offset: ((params?.page || 1) - 1) * (params?.pageSize || 50),\r\n          searchText: params?.searchText || null,\r\n          asOfDate: params?.temporalParams?.asOfDate || null,\r\n          effectiveFrom: params?.temporalParams?.dateRange?.start || null,\r\n          effectiveTo: params?.temporalParams?.dateRange?.end || null,\r\n          temporalMode: params?.temporalParams?.mode || 'current'\r\n        };\r\n      } else {\r\n        // åŸºç¡€æŸ¥è¯¢ç‰ˆæœ¬ï¼ˆä¸å«æ—¶æ€å‚æ•°ï¼‰\r\n        graphqlQuery = `\r\n          query GetOrganizations(\r\n            $first: Int, \r\n            $offset: Int, \r\n            $searchText: String\r\n          ) {\r\n            organizations(\r\n              first: $first, \r\n              offset: $offset, \r\n              searchText: $searchText\r\n            ) {\r\n              code\r\n              name\r\n              unit_type\r\n              status\r\n              level\r\n              path\r\n              sort_order\r\n              description\r\n              parent_code\r\n              created_at\r\n              updated_at\r\n            }\r\n            organizationStats {\r\n              totalCount\r\n            }\r\n          }\r\n        `;\r\n        variables = {\r\n          first: params?.pageSize || 50,\r\n          offset: ((params?.page || 1) - 1) * (params?.pageSize || 50),\r\n          searchText: params?.searchText || null\r\n        };\r\n      }\r\n\r\n      const data = await graphqlClient.request<{\r\n        organizations: any[];\r\n        organizationStats: { totalCount: number };\r\n      }>(graphqlQuery, variables);\r\n\r\n      // ç®€åŒ–çš„æ•°æ®è½¬æ¢ - æ— éœ€å¤æ‚çš„ZodéªŒè¯\r\n      const organizations = data.organizations.map((org: any) => {\r\n        try {\r\n          return safeTransform.graphqlToOrganization ? \r\n            safeTransform.graphqlToOrganization(org) : \r\n            org; // ç›´æ¥è¿”å›åŸå§‹æ•°æ®ï¼Œä¾èµ–åç«¯æ ¼å¼\r\n        } catch (error) {\r\n          console.warn('Failed to transform organization:', org, error);\r\n          return null;\r\n        }\r\n      }).filter(Boolean);\r\n\r\n      // ğŸ”§ ä¿®å¤: åŒºåˆ†å…¨å±€æ€»æ•°å’Œç­›é€‰ç»“æœæ€»æ•°\r\n      const isFiltered = !!(params?.searchText || params?.unit_type || params?.status || params?.level || params?.temporalParams);\r\n      const filteredTotalCount = isFiltered ? organizations.length : data.organizationStats.totalCount;\r\n      \r\n      return {\r\n        organizations: organizations,\r\n        total_count: filteredTotalCount,\r\n        page: params?.page || 1,\r\n        page_size: organizations.length,\r\n        total_pages: Math.ceil(filteredTotalCount / (params?.pageSize || 50))\r\n      };\r\n\r\n    } catch (error) {\r\n      console.error('Error fetching organizations:', error);\r\n      \r\n      if (error instanceof SimpleValidationError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new Error('Failed to fetch organizations. Please try again.');\r\n    }\r\n  },\r\n\r\n  // æ ¹æ®ä»£ç è·å–å•ä¸ªç»„ç»‡ - âœ… ä¿®å¤åè®®è¿åï¼Œç»Ÿä¸€ä½¿ç”¨GraphQL (æ”¯æŒæ—¶æ€æŸ¥è¯¢)\r\n  getByCode: async (code: string, temporalParams?: TemporalQueryParams): Promise<OrganizationUnit> => {\r\n    try {\r\n      if (!code || typeof code !== 'string') {\r\n        throw new SimpleValidationError('Invalid organization code', [\r\n          { field: 'code', message: 'Code is required' }\r\n        ]);\r\n      }\r\n\r\n      // âœ… ä½¿ç”¨GraphQLæŸ¥è¯¢ï¼Œéµå¾ª\"æŸ¥è¯¢ç»Ÿä¸€ç”¨GraphQL\"åŸåˆ™ (åŸºç¡€ç‰ˆæœ¬)\r\n      const useTemporalQuery = temporalParams && Object.keys(temporalParams).length > 0;\r\n      \r\n      let graphqlQuery, variables;\r\n      \r\n      if (useTemporalQuery) {\r\n        // æ—¶æ€æŸ¥è¯¢ç‰ˆæœ¬\r\n        graphqlQuery = `\r\n          query GetOrganization(\r\n            $code: String!, \r\n            $asOfDate: String,\r\n            $temporalMode: String\r\n          ) {\r\n            organization(\r\n              code: $code, \r\n              asOfDate: $asOfDate,\r\n              temporalMode: $temporalMode\r\n            ) {\r\n              code\r\n              name\r\n              unit_type\r\n              status\r\n              level\r\n              path\r\n              sort_order\r\n              description\r\n              parent_code\r\n              created_at\r\n              updated_at\r\n              effective_date\r\n              end_date\r\n              is_temporal\r\n            }\r\n          }\r\n        `;\r\n        variables = {\r\n          code,\r\n          asOfDate: temporalParams?.asOfDate || null,\r\n          temporalMode: temporalParams?.mode || 'current'\r\n        };\r\n      } else {\r\n        // åŸºç¡€æŸ¥è¯¢ç‰ˆæœ¬ï¼ˆä¸å«æ—¶æ€å‚æ•°ï¼‰\r\n        graphqlQuery = `\r\n          query GetOrganization($code: String!) {\r\n            organization(code: $code) {\r\n              code\r\n              name\r\n              unit_type\r\n              status\r\n              level\r\n              path\r\n              sort_order\r\n              description\r\n              parent_code\r\n              created_at\r\n              updated_at\r\n            }\r\n          }\r\n        `;\r\n        variables = { code };\r\n      }\r\n\r\n      const data = await graphqlClient.request<{\r\n        organization: any;\r\n      }>(graphqlQuery, variables);\r\n\r\n      const organization = data.organization;\r\n      if (!organization) {\r\n        throw new Error(`ç»„ç»‡ ${code} ä¸å­˜åœ¨`);\r\n      }\r\n\r\n      // ç®€å•æ•°æ®è½¬æ¢ï¼Œä¾èµ–åç«¯æ ¼å¼\r\n      return safeTransform.graphqlToOrganization ? \r\n        safeTransform.graphqlToOrganization(organization) : \r\n        organization;\r\n\r\n    } catch (error: unknown) {\r\n      console.error('Error fetching organization by code:', code, error);\r\n      \r\n      if (error instanceof Error && 'response' in error && (error as any).response?.status === 404) {\r\n        throw new Error(`ç»„ç»‡ ${code} ä¸å­˜åœ¨`);\r\n      }\r\n      \r\n      throw new Error(`è·å–ç»„ç»‡ ${code} å¤±è´¥ï¼Œè¯·é‡è¯•`);\r\n    }\r\n  },\r\n\r\n  // è·å–ç»„ç»‡ç»Ÿè®¡ä¿¡æ¯ - ä½¿ç”¨GraphQL\r\n  getStats: async (): Promise<OrganizationStats> => {\r\n    try {\r\n      const graphqlQuery = `\r\n        query GetOrganizationStats {\r\n          organizationStats {\r\n            totalCount\r\n            byType {\r\n              unitType\r\n              count\r\n            }\r\n            byStatus {\r\n              status\r\n              count\r\n            }\r\n            byLevel {\r\n              level\r\n              count\r\n            }\r\n          }\r\n        }\r\n      `;\r\n\r\n      const data = await graphqlClient.request<{\r\n        organizationStats: any;\r\n      }>(graphqlQuery);\r\n\r\n      const stats = data.organizationStats;\r\n      if (!stats) {\r\n        throw new Error('No statistics data returned');\r\n      }\r\n\r\n      // ç®€åŒ–çš„æ•°æ®è½¬æ¢\r\n      return {\r\n        total_count: stats.totalCount || 0,\r\n        by_type: stats.byType?.reduce((acc: any, item: any) => {\r\n          acc[item.unitType] = item.count;\r\n          return acc;\r\n        }, {}) || {},\r\n        by_status: stats.byStatus?.reduce((acc: any, item: any) => {\r\n          acc[item.status] = item.count;\r\n          return acc;\r\n        }, {}) || {},\r\n        by_level: stats.byLevel?.reduce((acc: any, item: any) => {\r\n          acc[item.level] = item.count;\r\n          return acc;\r\n        }, {}) || {}\r\n      };\r\n\r\n    } catch (error) {\r\n      console.error('Error fetching organization stats:', error);\r\n      throw new Error('Failed to fetch organization statistics. Please try again.');\r\n    }\r\n  },\r\n\r\n  // åˆ›å»ºç»„ç»‡ - ä¾èµ–åç«¯ç»Ÿä¸€éªŒè¯\r\n  create: async (input: CreateOrganizationInput): Promise<any> => {\r\n    try {\r\n      // åŸºç¡€å‰ç«¯éªŒè¯ (ç”¨æˆ·ä½“éªŒ)\r\n      const validationResult = validateOrganizationBasic(input);\r\n      if (!validationResult.isValid) {\r\n        throw new SimpleValidationError(\r\n          'è¾“å…¥éªŒè¯å¤±è´¥ï¼š' + formatValidationErrors(validationResult.errors), \r\n          validationResult.errors\r\n        );\r\n      }\r\n\r\n      // è½¬æ¢ä¸ºAPIæ ¼å¼\r\n      const apiData = safeTransform.cleanCreateInput(input);\r\n\r\n      const response = await restClient.request<any>('/organization-units', {\r\n        method: 'POST',\r\n        body: JSON.stringify(apiData),\r\n      });\r\n      \r\n      // ç®€å•çš„å“åº”éªŒè¯\r\n      if (!response.code) {\r\n        throw new Error('Invalid response from server');\r\n      }\r\n\r\n      return response;\r\n\r\n    } catch (error: any) {\r\n      console.error('Error creating organization:', error);\r\n      \r\n      if (error instanceof SimpleValidationError) {\r\n        throw error;\r\n      }\r\n      if (error.message?.includes('REST Error:')) {\r\n        // æœåŠ¡å™¨ç«¯éªŒè¯é”™è¯¯\r\n        const serverMessage = error.message;\r\n        throw new Error(serverMessage || 'Failed to create organization');\r\n      }\r\n      \r\n      throw new Error('Failed to create organization. Please try again.');\r\n    }\r\n  },\r\n\r\n  // æ›´æ–°ç»„ç»‡ - æ™ºèƒ½éªŒè¯ï¼Œæ ¹æ®æ›´æ–°å†…å®¹é€‰æ‹©åˆé€‚çš„éªŒè¯ç­–ç•¥\r\n  update: async (code: string, input: UpdateOrganizationInput): Promise<any> => {\r\n    try {\r\n      if (!code) {\r\n        throw new SimpleValidationError('Organization code is required', [\r\n          { field: 'code', message: 'Code is required' }\r\n        ]);\r\n      }\r\n\r\n      // æ™ºèƒ½éªŒè¯ç­–ç•¥ï¼šæ ¹æ®æ›´æ–°çš„å­—æ®µé€‰æ‹©éªŒè¯æ–¹æ³•\r\n      let validationResult;\r\n      \r\n      const inputKeys = Object.keys(input);\r\n      const isStatusOnlyUpdate = inputKeys.length === 1 && inputKeys[0] === 'status';\r\n      \r\n      if (isStatusOnlyUpdate) {\r\n        // ä»…çŠ¶æ€æ›´æ–°ï¼Œä½¿ç”¨çŠ¶æ€ä¸“ç”¨éªŒè¯\r\n        console.log('[API] Status-only update detected, using validateStatusUpdate');\r\n        validationResult = validateStatusUpdate(input);\r\n      } else {\r\n        // å®Œæ•´æ›´æ–°ï¼Œä½¿ç”¨æ›´æ–°ä¸“ç”¨éªŒè¯ï¼ˆä¸éªŒè¯unit_typeï¼‰\r\n        console.log('[API] Full update detected, using validateOrganizationUpdate');\r\n        validationResult = validateOrganizationUpdate(input);\r\n      }\r\n      \r\n      if (!validationResult.isValid) {\r\n        throw new SimpleValidationError(\r\n          'è¾“å…¥éªŒè¯å¤±è´¥ï¼š' + formatValidationErrors(validationResult.errors),\r\n          validationResult.errors\r\n        );\r\n      }\r\n\r\n      // è½¬æ¢ä¸ºAPIæ ¼å¼\r\n      const apiData = safeTransform.cleanUpdateInput(input);\r\n\r\n      const response = await restClient.request<any>(`/organization-units/${code}`, {\r\n        method: 'PUT',\r\n        body: JSON.stringify(apiData),\r\n      });\r\n      \r\n      if (!response.code) {\r\n        throw new Error('Invalid response from server');\r\n      }\r\n\r\n      return response;\r\n\r\n    } catch (error: any) {\r\n      console.error('Error updating organization:', code, error);\r\n      \r\n      if (error instanceof SimpleValidationError) {\r\n        throw error;\r\n      }\r\n      if (error.message?.includes('REST Error:')) {\r\n        const serverMessage = error.message;\r\n        throw new Error(serverMessage || 'Failed to update organization');\r\n      }\r\n      \r\n      throw new Error('Failed to update organization. Please try again.');\r\n    }\r\n  },\r\n\r\n  // åˆ é™¤ç»„ç»‡\r\n  delete: async (code: string): Promise<void> => {\r\n    try {\r\n      if (!code) {\r\n        throw new SimpleValidationError('Organization code is required', [\r\n          { field: 'code', message: 'Code is required' }\r\n        ]);\r\n      }\r\n\r\n      await restClient.request<void>(`/organization-units/${code}`, {\r\n        method: 'DELETE'\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Error deleting organization:', code, error);\r\n      \r\n      if (error && typeof error === 'object' && 'message' in error && typeof error.message === 'string' && error.message.includes('REST Error:')) {\r\n        const serverMessage = error.message;\r\n        throw new Error(serverMessage || 'Failed to delete organization');\r\n      }\r\n      \r\n      throw new Error('Failed to delete organization. Please try again.');\r\n    }\r\n  },\r\n\r\n  // ====== æ—¶æ€ç®¡ç†APIæ–¹æ³• ======\r\n\r\n  // è·å–ç»„ç»‡çš„å†å²ç‰ˆæœ¬\r\n  getHistory: async (code: string, params?: TemporalQueryParams): Promise<TemporalOrganizationUnit[]> => {\r\n    try {\r\n      if (!code || typeof code !== 'string') {\r\n        throw new SimpleValidationError('Invalid organization code', [\r\n          { field: 'code', message: 'Code is required' }\r\n        ]);\r\n      }\r\n\r\n      const graphqlQuery = `\r\n        query GetOrganizationHistory(\r\n          $code: String!,\r\n          $dateFrom: String,\r\n          $dateTo: String,\r\n          $limit: Int\r\n        ) {\r\n          organizationHistory(\r\n            code: $code,\r\n            dateFrom: $dateFrom,\r\n            dateTo: $dateTo,\r\n            limit: $limit\r\n          ) {\r\n            code\r\n            name\r\n            unitType\r\n            status\r\n            level\r\n            path\r\n            sortOrder\r\n            description\r\n            parentCode\r\n            effectiveFrom\r\n            effectiveTo\r\n            isTemporal\r\n            changeReason\r\n            changedBy\r\n            createdAt\r\n            updatedAt\r\n          }\r\n        }\r\n      `;\r\n\r\n      const variables = {\r\n        code,\r\n        dateFrom: params?.dateRange?.start || null,\r\n        dateTo: params?.dateRange?.end || null,\r\n        limit: params?.limit || 50\r\n      };\r\n\r\n      const data = await graphqlClient.request<{\r\n        organizationHistory: any[];\r\n      }>(graphqlQuery, variables);\r\n\r\n      return data.organizationHistory || [];\r\n\r\n    } catch (error) {\r\n      console.error('Error fetching organization history:', code, error);\r\n      throw new Error(`è·å–ç»„ç»‡ ${code} å†å²è®°å½•å¤±è´¥ï¼Œè¯·é‡è¯•`);\r\n    }\r\n  },\r\n\r\n  // è·å–ç»„ç»‡çš„æ—¶é—´çº¿äº‹ä»¶\r\n  getTimeline: async (code: string, params?: TemporalQueryParams): Promise<TimelineEvent[]> => {\r\n    try {\r\n      if (!code || typeof code !== 'string') {\r\n        throw new SimpleValidationError('Invalid organization code', [\r\n          { field: 'code', message: 'Code is required' }\r\n        ]);\r\n      }\r\n\r\n      const graphqlQuery = `\r\n        query GetOrganizationTimeline(\r\n          $code: String!,\r\n          $dateFrom: String,\r\n          $dateTo: String,\r\n          $eventTypes: [String],\r\n          $limit: Int\r\n        ) {\r\n          organizationTimeline(\r\n            code: $code,\r\n            dateFrom: $dateFrom,\r\n            dateTo: $dateTo,\r\n            eventTypes: $eventTypes,\r\n            limit: $limit\r\n          ) {\r\n            id\r\n            organizationCode\r\n            eventType\r\n            eventDate\r\n            effectiveDate\r\n            status\r\n            title\r\n            description\r\n            metadata\r\n            previousValue\r\n            newValue\r\n            triggeredBy\r\n            approvedBy\r\n            createdAt\r\n          }\r\n        }\r\n      `;\r\n\r\n      const variables = {\r\n        code,\r\n        dateFrom: params?.dateRange?.start || null,\r\n        dateTo: params?.dateRange?.end || null,\r\n        eventTypes: params?.eventTypes || null,\r\n        limit: params?.limit || 100\r\n      };\r\n\r\n      const data = await graphqlClient.request<{\r\n        organizationTimeline: any[];\r\n      }>(graphqlQuery, variables);\r\n\r\n      return data.organizationTimeline || [];\r\n\r\n    } catch (error) {\r\n      console.error('Error fetching organization timeline:', code, error);\r\n      throw new Error(`è·å–ç»„ç»‡ ${code} æ—¶é—´çº¿å¤±è´¥ï¼Œè¯·é‡è¯•`);\r\n    }\r\n  },\r\n\r\n  // åˆ›å»ºæ—¶æ€ç»„ç»‡è®°å½•\r\n  createTemporal: async (input: CreateOrganizationInput & { \r\n    effectiveFrom: string; \r\n    effectiveTo?: string; \r\n    changeReason?: string;\r\n  }): Promise<any> => {\r\n    try {\r\n      // åŸºç¡€å‰ç«¯éªŒè¯\r\n      const validationResult = validateOrganizationBasic(input);\r\n      if (!validationResult.isValid) {\r\n        throw new SimpleValidationError(\r\n          'è¾“å…¥éªŒè¯å¤±è´¥ï¼š' + formatValidationErrors(validationResult.errors), \r\n          validationResult.errors\r\n        );\r\n      }\r\n\r\n      // è½¬æ¢ä¸ºAPIæ ¼å¼\r\n      const apiData = {\r\n        ...safeTransform.cleanCreateInput(input),\r\n        effective_date: input.effectiveDate,\r\n        end_date: input.endDate,\r\n        change_reason: input.changeReason,\r\n        is_temporal: true\r\n      };\r\n\r\n      const response = await restClient.request<any>('/organization-units/temporal', {\r\n        method: 'POST',\r\n        body: JSON.stringify(apiData),\r\n      });\r\n      \r\n      if (!response.code) {\r\n        throw new Error('Invalid response from server');\r\n      }\r\n\r\n      return response;\r\n\r\n    } catch (error: any) {\r\n      console.error('Error creating temporal organization:', error);\r\n      \r\n      if (error instanceof SimpleValidationError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new Error('Failed to create temporal organization. Please try again.');\r\n    }\r\n  },\r\n\r\n  // æ›´æ–°æ—¶æ€ç»„ç»‡è®°å½• - ä½¿ç”¨äº‹ä»¶é©±åŠ¨API\r\n  updateTemporal: async (code: string, input: UpdateOrganizationInput & {\r\n    effectiveDate?: string;\r\n    endDate?: string;\r\n    changeReason?: string;\r\n  }): Promise<any> => {\r\n    try {\r\n      if (!code) {\r\n        throw new SimpleValidationError('Organization code is required', [\r\n          { field: 'code', message: 'Code is required' }\r\n        ]);\r\n      }\r\n\r\n      // æ™ºèƒ½éªŒè¯ç­–ç•¥\r\n      const validationResult = validateOrganizationUpdate(input);\r\n      if (!validationResult.isValid) {\r\n        throw new SimpleValidationError(\r\n          'è¾“å…¥éªŒè¯å¤±è´¥ï¼š' + formatValidationErrors(validationResult.errors),\r\n          validationResult.errors\r\n        );\r\n      }\r\n\r\n      // è½¬æ¢ä¸ºäº‹ä»¶é©±åŠ¨APIæ ¼å¼ - ä¿®å¤æ—¥æœŸæ ¼å¼\r\n      const eventData = {\r\n        event_type: \"UPDATE\",\r\n        effective_date: input.effectiveDate ? new Date(input.effectiveDate + 'T00:00:00Z').toISOString() : new Date().toISOString(),\r\n        end_date: input.endDate ? new Date(input.endDate + 'T00:00:00Z').toISOString() : null,\r\n        change_data: safeTransform.cleanUpdateInput(input),\r\n        change_reason: input.changeReason || \"ç»„ç»‡ä¿¡æ¯æ›´æ–°\"\r\n      };\r\n\r\n      // ä½¿ç”¨äº‹ä»¶é©±åŠ¨ç«¯ç‚¹\r\n      const response = await restClient.request<any>(`/organization-units/${code}/events`, {\r\n        method: 'POST',\r\n        body: JSON.stringify(eventData),\r\n      });\r\n      \r\n      if (!response.event_id) {\r\n        throw new Error('Invalid response from server');\r\n      }\r\n\r\n      return response;\r\n\r\n    } catch (error: any) {\r\n      console.error('Error updating temporal organization:', code, error);\r\n      \r\n      if (error instanceof SimpleValidationError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new Error('Failed to update temporal organization. Please try again.');\r\n    }\r\n  }\r\n};\r\n\r\n// å¯¼å‡ºç®€åŒ–çš„API\r\nexport default organizationAPI;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/api/temporal-graphql-client.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'OrganizationUnit' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3675,3678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3675,3678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3890,3893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3890,3893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":170,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3939,3942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3939,3942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":201,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4891,4894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4891,4894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":237,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5889,5892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5889,5892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€ç®¡ç†GraphQLæŸ¥è¯¢å®¢æˆ·ç«¯\r\n * ä¸“é—¨ç”¨äºæ—¶æ€æŸ¥è¯¢åŠŸèƒ½ï¼šorganizationAsOfDate å’Œ organizationHistory\r\n */\r\nimport type { \r\n  OrganizationUnit, \r\n  GraphQLResponse,\r\n} from '../types';\r\nimport type { \r\n  TemporalQueryParams,\r\n  TemporalOrganizationUnit,\r\n  TimelineEvent\r\n} from '../types/temporal';\r\n\r\n// GraphQLç«¯ç‚¹ - ç›´æ¥è·¯ç”±åˆ°æ ‡å‡†GraphQLæœåŠ¡ï¼ˆ8090ç«¯å£ï¼‰\r\nconst TEMPORAL_GRAPHQL_ENDPOINT = '/graphql';\r\n\r\ninterface TemporalGraphQLClient {\r\n  request<T>(query: string, variables?: Record<string, unknown>): Promise<T>;\r\n}\r\n\r\nconst temporalGraphQLClient: TemporalGraphQLClient = {\r\n  async request<T>(query: string, variables?: Record<string, unknown>): Promise<T> {\r\n    const response = await fetch(TEMPORAL_GRAPHQL_ENDPOINT, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        query,\r\n        variables\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Temporal GraphQL Error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    const result = await response.json() as GraphQLResponse<T>;\r\n    \r\n    if (result.errors && result.errors.length > 0) {\r\n      throw new Error(`Temporal GraphQL Error: ${result.errors[0].message}`);\r\n    }\r\n\r\n    if (!result.data) {\r\n      throw new Error('Temporal GraphQL Error: No data returned');\r\n    }\r\n\r\n    return result.data;\r\n  }\r\n};\r\n\r\n// GraphQLæŸ¥è¯¢å®šä¹‰\r\nconst TEMPORAL_QUERIES = {\r\n  // æ—¶é—´ç‚¹æŸ¥è¯¢ - æŸ¥è¯¢ç‰¹å®šæ—¶é—´ç‚¹çš„ç»„ç»‡çŠ¶æ€\r\n  ORGANIZATION_AS_OF_DATE: `\r\n    query OrganizationAsOfDate($code: String!, $asOfDate: String!) {\r\n      organizationAsOfDate(code: $code, asOfDate: $asOfDate) {\r\n        tenant_id\r\n        code\r\n        parent_code\r\n        name\r\n        unit_type\r\n        status\r\n        level\r\n        path\r\n        sort_order\r\n        description\r\n        profile\r\n        created_at\r\n        updated_at\r\n        effective_date\r\n        end_date\r\n        version\r\n        is_current\r\n        change_reason\r\n        valid_from\r\n        valid_to\r\n      }\r\n    }\r\n  `,\r\n\r\n  // å†å²æŸ¥è¯¢ - æŸ¥è¯¢æ—¶é—´èŒƒå›´å†…çš„æ‰€æœ‰å†å²è®°å½•\r\n  ORGANIZATION_HISTORY: `\r\n    query OrganizationHistory($code: String!, $fromDate: String!, $toDate: String!) {\r\n      organizationHistory(code: $code, fromDate: $fromDate, toDate: $toDate) {\r\n        tenant_id\r\n        code\r\n        parent_code\r\n        name\r\n        unit_type\r\n        status\r\n        level\r\n        path\r\n        sort_order\r\n        description\r\n        profile\r\n        created_at\r\n        updated_at\r\n        effective_date\r\n        end_date\r\n        version\r\n        is_current\r\n        change_reason\r\n        valid_from\r\n        valid_to\r\n      }\r\n    }\r\n  `,\r\n\r\n  // ä¼ ç»ŸæŸ¥è¯¢ä¿æŒå…¼å®¹ - å½“å‰æ•°æ®\r\n  ORGANIZATIONS_CURRENT: `\r\n    query OrganizationsCurrent($first: Int, $offset: Int, $searchText: String) {\r\n      organizations(first: $first, offset: $offset, searchText: $searchText) {\r\n        tenant_id\r\n        code\r\n        parent_code\r\n        name\r\n        unit_type\r\n        status\r\n        level\r\n        path\r\n        sort_order\r\n        description\r\n        profile\r\n        created_at\r\n        updated_at\r\n        effective_date\r\n        end_date\r\n        version\r\n        is_current\r\n      }\r\n    }\r\n  `,\r\n\r\n  // å•ä¸ªç»„ç»‡æŸ¥è¯¢ - å½“å‰æ•°æ®\r\n  ORGANIZATION_CURRENT: `\r\n    query OrganizationCurrent($code: String!) {\r\n      organization(code: $code) {\r\n        tenant_id\r\n        code\r\n        parent_code\r\n        name\r\n        unit_type\r\n        status\r\n        level\r\n        path\r\n        sort_order\r\n        description\r\n        profile\r\n        created_at\r\n        updated_at\r\n        effective_date\r\n        end_date\r\n        version\r\n        is_current\r\n      }\r\n    }\r\n  `\r\n};\r\n\r\n// æ—¶æ€æ•°æ®è½¬æ¢å™¨\r\nfunction transformToTemporalOrganization(data: any): TemporalOrganizationUnit {\r\n  return {\r\n    tenant_id: data.tenant_id || '',\r\n    code: data.code || '',\r\n    parent_code: data.parent_code || '',\r\n    name: data.name || '',\r\n    unit_type: data.unit_type as any || 'DEPARTMENT',\r\n    status: data.status as any || 'ACTIVE',\r\n    level: data.level || 1,\r\n    path: data.path || '',\r\n    sort_order: data.sort_order || 0,\r\n    description: data.description || '',\r\n    profile: data.profile || '',\r\n    created_at: data.created_at || '',\r\n    updated_at: data.updated_at || '',\r\n    effective_date: data.effective_date || '',\r\n    end_date: data.end_date || undefined,\r\n    is_current: data.is_current ?? true,\r\n    change_reason: data.change_reason || undefined,\r\n    approved_by: undefined, // GraphQLä¸­æš‚æ— æ­¤å­—æ®µ\r\n    approved_at: undefined  // GraphQLä¸­æš‚æ— æ­¤å­—æ®µ\r\n  };\r\n}\r\n\r\n// æ—¶æ€APIå®¢æˆ·ç«¯\r\nexport const temporalAPI = {\r\n  /**\r\n   * æŸ¥è¯¢æŒ‡å®šæ—¶é—´ç‚¹çš„ç»„ç»‡çŠ¶æ€\r\n   * @param code ç»„ç»‡ä»£ç \r\n   * @param asOfDate æŸ¥è¯¢æ—¶é—´ç‚¹ (YYYY-MM-DDæ ¼å¼)\r\n   * @returns è¯¥æ—¶é—´ç‚¹æœ‰æ•ˆçš„ç»„ç»‡è®°å½•\r\n   */\r\n  async getOrganizationAsOfDate(\r\n    code: string, \r\n    asOfDate: string\r\n  ): Promise<TemporalOrganizationUnit | null> {\r\n    try {\r\n      const data = await temporalGraphQLClient.request<{\r\n        organizationAsOfDate: any | null;\r\n      }>(\r\n        TEMPORAL_QUERIES.ORGANIZATION_AS_OF_DATE,\r\n        { code, asOfDate }\r\n      );\r\n\r\n      if (!data.organizationAsOfDate) {\r\n        return null;\r\n      }\r\n\r\n      return transformToTemporalOrganization(data.organizationAsOfDate);\r\n    } catch (error) {\r\n      console.error(`æ—¶é—´ç‚¹æŸ¥è¯¢å¤±è´¥ [code=${code}, asOfDate=${asOfDate}]:`, error);\r\n      throw new Error(`æ— æ³•æŸ¥è¯¢æŒ‡å®šæ—¶é—´ç‚¹çš„ç»„ç»‡æ•°æ®: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * æŸ¥è¯¢ç»„ç»‡çš„å®Œæ•´å†å²è®°å½•\r\n   * @param code ç»„ç»‡ä»£ç \r\n   * @param params æŸ¥è¯¢å‚æ•°\r\n   * @returns æ—¶é—´èŒƒå›´å†…çš„æ‰€æœ‰å†å²è®°å½•ï¼ŒæŒ‰æ—¶é—´å€’åº\r\n   */\r\n  async getOrganizationHistory(\r\n    code: string,\r\n    params?: {\r\n      fromDate?: string;\r\n      toDate?: string;\r\n    }\r\n  ): Promise<TemporalOrganizationUnit[]> {\r\n    try {\r\n      // è®¾ç½®é»˜è®¤æ—¶é—´èŒƒå›´ - æŸ¥è¯¢æ‰€æœ‰å†å²è®°å½•\r\n      const fromDate = params?.fromDate || '2020-01-01';\r\n      const toDate = params?.toDate || '2050-01-01';\r\n\r\n      const data = await temporalGraphQLClient.request<{\r\n        organizationHistory: any[];\r\n      }>(\r\n        TEMPORAL_QUERIES.ORGANIZATION_HISTORY,\r\n        { code, fromDate, toDate }\r\n      );\r\n\r\n      return data.organizationHistory.map(transformToTemporalOrganization);\r\n    } catch (error) {\r\n      console.error(`å†å²æŸ¥è¯¢å¤±è´¥ [code=${code}]:`, error);\r\n      throw new Error(`æ— æ³•æŸ¥è¯¢ç»„ç»‡å†å²æ•°æ®: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * è·å–ç»„ç»‡çš„æ—¶é—´çº¿äº‹ä»¶ï¼ˆä»å†å²è®°å½•è½¬æ¢ï¼‰\r\n   * @param code ç»„ç»‡ä»£ç \r\n   * @param params æŸ¥è¯¢å‚æ•°\r\n   * @returns æ—¶é—´çº¿äº‹ä»¶åˆ—è¡¨\r\n   */\r\n  async getOrganizationTimeline(\r\n    code: string,\r\n    params?: TemporalQueryParams\r\n  ): Promise<TimelineEvent[]> {\r\n    try {\r\n      const history = await this.getOrganizationHistory(code, params);\r\n      \r\n      // å°†å†å²è®°å½•è½¬æ¢ä¸ºæ—¶é—´çº¿äº‹ä»¶\r\n      const timeline: TimelineEvent[] = history.map((record, index) => ({\r\n        id: `${record.code}-${record.effective_date}`,\r\n        eventType: index === 0 ? 'CREATE' : 'UPDATE',\r\n        eventDate: record.effective_date,\r\n        description: `${record.name} - ${record.change_reason || 'ç»„ç»‡å˜æ›´'}`,\r\n        organizationCode: record.code,\r\n        organizationName: record.name,\r\n        changedFields: [], // å¯ä»¥æ ¹æ®éœ€è¦è®¡ç®—å˜æ›´å­—æ®µ\r\n        metadata: {\r\n          status: record.status,\r\n          unit_type: record.unit_type,\r\n          effective_date: record.effective_date,\r\n          end_date: record.end_date,\r\n          is_current: record.is_current\r\n        }\r\n      }));\r\n\r\n      return timeline;\r\n    } catch (error) {\r\n      console.error(`æ—¶é—´çº¿æŸ¥è¯¢å¤±è´¥ [code=${code}]:`, error);\r\n      throw new Error(`æ— æ³•ç”Ÿæˆç»„ç»‡æ—¶é—´çº¿: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * æ‰¹é‡æ—¶é—´ç‚¹æŸ¥è¯¢ - æ”¯æŒå¤šä¸ªç»„ç»‡çš„åŒä¸€æ—¶é—´ç‚¹æŸ¥è¯¢\r\n   * @param codes ç»„ç»‡ä»£ç æ•°ç»„\r\n   * @param asOfDate æŸ¥è¯¢æ—¶é—´ç‚¹\r\n   * @returns æ—¶é—´ç‚¹æŸ¥è¯¢ç»“æœæ˜ å°„\r\n   */\r\n  async getBatchOrganizationsAsOfDate(\r\n    codes: string[],\r\n    asOfDate: string\r\n  ): Promise<Record<string, TemporalOrganizationUnit | null>> {\r\n    try {\r\n      const results = await Promise.allSettled(\r\n        codes.map(code => this.getOrganizationAsOfDate(code, asOfDate))\r\n      );\r\n\r\n      const resultMap: Record<string, TemporalOrganizationUnit | null> = {};\r\n      \r\n      codes.forEach((code, index) => {\r\n        const result = results[index];\r\n        if (result.status === 'fulfilled') {\r\n          resultMap[code] = result.value;\r\n        } else {\r\n          console.warn(`æ‰¹é‡æŸ¥è¯¢å¤±è´¥ [code=${code}]:`, result.reason);\r\n          resultMap[code] = null;\r\n        }\r\n      });\r\n\r\n      return resultMap;\r\n    } catch (error) {\r\n      console.error(`æ‰¹é‡æ—¶é—´ç‚¹æŸ¥è¯¢å¤±è´¥:`, error);\r\n      throw new Error(`æ‰¹é‡æŸ¥è¯¢å¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * è·å–ç»„ç»‡åœ¨ç‰¹å®šæ—¶é—´èŒƒå›´å†…çš„å˜æ›´ç»Ÿè®¡\r\n   * @param code ç»„ç»‡ä»£ç \r\n   * @param params æŸ¥è¯¢å‚æ•°\r\n   * @returns å˜æ›´ç»Ÿè®¡ä¿¡æ¯\r\n   */\r\n  async getOrganizationChangeStats(\r\n    code: string,\r\n    params?: {\r\n      fromDate?: string;\r\n      toDate?: string;\r\n    }\r\n  ): Promise<{\r\n    totalChanges: number;\r\n    changesByType: Record<string, number>;\r\n    firstChange: string;\r\n    lastChange: string;\r\n    averageChangeInterval: number; // å¤©æ•°\r\n  }> {\r\n    try {\r\n      const history = await this.getOrganizationHistory(code, params);\r\n      \r\n      if (history.length <= 1) {\r\n        return {\r\n          totalChanges: 0,\r\n          changesByType: {},\r\n          firstChange: '',\r\n          lastChange: '',\r\n          averageChangeInterval: 0\r\n        };\r\n      }\r\n\r\n      const changes = history.slice(1); // æ’é™¤å½“å‰è®°å½•\r\n      const changesByType: Record<string, number> = {};\r\n      \r\n      changes.forEach(change => {\r\n        const reason = change.change_reason || 'UNKNOWN';\r\n        changesByType[reason] = (changesByType[reason] || 0) + 1;\r\n      });\r\n\r\n      // è®¡ç®—å¹³å‡å˜æ›´é—´éš”\r\n      const dates = history.map(h => new Date(h.effective_date)).sort((a, b) => a.getTime() - b.getTime());\r\n      const intervals = dates.slice(1).map((date, index) => \r\n        (date.getTime() - dates[index].getTime()) / (1000 * 60 * 60 * 24) // è½¬æ¢ä¸ºå¤©æ•°\r\n      );\r\n      const averageChangeInterval = intervals.length > 0 \r\n        ? intervals.reduce((sum, interval) => sum + interval, 0) / intervals.length \r\n        : 0;\r\n\r\n      return {\r\n        totalChanges: changes.length,\r\n        changesByType,\r\n        firstChange: dates[0]?.toISOString().split('T')[0] || '',\r\n        lastChange: dates[dates.length - 1]?.toISOString().split('T')[0] || '',\r\n        averageChangeInterval: Math.round(averageChangeInterval)\r\n      };\r\n    } catch (error) {\r\n      console.error(`å˜æ›´ç»Ÿè®¡æŸ¥è¯¢å¤±è´¥ [code=${code}]:`, error);\r\n      throw new Error(`æ— æ³•è·å–å˜æ›´ç»Ÿè®¡: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);\r\n    }\r\n  }\r\n};\r\n\r\n// å¯¼å‡ºé»˜è®¤APIå’Œæ—¶æ€API\r\nexport default temporalAPI;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/api/type-guards.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3779,3782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3779,3782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3813,3816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3813,3816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4097,4100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4097,4100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4137,4140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4137,4140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4416,4419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4416,4419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4466,4469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4466,4469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { z } from 'zod';\r\nimport { \r\n  OrganizationUnitSchema, \r\n  CreateOrganizationInputSchema, \r\n  CreateOrganizationResponseSchema,\r\n  UpdateOrganizationInputSchema,\r\n  GraphQLVariablesSchema,\r\n  GraphQLOrganizationResponseSchema\r\n} from '../validation/schemas';\r\nimport type { CreateOrganizationInput } from '../hooks/useOrganizationMutations';\r\nimport type { \r\n  ValidatedOrganizationUnit,\r\n  ValidatedCreateOrganizationInput,\r\n  ValidatedCreateOrganizationResponse,\r\n  ValidatedUpdateOrganizationInput,\r\n  ValidatedGraphQLVariables,\r\n  ValidatedGraphQLOrganizationResponse \r\n} from '../validation/schemas';\r\nimport type { OrganizationUnit } from '../types/organization';\r\nimport type { GraphQLResponse, GraphQLError } from '../types/api';\r\n\r\n// éªŒè¯é”™è¯¯ç±»\r\nexport class ValidationError extends Error {\r\n  public readonly code: string = 'VALIDATION_ERROR';\r\n  public readonly details: z.ZodIssue[];\r\n  \r\n  constructor(message: string, details: z.ZodIssue[]) {\r\n    super(message);\r\n    this.name = 'ValidationError';\r\n    this.details = details;\r\n  }\r\n}\r\n\r\n// ç»„ç»‡å•å…ƒéªŒè¯å‡½æ•°\r\nexport const validateOrganizationUnit = (data: unknown): ValidatedOrganizationUnit => {\r\n  const result = OrganizationUnitSchema.safeParse(data);\r\n  if (!result.success) {\r\n    throw new ValidationError('Invalid organization unit data', result.error.issues);\r\n  }\r\n  return result.data;\r\n};\r\n\r\n// åˆ›å»ºç»„ç»‡è¾“å…¥éªŒè¯å‡½æ•°\r\nexport const validateCreateOrganizationInput = (data: unknown): ValidatedCreateOrganizationInput => {\r\n  const result = CreateOrganizationInputSchema.safeParse(data);\r\n  if (!result.success) {\r\n    throw new ValidationError('Invalid create organization input', result.error.issues);\r\n  }\r\n  return result.data;\r\n};\r\n\r\n// æ›´æ–°ç»„ç»‡è¾“å…¥éªŒè¯å‡½æ•°\r\nexport const validateUpdateOrganizationInput = (data: unknown): ValidatedUpdateOrganizationInput => {\r\n  const result = UpdateOrganizationInputSchema.safeParse(data);\r\n  if (!result.success) {\r\n    throw new ValidationError('Invalid update organization input', result.error.issues);\r\n  }\r\n  return result.data;\r\n};\r\n\r\n// åˆ›å»ºç»„ç»‡å“åº”éªŒè¯å‡½æ•°\r\nexport const validateCreateOrganizationResponse = (data: unknown): ValidatedCreateOrganizationResponse => {\r\n  const result = CreateOrganizationResponseSchema.safeParse(data);\r\n  if (!result.success) {\r\n    throw new ValidationError('Invalid create organization response', result.error.issues);\r\n  }\r\n  return result.data;\r\n};\r\n\r\n// GraphQLå˜é‡éªŒè¯å‡½æ•°\r\nexport const validateGraphQLVariables = (data: unknown): ValidatedGraphQLVariables => {\r\n  const result = GraphQLVariablesSchema.safeParse(data);\r\n  if (!result.success) {\r\n    throw new ValidationError('Invalid GraphQL variables', result.error.issues);\r\n  }\r\n  return result.data;\r\n};\r\n\r\n// GraphQLç»„ç»‡å“åº”éªŒè¯å‡½æ•°\r\nexport const validateGraphQLOrganizationResponse = (data: unknown): ValidatedGraphQLOrganizationResponse => {\r\n  const result = GraphQLOrganizationResponseSchema.safeParse(data);\r\n  if (!result.success) {\r\n    throw new ValidationError('Invalid GraphQL organization response', result.error.issues);\r\n  }\r\n  return result.data;\r\n};\r\n\r\n// æ‰¹é‡éªŒè¯GraphQLç»„ç»‡å“åº”\r\nexport const validateGraphQLOrganizationList = (data: unknown[]): ValidatedGraphQLOrganizationResponse[] => {\r\n  return data.map((item, index) => {\r\n    try {\r\n      return validateGraphQLOrganizationResponse(item);\r\n    } catch (error) {\r\n      throw new ValidationError(`Invalid organization data at index ${index}`, \r\n        error instanceof ValidationError ? error.details : [{ message: 'Unknown validation error', code: 'custom', path: [] }]);\r\n    }\r\n  });\r\n};\r\n\r\n// GraphQLå“åº”ç±»å‹å®ˆå«\r\nexport const isGraphQLError = (response: unknown): response is { errors: GraphQLError[] } => {\r\n  return (\r\n    typeof response === 'object' && \r\n    response !== null && \r\n    'errors' in response &&\r\n    Array.isArray((response as any).errors) &&\r\n    (response as any).errors.length > 0\r\n  );\r\n};\r\n\r\n// GraphQLæˆåŠŸå“åº”ç±»å‹å®ˆå«\r\nexport const isGraphQLSuccessResponse = <T>(\r\n  response: unknown\r\n): response is GraphQLResponse<T> => {\r\n  return (\r\n    typeof response === 'object' && \r\n    response !== null && \r\n    'data' in response &&\r\n    (response as any).data !== null &&\r\n    (response as any).data !== undefined\r\n  );\r\n};\r\n\r\n// APIé”™è¯¯ç±»å‹å®ˆå«\r\nexport const isAPIError = (error: unknown): error is Error & { status: number; statusText: string } => {\r\n  return (\r\n    error instanceof Error && \r\n    'status' in error && \r\n    'statusText' in error &&\r\n    typeof (error as any).status === 'number' &&\r\n    typeof (error as any).statusText === 'string'\r\n  );\r\n};\r\n\r\n// éªŒè¯é”™è¯¯ç±»å‹å®ˆå«\r\nexport const isValidationError = (error: unknown): error is ValidationError => {\r\n  return error instanceof ValidationError;\r\n};\r\n\r\n// ç½‘ç»œé”™è¯¯ç±»å‹å®ˆå«\r\nexport const isNetworkError = (error: unknown): error is TypeError => {\r\n  return error instanceof TypeError && error.message.includes('fetch');\r\n};\r\n\r\n// å®‰å…¨çš„ç±»å‹è½¬æ¢å‡½æ•° - å°†GraphQLå“åº”è½¬æ¢ä¸ºå‰ç«¯æœŸæœ›çš„æ ¼å¼\r\nexport const safeTransformGraphQLToOrganizationUnit = (\r\n  graphqlOrg: ValidatedGraphQLOrganizationResponse\r\n): OrganizationUnit => {\r\n  return {\r\n    code: graphqlOrg.code,\r\n    parent_code: graphqlOrg.parentCode || '',\r\n    name: graphqlOrg.name,\r\n    unit_type: graphqlOrg.unitType as OrganizationUnit['unit_type'],\r\n    status: graphqlOrg.status as OrganizationUnit['status'],\r\n    level: graphqlOrg.level,\r\n    path: graphqlOrg.path || '',\r\n    sort_order: graphqlOrg.sortOrder || 0,\r\n    description: graphqlOrg.description || '',\r\n    created_at: graphqlOrg.createdAt || '',\r\n    updated_at: graphqlOrg.updatedAt || '',\r\n  };\r\n};\r\n\r\n// å®‰å…¨çš„ç±»å‹è½¬æ¢å‡½æ•° - å°†å‰ç«¯è¾“å…¥è½¬æ¢ä¸ºAPIæ ¼å¼\r\nexport const safeTransformCreateInputToAPI = (\r\n  input: CreateOrganizationInput\r\n): Record<string, unknown> => {\r\n  const validated = validateCreateOrganizationInput(input);\r\n  \r\n  const apiPayload: Record<string, unknown> = {\r\n    name: validated.name,\r\n    unit_type: validated.unit_type,\r\n    status: validated.status,\r\n    level: validated.level,\r\n    sort_order: validated.sort_order,\r\n    description: validated.description,\r\n  };\r\n\r\n  // åªæ·»åŠ æœ‰å€¼çš„å¯é€‰å­—æ®µ\r\n  if (validated['code'] !== undefined) {\r\n    apiPayload.code = validated['code'];\r\n  }\r\n  if (validated['parent_code'] !== undefined && validated['parent_code'] !== '') {\r\n    apiPayload.parent_code = validated['parent_code'];\r\n  }\r\n\r\n  return apiPayload;\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/components/Badge.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'space' is defined but never used.","line":7,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Canvas Kitå…¼å®¹çš„Badgeç»„ä»¶\r\n * è§£å†³Canvas Kit 13.xç‰ˆæœ¬ä¸­Badgeç»„ä»¶å˜æ›´é—®é¢˜\r\n */\r\nimport React from 'react';\r\nimport styled from '@emotion/styled';\r\nimport { colors, space } from '@workday/canvas-kit-react/tokens';\r\n\r\nexport interface BadgeProps {\r\n  children: React.ReactNode;\r\n  variant?: 'positive' | 'caution' | 'negative' | 'neutral' | 'outline';\r\n  size?: 'small' | 'medium';\r\n  color?: string;\r\n}\r\n\r\nconst StyledBadge = styled.span<{\r\n  variant: BadgeProps['variant'];\r\n  size: BadgeProps['size'];\r\n  color?: string;\r\n}>`\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border-radius: 12px;\r\n  font-weight: 600;\r\n  line-height: 1;\r\n  white-space: nowrap;\r\n  \r\n  ${({ size }) => size === 'small' ? `\r\n    padding: 2px 6px;\r\n    font-size: 11px;\r\n    min-height: 16px;\r\n  ` : `\r\n    padding: 4px 8px;\r\n    font-size: 12px;\r\n    min-height: 20px;\r\n  `}\r\n  \r\n  ${({ variant, color }) => {\r\n    if (color) {\r\n      return `\r\n        background-color: ${color};\r\n        color: white;\r\n        border: 1px solid ${color};\r\n      `;\r\n    }\r\n    \r\n    switch (variant) {\r\n      case 'positive':\r\n        return `\r\n          background-color: ${colors.greenFresca100};\r\n          color: ${colors.greenFresca600};\r\n          border: 1px solid ${colors.greenFresca300};\r\n        `;\r\n      case 'caution':\r\n        return `\r\n          background-color: ${colors.cantaloupe100};\r\n          color: ${colors.cantaloupe600};\r\n          border: 1px solid ${colors.cantaloupe300};\r\n        `;\r\n      case 'negative':\r\n        return `\r\n          background-color: ${colors.cinnamon100};\r\n          color: ${colors.cinnamon600};\r\n          border: 1px solid ${colors.cinnamon300};\r\n        `;\r\n      case 'outline':\r\n        return `\r\n          background-color: transparent;\r\n          color: ${colors.licorice500};\r\n          border: 1px solid ${colors.licorice300};\r\n        `;\r\n      default: // neutral\r\n        return `\r\n          background-color: ${colors.licorice100};\r\n          color: ${colors.licorice600};\r\n          border: 1px solid ${colors.licorice300};\r\n        `;\r\n    }\r\n  }}\r\n`;\r\n\r\nexport const Badge: React.FC<BadgeProps> = ({ \r\n  children, \r\n  variant = 'neutral', \r\n  size = 'medium', \r\n  color \r\n}) => {\r\n  return (\r\n    <StyledBadge variant={variant} size={size} color={color}>\r\n      {children}\r\n    </StyledBadge>\r\n  );\r\n};\r\n\r\nexport default Badge;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/hooks/useDebounce.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/hooks/useOrganizationMutations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/hooks/useOrganizations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/hooks/useTemporalAPI.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useMutation' is defined but never used.","line":5,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€ç®¡ç†APIå®¢æˆ·ç«¯é’©å­ (çº¯æ—¥æœŸç”Ÿæ•ˆæ¨¡å‹)\r\n * è¿æ¥åˆ°ç«¯å£9091çš„æ—¶æ€ç®¡ç†æœåŠ¡\r\n */\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { useCallback } from 'react';\r\n\r\n// æ—¶æ€ç®¡ç†APIåŸºç¡€URL\r\nconst TEMPORAL_API_BASE = 'http://localhost:9091/api/v1';\r\n\r\n// æŸ¥è¯¢å‚æ•°æ¥å£ (çº¯æ—¥æœŸç”Ÿæ•ˆæ¨¡å‹)\r\nexport interface TemporalQueryParams {\r\n  as_of_date?: string;      // æ—¶é—´ç‚¹æŸ¥è¯¢ YYYY-MM-DD\r\n  effective_from?: string;  // æ—¶é—´èŒƒå›´å¼€å§‹ YYYY-MM-DD  \r\n  effective_to?: string;    // æ—¶é—´èŒƒå›´ç»“æŸ YYYY-MM-DD\r\n}\r\n\r\n// æ—¶æ€ç»„ç»‡è®°å½• (çº¯æ—¥æœŸç”Ÿæ•ˆæ¨¡å‹)\r\nexport interface TemporalOrganizationRecord {\r\n  tenant_id: string;\r\n  code: string;\r\n  name: string;\r\n  unit_type: string;\r\n  status: string;\r\n  level: number;\r\n  path: string;\r\n  sort_order: number;\r\n  description?: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n  effective_date: string;   // ç”Ÿæ•ˆæ—¥æœŸ\r\n  end_date?: string;        // ç»“æŸæ—¥æœŸ (å¯é€‰)\r\n  is_current: boolean;      // æ˜¯å¦å½“å‰æœ‰æ•ˆ\r\n  change_reason?: string;   // å˜æ›´åŸå› \r\n  approved_by?: string;     // æ‰¹å‡†äºº\r\n  approved_at?: string;     // æ‰¹å‡†æ—¶é—´\r\n}\r\n\r\n// æ—¶æ€æŸ¥è¯¢å“åº”\r\nexport interface TemporalQueryResponse {\r\n  organizations: TemporalOrganizationRecord[];\r\n  queried_at: string;\r\n  query_options: TemporalQueryParams;\r\n  result_count: number;\r\n}\r\n\r\n// å¥åº·æ£€æŸ¥å“åº”\r\nexport interface TemporalHealthResponse {\r\n  service: string;\r\n  status: string;\r\n  features: string[];\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * æ—¶æ€ç®¡ç†æœåŠ¡å¥åº·æ£€æŸ¥\r\n */\r\nexport function useTemporalHealth() {\r\n  return useQuery({\r\n    queryKey: ['temporal', 'health'],\r\n    queryFn: async (): Promise<TemporalHealthResponse> => {\r\n      const response = await fetch(`${TEMPORAL_API_BASE.replace('/api/v1', '')}/health`);\r\n      if (!response.ok) {\r\n        throw new Error('æ—¶æ€ç®¡ç†æœåŠ¡ä¸å¯ç”¨');\r\n      }\r\n      return response.json();\r\n    },\r\n    staleTime: 30 * 1000, // 30ç§’å†…è®¤ä¸ºæ•°æ®æ–°é²œ\r\n    gcTime: 60 * 1000, // ç¼“å­˜1åˆ†é’Ÿ\r\n    retry: 3,\r\n  });\r\n}\r\n\r\n/**\r\n * æ—¶é—´ç‚¹æŸ¥è¯¢é’©å­\r\n */\r\nexport function useTemporalAsOfDateQuery(organizationCode: string, asOfDate: string, enabled = true) {\r\n  return useQuery({\r\n    queryKey: ['temporal', 'asOfDate', organizationCode, asOfDate],\r\n    queryFn: async (): Promise<TemporalQueryResponse> => {\r\n      const url = `${TEMPORAL_API_BASE}/organization-units/${organizationCode}/temporal?as_of_date=${asOfDate}`;\r\n      const response = await fetch(url);\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.message || 'æ—¶æ€æŸ¥è¯¢å¤±è´¥');\r\n      }\r\n      \r\n      return response.json();\r\n    },\r\n    enabled: enabled && !!organizationCode && !!asOfDate,\r\n    staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿå†…è®¤ä¸ºæ•°æ®æ–°é²œ\r\n    gcTime: 10 * 60 * 1000, // ç¼“å­˜10åˆ†é’Ÿ\r\n  });\r\n}\r\n\r\n/**\r\n * æ—¶é—´èŒƒå›´æŸ¥è¯¢é’©å­\r\n */\r\nexport function useTemporalDateRangeQuery(\r\n  organizationCode: string, \r\n  effectiveFrom: string, \r\n  effectiveTo: string,\r\n  enabled = true\r\n) {\r\n  return useQuery({\r\n    queryKey: ['temporal', 'dateRange', organizationCode, effectiveFrom, effectiveTo],\r\n    queryFn: async (): Promise<TemporalQueryResponse> => {\r\n      const url = `${TEMPORAL_API_BASE}/organization-units/${organizationCode}/temporal?effective_from=${effectiveFrom}&effective_to=${effectiveTo}`;\r\n      const response = await fetch(url);\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.message || 'æ—¶æ€èŒƒå›´æŸ¥è¯¢å¤±è´¥');\r\n      }\r\n      \r\n      return response.json();\r\n    },\r\n    enabled: enabled && !!organizationCode && !!effectiveFrom && !!effectiveTo,\r\n    staleTime: 5 * 60 * 1000,\r\n    gcTime: 10 * 60 * 1000,\r\n  });\r\n}\r\n\r\n/**\r\n * æ—¶æ€æŸ¥è¯¢å·¥å…·é’©å­\r\n */\r\nexport function useTemporalQueryUtils() {\r\n  const queryClient = useQueryClient();\r\n\r\n  // æ¸…é™¤æ—¶æ€æŸ¥è¯¢ç¼“å­˜\r\n  const clearTemporalCache = useCallback(async () => {\r\n    await queryClient.invalidateQueries({ queryKey: ['temporal'] });\r\n  }, [queryClient]);\r\n\r\n  // é¢„å–ç»„ç»‡çš„æ—¶æ€æ•°æ®\r\n  const prefetchTemporalData = useCallback(async (\r\n    organizationCode: string,\r\n    params: TemporalQueryParams\r\n  ) => {\r\n    if (params.as_of_date) {\r\n      await queryClient.prefetchQuery({\r\n        queryKey: ['temporal', 'asOfDate', organizationCode, params.as_of_date],\r\n        queryFn: async () => {\r\n          const url = `${TEMPORAL_API_BASE}/organization-units/${organizationCode}/temporal?as_of_date=${params.as_of_date}`;\r\n          const response = await fetch(url);\r\n          return response.json();\r\n        },\r\n        staleTime: 5 * 60 * 1000,\r\n      });\r\n    }\r\n    \r\n    if (params.effective_from && params.effective_to) {\r\n      await queryClient.prefetchQuery({\r\n        queryKey: ['temporal', 'dateRange', organizationCode, params.effective_from, params.effective_to],\r\n        queryFn: async () => {\r\n          const url = `${TEMPORAL_API_BASE}/organization-units/${organizationCode}/temporal?effective_from=${params.effective_from}&effective_to=${params.effective_to}`;\r\n          const response = await fetch(url);\r\n          return response.json();\r\n        },\r\n        staleTime: 5 * 60 * 1000,\r\n      });\r\n    }\r\n  }, [queryClient]);\r\n\r\n  // æ ¼å¼åŒ–æ—¥æœŸä¸ºAPIéœ€è¦çš„æ ¼å¼\r\n  const formatDateForAPI = useCallback((date: Date): string => {\r\n    return date.toISOString().slice(0, 10); // YYYY-MM-DD\r\n  }, []);\r\n\r\n  // è§£æAPIè¿”å›çš„æ—¥æœŸ\r\n  const parseAPIDate = useCallback((dateString: string): Date => {\r\n    return new Date(dateString);\r\n  }, []);\r\n\r\n  // æ£€æŸ¥è®°å½•æ˜¯å¦åœ¨æŒ‡å®šæ—¶é—´ç‚¹æœ‰æ•ˆ\r\n  const isRecordValidAt = useCallback((record: TemporalOrganizationRecord, date: Date): boolean => {\r\n    const effectiveDate = new Date(record.effective_date);\r\n    const endDate = record.end_date ? new Date(record.end_date) : null;\r\n    \r\n    return effectiveDate <= date && (!endDate || date < endDate);\r\n  }, []);\r\n\r\n  // è·å–è®°å½•çš„æœ‰æ•ˆæœŸæè¿°\r\n  const getRecordValidityDescription = useCallback((record: TemporalOrganizationRecord): string => {\r\n    const effectiveDate = new Date(record.effective_date);\r\n    const endDate = record.end_date ? new Date(record.end_date) : null;\r\n    \r\n    const effectiveDateStr = effectiveDate.toLocaleDateString('zh-CN');\r\n    \r\n    if (endDate) {\r\n      const endDateStr = endDate.toLocaleDateString('zh-CN');\r\n      return `${effectiveDateStr} - ${endDateStr}`;\r\n    } else {\r\n      return `${effectiveDateStr} èµ·ç”Ÿæ•ˆ`;\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    clearTemporalCache,\r\n    prefetchTemporalData,\r\n    formatDateForAPI,\r\n    parseAPIDate,\r\n    isRecordValidAt,\r\n    getRecordValidityDescription,\r\n  };\r\n}\r\n\r\n/**\r\n * æ—¶æ€æŸ¥è¯¢ç»Ÿè®¡é’©å­\r\n */\r\nexport function useTemporalQueryStats() {\r\n  const queryClient = useQueryClient();\r\n  \r\n  // è·å–ç¼“å­˜ç»Ÿè®¡\r\n  const getCacheStats = useCallback(() => {\r\n    const queryCache = queryClient.getQueryCache();\r\n    const temporalQueries = queryCache.findAll({ queryKey: ['temporal'] });\r\n    \r\n    return {\r\n      totalQueries: temporalQueries.length,\r\n      cachedQueries: temporalQueries.filter(q => q.state.data).length,\r\n      failedQueries: temporalQueries.filter(q => q.state.error).length,\r\n      loadingQueries: temporalQueries.filter(q => q.state.isFetching).length,\r\n    };\r\n  }, [queryClient]);\r\n  \r\n  return {\r\n    getCacheStats,\r\n  };\r\n}\r\n\r\n// é”™è¯¯ç±»å‹\r\nexport class TemporalAPIError extends Error {\r\n  constructor(\r\n    message: string,\r\n    public errorCode?: string,\r\n    public details?: string\r\n  ) {\r\n    super(message);\r\n    this.name = 'TemporalAPIError';\r\n  }\r\n}\r\n\r\n// å¯¼å‡ºå¸¸ç”¨æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°\r\nexport const TemporalDateUtils = {\r\n  today: () => new Date().toISOString().slice(0, 10),\r\n  yesterday: () => {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() - 1);\r\n    return date.toISOString().slice(0, 10);\r\n  },\r\n  nextWeek: () => {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() + 7);\r\n    return date.toISOString().slice(0, 10);\r\n  },\r\n  startOfMonth: () => {\r\n    const date = new Date();\r\n    date.setDate(1);\r\n    return date.toISOString().slice(0, 10);\r\n  },\r\n  endOfMonth: () => {\r\n    const date = new Date();\r\n    date.setMonth(date.getMonth() + 1, 0);\r\n    return date.toISOString().slice(0, 10);\r\n  },\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/hooks/useTemporalGraphQL.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TemporalMode' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":230,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6717,6720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6717,6720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":326,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9661,9664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9661,9664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":327,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":327,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9685,9688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9685,9688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":341,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10045,10048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10045,10048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":342,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10096,10099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10096,10099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€ç®¡ç†Reacté’©å­ - åŸºäºGraphQLæ—¶æ€æŸ¥è¯¢\r\n * æä¾›organizationAsOfDateå’ŒorganizationHistoryçš„Reacté›†æˆ\r\n */\r\nimport { useCallback } from 'react';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport type { UseQueryResult } from '@tanstack/react-query';\r\nimport temporalAPI from '../api/temporal-graphql-client';\r\nimport type { \r\n  TemporalQueryParams,\r\n  TemporalOrganizationUnit,\r\n  TimelineEvent,\r\n  TemporalMode\r\n} from '../types/temporal';\r\n\r\n// æ—¶æ€æŸ¥è¯¢é”®ç”Ÿæˆå™¨\r\nconst TEMPORAL_QUERY_KEYS = {\r\n  temporal: ['temporal'] as const,\r\n  asOfDate: (code: string, asOfDate: string) => \r\n    [...TEMPORAL_QUERY_KEYS.temporal, 'asOfDate', code, asOfDate] as const,\r\n  history: (code: string, fromDate?: string, toDate?: string) => \r\n    [...TEMPORAL_QUERY_KEYS.temporal, 'history', code, fromDate, toDate] as const,\r\n  timeline: (code: string, params?: TemporalQueryParams) => \r\n    [...TEMPORAL_QUERY_KEYS.temporal, 'timeline', code, params] as const,\r\n  stats: (code: string, fromDate?: string, toDate?: string) => \r\n    [...TEMPORAL_QUERY_KEYS.temporal, 'stats', code, fromDate, toDate] as const,\r\n  batch: (codes: string[], asOfDate: string) => \r\n    [...TEMPORAL_QUERY_KEYS.temporal, 'batch', codes.sort().join(','), asOfDate] as const,\r\n};\r\n\r\n// ç¼“å­˜é…ç½®\r\nconst TEMPORAL_CACHE_CONFIG = {\r\n  staleTime: 10 * 60 * 1000, // 10åˆ†é’Ÿ - å†å²æ•°æ®æ›´ç¨³å®š\r\n  gcTime: 30 * 60 * 1000,    // 30åˆ†é’Ÿ\r\n  refetchOnWindowFocus: false,\r\n  refetchOnMount: false,      // å†å²æ•°æ®ä¸éœ€è¦é‡æ–°åŠ è½½\r\n  retry: 2,\r\n};\r\n\r\n/**\r\n * æ—¶é—´ç‚¹æŸ¥è¯¢é’©å­ - æŸ¥è¯¢ç‰¹å®šæ—¶é—´ç‚¹çš„ç»„ç»‡çŠ¶æ€\r\n */\r\nexport function useOrganizationAsOfDate(\r\n  code: string,\r\n  asOfDate: string,\r\n  options?: {\r\n    enabled?: boolean;\r\n    onSuccess?: (data: TemporalOrganizationUnit | null) => void;\r\n    onError?: (error: Error) => void;\r\n  }\r\n): UseQueryResult<TemporalOrganizationUnit | null> & {\r\n  hasData: boolean;\r\n  isEmpty: boolean;\r\n  isHistoricalRecord: boolean;\r\n} {\r\n  const query = useQuery({\r\n    queryKey: TEMPORAL_QUERY_KEYS.asOfDate(code, asOfDate),\r\n    queryFn: () => temporalAPI.getOrganizationAsOfDate(code, asOfDate),\r\n    ...TEMPORAL_CACHE_CONFIG,\r\n    enabled: !!(code && asOfDate && options?.enabled !== false),\r\n    onSuccess: options?.onSuccess,\r\n    onError: options?.onError,\r\n  });\r\n\r\n  const hasData = !!query.data;\r\n  const isEmpty = !query.isLoading && !query.data;\r\n  const isHistoricalRecord = hasData ? !query.data!.is_current : false;\r\n\r\n  return {\r\n    ...query,\r\n    hasData,\r\n    isEmpty,\r\n    isHistoricalRecord\r\n  };\r\n}\r\n\r\n/**\r\n * ç»„ç»‡å†å²æŸ¥è¯¢é’©å­ - æŸ¥è¯¢å®Œæ•´å†å²è®°å½•\r\n */\r\nexport function useOrganizationHistory(\r\n  code: string,\r\n  params?: {\r\n    fromDate?: string;\r\n    toDate?: string;\r\n    enabled?: boolean;\r\n  }\r\n): UseQueryResult<TemporalOrganizationUnit[]> & {\r\n  hasHistory: boolean;\r\n  historyCount: number;\r\n  latestRecord: TemporalOrganizationUnit | undefined;\r\n  currentRecord: TemporalOrganizationUnit | undefined;\r\n  historicalRecords: TemporalOrganizationUnit[];\r\n} {\r\n  const { fromDate, toDate, enabled = true } = params || {};\r\n\r\n  const query = useQuery({\r\n    queryKey: TEMPORAL_QUERY_KEYS.history(code, fromDate, toDate),\r\n    queryFn: () => temporalAPI.getOrganizationHistory(code, { fromDate, toDate }),\r\n    ...TEMPORAL_CACHE_CONFIG,\r\n    enabled: !!(code && enabled),\r\n  });\r\n\r\n  const historyCount = query.data?.length || 0;\r\n  const hasHistory = historyCount > 0;\r\n  const latestRecord = query.data?.[0]; // æŒ‰æ—¶é—´å€’åºï¼Œç¬¬ä¸€ä¸ªæ˜¯æœ€æ–°çš„\r\n  const currentRecord = query.data?.find(record => record.is_current);\r\n  const historicalRecords = query.data?.filter(record => !record.is_current) || [];\r\n\r\n  return {\r\n    ...query,\r\n    hasHistory,\r\n    historyCount,\r\n    latestRecord,\r\n    currentRecord,\r\n    historicalRecords\r\n  };\r\n}\r\n\r\n/**\r\n * ç»„ç»‡æ—¶é—´çº¿æŸ¥è¯¢é’©å­ - åŸºäºå†å²è®°å½•ç”Ÿæˆæ—¶é—´çº¿\r\n */\r\nexport function useOrganizationTimeline(\r\n  code: string,\r\n  params?: TemporalQueryParams & { enabled?: boolean }\r\n): UseQueryResult<TimelineEvent[]> & {\r\n  hasEvents: boolean;\r\n  eventCount: number;\r\n  latestEvent: TimelineEvent | undefined;\r\n  eventsGroupedByYear: Record<string, TimelineEvent[]>;\r\n} {\r\n  const { enabled = true, ...timelineParams } = params || {};\r\n\r\n  const query = useQuery({\r\n    queryKey: TEMPORAL_QUERY_KEYS.timeline(code, timelineParams),\r\n    queryFn: () => temporalAPI.getOrganizationTimeline(code, timelineParams),\r\n    ...TEMPORAL_CACHE_CONFIG,\r\n    enabled: !!(code && enabled),\r\n  });\r\n\r\n  const eventCount = query.data?.length || 0;\r\n  const hasEvents = eventCount > 0;\r\n  const latestEvent = query.data?.[0]; // æœ€æ–°äº‹ä»¶\r\n\r\n  // æŒ‰å¹´ä»½åˆ†ç»„äº‹ä»¶\r\n  const eventsGroupedByYear = query.data?.reduce((groups, event) => {\r\n    const year = new Date(event.eventDate).getFullYear().toString();\r\n    if (!groups[year]) {\r\n      groups[year] = [];\r\n    }\r\n    groups[year].push(event);\r\n    return groups;\r\n  }, {} as Record<string, TimelineEvent[]>) || {};\r\n\r\n  return {\r\n    ...query,\r\n    hasEvents,\r\n    eventCount,\r\n    latestEvent,\r\n    eventsGroupedByYear\r\n  };\r\n}\r\n\r\n/**\r\n * æ‰¹é‡æ—¶é—´ç‚¹æŸ¥è¯¢é’©å­ - å¤šä¸ªç»„ç»‡çš„åŒä¸€æ—¶é—´ç‚¹æŸ¥è¯¢\r\n */\r\nexport function useBatchOrganizationsAsOfDate(\r\n  codes: string[],\r\n  asOfDate: string,\r\n  options?: {\r\n    enabled?: boolean;\r\n    onSuccess?: (data: Record<string, TemporalOrganizationUnit | null>) => void;\r\n  }\r\n): UseQueryResult<Record<string, TemporalOrganizationUnit | null>> & {\r\n  successCount: number;\r\n  failureCount: number;\r\n  hasAnyData: boolean;\r\n} {\r\n  const query = useQuery({\r\n    queryKey: TEMPORAL_QUERY_KEYS.batch(codes, asOfDate),\r\n    queryFn: () => temporalAPI.getBatchOrganizationsAsOfDate(codes, asOfDate),\r\n    ...TEMPORAL_CACHE_CONFIG,\r\n    enabled: !!(codes.length > 0 && asOfDate && options?.enabled !== false),\r\n    onSuccess: options?.onSuccess,\r\n  });\r\n\r\n  const successCount = Object.values(query.data || {}).filter(Boolean).length;\r\n  const failureCount = Object.values(query.data || {}).filter(data => data === null).length;\r\n  const hasAnyData = successCount > 0;\r\n\r\n  return {\r\n    ...query,\r\n    successCount,\r\n    failureCount,\r\n    hasAnyData\r\n  };\r\n}\r\n\r\n/**\r\n * ç»„ç»‡å˜æ›´ç»Ÿè®¡é’©å­\r\n */\r\nexport function useOrganizationChangeStats(\r\n  code: string,\r\n  params?: {\r\n    fromDate?: string;\r\n    toDate?: string;\r\n    enabled?: boolean;\r\n  }\r\n) {\r\n  const { fromDate, toDate, enabled = true } = params || {};\r\n\r\n  const query = useQuery({\r\n    queryKey: TEMPORAL_QUERY_KEYS.stats(code, fromDate, toDate),\r\n    queryFn: () => temporalAPI.getOrganizationChangeStats(code, { fromDate, toDate }),\r\n    ...TEMPORAL_CACHE_CONFIG,\r\n    enabled: !!(code && enabled),\r\n  });\r\n\r\n  return query;\r\n}\r\n\r\n/**\r\n * æ—¶æ€æŸ¥è¯¢ç¼“å­˜ç®¡ç†é’©å­\r\n */\r\nexport function useTemporalCacheManager() {\r\n  const queryClient = useQueryClient();\r\n\r\n  const invalidateAsOfDateCache = useCallback(\r\n    (code?: string) => {\r\n      const queryKey = code \r\n        ? TEMPORAL_QUERY_KEYS.asOfDate(code, '*' as any)\r\n        : TEMPORAL_QUERY_KEYS.temporal;\r\n      return queryClient.invalidateQueries({ queryKey });\r\n    },\r\n    [queryClient]\r\n  );\r\n\r\n  const invalidateHistoryCache = useCallback(\r\n    (code?: string) => {\r\n      const queryKey = code\r\n        ? TEMPORAL_QUERY_KEYS.history(code)\r\n        : TEMPORAL_QUERY_KEYS.temporal;\r\n      return queryClient.invalidateQueries({ queryKey });\r\n    },\r\n    [queryClient]\r\n  );\r\n\r\n  const clearAllTemporalCache = useCallback(\r\n    () => {\r\n      return queryClient.invalidateQueries({ queryKey: TEMPORAL_QUERY_KEYS.temporal });\r\n    },\r\n    [queryClient]\r\n  );\r\n\r\n  const prefetchAsOfDate = useCallback(\r\n    (code: string, asOfDate: string) => {\r\n      return queryClient.prefetchQuery({\r\n        queryKey: TEMPORAL_QUERY_KEYS.asOfDate(code, asOfDate),\r\n        queryFn: () => temporalAPI.getOrganizationAsOfDate(code, asOfDate),\r\n        ...TEMPORAL_CACHE_CONFIG\r\n      });\r\n    },\r\n    [queryClient]\r\n  );\r\n\r\n  const prefetchHistory = useCallback(\r\n    (code: string, params?: { fromDate?: string; toDate?: string }) => {\r\n      return queryClient.prefetchQuery({\r\n        queryKey: TEMPORAL_QUERY_KEYS.history(code, params?.fromDate, params?.toDate),\r\n        queryFn: () => temporalAPI.getOrganizationHistory(code, params),\r\n        ...TEMPORAL_CACHE_CONFIG\r\n      });\r\n    },\r\n    [queryClient]\r\n  );\r\n\r\n  return {\r\n    invalidateAsOfDateCache,\r\n    invalidateHistoryCache,\r\n    clearAllTemporalCache,\r\n    prefetchAsOfDate,\r\n    prefetchHistory\r\n  };\r\n}\r\n\r\n/**\r\n * æ—¶æ€æŸ¥è¯¢å·¥å…·é’©å­ - æä¾›å¸¸ç”¨çš„æ—¶æ€æŸ¥è¯¢è¾…åŠ©åŠŸèƒ½\r\n */\r\nexport function useTemporalQueryUtils() {\r\n  // ç”Ÿæˆå¸¸ç”¨çš„æ—¶é—´ç‚¹\r\n  const getCommonDatePoints = useCallback(() => {\r\n    const now = new Date();\r\n    const currentYear = now.getFullYear();\r\n    \r\n    return {\r\n      today: now.toISOString().split('T')[0],\r\n      yesterday: new Date(now.getTime() - 24 * 60 * 60 * 1000).toISOString().split('T')[0],\r\n      lastWeek: new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\r\n      lastMonth: new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\r\n      yearStart: `${currentYear}-01-01`,\r\n      lastYearEnd: `${currentYear - 1}-12-31`,\r\n    };\r\n  }, []);\r\n\r\n  // æ ¼å¼åŒ–æ—¶æ€æŸ¥è¯¢ç»“æœç”¨äºå±•ç¤º\r\n  const formatTemporalRecord = useCallback(\r\n    (record: TemporalOrganizationUnit) => {\r\n      return {\r\n        displayName: record.name,\r\n        effectivePeriod: record.end_date \r\n          ? `${record.effective_date} è‡³ ${record.end_date}`\r\n          : `${record.effective_date} èµ·ç”Ÿæ•ˆ`,\r\n        status: record.is_current ? 'å½“å‰æœ‰æ•ˆ' : 'å†å²è®°å½•',\r\n        changeReason: record.change_reason || 'æ— å˜æ›´è¯´æ˜',\r\n        organizationType: record.unit_type,\r\n        organizationStatus: record.status\r\n      };\r\n    },\r\n    []\r\n  );\r\n\r\n  // æ¯”è¾ƒä¸¤ä¸ªæ—¶æ€è®°å½•çš„å·®å¼‚\r\n  const compareRecords = useCallback(\r\n    (record1: TemporalOrganizationUnit, record2: TemporalOrganizationUnit) => {\r\n      const changes: Array<{\r\n        field: string;\r\n        oldValue: any;\r\n        newValue: any;\r\n        displayName: string;\r\n      }> = [];\r\n\r\n      const fieldMappings = {\r\n        name: 'ç»„ç»‡åç§°',\r\n        unit_type: 'ç»„ç»‡ç±»å‹',\r\n        status: 'çŠ¶æ€',\r\n        parent_code: 'ä¸Šçº§ç»„ç»‡',\r\n        description: 'æè¿°',\r\n        level: 'çº§åˆ«'\r\n      };\r\n\r\n      Object.entries(fieldMappings).forEach(([field, displayName]) => {\r\n        const oldValue = (record1 as any)[field];\r\n        const newValue = (record2 as any)[field];\r\n        \r\n        if (oldValue !== newValue) {\r\n          changes.push({\r\n            field,\r\n            oldValue,\r\n            newValue,\r\n            displayName\r\n          });\r\n        }\r\n      });\r\n\r\n      return changes;\r\n    },\r\n    []\r\n  );\r\n\r\n  return {\r\n    getCommonDatePoints,\r\n    formatTemporalRecord,\r\n    compareRecords\r\n  };\r\n}\r\n\r\n// å¯¼å‡ºæŸ¥è¯¢é”®å’Œç¼“å­˜é…ç½®ä¾›å¤–éƒ¨ä½¿ç”¨\r\nexport {\r\n  TEMPORAL_QUERY_KEYS,\r\n  TEMPORAL_CACHE_CONFIG\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/hooks/useTemporalQuery.ts","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useQueryClient\" cannot be called inside a callback. React Hooks must be called in a React function component or a custom React Hook function.","line":292,"column":25,"nodeType":"Identifier","endLine":292,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'eventTypes' is defined but never used.","line":394,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":394,"endColumn":16}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€æŸ¥è¯¢é’©å­å‡½æ•°\r\n * æä¾›æ—¶æ€æ•°æ®æŸ¥è¯¢ã€ç¼“å­˜å’ŒçŠ¶æ€ç®¡ç†åŠŸèƒ½\r\n */\r\nimport { useCallback } from 'react';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport type { UseQueryResult } from '@tanstack/react-query';\r\nimport organizationAPI from '../api/organizations-simplified';\r\nimport { useTemporalStore, useTemporalActions, temporalSelectors } from '../stores/temporalStore';\r\nimport type { \r\n  TemporalQueryParams,\r\n  TemporalOrganizationUnit,\r\n  TimelineEvent,\r\n  TemporalMode\r\n} from '../types/temporal';\r\nimport type { OrganizationUnit, OrganizationQueryParams } from '../types/organization';\r\n\r\n// æŸ¥è¯¢é”®ç”Ÿæˆå™¨\r\nconst QUERY_KEYS = {\r\n  temporal: ['temporal'] as const,\r\n  organizations: (params: TemporalQueryParams) => \r\n    [...QUERY_KEYS.temporal, 'organizations', params] as const,\r\n  organization: (code: string, params?: TemporalQueryParams) => \r\n    [...QUERY_KEYS.temporal, 'organization', code, params] as const,\r\n  history: (code: string, params?: TemporalQueryParams) => \r\n    [...QUERY_KEYS.temporal, 'history', code, params] as const,\r\n  timeline: (code: string, params?: TemporalQueryParams) => \r\n    [...QUERY_KEYS.temporal, 'timeline', code, params] as const,\r\n};\r\n\r\n// ç¼“å­˜é…ç½®\r\nconst CACHE_CONFIG = {\r\n  staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ\r\n  gcTime: 10 * 60 * 1000, // 10åˆ†é’Ÿ\r\n  refetchOnWindowFocus: false,\r\n  refetchOnMount: true,\r\n};\r\n\r\n// æ—¶æ€ç»„ç»‡æŸ¥è¯¢é’©å­\r\nexport function useTemporalOrganizations(\r\n  queryParams?: Partial<OrganizationQueryParams>\r\n): UseQueryResult<OrganizationUnit[]> & {\r\n  temporalContext: ReturnType<typeof temporalSelectors.useContext>;\r\n  isHistorical: boolean;\r\n} {\r\n  const temporalContext = temporalSelectors.useContext();\r\n  const temporalQueryParams = temporalSelectors.useQueryParams();\r\n  \r\n  // ä½¿ç”¨ç¨³å®šçš„actionså¼•ç”¨\r\n  const { getCachedOrganizations, cacheOrganizations } = useTemporalActions();\r\n\r\n  const queryKey = QUERY_KEYS.organizations(temporalQueryParams);\r\n  const cacheKey = JSON.stringify(queryKey);\r\n\r\n  const query = useQuery({\r\n    queryKey,\r\n    queryFn: async () => {\r\n      // å°è¯•ä»ç¼“å­˜è·å–\r\n      const cached = getCachedOrganizations(cacheKey);\r\n      if (cached) {\r\n        return cached;\r\n      }\r\n\r\n      // åˆå¹¶æŸ¥è¯¢å‚æ•°\r\n      const params: OrganizationQueryParams = {\r\n        ...queryParams,\r\n        temporalParams: temporalQueryParams\r\n      };\r\n\r\n      // è°ƒç”¨API\r\n      const response = await organizationAPI.getAll(params);\r\n      const organizations = response.organizations;\r\n\r\n      // è½¬æ¢ä¸ºæ—¶æ€ç»„ç»‡å•å…ƒæ ¼å¼ (çº¯æ—¥æœŸæ¨¡å‹)\r\n      const temporalOrganizations: TemporalOrganizationUnit[] = organizations.map(org => ({\r\n        ...org,\r\n        effective_date: org.created_at,  // ä½¿ç”¨åˆ›å»ºæ—¶é—´ä½œä¸ºç”Ÿæ•ˆæ—¥æœŸ\r\n        end_date: undefined,             // å½“å‰æœ‰æ•ˆï¼Œæœªç»“æŸ\r\n        is_current: true,                // å½“å‰æœ‰æ•ˆè®°å½•\r\n        change_reason: undefined,        // æ— å˜æ›´åŸå› \r\n        approved_by: undefined,          // æ— æ‰¹å‡†äºº\r\n        approved_at: undefined           // æ— æ‰¹å‡†æ—¶é—´\r\n      }));\r\n\r\n      // ç¼“å­˜ç»“æœ\r\n      cacheOrganizations(cacheKey, temporalOrganizations);\r\n\r\n      return temporalOrganizations;\r\n    },\r\n    ...CACHE_CONFIG,\r\n    enabled: !!temporalContext,\r\n  });\r\n\r\n  return {\r\n    ...query,\r\n    temporalContext,\r\n    isHistorical: temporalContext.mode === 'historical'\r\n  };\r\n}\r\n\r\n// æ—¶æ€å•ä¸ªç»„ç»‡æŸ¥è¯¢é’©å­\r\nexport function useTemporalOrganization(\r\n  code: string,\r\n  enabled: boolean = true\r\n): UseQueryResult<OrganizationUnit> & {\r\n  temporalContext: ReturnType<typeof temporalSelectors.useContext>;\r\n  isHistorical: boolean;\r\n} {\r\n  const temporalContext = temporalSelectors.useContext();\r\n  const temporalQueryParams = temporalSelectors.useQueryParams();\r\n\r\n  const query = useQuery({\r\n    queryKey: QUERY_KEYS.organization(code, temporalQueryParams),\r\n    queryFn: async () => {\r\n      return await organizationAPI.getByCode(code, temporalQueryParams);\r\n    },\r\n    ...CACHE_CONFIG,\r\n    enabled: enabled && !!code && !!temporalContext,\r\n  });\r\n\r\n  return {\r\n    ...query,\r\n    temporalContext,\r\n    isHistorical: temporalContext.mode === 'historical'\r\n  };\r\n}\r\n\r\n// ç»„ç»‡å†å²æŸ¥è¯¢é’©å­\r\nexport function useOrganizationHistory(\r\n  code: string,\r\n  params?: Partial<TemporalQueryParams>,\r\n  enabled: boolean = true\r\n): UseQueryResult<TemporalOrganizationUnit[]> & {\r\n  hasHistory: boolean;\r\n  latestRecord: TemporalOrganizationUnit | undefined;  // æ›´æ–°å­—æ®µå\r\n} {\r\n  const temporalQueryParams = temporalSelectors.useQueryParams();\r\n  \r\n  // ä½¿ç”¨ç¨³å®šçš„actionså¼•ç”¨\r\n  const { getCachedOrganizations, cacheOrganizations } = useTemporalActions();\r\n\r\n  const finalParams = { ...temporalQueryParams, ...params };\r\n  const queryKey = QUERY_KEYS.history(code, finalParams);\r\n  const cacheKey = JSON.stringify(queryKey);\r\n\r\n  const query = useQuery({\r\n    queryKey,\r\n    queryFn: async () => {\r\n      // å°è¯•ä»ç¼“å­˜è·å–\r\n      const cached = getCachedOrganizations(cacheKey);\r\n      if (cached) {\r\n        return cached;\r\n      }\r\n\r\n      // è°ƒç”¨API\r\n      const history = await organizationAPI.getHistory(code, finalParams);\r\n\r\n      // ç¼“å­˜ç»“æœ\r\n      cacheOrganizations(cacheKey, history);\r\n\r\n      return history;\r\n    },\r\n    ...CACHE_CONFIG,\r\n    enabled: enabled && !!code,\r\n  });\r\n\r\n  const hasHistory = (query.data?.length ?? 0) > 1;\r\n  const latestRecord = query.data?.[0]; // æœ€æ–°è®°å½• (çº¯æ—¥æœŸæ¨¡å‹)\r\n\r\n  return {\r\n    ...query,\r\n    hasHistory,\r\n    latestRecord  // æ›´åä¸ºlatestRecord\r\n  };\r\n}\r\n\r\n// ç»„ç»‡æ—¶é—´çº¿æŸ¥è¯¢é’©å­\r\nexport function useOrganizationTimeline(\r\n  code: string,\r\n  params?: Partial<TemporalQueryParams>,\r\n  enabled: boolean = true\r\n): UseQueryResult<TimelineEvent[]> & {\r\n  hasEvents: boolean;\r\n  eventCount: number;\r\n  latestEvent: TimelineEvent | undefined;\r\n} {\r\n  const temporalQueryParams = temporalSelectors.useQueryParams();\r\n  \r\n  // ä½¿ç”¨ç¨³å®šçš„actionså¼•ç”¨\r\n  const { getCachedTimeline, gcTimeline } = useTemporalActions();\r\n\r\n  const finalParams = { ...temporalQueryParams, ...params };\r\n  const queryKey = QUERY_KEYS.timeline(code, finalParams);\r\n  const cacheKey = JSON.stringify(queryKey);\r\n\r\n  const query = useQuery({\r\n    queryKey,\r\n    queryFn: async () => {\r\n      // å°è¯•ä»ç¼“å­˜è·å–\r\n      const cached = getCachedTimeline(cacheKey);\r\n      if (cached) {\r\n        return cached;\r\n      }\r\n\r\n      // è°ƒç”¨API\r\n      const timeline = await organizationAPI.getTimeline(code, finalParams);\r\n\r\n      // ç¼“å­˜ç»“æœ\r\n      gcTimeline(cacheKey, timeline);\r\n\r\n      return timeline;\r\n    },\r\n    ...CACHE_CONFIG,\r\n    enabled: enabled && !!code,\r\n  });\r\n\r\n  const eventCount = query.data?.length ?? 0;\r\n  const hasEvents = eventCount > 0;\r\n  const latestEvent = query.data?.[0]; // å‡è®¾æŒ‰æ—¶é—´å€’åºæ’åˆ—\r\n\r\n  return {\r\n    ...query,\r\n    hasEvents,\r\n    eventCount,\r\n    latestEvent\r\n  };\r\n}\r\n\r\n// æ—¶æ€æ¨¡å¼åˆ‡æ¢é’©å­\r\nexport function useTemporalMode() {\r\n  const mode = useTemporalStore((state) => state.context.mode);\r\n  \r\n  // ä½¿ç”¨ç¨³å®šçš„actionså¼•ç”¨\r\n  const { setMode, setAsOfDate } = useTemporalActions();\r\n  const queryClient = useQueryClient();\r\n\r\n  const switchToMode = useCallback(\r\n    async (newMode: TemporalMode, options?: { asOfDate?: string; clearCache?: boolean }) => {\r\n      // æ¸…é™¤ç›¸å…³æŸ¥è¯¢ç¼“å­˜\r\n      if (options?.clearCache) {\r\n        await queryClient.invalidateQueries({ queryKey: QUERY_KEYS.temporal });\r\n      }\r\n\r\n      // è®¾ç½®æ–°æ¨¡å¼\r\n      setMode(newMode);\r\n\r\n      // è®¾ç½®æ—¶é—´ç‚¹ï¼ˆå¦‚æœæä¾›ï¼‰\r\n      if (options?.asOfDate) {\r\n        setAsOfDate(options.asOfDate);\r\n      } else if (newMode === 'current') {\r\n        setAsOfDate(new Date().toISOString());\r\n      }\r\n    },\r\n    [setMode, setAsOfDate, queryClient]\r\n  );\r\n\r\n  const switchToCurrent = useCallback(() => \r\n    switchToMode('current', { clearCache: true }), [switchToMode]);\r\n\r\n  const switchToHistorical = useCallback((asOfDate: string) => \r\n    switchToMode('historical', { asOfDate, clearCache: true }), [switchToMode]);\r\n\r\n  const switchToPlanning = useCallback((asOfDate?: string) => \r\n    switchToMode('planning', { asOfDate, clearCache: true }), [switchToMode]);\r\n\r\n  return {\r\n    mode,\r\n    switchToMode,\r\n    switchToCurrent,\r\n    switchToHistorical,\r\n    switchToPlanning,\r\n    isHistorical: mode === 'historical',\r\n    isPlanning: mode === 'planning',\r\n    isCurrent: mode === 'current'\r\n  };\r\n}\r\n\r\n// æ—¶æ€æŸ¥è¯¢çŠ¶æ€é’©å­\r\nexport function useTemporalQueryState() {\r\n  const loading = temporalSelectors.useLoading();\r\n  const error = temporalSelectors.useError();\r\n  const context = temporalSelectors.useContext();\r\n  const queryParams = temporalSelectors.useQueryParams();\r\n  const cacheStats = temporalSelectors.useCacheStats();\r\n\r\n  // ä½¿ç”¨ç¨³å®šçš„actionså¼•ç”¨\r\n  const { setError, clearCache } = useTemporalActions();\r\n\r\n  const clearError = useCallback(() => setError(null), [setError]);\r\n\r\n  const refreshCache = useCallback(async () => {\r\n    const queryClient = useQueryClient();\r\n    clearCache();\r\n    await queryClient.invalidateQueries({ queryKey: QUERY_KEYS.temporal });\r\n  }, [clearCache]);\r\n\r\n  return {\r\n    loading,\r\n    error,\r\n    context,\r\n    queryParams,\r\n    cacheStats,\r\n    clearError,\r\n    refreshCache,\r\n    isLoading: Object.values(loading).some(Boolean),\r\n    hasError: !!error\r\n  };\r\n}\r\n\r\n// æ—¶æ€æ•°æ®é¢„åŠ è½½é’©å­\r\nexport function useTemporalPreloader() {\r\n  const queryClient = useQueryClient();\r\n  const temporalQueryParams = temporalSelectors.useQueryParams();\r\n\r\n  const preloadOrganizations = useCallback(\r\n    async (queryParams?: Partial<OrganizationQueryParams>) => {\r\n      const params = { ...queryParams, temporalParams: temporalQueryParams };\r\n      await queryClient.prefetchQuery({\r\n        queryKey: QUERY_KEYS.organizations(temporalQueryParams),\r\n        queryFn: () => organizationAPI.getAll(params),\r\n        ...CACHE_CONFIG,\r\n      });\r\n    },\r\n    [queryClient, temporalQueryParams]\r\n  );\r\n\r\n  const preloadOrganization = useCallback(\r\n    async (code: string) => {\r\n      await queryClient.prefetchQuery({\r\n        queryKey: QUERY_KEYS.organization(code, temporalQueryParams),\r\n        queryFn: () => organizationAPI.getByCode(code, temporalQueryParams),\r\n        ...CACHE_CONFIG,\r\n      });\r\n    },\r\n    [queryClient, temporalQueryParams]\r\n  );\r\n\r\n  const preloadHistory = useCallback(\r\n    async (code: string, params?: Partial<TemporalQueryParams>) => {\r\n      const finalParams = { ...temporalQueryParams, ...params };\r\n      await queryClient.prefetchQuery({\r\n        queryKey: QUERY_KEYS.history(code, finalParams),\r\n        queryFn: () => organizationAPI.getHistory(code, finalParams),\r\n        ...CACHE_CONFIG,\r\n      });\r\n    },\r\n    [queryClient, temporalQueryParams]\r\n  );\r\n\r\n  const preloadTimeline = useCallback(\r\n    async (code: string, params?: Partial<TemporalQueryParams>) => {\r\n      const finalParams = { ...temporalQueryParams, ...params };\r\n      await queryClient.prefetchQuery({\r\n        queryKey: QUERY_KEYS.timeline(code, finalParams),\r\n        queryFn: () => organizationAPI.getTimeline(code, finalParams),\r\n        ...CACHE_CONFIG,\r\n      });\r\n    },\r\n    [queryClient, temporalQueryParams]\r\n  );\r\n\r\n  return {\r\n    preloadOrganizations,\r\n    preloadOrganization,\r\n    preloadHistory,\r\n    preloadTimeline\r\n  };\r\n}\r\n\r\n// æ—¶æ€æŸ¥è¯¢å·¥å…·é’©å­\r\nexport function useTemporalUtils() {\r\n  // ä½¿ç”¨ç¨³å®šçš„actionså¼•ç”¨\r\n  const { setQueryParams } = useTemporalActions();\r\n\r\n  const setDateRange = useCallback(\r\n    (start: Date, end: Date) => {\r\n      setQueryParams({ dateRange: { start, end } });\r\n    },\r\n    [setQueryParams]\r\n  );\r\n\r\n  const setAsOfDate = useCallback(\r\n    (date: Date) => {\r\n      setQueryParams({ asOfDate: date });\r\n    },\r\n    [setQueryParams]\r\n  );\r\n\r\n  const toggleIncludeInactive = useCallback(() => {\r\n    setQueryParams({ includeHistory: true });\r\n  }, [setQueryParams]);\r\n\r\n  const setEventTypes = useCallback(\r\n    (eventTypes: string[]) => {\r\n      setQueryParams({ includeFuture: true });\r\n    },\r\n    [setQueryParams]\r\n  );\r\n\r\n  return {\r\n    setDateRange,\r\n    setAsOfDate,\r\n    toggleIncludeInactive,\r\n    setEventTypes\r\n  };\r\n}\r\n\r\n// å¯¼å‡ºæ‰€æœ‰é’©å­\r\nexport {\r\n  QUERY_KEYS as temporalQueryKeys,\r\n  CACHE_CONFIG as temporalCacheConfig\r\n};","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/stores/temporalStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/types/api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/types/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/types/monitoring.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/types/organization.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/types/temporal.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/types/timeline.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TemporalOrganizationUnit' is defined but never used.","line":6,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":39}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶é—´çº¿æ“ä½œå’Œç®¡ç†ç±»å‹å®šä¹‰\r\n * æ”¯æŒæ—¶é—´çº¿çš„å¯è§†åŒ–ã€å¯¼èˆªå’Œæ“ä½œ\r\n */\r\n\r\nimport type { TemporalOrganizationUnit, TimelineEvent, EventType, EventStatus } from './temporal';\r\n\r\n// æ—¶é—´çº¿è§†å›¾é…ç½®\r\nexport interface TimelineViewConfig {\r\n  mode: TimelineDisplayMode;\r\n  zoomLevel: TimelineZoomLevel;\r\n  showEvents: EventType[];\r\n  dateRange: {\r\n    start: Date;\r\n    end: Date;\r\n  };\r\n  groupBy?: TimelineGrouping;\r\n  filterBy?: TimelineFilter;\r\n}\r\n\r\n// æ—¶é—´çº¿æ˜¾ç¤ºæ¨¡å¼\r\nexport type TimelineDisplayMode = 'compact' | 'detailed' | 'gantt' | 'calendar';\r\n\r\n// æ—¶é—´çº¿ç¼©æ”¾çº§åˆ«\r\nexport type TimelineZoomLevel = 'year' | 'quarter' | 'month' | 'week' | 'day';\r\n\r\n// æ—¶é—´çº¿åˆ†ç»„æ–¹å¼\r\nexport type TimelineGrouping = 'none' | 'event_type' | 'organization' | 'author' | 'status';\r\n\r\n// æ—¶é—´çº¿ç­›é€‰å™¨\r\nexport interface TimelineFilter {\r\n  eventTypes?: EventType[];\r\n  statuses?: EventStatus[];\r\n  authors?: string[];\r\n  organizationCodes?: string[];\r\n  dateRange?: {\r\n    start: Date;\r\n    end: Date;\r\n  };\r\n}\r\n\r\n// æ—¶é—´çº¿æ•°æ®ç‚¹\r\nexport interface TimelineDataPoint {\r\n  id: string;\r\n  timestamp: Date;\r\n  organizationCode: string;\r\n  organizationName: string;\r\n  event: TimelineEvent;\r\n  position: TimelinePosition;\r\n  visual: TimelineVisualConfig;\r\n  interactions: TimelineInteraction[];\r\n}\r\n\r\n// æ—¶é—´çº¿ä½ç½®ä¿¡æ¯\r\nexport interface TimelinePosition {\r\n  x: number;          // æ—¶é—´è½´ä½ç½®\r\n  y: number;          // å‚ç›´ä½ç½® (å¤šè½¨é“æ˜¾ç¤º)\r\n  width?: number;     // äº‹ä»¶æŒç»­æ—¶é—´å®½åº¦\r\n  height?: number;    // æ˜¾ç¤ºé«˜åº¦\r\n  track: number;      // è½¨é“ç¼–å·\r\n}\r\n\r\n// æ—¶é—´çº¿è§†è§‰é…ç½®\r\nexport interface TimelineVisualConfig {\r\n  color: string;\r\n  icon?: string;\r\n  size: 'small' | 'medium' | 'large';\r\n  shape: 'circle' | 'square' | 'diamond' | 'triangle';\r\n  opacity?: number;\r\n  highlighted?: boolean;\r\n  selected?: boolean;\r\n}\r\n\r\n// æ—¶é—´çº¿äº¤äº’é…ç½®\r\nexport interface TimelineInteraction {\r\n  type: InteractionType;\r\n  enabled: boolean;\r\n  handler?: (event: TimelineEvent) => void;\r\n}\r\n\r\nexport type InteractionType = \r\n  | 'click'\r\n  | 'hover'\r\n  | 'double_click'\r\n  | 'context_menu'\r\n  | 'drag'\r\n  | 'select';\r\n\r\n// æ—¶é—´çº¿å¯¼èˆªå™¨\r\nexport interface TimelineNavigator {\r\n  currentDate: Date;\r\n  viewportStart: Date;\r\n  viewportEnd: Date;\r\n  totalRange: {\r\n    start: Date;\r\n    end: Date;\r\n  };\r\n  bookmarks: TimelineBookmark[];\r\n  quickJumps: QuickJumpOption[];\r\n}\r\n\r\n// æ—¶é—´çº¿ä¹¦ç­¾\r\nexport interface TimelineBookmark {\r\n  id: string;\r\n  name: string;\r\n  date: Date;\r\n  description?: string;\r\n  color?: string;\r\n  icon?: string;\r\n  organizationCode?: string;\r\n}\r\n\r\n// å¿«é€Ÿè·³è½¬é€‰é¡¹\r\nexport interface QuickJumpOption {\r\n  id: string;\r\n  label: string;\r\n  date: Date;\r\n  type: 'preset' | 'bookmark' | 'recent';\r\n}\r\n\r\n// æ—¶é—´çº¿æ“ä½œæ¥å£\r\nexport interface TimelineOperations {\r\n  // æ—¶é—´çº¿å¯¼èˆª\r\n  jumpToDate: (date: Date) => void;\r\n  jumpToEvent: (eventId: string) => void;\r\n  zoomIn: () => void;\r\n  zoomOut: () => void;\r\n  resetZoom: () => void;\r\n  \r\n  // æ—¶é—´çº¿ç¼–è¾‘\r\n  createEvent: (event: Partial<TimelineEvent>) => Promise<TimelineEvent>;\r\n  updateEvent: (eventId: string, updates: Partial<TimelineEvent>) => Promise<TimelineEvent>;\r\n  deleteEvent: (eventId: string) => Promise<void>;\r\n  \r\n  // æ‰¹é‡æ“ä½œ\r\n  moveEvents: (eventIds: string[], newDate: Date) => Promise<void>;\r\n  duplicateEvents: (eventIds: string[]) => Promise<TimelineEvent[]>;\r\n  \r\n  // æ—¶é—´çº¿æ ¡æ­£\r\n  correctTimeline: (correction: TimelineCorrection) => Promise<void>;\r\n  undoCorrection: (correctionId: string) => Promise<void>;\r\n}\r\n\r\n// æ—¶é—´çº¿æ ¡æ­£\r\nexport interface TimelineCorrection {\r\n  id: string;\r\n  type: CorrectionType;\r\n  targetEventId: string;\r\n  newTimestamp: Date;\r\n  reason: string;\r\n  approvedBy?: string;\r\n  appliedAt?: Date;\r\n  previousState: TimelineEvent;\r\n}\r\n\r\nexport type CorrectionType = 'timestamp' | 'event_type' | 'rollback' | 'merge' | 'split';\r\n\r\n// æ—¶é—´çº¿çŠ¶æ€ç®¡ç†\r\nexport interface TimelineState {\r\n  // è§†å›¾çŠ¶æ€\r\n  config: TimelineViewConfig;\r\n  navigator: TimelineNavigator;\r\n  selectedEvents: string[];\r\n  highlightedEvents: string[];\r\n  \r\n  // æ•°æ®çŠ¶æ€\r\n  events: TimelineDataPoint[];\r\n  loading: boolean;\r\n  error?: string;\r\n  \r\n  // äº¤äº’çŠ¶æ€\r\n  dragging?: {\r\n    eventId: string;\r\n    startPosition: { x: number; y: number };\r\n  };\r\n  contextMenu?: {\r\n    eventId: string;\r\n    position: { x: number; y: number };\r\n    visible: boolean;\r\n  };\r\n}\r\n\r\n// æ—¶é—´çº¿åˆ†ææŒ‡æ ‡\r\nexport interface TimelineAnalytics {\r\n  totalEvents: number;\r\n  eventsByType: Record<EventType, number>;\r\n  eventsByStatus: Record<EventStatus, number>;\r\n  averageEventDuration: number;  // åˆ†é’Ÿ\r\n  peakActivityPeriods: {\r\n    period: string;\r\n    eventCount: number;\r\n  }[];\r\n  changePatterns: {\r\n    pattern: string;\r\n    frequency: number;\r\n    description: string;\r\n  }[];\r\n}\r\n\r\n// æ—¶é—´çº¿å¯¼å‡ºé…ç½®\r\nexport interface TimelineExportConfig {\r\n  format: 'json' | 'csv' | 'pdf' | 'png' | 'svg';\r\n  dateRange?: {\r\n    start: Date;\r\n    end: Date;\r\n  };\r\n  includeMetadata: boolean;\r\n  includeVisuals: boolean;\r\n  resolution?: 'low' | 'medium' | 'high';  // å›¾åƒå¯¼å‡ºåˆ†è¾¨ç‡\r\n  pageSize?: 'A4' | 'A3' | 'letter';       // PDFé¡µé¢å¤§å°\r\n}\r\n\r\n// æ—¶é—´çº¿æ€§èƒ½é…ç½®\r\nexport interface TimelinePerformanceConfig {\r\n  virtualScrolling: boolean;      // è™šæ‹Ÿæ»šåŠ¨\r\n  lazyLoading: boolean;          // æ‡’åŠ è½½äº‹ä»¶\r\n  maxVisibleEvents: number;       // æœ€å¤§å¯è§äº‹ä»¶æ•°\r\n  renderThreshold: number;        // æ¸²æŸ“é˜ˆå€¼\r\n  cacheStrategy: 'memory' | 'disk' | 'hybrid';\r\n  prefetchMargin: number;         // é¢„å–è¾¹è· (æ¯«ç§’)\r\n}","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/validation/schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/shared/validation/simple-validation.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1031,1034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1031,1034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1812,1815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1812,1815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2938,2941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2938,2941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4466,4469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4466,4469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":190,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5674,5677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5674,5677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":198,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5923,5926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5923,5926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5952,5955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5952,5955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":210,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6441,6444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6441,6444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ğŸ¯ ç®€åŒ–çš„å‰ç«¯éªŒè¯ç³»ç»Ÿ (Phase 2ä¼˜åŒ–)\r\n// âœ… ç§»é™¤Zodä¾èµ–ï¼Œå‡å°‘åŒ…ä½“ç§¯50KB\r\n// âœ… ç»Ÿä¸€åç«¯éªŒè¯ï¼Œå‰ç«¯ä»…ä¿ç•™ç”¨æˆ·ä½“éªŒå¿…éœ€éªŒè¯\r\n// âœ… ä»889è¡Œå¤æ‚éªŒè¯ä»£ç ç®€åŒ–è‡³100è¡ŒåŸºç¡€éªŒè¯\r\n\r\nexport interface ValidationError {\r\n  field: string;\r\n  message: string;\r\n}\r\n\r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  errors: ValidationError[];\r\n}\r\n\r\n// åŸºç¡€éªŒè¯å‡½æ•° - ä»…ç”¨äºå³æ—¶ç”¨æˆ·ä½“éªŒåé¦ˆ\r\nexport const basicValidation = {\r\n  required: (value: unknown): boolean => {\r\n    if (typeof value === 'string') {\r\n      return value.trim() !== '';\r\n    }\r\n    return value != null && value !== undefined;\r\n  },\r\n\r\n  maxLength: (value: string, max: number): boolean => {\r\n    return !value || value.length <= max;\r\n  },\r\n\r\n  minLength: (value: string, min: number): boolean => {\r\n    return !value || value.length >= min;\r\n  },\r\n\r\n  pattern: (value: string, regex: RegExp): boolean => {\r\n    return !value || regex.test(value);\r\n  },\r\n\r\n  positiveNumber: (value: number): boolean => {\r\n    return typeof value === 'number' && value >= 0;\r\n  }\r\n};\r\n\r\n// ç»„ç»‡å•å…ƒåŸºç¡€éªŒè¯ - ä¾èµ–åç«¯ç»Ÿä¸€éªŒè¯\r\nexport function validateOrganizationBasic(data: any): ValidationResult {\r\n  const errors: ValidationError[] = [];\r\n\r\n  // ä»…ä¿ç•™å…³é”®çš„ç”¨æˆ·ä½“éªŒéªŒè¯\r\n  if (!basicValidation.required(data.name)) {\r\n    errors.push({ field: 'name', message: 'ç»„ç»‡åç§°ä¸èƒ½ä¸ºç©º' });\r\n  }\r\n\r\n  if (data.name && !basicValidation.maxLength(data.name, 100)) {\r\n    errors.push({ field: 'name', message: 'ç»„ç»‡åç§°ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦' });\r\n  }\r\n\r\n  if (!basicValidation.required(data.unit_type)) {\r\n    errors.push({ field: 'unit_type', message: 'è¯·é€‰æ‹©ç»„ç»‡ç±»å‹' });\r\n  }\r\n\r\n  if (data.sort_order !== undefined && !basicValidation.positiveNumber(data.sort_order)) {\r\n    errors.push({ field: 'sort_order', message: 'æ’åºé¡ºåºå¿…é¡»ä¸ºéè´Ÿæ•°' });\r\n  }\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n// ç»„ç»‡å•å…ƒæ›´æ–°éªŒè¯ - ç”¨äºç¼–è¾‘æ¨¡å¼ï¼ˆæ”¯æŒæ‰€æœ‰å­—æ®µç¼–è¾‘ï¼Œé™¤äº†ç»„ç»‡ç¼–ç ï¼‰\r\nexport function validateOrganizationUpdate(data: any): ValidationResult {\r\n  const errors: ValidationError[] = [];\r\n\r\n  // ä»…ä¿ç•™å…³é”®çš„ç”¨æˆ·ä½“éªŒéªŒè¯\r\n  if (data.name && !basicValidation.required(data.name)) {\r\n    errors.push({ field: 'name', message: 'ç»„ç»‡åç§°ä¸èƒ½ä¸ºç©º' });\r\n  }\r\n\r\n  if (data.name && !basicValidation.maxLength(data.name, 100)) {\r\n    errors.push({ field: 'name', message: 'ç»„ç»‡åç§°ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦' });\r\n  }\r\n\r\n  // ç¼–è¾‘æ¨¡å¼ä¸‹ä¹Ÿéœ€è¦éªŒè¯unit_type\r\n  if (data.unit_type && !basicValidation.required(data.unit_type)) {\r\n    errors.push({ field: 'unit_type', message: 'è¯·é€‰æ‹©ç»„ç»‡ç±»å‹' });\r\n  }\r\n\r\n  // éªŒè¯levelå­—æ®µ\r\n  if (data.level !== undefined && !basicValidation.positiveNumber(data.level)) {\r\n    errors.push({ field: 'level', message: 'ç»„ç»‡å±‚çº§å¿…é¡»ä¸ºæ­£æ•°' });\r\n  }\r\n\r\n  if (data.level && (data.level < 1 || data.level > 10)) {\r\n    errors.push({ field: 'level', message: 'ç»„ç»‡å±‚çº§å¿…é¡»åœ¨1-10ä¹‹é—´' });\r\n  }\r\n\r\n  if (data.sort_order !== undefined && !basicValidation.positiveNumber(data.sort_order)) {\r\n    errors.push({ field: 'sort_order', message: 'æ’åºé¡ºåºå¿…é¡»ä¸ºéè´Ÿæ•°' });\r\n  }\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n// éªŒè¯APIå“åº”æ ¼å¼ - ç¡®ä¿æ˜¯å®Œæ•´çš„ç»„ç»‡å•å…ƒå¯¹è±¡\r\nexport function validateOrganizationResponse(data: any): ValidationResult {\r\n  const errors: ValidationError[] = [];\r\n\r\n  // éªŒè¯å¿…éœ€å­—æ®µ\r\n  const requiredFields = ['code', 'name', 'unit_type', 'status', 'level'];\r\n  for (const field of requiredFields) {\r\n    if (!basicValidation.required(data[field])) {\r\n      errors.push({ field, message: `${field} å­—æ®µä¸èƒ½ä¸ºç©º` });\r\n    }\r\n  }\r\n\r\n  // éªŒè¯çŠ¶æ€æšä¸¾\r\n  if (data.status && !['ACTIVE', 'INACTIVE', 'PLANNED'].includes(data.status)) {\r\n    errors.push({ field: 'status', message: 'çŠ¶æ€å€¼æ— æ•ˆ' });\r\n  }\r\n\r\n  // éªŒè¯ç±»å‹æšä¸¾  \r\n  if (data.unit_type && !['DEPARTMENT', 'COST_CENTER', 'COMPANY', 'PROJECT_TEAM'].includes(data.unit_type)) {\r\n    errors.push({ field: 'unit_type', message: 'ç»„ç»‡ç±»å‹æ— æ•ˆ' });\r\n  }\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n// ç®€åŒ–çš„é”™è¯¯å¤„ç† - ä¾èµ–åç«¯è¿”å›è¯¦ç»†é”™è¯¯\r\nexport class SimpleValidationError extends Error {\r\n  public readonly fieldErrors: ValidationError[];\r\n  \r\n  constructor(message: string, errors: ValidationError[] = []) {\r\n    super(message);\r\n    this.name = 'SimpleValidationError';\r\n    this.fieldErrors = errors;\r\n  }\r\n}\r\n\r\n// æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ¯\r\nexport function formatValidationErrors(errors: ValidationError[]): string {\r\n  return errors.map(error => error.message).join('; ');\r\n}\r\n\r\n// è·å–å­—æ®µé”™è¯¯\r\nexport function getFieldError(errors: ValidationError[], fieldName: string): string | undefined {\r\n  const error = errors.find(e => e.field === fieldName);\r\n  return error?.message;\r\n}\r\n\r\n// ç®€åŒ–çš„æ•°æ®è½¬æ¢ - é¿å…å¤æ‚çš„ç±»å‹å®ˆå«\r\nexport const safeTransform = {\r\n  // GraphQLåˆ°å‰ç«¯æ ¼å¼è½¬æ¢ (å…¼å®¹REST APIå“åº”æ ¼å¼)\r\n  graphqlToOrganization: (orgData: any) => {\r\n    // å…¼å®¹å¤„ç†: REST APIå“åº”ç›´æ¥è¿”å›OrganizationUnitæ ¼å¼\r\n    if (orgData.unit_type && orgData.created_at) {\r\n      // è¿™æ˜¯REST APIå“åº”æ ¼å¼ï¼Œç›´æ¥éªŒè¯å¹¶è¿”å›\r\n      const basicValidation = validateOrganizationResponse(orgData);\r\n      if (basicValidation.isValid) {\r\n        return orgData;\r\n      }\r\n    }\r\n    \r\n    // GraphQLæ ¼å¼è½¬æ¢ (æ”¯æŒä¸‹åˆ’çº¿å‘½åçº¦å®š)\r\n    return {\r\n      code: orgData.code || '',\r\n      name: orgData.name || '',\r\n      unit_type: orgData.unit_type || orgData.unitType || '',  // æ”¯æŒä¸¤ç§å‘½åæ–¹å¼\r\n      status: orgData.status || 'ACTIVE',\r\n      level: orgData.level || 1,\r\n      parent_code: orgData.parent_code || orgData.parentCode || '',\r\n      path: orgData.path || '',\r\n      sort_order: orgData.sort_order || orgData.sortOrder || 0,\r\n      description: orgData.description || '',\r\n      created_at: orgData.created_at || orgData.createdAt || '',\r\n      updated_at: orgData.updated_at || orgData.updatedAt || '',\r\n      // æ—¶æ€å­—æ®µï¼ˆå¦‚æœå­˜åœ¨ï¼‰\r\n      effective_date: orgData.effective_date || orgData.effectiveDate || null,\r\n      end_date: orgData.end_date || orgData.endDate || null,\r\n      is_temporal: orgData.is_temporal || orgData.isTemporal || false\r\n    };\r\n  },\r\n\r\n  // ç®€å•çš„æ•°æ®æ¸…ç†ï¼Œä¾èµ–åç«¯éªŒè¯\r\n  cleanCreateInput: (input: any) => ({\r\n    name: input.name?.trim(),\r\n    unit_type: input.unit_type,\r\n    parent_code: input.parent_code || null,\r\n    sort_order: input.sort_order || 0,\r\n    description: input.description?.trim() || '',\r\n  }),\r\n\r\n  cleanUpdateInput: (input: any) => {\r\n    const result: any = {};\r\n    if (input.name !== undefined) result.name = input.name?.trim();\r\n    if (input.unit_type !== undefined) result.unit_type = input.unit_type;\r\n    if (input.status !== undefined) result.status = input.status;\r\n    if (input.sort_order !== undefined) result.sort_order = input.sort_order;\r\n    if (input.description !== undefined) result.description = input.description?.trim();\r\n    return result;\r\n  }\r\n};\r\n\r\n// çŠ¶æ€æ›´æ–°éªŒè¯ - ä»…éªŒè¯çŠ¶æ€ç›¸å…³å­—æ®µ\r\nexport function validateStatusUpdate(data: any): ValidationResult {\r\n  const errors: ValidationError[] = [];\r\n\r\n  // ä»…éªŒè¯çŠ¶æ€å­—æ®µ\r\n  if (!basicValidation.required(data.status)) {\r\n    errors.push({ field: 'status', message: 'çŠ¶æ€ä¸èƒ½ä¸ºç©º' });\r\n  }\r\n\r\n  if (data.status && !['ACTIVE', 'INACTIVE', 'PLANNED'].includes(data.status)) {\r\n    errors.push({ field: 'status', message: 'çŠ¶æ€å€¼æ— æ•ˆï¼Œå¿…é¡»æ˜¯ ACTIVEã€INACTIVE æˆ– PLANNED' });\r\n  }\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n// å‘åå…¼å®¹çš„å¯¼å‡º (ç”¨äºé€æ­¥è¿ç§»)\r\nexport const validateCreateOrganizationInput = validateOrganizationBasic;\r\nexport const validateUpdateOrganizationInput = validateOrganizationBasic;","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/architecture-e2e.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/basic-functionality-test.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/business-flow-e2e.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'paginationArea' is assigned a value but never used.","line":152,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":152,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test, expect } from '@playwright/test';\r\n\r\ntest.describe('ä¸šåŠ¡æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•', () => {\r\n  \r\n  test.beforeEach(async ({ page }) => {\r\n    await page.goto('/organizations');\r\n    // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ\r\n    await expect(page.getByText('ç»„ç»‡æ¶æ„ç®¡ç†')).toBeVisible();\r\n  });\r\n\r\n  test('å®Œæ•´CRUDä¸šåŠ¡æµç¨‹æµ‹è¯•', async ({ page }) => {\r\n    // === CREATE æ“ä½œæµ‹è¯• ===\r\n    \r\n    // 1. ç‚¹å‡»æ–°å¢æŒ‰é’®\r\n    await page.getByRole('button', { name: 'æ–°å¢ç»„ç»‡å•å…ƒ' }).click();\r\n    \r\n    // 2. ç­‰å¾…è¡¨å•æ¨¡æ€æ¡†å‡ºç°\r\n    const formModal = page.getByTestId('organization-form');\r\n    await expect(formModal).toBeVisible();\r\n    \r\n    // 3. å¡«å†™è¡¨å•å­—æ®µ\r\n    await page.locator('input[name=\"name\"]').fill('æµ‹è¯•éƒ¨é—¨E2E');\r\n    await page.locator('select[name=\"unit_type\"]').selectOption('DEPARTMENT');\r\n    await page.locator('input[name=\"description\"]').fill('E2Eæµ‹è¯•åˆ›å»ºçš„ç»„ç»‡');\r\n    \r\n    // 4. æäº¤è¡¨å•\r\n    await page.getByTestId('form-submit-button').click();\r\n    \r\n    // 5. éªŒè¯è¡¨å•å…³é—­\r\n    await expect(formModal).not.toBeVisible();\r\n\r\n    // === READ æ“ä½œæµ‹è¯• ===\r\n    \r\n    // 6. éªŒè¯æ•°æ®æ˜¾ç¤ºåœ¨è¡¨æ ¼ä¸­\r\n    await page.waitForTimeout(2000); // ç­‰å¾…æ•°æ®åˆ·æ–°\r\n    const organizationTable = page.getByTestId('organization-table');\r\n    await expect(organizationTable).toBeVisible();\r\n    \r\n    const tableRow = page.locator('tr:has-text(\"æµ‹è¯•éƒ¨é—¨E2E\")');\r\n    await expect(tableRow).toBeVisible();\r\n    \r\n    // 7. éªŒè¯æ•°æ®å­—æ®µå®Œæ•´æ€§\r\n    await expect(tableRow.getByText('DEPARTMENT')).toBeVisible();\r\n    await expect(tableRow.getByText('ACTIVE')).toBeVisible();\r\n\r\n    // === UPDATE æ“ä½œæµ‹è¯• ===\r\n    \r\n    // 8. ç‚¹å‡»ç¼–è¾‘æŒ‰é’®\r\n    const editButton = tableRow.getByRole('button', { name: /ç¼–è¾‘|Edit/ });\r\n    \r\n    if (await editButton.isVisible()) {\r\n      await editButton.click();\r\n      \r\n      // ç­‰å¾…ç¼–è¾‘è¡¨å•å‡ºç°\r\n      await expect(formModal).toBeVisible();\r\n      await expect(page.getByText('ç¼–è¾‘ç»„ç»‡å•å…ƒ')).toBeVisible();\r\n      \r\n      // ä¿®æ”¹åç§°\r\n      const nameInput = page.locator('input[name=\"name\"]');\r\n      await nameInput.clear();\r\n      await nameInput.fill('æµ‹è¯•éƒ¨é—¨E2E-å·²æ›´æ–°');\r\n      \r\n      // æäº¤æ›´æ–°\r\n      await page.getByTestId('form-submit-button').click();\r\n      \r\n      // éªŒè¯è¡¨å•å…³é—­\r\n      await expect(formModal).not.toBeVisible();\r\n      \r\n      // éªŒè¯æ›´æ–°åçš„æ•°æ®\r\n      await page.waitForTimeout(2000);\r\n      await expect(page.locator('tr:has-text(\"æµ‹è¯•éƒ¨é—¨E2E-å·²æ›´æ–°\")')).toBeVisible();\r\n    }\r\n\r\n    // === DELETE æ“ä½œæµ‹è¯• ===\r\n    \r\n    // 9. ç‚¹å‡»åˆ é™¤æŒ‰é’®\r\n    const updatedRow = page.locator('tr:has-text(\"æµ‹è¯•éƒ¨é—¨E2E\")');\r\n    const deleteButton = updatedRow.getByRole('button', { name: /åˆ é™¤|Delete/ });\r\n    \r\n    if (await deleteButton.isVisible()) {\r\n      await deleteButton.click();\r\n      \r\n      // å¦‚æœæœ‰ç¡®è®¤å¯¹è¯æ¡†ï¼Œç¡®è®¤åˆ é™¤\r\n      const confirmButton = page.getByRole('button', { name: /ç¡®è®¤|åˆ é™¤|Delete|ç¡®å®š/ });\r\n      if (await confirmButton.isVisible({ timeout: 2000 })) {\r\n        await confirmButton.click();\r\n      }\r\n      \r\n      // éªŒè¯åˆ é™¤åæ•°æ®ä¸å†æ˜¾ç¤º\r\n      await page.waitForTimeout(2000);\r\n      await expect(updatedRow).not.toBeVisible();\r\n    } else {\r\n      console.log('åˆ é™¤æŒ‰é’®ä¸å¯è§ï¼Œè·³è¿‡åˆ é™¤æµ‹è¯•');\r\n    }\r\n  });\r\n\r\n  test('åˆ†é¡µå’Œç­›é€‰åŠŸèƒ½æµ‹è¯•', async ({ page }) => {\r\n    // ç­‰å¾…é¡µé¢æ•°æ®åŠ è½½å®Œæˆ\r\n    await page.waitForTimeout(2000);\r\n    const organizationTable = page.getByTestId('organization-table');\r\n    await expect(organizationTable).toBeVisible();\r\n\r\n    // 1. éªŒè¯æœç´¢åŠŸèƒ½\r\n    const searchInput = page.locator('input[placeholder*=\"æœç´¢\"], input[name=\"search\"]').first();\r\n    \r\n    if (await searchInput.isVisible()) {\r\n      // è¾“å…¥æœç´¢å…³é”®è¯\r\n      await searchInput.fill('é«˜è°·é›†å›¢');\r\n      await page.waitForTimeout(1500); // ç­‰å¾…debounceæœç´¢\r\n      \r\n      // éªŒè¯æœç´¢ç»“æœ\r\n      const searchResults = page.locator('tr:has-text(\"é«˜è°·é›†å›¢\")');\r\n      if (await searchResults.first().isVisible()) {\r\n        await expect(searchResults.first()).toBeVisible();\r\n        console.log('âœ“ æœç´¢åŠŸèƒ½æ­£å¸¸');\r\n      } else {\r\n        console.log('æœç´¢ç»“æœä¸ºç©ºï¼Œç»§ç»­æµ‹è¯•');\r\n      }\r\n      \r\n      // æ¸…ç©ºæœç´¢\r\n      await searchInput.clear();\r\n      await page.waitForTimeout(1000);\r\n    } else {\r\n      console.log('æœç´¢æ¡†ä¸å¯è§ï¼Œè·³è¿‡æœç´¢æµ‹è¯•');\r\n    }\r\n\r\n    // 2. éªŒè¯ç­›é€‰åŠŸèƒ½\r\n    const typeFilterSelect = page.locator('select[name*=\"type\"], select[name*=\"unit_type\"]').first();\r\n    \r\n    if (await typeFilterSelect.isVisible()) {\r\n      // é€‰æ‹©ç‰¹å®šç±»å‹è¿›è¡Œç­›é€‰\r\n      await typeFilterSelect.selectOption('COMPANY');\r\n      await page.waitForTimeout(1000);\r\n      \r\n      // éªŒè¯ç­›é€‰ç»“æœ\r\n      const companyRows = page.locator('tr:has-text(\"COMPANY\")');\r\n      if (await companyRows.first().isVisible()) {\r\n        await expect(companyRows.first()).toBeVisible();\r\n        console.log('âœ“ ç±»å‹ç­›é€‰åŠŸèƒ½æ­£å¸¸');\r\n      } else {\r\n        console.log('æ— COMPANYç±»å‹æ•°æ®ï¼Œç­›é€‰ç»“æœä¸ºç©º');\r\n      }\r\n      \r\n      // é‡ç½®ç­›é€‰\r\n      await typeFilterSelect.selectOption('');\r\n      await page.waitForTimeout(1000);\r\n    } else {\r\n      console.log('ç±»å‹ç­›é€‰å™¨ä¸å¯è§ï¼Œè·³è¿‡ç­›é€‰æµ‹è¯•');\r\n    }\r\n\r\n    // 3. éªŒè¯åˆ†é¡µåŠŸèƒ½ï¼ˆå¦‚æœæœ‰è¶³å¤Ÿæ•°æ®ï¼‰\r\n    const paginationArea = page.locator('[data-testid*=\"pagination\"], .pagination').first();\r\n    const nextPageButton = page.getByRole('button', { name: /ä¸‹ä¸€é¡µ|Next|>/ });\r\n    \r\n    // æ£€æŸ¥æ˜¯å¦æœ‰åˆ†é¡µæ§ä»¶\r\n    if (await nextPageButton.isVisible()) {\r\n      // è®°å½•å½“å‰é¡µç \r\n      const currentPageInfo = page.locator('text=/é¡µ|Page/').first();\r\n      const initialPage = await currentPageInfo.textContent();\r\n      \r\n      // ç‚¹å‡»ä¸‹ä¸€é¡µ\r\n      await nextPageButton.click();\r\n      await page.waitForTimeout(1500);\r\n      \r\n      // éªŒè¯é¡µé¢å·²åˆ‡æ¢\r\n      const newPageInfo = await currentPageInfo.textContent();\r\n      if (initialPage !== newPageInfo) {\r\n        console.log('âœ“ åˆ†é¡µåŠŸèƒ½æ­£å¸¸');\r\n        \r\n        // è¿”å›ç¬¬ä¸€é¡µ\r\n        const prevPageButton = page.getByRole('button', { name: /ä¸Šä¸€é¡µ|Previous|</ });\r\n        if (await prevPageButton.isVisible()) {\r\n          await prevPageButton.click();\r\n          await page.waitForTimeout(1000);\r\n        }\r\n      }\r\n    } else {\r\n      console.log('åˆ†é¡µæŒ‰é’®ä¸å¯è§ï¼Œæ•°æ®å¯èƒ½ä¸è¶³ä¸€é¡µ');\r\n    }\r\n\r\n    // 4. éªŒè¯æ•°æ®åŠ è½½çŠ¶æ€\r\n    const tableRows = organizationTable.locator('tbody tr');\r\n    const rowCount = await tableRows.count();\r\n    console.log(`è¡¨æ ¼æ˜¾ç¤º ${rowCount} è¡Œæ•°æ®`);\r\n    \r\n    if (rowCount > 0) {\r\n      // éªŒè¯è¡¨æ ¼åŸºæœ¬ç»“æ„\r\n      const firstRow = tableRows.first();\r\n      await expect(firstRow).toBeVisible();\r\n      \r\n      // éªŒè¯è¡¨å¤´å­˜åœ¨\r\n      const tableHeaders = organizationTable.locator('thead th');\r\n      const headerCount = await tableHeaders.count();\r\n      expect(headerCount).toBeGreaterThan(3); // è‡³å°‘æœ‰ç¼–ç ã€åç§°ã€ç±»å‹ã€çŠ¶æ€ç­‰åˆ—\r\n      \r\n      console.log('âœ“ è¡¨æ ¼ç»“æ„éªŒè¯é€šè¿‡');\r\n    } else {\r\n      console.log('è¡¨æ ¼æ— æ•°æ®ï¼Œæ£€æŸ¥æ•°æ®æº');\r\n    }\r\n  });\r\n\r\n  test('æ€§èƒ½å’Œå“åº”æ—¶é—´æµ‹è¯•', async ({ page }) => {\r\n    const startTime = Date.now();\r\n    \r\n    // 1. æµ‹è¯•é¡µé¢åŠ è½½æ€§èƒ½\r\n    await page.goto('/organizations');\r\n    await expect(page.getByText('ç»„ç»‡æ¶æ„ç®¡ç†')).toBeVisible();\r\n    \r\n    const loadTime = Date.now() - startTime;\r\n    console.log(`é¡µé¢åŠ è½½æ—¶é—´: ${loadTime}ms`);\r\n    \r\n    // æ–­è¨€åŠ è½½æ—¶é—´åœ¨åˆç†èŒƒå›´å†…ï¼ˆ< 3ç§’ï¼‰\r\n    expect(loadTime).toBeLessThan(3000);\r\n\r\n    // 2. æµ‹è¯•APIå“åº”æ€§èƒ½\r\n    const apiStartTime = Date.now();\r\n    \r\n    await page.evaluate(async () => {\r\n      const response = await fetch('http://localhost:8090/graphql', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: `{\r\n            organizations(first: 50) {\r\n              code\r\n              name\r\n              unitType\r\n            }\r\n          }`\r\n        })\r\n      });\r\n      return response.json();\r\n    });\r\n    \r\n    const apiTime = Date.now() - apiStartTime;\r\n    console.log(`APIå“åº”æ—¶é—´: ${apiTime}ms`);\r\n    \r\n    // æ–­è¨€APIå“åº”æ—¶é—´åœ¨åˆç†èŒƒå›´å†…ï¼ˆ< 1ç§’ï¼‰\r\n    expect(apiTime).toBeLessThan(1000);\r\n  });\r\n\r\n  test('é”™è¯¯å¤„ç†å’Œæ¢å¤æµ‹è¯•', async ({ page }) => {\r\n    // 1. æµ‹è¯•ç½‘ç»œé”™è¯¯å¤„ç†\r\n    await page.route('**/graphql', route => {\r\n      route.fulfill({\r\n        status: 500,\r\n        contentType: 'application/json',\r\n        body: JSON.stringify({ error: 'Internal Server Error' })\r\n      });\r\n    });\r\n\r\n    await page.reload();\r\n    \r\n    // éªŒè¯é”™è¯¯çŠ¶æ€æ˜¾ç¤º\r\n    await expect(\r\n      page.getByText('åŠ è½½å¤±è´¥').or(page.getByText('ç½‘ç»œé”™è¯¯'))\r\n    ).toBeVisible();\r\n\r\n    // 2. æµ‹è¯•é‡è¯•æœºåˆ¶\r\n    await page.unroute('**/graphql');\r\n    \r\n    const retryButton = page.getByRole('button', { name: 'é‡è¯•' }).or(\r\n      page.getByText('é‡è¯•')\r\n    );\r\n    \r\n    if (await retryButton.isVisible()) {\r\n      await retryButton.click();\r\n      \r\n      // éªŒè¯æ¢å¤åæ­£å¸¸æ˜¾ç¤º\r\n      await expect(page.getByText('ç»„ç»‡æ¶æ„ç®¡ç†')).toBeVisible();\r\n    }\r\n  });\r\n\r\n  test('æ•°æ®ä¸€è‡´æ€§éªŒè¯æµ‹è¯•', async ({ page }) => {\r\n    // éªŒè¯å‰ç«¯æ˜¾ç¤ºçš„æ•°æ®ä¸åç«¯APIè¿”å›çš„æ•°æ®ä¸€è‡´\r\n    \r\n    // 1. è·å–å‰ç«¯æ˜¾ç¤ºçš„æ•°æ®\r\n    const frontendData = await page.evaluate(() => {\r\n      const rows = Array.from(document.querySelectorAll('tr'));\r\n      return rows.map(row => {\r\n        const cells = Array.from(row.querySelectorAll('td'));\r\n        if (cells.length >= 4) {\r\n          return {\r\n            code: cells[0]?.textContent?.trim(),\r\n            name: cells[1]?.textContent?.trim(),\r\n            type: cells[2]?.textContent?.trim(),\r\n            status: cells[3]?.textContent?.trim()\r\n          };\r\n        }\r\n        return null;\r\n      }).filter(Boolean);\r\n    });\r\n\r\n    // 2. ç›´æ¥è°ƒç”¨APIè·å–æ•°æ®\r\n    const apiData = await page.evaluate(async () => {\r\n      const response = await fetch('http://localhost:8090/graphql', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: `{\r\n            organizations(first: 50) {\r\n              code\r\n              name\r\n              unitType\r\n              status\r\n            }\r\n          }`\r\n        })\r\n      });\r\n      const result = await response.json();\r\n      return result.data?.organizations || [];\r\n    });\r\n\r\n    // 3. éªŒè¯æ•°æ®ä¸€è‡´æ€§ - è€ƒè™‘çŠ¶æ€æ˜¾ç¤ºçš„æœ¬åœ°åŒ–\r\n    if (frontendData.length > 0 && apiData.length > 0) {\r\n      const firstFrontendItem = frontendData[0];\r\n      const firstApiItem = apiData[0];\r\n\r\n      expect(firstFrontendItem.code).toBe(firstApiItem.code);\r\n      expect(firstFrontendItem.name).toBe(firstApiItem.name);\r\n      expect(firstFrontendItem.type).toBe(firstApiItem.unitType);\r\n      \r\n      // çŠ¶æ€å­—æ®µå¤„ç†æœ¬åœ°åŒ–æ˜ å°„\r\n      const statusMap = {\r\n        'ACTIVE': 'å¯ç”¨',\r\n        'INACTIVE': 'ç¦ç”¨',\r\n        'PLANNED': 'è®¡åˆ’'\r\n      };\r\n      const expectedStatus = statusMap[firstApiItem.status] || firstApiItem.status;\r\n      expect(firstFrontendItem.status).toBe(expectedStatus);\r\n    }\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/canvas-e2e.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/optimization-verification-e2e.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":124,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":124,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test, expect } from '@playwright/test';\r\n\r\ntest.describe('ä¼˜åŒ–æ•ˆæœéªŒè¯æµ‹è¯•', () => {\r\n  \r\n  test('Phase 2: éªŒè¯ç®€åŒ–åçš„å‰ç«¯éªŒè¯ä½“ç³»', async ({ page }) => {\r\n    await page.goto('/organizations');\r\n\r\n    // 1. éªŒè¯åŸºç¡€å‰ç«¯éªŒè¯ä¿ç•™\r\n    await page.getByRole('button', { name: 'æ–°å¢ç»„ç»‡å•å…ƒ' }).click();\r\n    \r\n    const modal = page.locator('[role=\"dialog\"]');\r\n    if (await modal.isVisible()) {\r\n      // æµ‹è¯•å¿…å¡«å­—æ®µéªŒè¯\r\n      const submitButton = modal.getByRole('button', { name: 'ç¡®å®š' });\r\n      await submitButton.click();\r\n      \r\n      // åº”è¯¥æ˜¾ç¤ºåŸºç¡€éªŒè¯é”™è¯¯\r\n      await expect(\r\n        modal.getByText('è¯·å¡«å†™åç§°').or(modal.getByText('åç§°ä¸èƒ½ä¸ºç©º'))\r\n      ).toBeVisible();\r\n      \r\n      // æµ‹è¯•é•¿åº¦é™åˆ¶\r\n      await modal.locator('input[name=\"name\"]').fill('a'.repeat(101));\r\n      await submitButton.click();\r\n      \r\n      await expect(\r\n        modal.getByText('åç§°è¿‡é•¿').or(modal.getByText('è¶…å‡ºæœ€å¤§é•¿åº¦'))\r\n      ).toBeVisible();\r\n    }\r\n  });\r\n\r\n  test('Phase 2: éªŒè¯Zodå¤æ‚éªŒè¯å·²ç®€åŒ–', async ({ page }) => {\r\n    // éªŒè¯å‰ç«¯ä¸å†è¿›è¡Œå¤æ‚çš„è¿è¡Œæ—¶éªŒè¯\r\n    await page.goto('/organizations');\r\n    \r\n    // ç›‘å¬æ§åˆ¶å°ï¼Œåº”è¯¥æ²¡æœ‰å¤æ‚çš„ZodéªŒè¯æ—¥å¿—\r\n    const complexValidationLogs = [];\r\n    page.on('console', msg => {\r\n      const text = msg.text();\r\n      if (text.includes('ZodError') || text.includes('ZodSchema') || \r\n          text.includes('validateOrganizationUnit')) {\r\n        complexValidationLogs.push(text);\r\n      }\r\n    });\r\n\r\n    // æ‰§è¡Œä¸€äº›æ“ä½œ\r\n    await page.getByRole('button', { name: 'æ–°å¢ç»„ç»‡å•å…ƒ' }).click();\r\n    await page.waitForTimeout(500);\r\n\r\n    // åº”è¯¥æ²¡æœ‰å¤æ‚éªŒè¯æ—¥å¿—\r\n    expect(complexValidationLogs.length).toBe(0);\r\n  });\r\n\r\n  test('Phase 3: éªŒè¯DDDç®€åŒ–æ•ˆæœ', async ({ page }) => {\r\n    // æµ‹è¯•åç«¯APIå“åº”æ—¶é—´æ”¹å–„\r\n    const startTime = Date.now();\r\n    \r\n    const response = await page.evaluate(async () => {\r\n      const response = await fetch('http://localhost:9090/api/v1/organization-units', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          name: 'æ€§èƒ½æµ‹è¯•éƒ¨é—¨',\r\n          unit_type: 'DEPARTMENT',\r\n          parent_code: null\r\n        })\r\n      });\r\n      return {\r\n        status: response.status,\r\n        ok: response.ok,\r\n        data: await response.json()\r\n      };\r\n    });\r\n    \r\n    const responseTime = Date.now() - startTime;\r\n    console.log(`ç®€åŒ–åAPIå“åº”æ—¶é—´: ${responseTime}ms`);\r\n    \r\n    // éªŒè¯å“åº”æˆåŠŸä¸”æ€§èƒ½è‰¯å¥½\r\n    expect(response.status).toBe(201);\r\n    expect(responseTime).toBeLessThan(500); // ç®€åŒ–ååº”è¯¥æ›´å¿«\r\n  });\r\n\r\n  test('ä¼˜åŒ–æ”¶ç›Šé‡åŒ–éªŒè¯', async ({ page }) => {\r\n    await page.goto('/organizations');\r\n    \r\n    // 1. éªŒè¯æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–ï¼ˆé€šè¿‡ç½‘ç»œè¯·æ±‚å¤§å°ï¼‰\r\n    const networkRequests = [];\r\n    page.on('response', response => {\r\n      if (response.url().includes('.js') || response.url().includes('.css')) {\r\n        networkRequests.push({\r\n          url: response.url(),\r\n          size: response.headers()['content-length']\r\n        });\r\n      }\r\n    });\r\n\r\n    await page.reload();\r\n    await page.waitForLoadState('networkidle');\r\n\r\n    // è®¡ç®—æ€»çš„å‰ç«¯èµ„æºå¤§å°\r\n    const totalSize = networkRequests.reduce((sum, req) => {\r\n      return sum + (parseInt(req.size) || 0);\r\n    }, 0);\r\n\r\n    console.log(`å‰ç«¯èµ„æºæ€»å¤§å°: ${(totalSize / 1024).toFixed(2)}KB`);\r\n    \r\n    // éªŒè¯ä½“ç§¯åœ¨åˆç†èŒƒå›´å†…ï¼ˆç®€åŒ–ååº”è¯¥æ›´å°ï¼‰\r\n    expect(totalSize).toBeLessThan(2 * 1024 * 1024); // < 2MB\r\n\r\n    // 2. éªŒè¯æœåŠ¡æ•°é‡å‡å°‘æ•ˆæœ\r\n    const activeServices = [];\r\n    const servicePorts = [8090, 9090]; // åªæœ‰2ä¸ªæ ¸å¿ƒæœåŠ¡\r\n\r\n    for (const port of servicePorts) {\r\n      try {\r\n        const response = await page.evaluate(async (p) => {\r\n          const res = await fetch(`http://localhost:${p}/health`, {\r\n            signal: AbortSignal.timeout(2000)\r\n          });\r\n          return res.ok;\r\n        }, port);\r\n        \r\n        if (response) activeServices.push(port);\r\n      } catch (error) {\r\n        // æœåŠ¡ä¸å¯ç”¨\r\n      }\r\n    }\r\n\r\n    // éªŒè¯åªæœ‰2ä¸ªæœåŠ¡åœ¨è¿è¡Œ\r\n    expect(activeServices.length).toBe(2);\r\n    expect(activeServices).toContain(8090); // æŸ¥è¯¢æœåŠ¡\r\n    expect(activeServices).toContain(9090); // å‘½ä»¤æœåŠ¡\r\n  });\r\n\r\n  test('ç³»ç»Ÿç¨³å®šæ€§éªŒè¯æµ‹è¯•', async ({ page }) => {\r\n    // è¿ç»­æ“ä½œæµ‹è¯•ç³»ç»Ÿç¨³å®šæ€§\r\n    await page.goto('/organizations');\r\n\r\n    const operations = [];\r\n    \r\n    for (let i = 0; i < 5; i++) {\r\n      const startTime = Date.now();\r\n      \r\n      try {\r\n        // æ‰§è¡Œåˆ›å»ºæ“ä½œ\r\n        const response = await page.evaluate(async (index) => {\r\n          const response = await fetch('http://localhost:9090/api/v1/organization-units', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n              name: `ç¨³å®šæ€§æµ‹è¯•éƒ¨é—¨${index}`,\r\n              unit_type: 'DEPARTMENT',\r\n              parent_code: null\r\n            })\r\n          });\r\n          return response.ok;\r\n        }, i);\r\n        \r\n        const duration = Date.now() - startTime;\r\n        operations.push({ success: response, duration });\r\n        \r\n      } catch (error) {\r\n        operations.push({ success: false, duration: Date.now() - startTime, error });\r\n      }\r\n\r\n      await page.waitForTimeout(100); // çŸ­æš‚é—´éš”\r\n    }\r\n\r\n    // éªŒè¯ç¨³å®šæ€§æŒ‡æ ‡\r\n    const successRate = operations.filter(op => op.success).length / operations.length;\r\n    const avgDuration = operations.reduce((sum, op) => sum + op.duration, 0) / operations.length;\r\n\r\n    console.log(`æˆåŠŸç‡: ${(successRate * 100).toFixed(2)}%`);\r\n    console.log(`å¹³å‡å“åº”æ—¶é—´: ${avgDuration.toFixed(2)}ms`);\r\n\r\n    // æ–­è¨€ç¨³å®šæ€§è¦æ±‚\r\n    expect(successRate).toBeGreaterThan(0.8); // æˆåŠŸç‡ > 80%\r\n    expect(avgDuration).toBeLessThan(1000);   // å¹³å‡å“åº”æ—¶é—´ < 1ç§’\r\n  });\r\n\r\n  test('ç›‘æ§æŒ‡æ ‡éªŒè¯æµ‹è¯•', async ({ page }) => {\r\n    await page.goto('/organizations');\r\n\r\n    // éªŒè¯ç›‘æ§æŒ‡æ ‡ç«¯ç‚¹å¯è®¿é—®\r\n    const metricsResponse = await page.evaluate(async () => {\r\n      try {\r\n        const response = await fetch('http://localhost:8090/metrics');\r\n        return {\r\n          status: response.status,\r\n          text: await response.text()\r\n        };\r\n      } catch (error) {\r\n        return { error: error.message };\r\n      }\r\n    });\r\n\r\n    expect(metricsResponse.status).toBe(200);\r\n    expect(metricsResponse.text).toContain('http_requests_total');\r\n    expect(metricsResponse.text).toContain('organization_operations_total');\r\n\r\n    // æ‰§è¡Œä¸€äº›æ“ä½œç”ŸæˆæŒ‡æ ‡\r\n    await page.evaluate(async () => {\r\n      await fetch('http://localhost:8090/graphql', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: '{ organizations(first: 50) { code name } }'\r\n        })\r\n      });\r\n    });\r\n\r\n    // å†æ¬¡æ£€æŸ¥æŒ‡æ ‡æ›´æ–°\r\n    const updatedMetrics = await page.evaluate(async () => {\r\n      const response = await fetch('http://localhost:8090/metrics');\r\n      return response.text();\r\n    });\r\n\r\n    // éªŒè¯ä¸šåŠ¡æŒ‡æ ‡è¢«æ­£ç¡®è®°å½•\r\n    expect(updatedMetrics).toContain('query_list');\r\n    expect(updatedMetrics).toContain('graphql-server');\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/regression-e2e.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":148,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":148,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":167,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":167,"endColumn":21},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":190,"column":7,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":190,"endColumn":20,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[5530,5543],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":192,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":192,"endColumn":22,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[5590,5603],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":194,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":194,"endColumn":22,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[5673,5686],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test, expect } from '@playwright/test';\r\n\r\ntest.describe('å›å½’æµ‹è¯•å’Œå…¼å®¹æ€§éªŒè¯', () => {\r\n  \r\n  test('å…³é”®åŠŸèƒ½å›å½’æµ‹è¯•', async ({ page }) => {\r\n    await page.goto('/organizations');\r\n\r\n    // 1. éªŒè¯åŸºæœ¬UIç»„ä»¶æ­£å¸¸å·¥ä½œ\r\n    await expect(page.getByText('ç»„ç»‡æ¶æ„ç®¡ç†')).toBeVisible();\r\n    await expect(page.getByRole('button', { name: 'æ–°å¢ç»„ç»‡å•å…ƒ' })).toBeVisible();\r\n    await expect(page.getByRole('button', { name: 'å¯¼å…¥æ•°æ®' })).toBeVisible();\r\n    await expect(page.getByRole('button', { name: 'å¯¼å‡ºæŠ¥å‘Š' })).toBeVisible();\r\n\r\n    // 2. éªŒè¯æ•°æ®åŠ è½½åŠŸèƒ½\r\n    await page.waitForTimeout(2000);\r\n    \r\n    const hasData = await page.locator('table tbody tr').count() > 0;\r\n    const hasNoDataMessage = await page.getByText('æš‚æ— ç»„ç»‡æ•°æ®').isVisible();\r\n    \r\n    expect(hasData || hasNoDataMessage).toBe(true);\r\n\r\n    // 3. éªŒè¯Canvasç»„ä»¶æ ·å¼å…¼å®¹æ€§\r\n    const canvasComponents = await page.locator('[class*=\"css-\"]').count();\r\n    expect(canvasComponents).toBeGreaterThan(0);\r\n  });\r\n\r\n  test('APIå…¼å®¹æ€§æµ‹è¯•', async ({ page }) => {\r\n    // éªŒè¯æ–°çš„ç»Ÿä¸€GraphQLæ¥å£å‘ä¸‹å…¼å®¹\r\n    \r\n    // 1. æµ‹è¯•GraphQLæŸ¥è¯¢\r\n    const graphqlResult = await page.evaluate(async () => {\r\n      const response = await fetch('http://localhost:8090/graphql', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: `{\r\n            organizations(first: 50) {\r\n              code\r\n              name\r\n              unitType\r\n              status\r\n              level\r\n              parentCode\r\n              createdAt\r\n              updatedAt\r\n            }\r\n          }`\r\n        })\r\n      });\r\n      return response.json();\r\n    });\r\n\r\n    expect(graphqlResult).toHaveProperty('data');\r\n    expect(graphqlResult.data).toHaveProperty('organizations');\r\n\r\n    // 2. æµ‹è¯•REST APIå…¼å®¹æ€§ï¼ˆå¦‚æœä¿ç•™ï¼‰\r\n    const restResult = await page.evaluate(async () => {\r\n      try {\r\n        const response = await fetch('http://localhost:8090/api/v1/organization-units');\r\n        return {\r\n          status: response.status,\r\n          ok: response.ok,\r\n          data: await response.json()\r\n        };\r\n      } catch (error) {\r\n        return { error: error.message };\r\n      }\r\n    });\r\n\r\n    expect(restResult.status).toBe(200);\r\n    // ä¿®æ­£ï¼šREST APIç›´æ¥è¿”å›æ•°æ®ï¼Œä¸åŒ…è£…åœ¨'data'å­—æ®µä¸­\r\n    expect(restResult.data).toHaveProperty('organizations');\r\n  });\r\n\r\n  test('æ•°æ®è¿ç§»éªŒè¯æµ‹è¯•', async ({ page }) => {\r\n    // éªŒè¯é‡æ„åæ•°æ®å®Œæ•´æ€§\r\n    await page.goto('/organizations');\r\n\r\n    // 1. éªŒè¯å·²çŸ¥çš„æµ‹è¯•æ•°æ®å­˜åœ¨\r\n    const knownOrganizations = [\r\n      'é«˜è°·é›†å›¢',\r\n      'æŠ€æœ¯éƒ¨'\r\n    ];\r\n\r\n    for (const orgName of knownOrganizations) {\r\n      // å°è¯•æŸ¥æ‰¾ç»„ç»‡æ•°æ®\r\n      const orgElement = page.getByText(orgName);\r\n      \r\n      if (await orgElement.isVisible()) {\r\n        console.log(`âœ“ æ‰¾åˆ°ç»„ç»‡: ${orgName}`);\r\n        \r\n        // éªŒè¯ç›¸å…³æ•°æ®å­—æ®µå®Œæ•´\r\n        const row = page.locator(`tr:has-text(\"${orgName}\")`);\r\n        const cells = await row.locator('td').allTextContents();\r\n        \r\n        expect(cells.length).toBeGreaterThan(3); // è‡³å°‘æœ‰ç¼–ç ã€åç§°ã€ç±»å‹ã€çŠ¶æ€\r\n      }\r\n    }\r\n\r\n    // 2. éªŒè¯æ•°æ®ç»“æ„å­—æ®µå®Œæ•´æ€§\r\n    const sampleData = await page.evaluate(async () => {\r\n      const response = await fetch('http://localhost:8090/graphql', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: `{\r\n            organizations(first: 50) {\r\n              code\r\n              name\r\n              unitType\r\n              status\r\n              level\r\n              parentCode\r\n            }\r\n          }`\r\n        })\r\n      });\r\n      const result = await response.json();\r\n      return result.data?.organizations?.[0];\r\n    });\r\n\r\n    if (sampleData) {\r\n      expect(sampleData).toHaveProperty('code');\r\n      expect(sampleData).toHaveProperty('name'); \r\n      expect(sampleData).toHaveProperty('unitType');\r\n      expect(sampleData).toHaveProperty('status');\r\n      expect(sampleData).toHaveProperty('level');\r\n      // parentCode å¯ä»¥ä¸º nullï¼Œæ‰€ä»¥ä½¿ç”¨ toHaveProperty\r\n      expect('parentCode' in sampleData).toBe(true);\r\n    }\r\n  });\r\n\r\n  test('è·¨æµè§ˆå™¨å…¼å®¹æ€§éªŒè¯', async ({ page, browserName }) => {\r\n    await page.goto('/organizations');\r\n    \r\n    console.log(`æµ‹è¯•æµè§ˆå™¨: ${browserName}`);\r\n\r\n    // 1. éªŒè¯åŸºæœ¬åŠŸèƒ½åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­æ­£å¸¸å·¥ä½œ\r\n    await expect(page.getByText('ç»„ç»‡æ¶æ„ç®¡ç†')).toBeVisible();\r\n\r\n    // 2. éªŒè¯JavaScriptåŠŸèƒ½\r\n    const jsTest = await page.evaluate(() => {\r\n      // æµ‹è¯•ç°ä»£JavaScriptç‰¹æ€§\r\n      try {\r\n        const testData = { test: 'value' };\r\n        const { test } = testData; // è§£æ„èµ‹å€¼\r\n        return Promise.resolve(test === 'value');\r\n      } catch (error) {\r\n        return false;\r\n      }\r\n    });\r\n\r\n    expect(jsTest).toBe(true);\r\n\r\n    // 3. éªŒè¯Canvas Kitåœ¨ä¸åŒæµè§ˆå™¨ä¸­çš„æ¸²æŸ“\r\n    const canvasStyles = await page.locator('body').getAttribute('style');\r\n    \r\n    if (canvasStyles) {\r\n      expect(canvasStyles).toContain('--cnvs-');\r\n    }\r\n\r\n    // 4. éªŒè¯ç½‘ç»œè¯·æ±‚åœ¨ä¸åŒæµè§ˆå™¨ä¸­æ­£å¸¸å·¥ä½œ\r\n    const apiTest = await page.evaluate(async () => {\r\n      try {\r\n        const response = await fetch('http://localhost:8090/health');\r\n        return response.ok;\r\n      } catch (error) {\r\n        return false;\r\n      }\r\n    });\r\n\r\n    expect(apiTest).toBe(true);\r\n  });\r\n\r\n  test('æ€§èƒ½å›å½’æµ‹è¯•', async ({ page }) => {\r\n    // éªŒè¯ä¼˜åŒ–åæ€§èƒ½ä¸åŠ£äºé‡æ„å‰\r\n\r\n    const startTime = Date.now();\r\n    await page.goto('/organizations');\r\n    await expect(page.getByText('ç»„ç»‡æ¶æ„ç®¡ç†')).toBeVisible();\r\n    const loadTime = Date.now() - startTime;\r\n\r\n    console.log(`é¡µé¢åŠ è½½æ—¶é—´: ${loadTime}ms`);\r\n\r\n    // 1. é¡µé¢åŠ è½½æ€§èƒ½ä¸åº”åŠ£åŒ–\r\n    expect(loadTime).toBeLessThan(5000); // 5ç§’å†…åŠ è½½å®Œæˆ\r\n\r\n    // 2. æµ‹è¯•å†…å­˜ä½¿ç”¨æƒ…å†µ\r\n    const memoryUsage = await page.evaluate(() => {\r\n      // @ts-ignore\r\n      return performance.memory ? {\r\n        // @ts-ignore\r\n        usedJSHeapSize: performance.memory.usedJSHeapSize,\r\n        // @ts-ignore\r\n        totalJSHeapSize: performance.memory.totalJSHeapSize\r\n      } : null;\r\n    });\r\n\r\n    if (memoryUsage) {\r\n      console.log(`å†…å­˜ä½¿ç”¨: ${(memoryUsage.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB`);\r\n      \r\n      // å†…å­˜ä½¿ç”¨åº”è¯¥åœ¨åˆç†èŒƒå›´å†…\r\n      expect(memoryUsage.usedJSHeapSize).toBeLessThan(100 * 1024 * 1024); // < 100MB\r\n    }\r\n\r\n    // 3. æµ‹è¯•APIå“åº”æ€§èƒ½\r\n    const apiStartTime = Date.now();\r\n    await page.evaluate(async () => {\r\n      const response = await fetch('http://localhost:8090/graphql', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: '{ organizations(first: 50) { code name } }'\r\n        })\r\n      });\r\n      return response.json();\r\n    });\r\n    const apiTime = Date.now() - apiStartTime;\r\n\r\n    console.log(`APIå“åº”æ—¶é—´: ${apiTime}ms`);\r\n    expect(apiTime).toBeLessThan(2000); // APIå“åº” < 2ç§’\r\n  });\r\n\r\n  test('é”™è¯¯è¾¹ç•Œå’Œå¼‚å¸¸å¤„ç†æµ‹è¯•', async ({ page }) => {\r\n    await page.goto('/organizations');\r\n\r\n    // 1. æµ‹è¯•ç½‘ç»œä¸­æ–­å¤„ç†\r\n    await page.route('**/*', route => route.abort());\r\n    \r\n    // åˆ·æ–°é¡µé¢è§¦å‘ç½‘ç»œé”™è¯¯\r\n    await page.reload();\r\n\r\n    // åº”è¯¥æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯ç™½å±\r\n    const errorText = await page.textContent('body');\r\n    expect(errorText).not.toBe('');\r\n    \r\n    // æ¢å¤ç½‘ç»œ\r\n    await page.unroute('**/*');\r\n\r\n    // 2. æµ‹è¯•APIé”™è¯¯å¤„ç†\r\n    await page.route('**/graphql', route => {\r\n      route.fulfill({\r\n        status: 500,\r\n        contentType: 'application/json',\r\n        body: JSON.stringify({ error: 'Server Error' })\r\n      });\r\n    });\r\n\r\n    await page.reload();\r\n    \r\n    // åº”è¯¥æœ‰é”™è¯¯æç¤ºè€Œä¸æ˜¯å´©æºƒ\r\n    await expect(\r\n      page.getByText('åŠ è½½å¤±è´¥').or(page.getByText('æœåŠ¡å™¨é”™è¯¯'))\r\n    ).toBeVisible();\r\n\r\n    await page.unroute('**/graphql');\r\n\r\n    // 3. æµ‹è¯•JavaScripté”™è¯¯å¤„ç†\r\n    const jsErrors = [];\r\n    page.on('pageerror', error => jsErrors.push(error));\r\n\r\n    // è§¦å‘ä¸€äº›æ“ä½œ\r\n    await page.getByRole('button', { name: 'æ–°å¢ç»„ç»‡å•å…ƒ' }).click();\r\n    await page.waitForTimeout(1000);\r\n\r\n    // ä¸åº”è¯¥æœ‰æœªæ•è·çš„JavaScripté”™è¯¯\r\n    expect(jsErrors.length).toBe(0);\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/schema-validation.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/simple-connection-test.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/temporal-features.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/temporal-management-e2e.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":394,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":394,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12955,12958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12955,12958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€ç®¡ç†ç³»ç»Ÿç«¯åˆ°ç«¯æµ‹è¯•\r\n * éªŒè¯æ—¶æ€ç»„ç»‡æ¶æ„ç®¡ç†çš„å®Œæ•´ç”¨æˆ·æµç¨‹\r\n */\r\nimport { test, expect, Page } from '@playwright/test';\r\n\r\n// æµ‹è¯•é…ç½®\r\nconst BASE_URL = 'http://localhost:3000';\r\nconst TEST_TIMEOUT = 30000;\r\n\r\n// æµ‹è¯•æ•°æ®\r\nconst TEST_ORG = {\r\n  name: `E2Eæµ‹è¯•ç»„ç»‡_${Date.now()}`,\r\n  unit_type: 'DEPARTMENT',\r\n  status: 'ACTIVE',\r\n  description: 'E2Eè‡ªåŠ¨åŒ–æµ‹è¯•åˆ›å»ºçš„ç»„ç»‡'\r\n};\r\n\r\nconst PLANNED_ORG = {\r\n  name: `E2Eè®¡åˆ’ç»„ç»‡_${Date.now()}`,\r\n  unit_type: 'DEPARTMENT', \r\n  status: 'PLANNED',\r\n  description: 'E2Eè‡ªåŠ¨åŒ–æµ‹è¯•åˆ›å»ºçš„è®¡åˆ’ç»„ç»‡'\r\n};\r\n\r\ntest.describe('æ—¶æ€ç®¡ç†ç³»ç»Ÿ E2E æµ‹è¯•å¥—ä»¶', () => {\r\n  \r\n  test.beforeEach(async ({ page }) => {\r\n    // è®¾ç½®æµ‹è¯•è¶…æ—¶\r\n    test.setTimeout(TEST_TIMEOUT);\r\n    \r\n    // å¯¼èˆªåˆ°åº”ç”¨ä¸»é¡µ\r\n    await page.goto(BASE_URL);\r\n    await page.waitForLoadState('networkidle');\r\n  });\r\n\r\n  test.describe('1. æ—¶æ€å¯¼èˆªåŠŸèƒ½æµ‹è¯•', () => {\r\n    \r\n    test('åº”è¯¥èƒ½å¤Ÿåˆ‡æ¢æ—¶æ€æ¨¡å¼', async ({ page }) => {\r\n      // éªŒè¯é¡µé¢åŠ è½½\r\n      await expect(page).toHaveTitle(/Cube Castle/);\r\n      \r\n      // æŸ¥æ‰¾æ—¶æ€å¯¼èˆªæ \r\n      const temporalNavbar = page.locator('[data-testid=\"temporal-navbar\"]');\r\n      await expect(temporalNavbar).toBeVisible();\r\n      \r\n      // æµ‹è¯•å½“å‰æ¨¡å¼ -> å†å²æ¨¡å¼\r\n      const historicalButton = page.locator('button:has-text(\"å†å²æ¨¡å¼\")');\r\n      await historicalButton.click();\r\n      \r\n      // éªŒè¯æ¨¡å¼åˆ‡æ¢\r\n      await expect(page.locator('[data-testid=\"mode-indicator\"]:has-text(\"å†å²\")')).toBeVisible();\r\n      \r\n      // æµ‹è¯•å†å²æ¨¡å¼ -> è§„åˆ’æ¨¡å¼  \r\n      const planningButton = page.locator('button:has-text(\"è§„åˆ’æ¨¡å¼\")');\r\n      await planningButton.click();\r\n      \r\n      // éªŒè¯æ¨¡å¼åˆ‡æ¢\r\n      await expect(page.locator('[data-testid=\"mode-indicator\"]:has-text(\"è§„åˆ’\")')).toBeVisible();\r\n      \r\n      // è¿”å›å½“å‰æ¨¡å¼\r\n      const currentButton = page.locator('button:has-text(\"å½“å‰æ¨¡å¼\")');\r\n      await currentButton.click();\r\n      \r\n      await expect(page.locator('[data-testid=\"mode-indicator\"]:has-text(\"å½“å‰\")')).toBeVisible();\r\n    });\r\n\r\n    test('åº”è¯¥åœ¨å†å²æ¨¡å¼ä¸‹ç¦ç”¨ç¼–è¾‘æ“ä½œ', async ({ page }) => {\r\n      // åˆ‡æ¢åˆ°å†å²æ¨¡å¼\r\n      await page.locator('button:has-text(\"å†å²æ¨¡å¼\")').click();\r\n      await page.waitForTimeout(1000);\r\n      \r\n      // éªŒè¯æ–°å¢æŒ‰é’®è¢«ç¦ç”¨æˆ–æ˜¾ç¤ºç¦ç”¨æ–‡æœ¬\r\n      const addButton = page.locator('button:has-text(\"æ–°å¢ç»„ç»‡\")').first();\r\n      await expect(addButton).toBeDisabled();\r\n    });\r\n  });\r\n\r\n  test.describe('2. ç»„ç»‡CRUDæ“ä½œæµ‹è¯•', () => {\r\n    \r\n    test('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºæ–°ç»„ç»‡', async ({ page }) => {\r\n      // ç‚¹å‡»æ–°å¢ç»„ç»‡æŒ‰é’®\r\n      const addButton = page.locator('button:has-text(\"æ–°å¢ç»„ç»‡\")').first();\r\n      await addButton.click();\r\n      \r\n      // éªŒè¯è¡¨å•å¼¹çª—æ‰“å¼€\r\n      const formModal = page.locator('[data-testid=\"organization-form\"]');\r\n      await expect(formModal).toBeVisible();\r\n      \r\n      // å¡«å†™è¡¨å•\r\n      await page.fill('[data-testid=\"form-field-name\"] input', TEST_ORG.name);\r\n      await page.selectOption('[data-testid=\"form-field-unit-type\"] select', TEST_ORG.unit_type);\r\n      await page.fill('[data-testid=\"form-field-description\"] textarea', TEST_ORG.description);\r\n      \r\n      // æäº¤è¡¨å•\r\n      const submitButton = page.locator('[data-testid=\"form-submit-button\"]');\r\n      await submitButton.click();\r\n      \r\n      // éªŒè¯åˆ›å»ºæˆåŠŸ - ç­‰å¾…è¡¨å•å…³é—­\r\n      await expect(formModal).not.toBeVisible();\r\n      \r\n      // éªŒè¯ç»„ç»‡å‡ºç°åœ¨åˆ—è¡¨ä¸­\r\n      await page.waitForTimeout(2000); // ç­‰å¾…æ•°æ®åŠ è½½\r\n      await expect(page.locator(`text=${TEST_ORG.name}`).first()).toBeVisible();\r\n    });\r\n\r\n    test('åº”è¯¥èƒ½å¤Ÿç¼–è¾‘ç°æœ‰ç»„ç»‡', async ({ page }) => {\r\n      // å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ç»‡\r\n      await createTestOrganization(page, TEST_ORG);\r\n      \r\n      // æ‰¾åˆ°å¹¶ç‚¹å‡»ç¼–è¾‘æŒ‰é’®\r\n      const editButton = page.locator(`tr:has-text(\"${TEST_ORG.name}\") button[title*=\"ç¼–è¾‘\"]`).first();\r\n      await editButton.click();\r\n      \r\n      // éªŒè¯ç¼–è¾‘è¡¨å•æ‰“å¼€\r\n      const formModal = page.locator('[data-testid=\"organization-form\"]');\r\n      await expect(formModal).toBeVisible();\r\n      \r\n      // ä¿®æ”¹åç§°\r\n      const updatedName = `${TEST_ORG.name}_å·²ç¼–è¾‘`;\r\n      await page.fill('[data-testid=\"form-field-name\"] input', updatedName);\r\n      \r\n      // æäº¤ç¼–è¾‘\r\n      await page.locator('[data-testid=\"form-submit-button\"]').click();\r\n      await expect(formModal).not.toBeVisible();\r\n      \r\n      // éªŒè¯ç¼–è¾‘æˆåŠŸ\r\n      await page.waitForTimeout(2000);\r\n      await expect(page.locator(`text=${updatedName}`).first()).toBeVisible();\r\n    });\r\n  });\r\n\r\n  test.describe('3. è®¡åˆ’ç»„ç»‡åˆ›å»ºæµ‹è¯•', () => {\r\n    \r\n    test('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºè®¡åˆ’ç»„ç»‡', async ({ page }) => {\r\n      // ç‚¹å‡»æ–°å¢è®¡åˆ’ç»„ç»‡æŒ‰é’®\r\n      const plannedButton = page.locator('button:has-text(\"æ–°å¢è®¡åˆ’ç»„ç»‡\")');\r\n      await plannedButton.click();\r\n      \r\n      // éªŒè¯è¡¨å•å¼¹çª—æ‰“å¼€\r\n      const formModal = page.locator('[data-testid=\"organization-form\"]');\r\n      await expect(formModal).toBeVisible();\r\n      \r\n      // å¡«å†™åŸºæœ¬ä¿¡æ¯\r\n      await page.fill('[data-testid=\"form-field-name\"] input', PLANNED_ORG.name);\r\n      await page.fill('[data-testid=\"form-field-description\"] textarea', PLANNED_ORG.description);\r\n      \r\n      // éªŒè¯æ—¶æ€ç®¡ç†è‡ªåŠ¨å¯ç”¨\r\n      const temporalCheckbox = page.locator('[data-testid=\"form-field-is-temporal\"] input');\r\n      await expect(temporalCheckbox).toBeChecked();\r\n      \r\n      // è®¾ç½®ç”Ÿæ•ˆæ—¶é—´ï¼ˆæ˜å¤©ï¼‰\r\n      const tomorrow = new Date();\r\n      tomorrow.setDate(tomorrow.getDate() + 1);\r\n      const tomorrowStr = tomorrow.toISOString().slice(0, 16);\r\n      \r\n      await page.fill('[data-testid=\"form-field-effective-from\"] input', tomorrowStr);\r\n      \r\n      // å¡«å†™å˜æ›´åŸå› \r\n      await page.fill('[data-testid=\"form-field-change-reason\"] textarea', 'åˆ›å»ºè®¡åˆ’ä¸­çš„æ–°éƒ¨é—¨');\r\n      \r\n      // æäº¤è¡¨å•\r\n      await page.locator('[data-testid=\"form-submit-button\"]').click();\r\n      await expect(formModal).not.toBeVisible();\r\n      \r\n      // éªŒè¯è®¡åˆ’ç»„ç»‡åˆ›å»ºæˆåŠŸ\r\n      await page.waitForTimeout(2000);\r\n      await expect(page.locator(`text=${PLANNED_ORG.name}`).first()).toBeVisible();\r\n      \r\n      // éªŒè¯çŠ¶æ€ä¸ºè®¡åˆ’ä¸­\r\n      const plannedBadge = page.locator(`tr:has-text(\"${PLANNED_ORG.name}\") text=è®¡åˆ’`).first();\r\n      await expect(plannedBadge).toBeVisible();\r\n    });\r\n  });\r\n\r\n  test.describe('4. æ—¶æ€è¡¨æ ¼åŠŸèƒ½æµ‹è¯•', () => {\r\n    \r\n    test('åº”è¯¥æ˜¾ç¤ºæ—¶æ€æŒ‡ç¤ºå™¨å’ŒçŠ¶æ€', async ({ page }) => {\r\n      // éªŒè¯æ—¶æ€è¡¨æ ¼å­˜åœ¨\r\n      const temporalTable = page.locator('[data-testid=\"temporal-table\"]');\r\n      if (await temporalTable.isVisible()) {\r\n        // éªŒè¯æ—¶æ€æŒ‡ç¤ºå™¨åˆ—å­˜åœ¨\r\n        await expect(page.locator('th:has-text(\"æ—¶æ€çŠ¶æ€\")')).toBeVisible();\r\n      }\r\n      \r\n      // éªŒè¯çŠ¶æ€åˆ—æ˜¾ç¤º\r\n      await expect(page.locator('th:has-text(\"çŠ¶æ€\")')).toBeVisible();\r\n    });\r\n\r\n    test('åº”è¯¥æ”¯æŒæœç´¢å’Œç­›é€‰', async ({ page }) => {\r\n      // æŸ¥æ‰¾æœç´¢è¾“å…¥æ¡†\r\n      const searchInput = page.locator('input[placeholder*=\"æœç´¢\"]').first();\r\n      if (await searchInput.isVisible()) {\r\n        // è¾“å…¥æœç´¢å…³é”®è¯\r\n        await searchInput.fill('éƒ¨é—¨');\r\n        await page.waitForTimeout(1000);\r\n        \r\n        // éªŒè¯æœç´¢ç»“æœ\r\n        const searchResults = page.locator('table tbody tr');\r\n        const count = await searchResults.count();\r\n        expect(count).toBeGreaterThanOrEqual(0);\r\n      }\r\n    });\r\n  });\r\n\r\n  test.describe('5. æ—¶é—´çº¿åŠŸèƒ½æµ‹è¯•', () => {\r\n    \r\n    test('åº”è¯¥èƒ½å¤ŸæŸ¥çœ‹ç»„ç»‡æ—¶é—´çº¿', async ({ page }) => {\r\n      // å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ç»‡\r\n      await createTestOrganization(page, TEST_ORG);\r\n      \r\n      // ç‚¹å‡»æ—¶é—´çº¿æŒ‰é’®\r\n      const timelineButton = page.locator(`tr:has-text(\"${TEST_ORG.name}\") button[title*=\"æ—¶é—´çº¿\"]`).first();\r\n      if (await timelineButton.isVisible()) {\r\n        await timelineButton.click();\r\n        \r\n        // éªŒè¯æ—¶é—´çº¿ç»„ä»¶åŠ è½½\r\n        await expect(page.locator('[data-testid=\"timeline-component\"]')).toBeVisible();\r\n        \r\n        // éªŒè¯æ—¶é—´çº¿äº‹ä»¶\r\n        const timelineEvents = page.locator('[data-testid=\"timeline-event\"]');\r\n        const eventCount = await timelineEvents.count();\r\n        expect(eventCount).toBeGreaterThanOrEqual(1); // è‡³å°‘åº”è¯¥æœ‰åˆ›å»ºäº‹ä»¶\r\n      }\r\n    });\r\n  });\r\n\r\n  test.describe('6. è®°å½•å¯¹æ¯”åŠŸèƒ½æµ‹è¯•', () => {\r\n    \r\n    test('åº”è¯¥èƒ½å¤Ÿè¿›è¡Œè®°å½•å¯¹æ¯”', async ({ page }) => {\r\n      // è®¿é—®è®°å½•å¯¹æ¯”é¡µé¢ï¼ˆå¦‚æœæœ‰ç›´æ¥é“¾æ¥ï¼‰\r\n      const versionComparisonButton = page.locator('button:has-text(\"è®°å½•å¯¹æ¯”\")').first();\r\n      if (await versionComparisonButton.isVisible()) {\r\n        await versionComparisonButton.click();\r\n        \r\n        // éªŒè¯è®°å½•å¯¹æ¯”ç•Œé¢åŠ è½½\r\n        await expect(page.locator('[data-testid=\"record-comparison\"]')).toBeVisible();\r\n        \r\n        // éªŒè¯æ—¥æœŸé€‰æ‹©å™¨\r\n        const versionSelectors = page.locator('select');\r\n        const selectorCount = await versionSelectors.count();\r\n        expect(selectorCount).toBeGreaterThanOrEqual(2); // è‡³å°‘ä¸¤ä¸ªæ—¥æœŸé€‰æ‹©å™¨\r\n      }\r\n    });\r\n  });\r\n\r\n  test.describe('7. æ—¶æ€è®¾ç½®åŠŸèƒ½æµ‹è¯•', () => {\r\n    \r\n    test('åº”è¯¥èƒ½å¤Ÿæ‰“å¼€å’Œé…ç½®æ—¶æ€è®¾ç½®', async ({ page }) => {\r\n      // æŸ¥æ‰¾è®¾ç½®æŒ‰é’®\r\n      const settingsButton = page.locator('button:has-text(\"è®¾ç½®\")').first();\r\n      if (await settingsButton.isVisible()) {\r\n        await settingsButton.click();\r\n        \r\n        // éªŒè¯è®¾ç½®å¼¹çª—æ‰“å¼€\r\n        const settingsModal = page.locator('[data-testid=\"temporal-settings\"]');\r\n        await expect(settingsModal).toBeVisible();\r\n        \r\n        // æµ‹è¯•åŸºç¡€è®¾ç½®\r\n        const limitSelect = page.locator('[data-testid=\"settings-limit\"] select');\r\n        if (await limitSelect.isVisible()) {\r\n          await limitSelect.selectOption('100');\r\n        }\r\n        \r\n        // æµ‹è¯•åŒ…å«åœç”¨æ•°æ®é€‰é¡¹\r\n        const includeInactiveCheckbox = page.locator('[data-testid=\"settings-include-inactive\"] input');\r\n        if (await includeInactiveCheckbox.isVisible()) {\r\n          await includeInactiveCheckbox.check();\r\n        }\r\n        \r\n        // åº”ç”¨è®¾ç½®\r\n        const applyButton = page.locator('button:has-text(\"åº”ç”¨è®¾ç½®\")');\r\n        if (await applyButton.isVisible() && await applyButton.isEnabled()) {\r\n          await applyButton.click();\r\n          await expect(settingsModal).not.toBeVisible();\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  test.describe('8. é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•', () => {\r\n    \r\n    test('åº”è¯¥å¤„ç†ç½‘ç»œé”™è¯¯', async ({ page }) => {\r\n      // æ‹¦æˆªç½‘ç»œè¯·æ±‚å¹¶æ¨¡æ‹Ÿé”™è¯¯\r\n      await page.route('**/api/**', route => {\r\n        route.abort('failed');\r\n      });\r\n      \r\n      // å°è¯•åŠ è½½æ•°æ®\r\n      await page.reload();\r\n      \r\n      // éªŒè¯é”™è¯¯æç¤º\r\n      await expect(page.locator('text=åŠ è½½å¤±è´¥').or(page.locator('text=ç½‘ç»œé”™è¯¯'))).toBeVisible({ timeout: 10000 });\r\n    });\r\n\r\n    test('åº”è¯¥å¤„ç†ç©ºæ•°æ®çŠ¶æ€', async ({ page }) => {\r\n      // æŸ¥æ‰¾ç©ºçŠ¶æ€æç¤º\r\n      const emptyState = page.locator('text=æš‚æ— æ•°æ®').or(page.locator('text=æ²¡æœ‰æ‰¾åˆ°'));\r\n      if (await emptyState.isVisible()) {\r\n        await expect(emptyState).toBeVisible();\r\n      }\r\n    });\r\n  });\r\n\r\n  test.describe('9. æ€§èƒ½å’Œå“åº”æ€§æµ‹è¯•', () => {\r\n    \r\n    test('é¡µé¢åŠ è½½æ—¶é—´åº”è¯¥åˆç†', async ({ page }) => {\r\n      const startTime = Date.now();\r\n      \r\n      await page.goto(BASE_URL);\r\n      await page.waitForLoadState('networkidle');\r\n      \r\n      const loadTime = Date.now() - startTime;\r\n      \r\n      // éªŒè¯é¡µé¢åŠ è½½æ—¶é—´å°äº5ç§’\r\n      expect(loadTime).toBeLessThan(5000);\r\n      console.log(`é¡µé¢åŠ è½½æ—¶é—´: ${loadTime}ms`);\r\n    });\r\n\r\n    test('åº”è¯¥å“åº”å¿«é€Ÿäº¤äº’', async ({ page }) => {\r\n      // æµ‹è¯•æŒ‰é’®ç‚¹å‡»å“åº”\r\n      const buttons = page.locator('button:visible');\r\n      const buttonCount = await buttons.count();\r\n      \r\n      if (buttonCount > 0) {\r\n        const startTime = Date.now();\r\n        await buttons.first().click();\r\n        const responseTime = Date.now() - startTime;\r\n        \r\n        // éªŒè¯äº¤äº’å“åº”æ—¶é—´å°äº1ç§’\r\n        expect(responseTime).toBeLessThan(1000);\r\n        console.log(`æŒ‰é’®å“åº”æ—¶é—´: ${responseTime}ms`);\r\n      }\r\n    });\r\n  });\r\n\r\n  test.describe('10. é›†æˆæµ‹è¯•', () => {\r\n    \r\n    test('å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•', async ({ page }) => {\r\n      console.log('å¼€å§‹å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•...');\r\n      \r\n      // 1. åˆ›å»ºç»„ç»‡\r\n      console.log('æ­¥éª¤1: åˆ›å»ºç»„ç»‡');\r\n      await createTestOrganization(page, {\r\n        ...TEST_ORG,\r\n        name: `å®Œæ•´æµç¨‹æµ‹è¯•_${Date.now()}`\r\n      });\r\n      \r\n      // 2. åˆ‡æ¢åˆ°å†å²æ¨¡å¼\r\n      console.log('æ­¥éª¤2: åˆ‡æ¢æ—¶æ€æ¨¡å¼');\r\n      const historicalButton = page.locator('button:has-text(\"å†å²æ¨¡å¼\")');\r\n      if (await historicalButton.isVisible()) {\r\n        await historicalButton.click();\r\n        await page.waitForTimeout(1000);\r\n      }\r\n      \r\n      // 3. è¿”å›å½“å‰æ¨¡å¼\r\n      console.log('æ­¥éª¤3: è¿”å›å½“å‰æ¨¡å¼');\r\n      const currentButton = page.locator('button:has-text(\"å½“å‰æ¨¡å¼\")');\r\n      if (await currentButton.isVisible()) {\r\n        await currentButton.click();\r\n        await page.waitForTimeout(1000);\r\n      }\r\n      \r\n      // 4. åˆ›å»ºè®¡åˆ’ç»„ç»‡\r\n      console.log('æ­¥éª¤4: åˆ›å»ºè®¡åˆ’ç»„ç»‡');\r\n      const plannedButton = page.locator('button:has-text(\"æ–°å¢è®¡åˆ’ç»„ç»‡\")');\r\n      if (await plannedButton.isVisible()) {\r\n        await plannedButton.click();\r\n        \r\n        const formModal = page.locator('[data-testid=\"organization-form\"]');\r\n        if (await formModal.isVisible()) {\r\n          await page.fill('[data-testid=\"form-field-name\"] input', `è®¡åˆ’æµç¨‹æµ‹è¯•_${Date.now()}`);\r\n          \r\n          // è®¾ç½®æœªæ¥ç”Ÿæ•ˆæ—¶é—´\r\n          const tomorrow = new Date();\r\n          tomorrow.setDate(tomorrow.getDate() + 1);\r\n          const tomorrowStr = tomorrow.toISOString().slice(0, 16);\r\n          \r\n          await page.fill('[data-testid=\"form-field-effective-from\"] input', tomorrowStr);\r\n          await page.fill('[data-testid=\"form-field-change-reason\"] textarea', 'å®Œæ•´æµç¨‹æµ‹è¯•');\r\n          \r\n          await page.locator('[data-testid=\"form-submit-button\"]').click();\r\n          await page.waitForTimeout(2000);\r\n        }\r\n      }\r\n      \r\n      console.log('å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•å®Œæˆ');\r\n    });\r\n  });\r\n});\r\n\r\n// è¾…åŠ©å‡½æ•°ï¼šåˆ›å»ºæµ‹è¯•ç»„ç»‡\r\nasync function createTestOrganization(page: Page, orgData: any) {\r\n  const addButton = page.locator('button:has-text(\"æ–°å¢ç»„ç»‡\")').first();\r\n  await addButton.click();\r\n  \r\n  const formModal = page.locator('[data-testid=\"organization-form\"]');\r\n  await expect(formModal).toBeVisible();\r\n  \r\n  await page.fill('[data-testid=\"form-field-name\"] input', orgData.name);\r\n  await page.selectOption('[data-testid=\"form-field-unit-type\"] select', orgData.unit_type);\r\n  if (orgData.description) {\r\n    await page.fill('[data-testid=\"form-field-description\"] textarea', orgData.description);\r\n  }\r\n  \r\n  await page.locator('[data-testid=\"form-submit-button\"]').click();\r\n  await expect(formModal).not.toBeVisible();\r\n  await page.waitForTimeout(2000);\r\n}","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/e2e/temporal-management.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'noResultsMessage' is assigned a value but never used.","line":301,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":301,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * æ—¶æ€ç®¡ç†E2Eæµ‹è¯•\r\n * æµ‹è¯•æ—¶æ€æŸ¥è¯¢ã€äº‹ä»¶åˆ›å»ºå’Œæ—¶é—´è½´å¯¼èˆªåŠŸèƒ½\r\n */\r\n\r\nimport { test, expect } from '@playwright/test';\r\n\r\nconst BASE_URL = 'http://localhost:3000';\r\nconst TEMPORAL_API_URL = 'http://localhost:9091';\r\n\r\n// æµ‹è¯•æ•°æ®\r\nconst TEST_TENANT_ID = '3b99930c-4dc6-4cc9-8e4d-7d960a931cb9';\r\nconst TEST_ORG_CODE = '1000056';\r\n\r\ntest.describe('æ—¶æ€ç®¡ç†åŠŸèƒ½', () => {\r\n  test.beforeEach(async ({ page }) => {\r\n    // å¯¼èˆªåˆ°æ—¶æ€ç®¡ç†æ¼”ç¤ºé¡µé¢\r\n    await page.goto(`${BASE_URL}/temporal-demo`);\r\n    \r\n    // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ\r\n    await expect(page.locator('h1')).toContainText('æ—¶æ€ç®¡ç†é›†æˆæ¼”ç¤º');\r\n  });\r\n\r\n  test('åº”è¯¥æ˜¾ç¤ºæ—¶æ€æœåŠ¡çŠ¶æ€', async ({ page }) => {\r\n    // æ£€æŸ¥æ—¶æ€æœåŠ¡çŠ¶æ€æŒ‡ç¤ºå™¨\r\n    const statusBadge = page.locator('[data-testid=\"temporal-service-status\"]').or(\r\n      page.locator('text=æ—¶æ€æœåŠ¡').first()\r\n    );\r\n    \r\n    // ç­‰å¾…çŠ¶æ€åŠ è½½\r\n    await expect(statusBadge).toBeVisible({ timeout: 10000 });\r\n    \r\n    // éªŒè¯æœåŠ¡çŠ¶æ€ï¼ˆæ­£å¸¸æˆ–å¼‚å¸¸ï¼‰\r\n    const badgeText = await statusBadge.textContent();\r\n    expect(['æ­£å¸¸', 'å¼‚å¸¸', 'æœªè¿æ¥']).toContain(badgeText?.split(':')[1]?.trim());\r\n  });\r\n\r\n  test('åº”è¯¥æ˜¾ç¤ºç»„ç»‡åˆ—è¡¨', async ({ page }) => {\r\n    // ç­‰å¾…ç»„ç»‡åˆ—è¡¨è¡¨æ ¼åŠ è½½\r\n    await expect(page.locator('table')).toBeVisible();\r\n    \r\n    // æ£€æŸ¥è¡¨æ ¼æ ‡é¢˜\r\n    await expect(page.locator('th')).toContainText('ç»„ç»‡ä»£ç ');\r\n    await expect(page.locator('th')).toContainText('ç»„ç»‡åç§°');\r\n    await expect(page.locator('th')).toContainText('çŠ¶æ€');\r\n    \r\n    // æ£€æŸ¥æ˜¯å¦æœ‰ç»„ç»‡æ•°æ®\r\n    const rows = page.locator('tbody tr');\r\n    await expect(rows).toHaveCountGreaterThan(0);\r\n  });\r\n\r\n  test('åº”è¯¥èƒ½å¤Ÿæœç´¢ç»„ç»‡', async ({ page }) => {\r\n    // è·å–æœç´¢æ¡†\r\n    const searchInput = page.locator('input[placeholder*=\"è¾“å…¥ç»„ç»‡åç§°\"]');\r\n    await expect(searchInput).toBeVisible();\r\n    \r\n    // è®°å½•åˆå§‹è¡Œæ•°\r\n    const initialRowCount = await page.locator('tbody tr').count();\r\n    \r\n    // æ‰§è¡Œæœç´¢\r\n    await searchInput.fill(TEST_ORG_CODE);\r\n    await searchInput.press('Enter');\r\n    \r\n    // ç­‰å¾…æœç´¢ç»“æœ\r\n    await page.waitForTimeout(500);\r\n    \r\n    // éªŒè¯æœç´¢ç»“æœ\r\n    const filteredRows = page.locator('tbody tr');\r\n    const filteredCount = await filteredRows.count();\r\n    \r\n    if (filteredCount > 0) {\r\n      // éªŒè¯æœç´¢ç»“æœåŒ…å«æœç´¢å…³é”®è¯\r\n      const firstRowCode = await filteredRows.first().locator('td').first().textContent();\r\n      expect(firstRowCode).toContain(TEST_ORG_CODE);\r\n    }\r\n    \r\n    expect(filteredCount).toBeLessThanOrEqual(initialRowCount);\r\n  });\r\n\r\n  test('åº”è¯¥èƒ½å¤Ÿæ‰“å¼€ç»„ç»‡è¯¦æƒ…é¢æ¿', async ({ page }) => {\r\n    // æ‰¾åˆ°ç¬¬ä¸€ä¸ª\"æŸ¥çœ‹è¯¦æƒ…\"æŒ‰é’®\r\n    const viewDetailsButton = page.locator('text=æŸ¥çœ‹è¯¦æƒ…').first();\r\n    await expect(viewDetailsButton).toBeVisible();\r\n    \r\n    // ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…\r\n    await viewDetailsButton.click();\r\n    \r\n    // ç­‰å¾…è¯¦æƒ…é¢æ¿æ‰“å¼€\r\n    await expect(page.locator('[data-testid=\"organization-detail-panel\"]').or(\r\n      page.locator('text=ç»„ç»‡è¯¦æƒ…').first()\r\n    )).toBeVisible({ timeout: 5000 });\r\n    \r\n    // éªŒè¯è¯¦æƒ…é¢æ¿å†…å®¹\r\n    await expect(page.locator('text=åŸºç¡€ä¿¡æ¯')).toBeVisible();\r\n    await expect(page.locator('text=æ—¶æ€ç®¡ç†ä¿¡æ¯')).toBeVisible();\r\n  });\r\n  \r\n  test('æ—¶é—´è½´å¯¼èˆªåŠŸèƒ½æµ‹è¯•', async ({ page }) => {\r\n    // å…ˆæ‰“å¼€ç»„ç»‡è¯¦æƒ…é¢æ¿\r\n    await page.locator('text=æŸ¥çœ‹è¯¦æƒ…').first().click();\r\n    await expect(page.locator('text=åŸºç¡€ä¿¡æ¯')).toBeVisible();\r\n    \r\n    // æ£€æŸ¥æ—¶é—´è½´æ˜¯å¦å­˜åœ¨\r\n    const timeline = page.locator('[data-testid=\"timeline\"]').or(\r\n      page.locator('.timeline-container').first()\r\n    );\r\n    \r\n    if (await timeline.isVisible()) {\r\n      // æ£€æŸ¥æ—¶é—´è½´èŠ‚ç‚¹\r\n      const timelineNodes = page.locator('[data-testid=\"timeline-node\"]').or(\r\n        page.locator('.timeline-node')\r\n      );\r\n      \r\n      const nodeCount = await timelineNodes.count();\r\n      if (nodeCount > 0) {\r\n        // ç‚¹å‡»ç¬¬ä¸€ä¸ªæ—¶é—´è½´èŠ‚ç‚¹\r\n        await timelineNodes.first().click();\r\n        \r\n        // éªŒè¯è¯¦æƒ…å†…å®¹æ›´æ–°\r\n        await expect(page.locator('input[value]').first()).toBeVisible();\r\n        \r\n        // å¦‚æœæœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œæµ‹è¯•åˆ‡æ¢\r\n        if (nodeCount > 1) {\r\n          await timelineNodes.nth(1).click();\r\n          await page.waitForTimeout(500);\r\n        }\r\n      }\r\n    }\r\n  });\r\n});\r\n\r\ntest.describe('æ—¶æ€APIé›†æˆæµ‹è¯•', () => {\r\n  test('æ—¶æ€æŸ¥è¯¢APIåº”è¯¥æ­£å¸¸å·¥ä½œ', async ({ request }) => {\r\n    // æµ‹è¯•å½“å‰è®°å½•æŸ¥è¯¢\r\n    const currentRecordResponse = await request.get(\r\n      `${TEMPORAL_API_URL}/api/v1/organization-units/${TEST_ORG_CODE}`,\r\n      {\r\n        headers: {\r\n          'X-Tenant-ID': TEST_TENANT_ID\r\n        }\r\n      }\r\n    );\r\n    \r\n    if (currentRecordResponse.ok()) {\r\n      const data = await currentRecordResponse.json();\r\n      expect(data).toHaveProperty('organizations');\r\n      expect(Array.isArray(data.organizations)).toBeTruthy();\r\n    } else {\r\n      // å¦‚æœ404ï¼Œè¯´æ˜æµ‹è¯•ç»„ç»‡ä¸å­˜åœ¨ï¼Œè¿™æ˜¯å¯æ¥å—çš„\r\n      expect([200, 404]).toContain(currentRecordResponse.status());\r\n    }\r\n  });\r\n  \r\n  test('å†å²è®°å½•æŸ¥è¯¢åº”è¯¥æ­£å¸¸å·¥ä½œ', async ({ request }) => {\r\n    const historyResponse = await request.get(\r\n      `${TEMPORAL_API_URL}/api/v1/organization-units/${TEST_ORG_CODE}?include_history=true&max_records=5`,\r\n      {\r\n        headers: {\r\n          'X-Tenant-ID': TEST_TENANT_ID\r\n        }\r\n      }\r\n    );\r\n    \r\n    if (historyResponse.ok()) {\r\n      const data = await historyResponse.json();\r\n      expect(data).toHaveProperty('organizations');\r\n      expect(data).toHaveProperty('result_count');\r\n    } else {\r\n      expect([200, 404]).toContain(historyResponse.status());\r\n    }\r\n  });\r\n  \r\n  test('æœªæ¥è®°å½•æŸ¥è¯¢åº”è¯¥æ­£å¸¸å·¥ä½œ', async ({ request }) => {\r\n    const futureResponse = await request.get(\r\n      `${TEMPORAL_API_URL}/api/v1/organization-units/${TEST_ORG_CODE}?include_future=true`,\r\n      {\r\n        headers: {\r\n          'X-Tenant-ID': TEST_TENANT_ID\r\n        }\r\n      }\r\n    );\r\n    \r\n    if (futureResponse.ok()) {\r\n      const data = await futureResponse.json();\r\n      expect(data).toHaveProperty('organizations');\r\n      expect(data).toHaveProperty('query_options');\r\n      expect(data.query_options.IncludeFuture).toBeTruthy();\r\n    } else {\r\n      expect([200, 404]).toContain(futureResponse.status());\r\n    }\r\n  });\r\n  \r\n  test('èŒƒå›´æŸ¥è¯¢åº”è¯¥æ­£å¸¸å·¥ä½œ', async ({ request }) => {\r\n    const rangeResponse = await request.get(\r\n      `${TEMPORAL_API_URL}/api/v1/organization-units/${TEST_ORG_CODE}?effective_from=2025-01-01&effective_to=2025-12-31`,\r\n      {\r\n        headers: {\r\n          'X-Tenant-ID': TEST_TENANT_ID\r\n        }\r\n      }\r\n    );\r\n    \r\n    if (rangeResponse.ok()) {\r\n      const data = await rangeResponse.json();\r\n      expect(data).toHaveProperty('organizations');\r\n      expect(data.query_options).toHaveProperty('EffectiveFrom');\r\n      expect(data.query_options).toHaveProperty('EffectiveTo');\r\n    } else {\r\n      expect([200, 404]).toContain(rangeResponse.status());\r\n    }\r\n  });\r\n  \r\n  test('æ—¶æ€äº‹ä»¶åˆ›å»ºAPIåº”è¯¥æ­£å¸¸å·¥ä½œ', async ({ request }) => {\r\n    // æµ‹è¯•UPDATEäº‹ä»¶\r\n    const updateEventData = {\r\n      event_type: 'UPDATE',\r\n      effective_date: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(), // æ˜å¤©\r\n      change_data: {\r\n        description: 'E2Eæµ‹è¯•æ›´æ–°æè¿°'\r\n      },\r\n      change_reason: 'E2Eè‡ªåŠ¨åŒ–æµ‹è¯•'\r\n    };\r\n    \r\n    const eventResponse = await request.post(\r\n      `${TEMPORAL_API_URL}/api/v1/organization-units/${TEST_ORG_CODE}/events`,\r\n      {\r\n        headers: {\r\n          'X-Tenant-ID': TEST_TENANT_ID,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        data: updateEventData\r\n      }\r\n    );\r\n    \r\n    if (eventResponse.ok()) {\r\n      const data = await eventResponse.json();\r\n      expect(data).toHaveProperty('event_id');\r\n      expect(data).toHaveProperty('event_type');\r\n      expect(data.event_type).toBe('UPDATE');\r\n      expect(data).toHaveProperty('status');\r\n      expect(data.status).toBe('processed');\r\n    } else {\r\n      // å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯å› ä¸ºç»„ç»‡ä¸å­˜åœ¨\r\n      expect([201, 404, 500]).toContain(eventResponse.status());\r\n    }\r\n  });\r\n});\r\n\r\ntest.describe('æ—¶æ€ç®¡ç†æ€§èƒ½æµ‹è¯•', () => {\r\n  test('é¡µé¢åŠ è½½æ€§èƒ½åº”è¯¥åœ¨å¯æ¥å—èŒƒå›´å†…', async ({ page }) => {\r\n    const startTime = Date.now();\r\n    \r\n    // å¯¼èˆªåˆ°é¡µé¢\r\n    await page.goto(`${BASE_URL}/temporal-demo`);\r\n    \r\n    // ç­‰å¾…å…³é”®å†…å®¹åŠ è½½\r\n    await expect(page.locator('h1')).toContainText('æ—¶æ€ç®¡ç†é›†æˆæ¼”ç¤º');\r\n    await expect(page.locator('table')).toBeVisible();\r\n    \r\n    const loadTime = Date.now() - startTime;\r\n    \r\n    // éªŒè¯åŠ è½½æ—¶é—´åœ¨3ç§’å†…\r\n    expect(loadTime).toBeLessThan(3000);\r\n    console.log(`é¡µé¢åŠ è½½æ—¶é—´: ${loadTime}ms`);\r\n  });\r\n  \r\n  test('ç»„ç»‡è¯¦æƒ…é¢æ¿æ‰“å¼€æ€§èƒ½', async ({ page }) => {\r\n    // å…ˆå¯¼èˆªåˆ°é¡µé¢\r\n    await page.goto(`${BASE_URL}/temporal-demo`);\r\n    await expect(page.locator('table')).toBeVisible();\r\n    \r\n    const startTime = Date.now();\r\n    \r\n    // ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…\r\n    await page.locator('text=æŸ¥çœ‹è¯¦æƒ…').first().click();\r\n    \r\n    // ç­‰å¾…è¯¦æƒ…é¢æ¿æ˜¾ç¤º\r\n    await expect(page.locator('text=åŸºç¡€ä¿¡æ¯')).toBeVisible();\r\n    \r\n    const openTime = Date.now() - startTime;\r\n    \r\n    // éªŒè¯æ‰“å¼€æ—¶é—´åœ¨2ç§’å†…\r\n    expect(openTime).toBeLessThan(2000);\r\n    console.log(`è¯¦æƒ…é¢æ¿æ‰“å¼€æ—¶é—´: ${openTime}ms`);\r\n  });\r\n});\r\n\r\ntest.describe('æ—¶æ€ç®¡ç†é”™è¯¯å¤„ç†', () => {\r\n  test('æ— æ•ˆç»„ç»‡ä»£ç åº”è¯¥æ˜¾ç¤ºé€‚å½“é”™è¯¯', async ({ page }) => {\r\n    await page.goto(`${BASE_URL}/temporal-demo`);\r\n    \r\n    // æœç´¢ä¸å­˜åœ¨çš„ç»„ç»‡\r\n    const searchInput = page.locator('input[placeholder*=\"è¾“å…¥ç»„ç»‡åç§°\"]');\r\n    await searchInput.fill('NONEXISTENT999');\r\n    await searchInput.press('Enter');\r\n    \r\n    // ç­‰å¾…æœç´¢ç»“æœ\r\n    await page.waitForTimeout(1000);\r\n    \r\n    // éªŒè¯æ²¡æœ‰æœç´¢ç»“æœæˆ–æ˜¾ç¤ºé€‚å½“æ¶ˆæ¯\r\n    const noResultsMessage = page.locator('text=æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç»„ç»‡').or(\r\n      page.locator('tbody tr')\r\n    );\r\n    \r\n    const rows = await page.locator('tbody tr').count();\r\n    if (rows === 0) {\r\n      await expect(page.locator('text=æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç»„ç»‡')).toBeVisible();\r\n    }\r\n  });\r\n  \r\n  test('æ—¶æ€æœåŠ¡ä¸å¯ç”¨æ—¶åº”è¯¥ä¼˜é›…å¤„ç†', async ({ page, context }) => {\r\n    // æ¨¡æ‹Ÿç½‘ç»œå¤±è´¥\r\n    await context.route('**/api/v1/organization-units/**', route => {\r\n      route.fulfill({\r\n        status: 500,\r\n        body: JSON.stringify({ error: 'Service Unavailable' })\r\n      });\r\n    });\r\n    \r\n    await page.goto(`${BASE_URL}/temporal-demo`);\r\n    \r\n    // å°è¯•æ‰“å¼€è¯¦æƒ…é¢æ¿\r\n    const viewDetailsButton = page.locator('text=æŸ¥çœ‹è¯¦æƒ…').first();\r\n    if (await viewDetailsButton.isVisible()) {\r\n      await viewDetailsButton.click();\r\n      \r\n      // åº”è¯¥æ˜¾ç¤ºé”™è¯¯çŠ¶æ€æˆ–åŠ è½½çŠ¶æ€\r\n      // é¡µé¢åº”è¯¥ä¸ä¼šå´©æºƒ\r\n      await page.waitForTimeout(2000);\r\n    }\r\n    \r\n    // éªŒè¯é¡µé¢ä»ç„¶å¯ç”¨\r\n    await expect(page.locator('h1')).toContainText('æ—¶æ€ç®¡ç†é›†æˆæ¼”ç¤º');\r\n  });\r\n});\r\n\r\ntest.describe('æ—¶æ€ç®¡ç†å¯è®¿é—®æ€§æµ‹è¯•', () => {\r\n  test('é¡µé¢åº”è¯¥æ»¡è¶³åŸºæœ¬å¯è®¿é—®æ€§è¦æ±‚', async ({ page }) => {\r\n    await page.goto(`${BASE_URL}/temporal-demo`);\r\n    \r\n    // æ£€æŸ¥æ˜¯å¦æœ‰é€‚å½“çš„æ ‡é¢˜å±‚æ¬¡\r\n    await expect(page.locator('h1')).toBeVisible();\r\n    \r\n    // æ£€æŸ¥è¡¨æ ¼æ˜¯å¦æœ‰é€‚å½“çš„æ ‡é¢˜\r\n    const table = page.locator('table');\r\n    await expect(table).toBeVisible();\r\n    await expect(table.locator('th').first()).toBeVisible();\r\n    \r\n    // æ£€æŸ¥æŒ‰é’®æ˜¯å¦å¯è®¿é—®\r\n    const buttons = page.locator('button');\r\n    const buttonCount = await buttons.count();\r\n    expect(buttonCount).toBeGreaterThan(0);\r\n    \r\n    // æ£€æŸ¥è¾“å…¥æ¡†æ˜¯å¦æœ‰æ ‡ç­¾æˆ–å ä½ç¬¦\r\n    const inputs = page.locator('input');\r\n    for (let i = 0; i < await inputs.count(); i++) {\r\n      const input = inputs.nth(i);\r\n      const placeholder = await input.getAttribute('placeholder');\r\n      const ariaLabel = await input.getAttribute('aria-label');\r\n      const id = await input.getAttribute('id');\r\n      \r\n      // è¾“å…¥æ¡†åº”è¯¥æœ‰placeholderã€aria-labelæˆ–å¯¹åº”çš„label\r\n      expect(placeholder || ariaLabel || id).toBeTruthy();\r\n    }\r\n  });\r\n  \r\n  test('é”®ç›˜å¯¼èˆªåº”è¯¥æ­£å¸¸å·¥ä½œ', async ({ page }) => {\r\n    await page.goto(`${BASE_URL}/temporal-demo`);\r\n    \r\n    // ä½¿ç”¨Tabé”®å¯¼èˆª\r\n    await page.keyboard.press('Tab');\r\n    \r\n    // éªŒè¯ç„¦ç‚¹åœ¨å¯èšç„¦å…ƒç´ ä¸Š\r\n    const focusedElement = await page.locator(':focus');\r\n    await expect(focusedElement).toBeVisible();\r\n    \r\n    // ç»§ç»­Tabå¯¼èˆªå‡ æ¬¡\r\n    for (let i = 0; i < 3; i++) {\r\n      await page.keyboard.press('Tab');\r\n      await page.waitForTimeout(100);\r\n    }\r\n    \r\n    // éªŒè¯ä»æœ‰å…ƒç´ è·å¾—ç„¦ç‚¹\r\n    const finalFocusedElement = await page.locator(':focus');\r\n    await expect(finalFocusedElement).toBeVisible();\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/tests/temporal-management.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/shangmeilin/cube-castle/frontend/vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
docs/api/schema.graphql:138:    startDate: Date
docs/api/schema.graphql:220:    startDate: String
docs/api/CHANGELOG.md:107:- **æ–°å¢æŸ¥è¯¢**: `auditHistory(recordId: UUID!, startDate: Date, endDate: Date, operation: OperationType, userId: UUID, limit: Int)`
docs/api/CHANGELOG.md:237:  - PROJECT_TEAM: projectCode, projectManager, startDate, endDate, budget
database/migrations/044_create_position_assignments.sql:17:    start_date DATE NOT NULL,
database/migrations/044_create_position_assignments.sql:28:        CHECK (end_date IS NULL OR end_date > start_date),
database/migrations/044_create_position_assignments.sql:41:    ON position_assignments(tenant_id, position_code, employee_id, start_date);
database/migrations/044_create_position_assignments.sql:44:    ON position_assignments(tenant_id, position_code, start_date DESC);
database/migrations/044_create_position_assignments.sql:47:    ON position_assignments(tenant_id, employee_id, start_date DESC);
database/migrations/047_rename_position_assignments_start_date.sql:1:-- 047_rename_position_assignments_start_date.sql
database/migrations/047_rename_position_assignments_start_date.sql:2:-- ç›®çš„ï¼šç»Ÿä¸€ position_assignments è¡¨çš„æ—¶æ€å­—æ®µå‘½åï¼Œä» start_date è°ƒæ•´ä¸º effective_dateï¼Œä¿æŒä¸å…¶å®ƒæ—¶æ€è¡¨ä¸€è‡´ã€‚
database/migrations/047_rename_position_assignments_start_date.sql:7:    RENAME COLUMN start_date TO effective_date;
docs/archive/development-plans/81-graphql-draft-snippets.md:165:    startDate: Date
frontend/src/features/temporal/components/TimelineComponent.tsx:233:    const calculateDuration = (startDate: string, endDate?: string | null) => {
frontend/src/features/temporal/components/TimelineComponent.tsx:234:      const start = new Date(startDate);
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:32:| **ä»»èŒè®°å½•** | `position_assignments` | **`start_date` + `end_date`** ğŸ”´ | 044_create_position_assignments.sql |
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:36:- ä»»èŒè®°å½•ï¼ˆposition_assignmentsï¼‰å•ç‹¬ä½¿ç”¨ `start_date`
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:42:- 4ä¸ªç´¢å¼•åŒ…å« `start_date` å­—æ®µ
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:93:#### è¯æ®3ï¼šä»»èŒè®°å½•ä½¿ç”¨ start_dateï¼ˆ044è¿ç§»ï¼‰ğŸ”´
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:98:    start_date DATE NOT NULL,
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:103:        CHECK (end_date IS NULL OR end_date > start_date),
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:106:-- ç´¢å¼•ä¹ŸåŸºäº start_date
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:108:    ON position_assignments(tenant_id, position_code, employee_id, start_date);
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:111:    ON position_assignments(tenant_id, position_code, start_date DESC);
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:114:    ON position_assignments(tenant_id, employee_id, start_date DESC);
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:117:#### è¯æ®4ï¼šä»“å‚¨ä»£ç ä½¿ç”¨ start_date
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:124:        assignment_type, assignment_status, fte, start_date, end_date, is_current, notes
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:145:  - start_date: "å‘˜å·¥ä»ä½•æ—¶å¼€å§‹ä»»èŒ"
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:197:  AND pa.start_date <= '2025-10-01'        -- è¿™é‡Œå´æ˜¯ start_date âš ï¸
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:220:  startDate: String!        # æ¥è‡ª position_assignments.start_date âš ï¸
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:237:  startDate: string;        // å¦ä¸€ä¸ªå‘½å âš ï¸
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:264:                AND start_date <= $2        // start_date âš ï¸
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:293:å°† `position_assignments.start_date` é‡å‘½åä¸º `effective_date`ï¼Œä¸å…¨ç³»ç»Ÿä¿æŒä¸€è‡´ã€‚
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:300:-- 047_rename_assignment_start_date_to_effective_date.sql
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:305:RENAME COLUMN start_date TO effective_date;
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:459:  - ç›‘æ§å‘Šè­¦å¦‚å¼•ç”¨ `start_date`ï¼Œéœ€è°ƒæ•´æŒ‡æ ‡æ ‡ç­¾æˆ–æŸ¥è¯¢ã€‚
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:501:-- 1. é‡å‘½åå› start_date
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:503:RENAME COLUMN effective_date TO start_date;
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:511:    CHECK (end_date IS NULL OR end_date > start_date);
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:516:    ON position_assignments(tenant_id, position_code, employee_id, start_date);
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:520:    ON position_assignments(tenant_id, position_code, start_date DESC);
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:524:    ON position_assignments(tenant_id, employee_id, start_date DESC);
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:531:- [x] æ•°æ®å®Œæ•´æ€§ï¼š`047_rename_position_assignments_start_date.sql` ä»…æ‰§è¡Œåˆ—é‡å‘½åä¸ç´¢å¼•é‡å»ºï¼ˆæ— æ•°æ®å†™å…¥ï¼‰ï¼ŒéªŒè¯åç»­æŸ¥è¯¢æœªå‡ºç°ç¼ºå¤±è®°å½•ï¼ˆå‚è€ƒ 06 å·æ—¥å¿— Â§6.4ï¼‰ã€‚
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:574:- `database/migrations/044_create_position_assignments.sql` - ä»»èŒè®°å½•æ—¶æ€æ¨¡å¼ï¼ˆä½¿ç”¨ start_dateï¼‰
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:614:- ç›˜ç‚¹ä¾èµ– `start_date` çš„å®šæ—¶ä»»åŠ¡/æŠ¥è¡¨è„šæœ¬ï¼Œå‡†å¤‡åŒæ­¥æ›´æ–°æ—¶é—´ç‚¹ã€‚
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:633:- å›æ»šåéœ€é€šçŸ¥æ‰€æœ‰å›¢é˜Ÿä¿æŒ `start_date` å­—æ®µå‘½åï¼Œå¹¶åœ¨ 06 å·æ—¥å¿—ç™»è®°åŸå› ä¸åç»­åŠ¨ä½œã€‚
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:651:  - æŸ¥è¯¢æœåŠ¡/å‰ç«¯å›¢é˜Ÿå¤æ ¸ 86 å·è®¡åˆ’äº¤ä»˜çš„ GraphQL & UI åœºæ™¯ï¼Œç¡®è®¤ç»§ç»­ä½¿ç”¨ `effectiveDate` å­—æ®µï¼Œæ— æ®‹ç•™ `startDate` å¼•ç”¨ã€‚
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:675:| Stage 4 æºç ä»å¼•ç”¨ `startDate` | æ¥å£/å‰ç«¯æŠ¥é”™ | åœ¨ T-3 å¤©å®Œæˆä»£ç é™æ€æ£€æŸ¥ï¼ˆ`rg "startDate" cmd frontend`ï¼‰å¹¶æäº¤å®¡æŸ¥è®°å½•ï¼›è‹¥å‘ç°æ®‹ç•™ï¼Œå…ˆä¿®å¤å†è¿›å…¥ä¸Šçº¿çª—å£ã€‚ |
docs/archive/development-plans/87-temporal-field-naming-consistency-decision.md:676:| å¤–éƒ¨ä¾èµ–æœªåŒæ­¥ | ç¬¬ä¸‰æ–¹é›†æˆå¤±è´¥ | åœ¨å‘å¸ƒè¯´æ˜ä¸­é™„æ–°æ—§å­—æ®µæ˜ å°„ï¼Œæå‰ 48 å°æ—¶å‘é€é€šçŸ¥ï¼›å¿…è¦æ—¶æä¾›å…¼å®¹å±‚ï¼ˆä¾‹å¦‚æ–°å¢è§†å›¾ `position_assignments_view` æš‚æ—¶æš´éœ² `start_date` åˆ«åï¼Œçª—å£æœŸç»“æŸåä¸‹çº¿ï¼‰ã€‚ |
docs/archive/development-plans/84-position-lifecycle-stage2-implementation-plan.md:119:  1. `044_create_position_assignments.sql`ï¼šæŒ‰ç…§ 80 å· Â§3.2.1 äº‹ä»¶å‘¨æœŸæ¨¡å¼åˆ›å»ºè¡¨ï¼ŒåŒ…å«å­—æ®µ `assignment_id`, `tenant_id`, `position_code`, `position_record_id`, `employee_id`, `assignment_type`, `assignment_status`, `start_date`, `end_date`, `is_current`, `created_at`, `updated_at`ï¼Œå¹¶å®ç°ä»¥ä¸‹çº¦æŸï¼š  
docs/archive/development-plans/84-position-lifecycle-stage2-implementation-plan.md:120:     - `(tenant_id, position_code, employee_id, start_date)` å”¯ä¸€ï¼›  
docs/archive/development-plans/84-position-lifecycle-stage2-implementation-plan.md:122:     - `CHECK (end_date IS NULL OR end_date > start_date)`ï¼›  
frontend/src/features/audit/components/AuditHistorySection.tsx:74:        query GetAuditHistory($recordId: String!, $limit: Int, $startDate: String, $endDate: String, $operation: OperationType, $userId: String) {
frontend/src/features/audit/components/AuditHistorySection.tsx:75:          auditHistory(recordId: $recordId, limit: $limit, startDate: $startDate, endDate: $endDate, operation: $operation, userId: $userId) {
frontend/src/features/audit/components/AuditHistorySection.tsx:95:        startDate: params?.startDate || null,
frontend/src/shared/validation/schemas.ts:244:    isEndDateAfterStartDate: (startDate: string, endDate: string): boolean => {
frontend/src/shared/validation/schemas.ts:245:      return validateTemporalDate.isEndDateAfterStartDate(startDate, endDate);
frontend/src/shared/utils/temporal-validation-adapter.ts:29:  isDateInRange: (dateString: string, startDate?: string, endDate?: string): boolean => {
frontend/src/shared/utils/temporal-validation-adapter.ts:30:    if (!startDate && !endDate) {
frontend/src/shared/utils/temporal-validation-adapter.ts:33:    return TemporalUtils.isInRange(dateString, startDate, endDate);
frontend/src/shared/utils/temporal-validation-adapter.ts:36:  isEndDateAfterStartDate: (startDate: string, endDate: string): boolean => {
frontend/src/shared/utils/temporal-validation-adapter.ts:38:      effectiveDate: startDate,
frontend/src/shared/types/temporal.ts:45:  startDate?: string;       // å®¡è®¡è®°å½•å¼€å§‹æ—¶é—´
frontend/src/generated/graphql-types.ts:817:  startDate?: InputMaybe<Scalars["String"]["input"]>;
frontend/src/generated/graphql-types.ts:969:  startDate?: InputMaybe<Scalars["Date"]["input"]>;

> ç»“æœï¼šæœªåœ¨ä»£ç ä¸­å‘ç° start_date/startDate æ®‹ç•™ã€‚
