services:
  gh-runner:
    image: myoung34/github-runner:2.315.0
    container_name: cubecastle-gh-runner
    environment:
      # 仓库 URL（必填）
      REPO_URL: https://github.com/jacksonlee411/cube-castle
      # Runner 名称（可自定义）
      RUNNER_NAME: cc-runner-${HOSTNAME}
      # Runner 标签
      RUNNER_LABELS: self-hosted,cubecastle,linux,x64,docker
      # 工作目录
      RUNNER_WORKDIR: /tmp/runner/work
      # 以 Ephemeral 模式运行（Job 完成后自动注销）
      EPHEMERAL: "true"
      # 禁止自动更新（固定镜像版本）
      DISABLE_AUTO_UPDATE: "true"
      # 注册令牌/访问令牌（二选一；从宿主 secrets/.env.local 注入）
      # 优先 REG_TOKEN；无则使用 PAT
      RUNNER_TOKEN: ${GH_RUNNER_REG_TOKEN}
      ACCESS_TOKEN: ${GH_RUNNER_PAT}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./secrets:/secrets:ro
    restart: unless-stopped

