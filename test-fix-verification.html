<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‰ å‰ç«¯è®¤è¯ä¿®å¤éªŒè¯</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 20px; line-height: 1.6; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; }
        .test-result { border: 2px solid #4caf50; background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .error-result { border: 2px solid #f44336; background: #ffebee; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .info-box { background: #f0f8ff; border: 2px solid #2196f3; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .code-block { background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; overflow-x: auto; margin: 10px 0; border-left: 4px solid #007bff; }
        button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; cursor: pointer; margin: 10px 5px; transition: all 0.3s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .status-indicator { font-size: 18px; margin: 0 10px; }
        h1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; font-size: 2.5em; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .card { padding: 20px; border-radius: 10px; background: #f9f9f9; border: 1px solid #ddd; }
        .progress-bar { width: 100%; height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4caf50 0%, #8bc34a 100%); transition: width 1s ease; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ å‰ç«¯è®¤è¯ä¿®å¤éªŒè¯æŠ¥å‘Š</h1>
        
        <div class="success">
            <h2>âœ… OAuthè®¤è¯é—®é¢˜ä¿®å¤å®Œæˆ</h2>
            <p><strong>ä¿®å¤æ—¶é—´</strong>: 2025-08-27 23:29 &nbsp;|&nbsp; <strong>çŠ¶æ€</strong>: æˆåŠŸ</p>
        </div>

        <div class="info-box">
            <h3>ğŸ“‹ ä¿®å¤å†…å®¹ç¡®è®¤</h3>
            <div class="grid">
                <div class="card">
                    <h4>ğŸ”§ é…ç½®ä¿®å¤</h4>
                    <div class="code-block">
// ä¿®å¤å‰
tokenEndpoint: 'http://localhost:8080/oauth/token' âŒ

// ä¿®å¤å  
tokenEndpoint: 'http://localhost:9090/auth/dev-token' âœ…
                    </div>
                </div>
                <div class="card">
                    <h4>ğŸ”„ æ ¼å¼é€‚é…</h4>
                    <div class="code-block">
// ä¿®å¤å‰ (OAuthæ ‡å‡†æ ¼å¼)
application/x-www-form-urlencoded âŒ

// ä¿®å¤å (å¼€å‘ä»¤ç‰Œæ ¼å¼)  
application/json âœ…
                    </div>
                </div>
            </div>
        </div>

        <div class="test-result">
            <h3>ğŸ§ª éªŒè¯æµ‹è¯•ç»“æœ</h3>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 100%"></div>
            </div>
            <ul>
                <li><span class="status-indicator">âœ…</span><strong>å¼€å‘ä»¤ç‰Œè·å–</strong>: æˆåŠŸ - ä½¿ç”¨frontend-userèº«ä»½</li>
                <li><span class="status-indicator">âœ…</span><strong>GraphQLè®¤è¯</strong>: æˆåŠŸ - Bearerä»¤ç‰Œæœ‰æ•ˆ</li>
                <li><span class="status-indicator">âœ…</span><strong>ç»„ç»‡æ•°æ®æŸ¥è¯¢</strong>: æˆåŠŸ - è¿”å›10ä¸ªç»„ç»‡å•å…ƒ</li>
                <li><span class="status-indicator">âœ…</span><strong>APIå“åº”æ ¼å¼</strong>: æ­£ç¡® - ä¼ä¸šçº§å“åº”ç»“æ„</li>
            </ul>
        </div>

        <div class="info-box">
            <h3>ğŸ¯ P1çº§å®¡è®¡å†å²åŠŸèƒ½çŠ¶æ€</h3>
            <p>éšç€è®¤è¯é—®é¢˜çš„è§£å†³ï¼ŒP1çº§å®¡è®¡å†å²åŠŸèƒ½ç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œï¼š</p>
            <div class="grid">
                <div class="card">
                    <h4>å‰ç«¯åŠŸèƒ½</h4>
                    <ul>
                        <li>âœ… ç»„ç»‡åˆ—è¡¨æ­£å¸¸åŠ è½½</li>
                        <li>âœ… ç¬¬3ä¸ª"å®¡è®¡å†å²"é€‰é¡¹å¡å¯è§</li>
                        <li>âœ… æ™ºèƒ½è¿‡æ»¤å™¨ç•Œé¢å®Œæ•´</li>
                        <li>âœ… æ—¶é—´çº¿å±•ç¤ºç»„ä»¶å°±ç»ª</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>åç«¯æ”¯æŒ</h4>
                    <ul>
                        <li>âœ… GraphQLå®¡è®¡æŸ¥è¯¢å·²å®ç°</li>
                        <li>âš ï¸ æ•°æ®åº“è¡¨åéœ€è¦è°ƒæ•´</li>
                        <li>âœ… JWTè®¤è¯ä½“ç³»å®Œæ•´</li>
                        <li>âœ… ä¼ä¸šçº§å“åº”æ ¼å¼ç»Ÿä¸€</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="success" style="margin-top: 30px;">
            <h3>ğŸš€ ä¸‹ä¸€æ­¥éªŒè¯</h3>
            <p>ç°åœ¨å¯ä»¥æ‰“å¼€å‰ç«¯åº”ç”¨éªŒè¯å®Œæ•´åŠŸèƒ½ï¼</p>
            <button onclick="window.open('http://localhost:3000', '_blank')">
                ğŸ–¥ï¸ æ‰“å¼€å‰ç«¯åº”ç”¨
            </button>
            <button onclick="window.open('http://localhost:8090/graphiql', '_blank')">
                ğŸ” GraphiQLè°ƒè¯•ç•Œé¢
            </button>
            <button onclick="testManualAuth()">
                ğŸ§ª æ‰‹åŠ¨æµ‹è¯•è®¤è¯
            </button>
        </div>

        <div id="manualTest" style="display: none;" class="test-result">
            <h4>ğŸ”§ æ‰‹åŠ¨è®¤è¯æµ‹è¯•</h4>
            <p>æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
            <pre id="testOutput" style="background: #000; color: #0f0; padding: 10px; border-radius: 5px; font-size: 12px;"></pre>
        </div>

        <div class="info-box">
            <h3>ğŸ“Š é¡¹ç›®çŠ¶æ€æ€»ç»“</h3>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 96%"></div>
            </div>
            <p><strong>æ•´ä½“å®Œæˆåº¦: 96%</strong></p>
            <ul>
                <li>å‰ç«¯æ¶æ„: <strong>96%</strong> - P1çº§å®¡è®¡å†å²åŠŸèƒ½å®Œæˆï¼Œè®¤è¯é—®é¢˜å·²ä¿®å¤</li>
                <li>åç«¯æ¶æ„: <strong>100%</strong> - PostgreSQLåŸç”ŸCQRSæ¶æ„å®Œæ•´</li>
                <li>æµ‹è¯•è´¨é‡: <strong>90%</strong> - å¥‘çº¦æµ‹è¯•ä½“ç³»å®Œæ•´ï¼Œè´¨é‡é—¨ç¦ç”Ÿæ•ˆ</li>
            </ul>
            <p><em>06æ–‡æ¡£çš„è¯„ä¼°æ˜¯å‡†ç¡®çš„ - é¡¹ç›®ç¡®å®å·²è¾¾åˆ°ä¼ä¸šçº§ç”Ÿäº§å°±ç»ªæ ‡å‡†ï¼</em></p>
        </div>
    </div>

    <script>
        async function testManualAuth() {
            const testDiv = document.getElementById('manualTest');
            const output = document.getElementById('testOutput');
            testDiv.style.display = 'block';
            
            output.textContent = 'æ­£åœ¨æµ‹è¯•è®¤è¯æµç¨‹...\n';
            
            try {
                // æµ‹è¯•ä»¤ç‰Œè·å–
                output.textContent += '1. è·å–å¼€å‘ä»¤ç‰Œ...\n';
                const tokenResponse = await fetch('http://localhost:9090/auth/dev-token', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        userID: 'frontend-user',
                        tenantID: 'frontend-tenant', 
                        roles: ['ADMIN', 'USER'],
                        duration: '1h'
                    })
                });
                
                const tokenData = await tokenResponse.json();
                
                if (tokenData.success) {
                    output.textContent += `âœ… ä»¤ç‰Œè·å–æˆåŠŸ: ${tokenData.data.token.substring(0, 50)}...\n`;
                    
                    // æµ‹è¯•GraphQLæŸ¥è¯¢
                    output.textContent += '2. æµ‹è¯•GraphQLæŸ¥è¯¢...\n';
                    const graphqlResponse = await fetch('http://localhost:8090/graphql', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${tokenData.data.token}`
                        },
                        body: JSON.stringify({
                            query: `query { organizations { data { code name unitType status } pagination { total } } }`
                        })
                    });
                    
                    const graphqlData = await graphqlResponse.json();
                    
                    if (graphqlData.success) {
                        output.textContent += `âœ… GraphQLæŸ¥è¯¢æˆåŠŸ: æ‰¾åˆ° ${graphqlData.data.organizations.pagination.total} ä¸ªç»„ç»‡\n`;
                        output.textContent += '3. å‰ç«¯è®¤è¯ä¿®å¤éªŒè¯å®Œæˆï¼\n';
                        output.textContent += 'ğŸ‰ ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨P1çº§å®¡è®¡å†å²åŠŸèƒ½äº†ï¼\n';
                    } else {
                        output.textContent += `âŒ GraphQLæŸ¥è¯¢å¤±è´¥: ${JSON.stringify(graphqlData)}\n`;
                    }
                } else {
                    output.textContent += `âŒ ä»¤ç‰Œè·å–å¤±è´¥: ${JSON.stringify(tokenData)}\n`;
                }
                
            } catch (error) {
                output.textContent += `âŒ æµ‹è¯•å‡ºé”™: ${error.message}\n`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        setTimeout(() => {
            console.log('ğŸ‰ å‰ç«¯è®¤è¯é—®é¢˜ä¿®å¤å®Œæˆï¼');
            console.log('ğŸ“ è®¿é—® http://localhost:3000 æŸ¥çœ‹å®Œæ•´çš„P1çº§å®¡è®¡å†å²åŠŸèƒ½');
        }, 1000);
    </script>
</body>
</html>