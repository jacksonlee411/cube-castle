# Cube Castle 项目 - Cursor AI 开发规范

## 项目概述
这是一个基于Go和Python的微服务架构项目，包含CoreHR API系统和AI智能服务集成。

## 技术栈
- **后端**: Go (Chi路由器, gRPC客户端)
- **AI服务**: Python (gRPC服务器, OpenAI API集成)
- **数据库**: PostgreSQL
- **通信**: gRPC (服务间通信)
- **容器化**: Docker Compose

## 项目结构
```
cube-castle/
├── go-app/                    # Go API服务
│   ├── cmd/server/main.go     # 主服务器入口
│   ├── internal/              # 内部包
│   │   ├── corehr/           # CoreHR业务逻辑
│   │   ├── intelligencegateway/ # AI网关
│   │   └── common/           # 公共组件
│   └── generated/            # 生成的代码
├── python-ai/                 # Python AI服务
│   ├── main.py               # 真实AI服务
│   ├── main_mock.py          # 模拟AI服务
│   └── requirements.txt      # Python依赖
├── contracts/                # API契约定义
├── docs/                     # 项目文档
└── docker-compose.yml        # 容器编排
```

## 开发规范

### 1. 环境配置
- 始终使用Python虚拟环境 (`python-ai/venv/`)
- Go模块路径: `github.com/gaogu/cube-castle/go-app`
- 服务端口: Go服务(8080), Python AI服务(50051)

### 2. 服务启动顺序
1. 先启动Python AI服务
2. 再启动Go API服务
3. 确保gRPC连接成功

### 3. 常见问题避免
- **路由注册**: 避免Chi路由器冲突，明确注册顺序
- **gRPC连接**: 添加超时和重试机制
- **环境变量**: 使用.env文件管理配置
- **依赖管理**: 定期运行`go mod tidy`

### 4. 代码风格
- Go: 使用标准Go格式化
- Python: 遵循PEP 8规范
- 错误处理: 统一错误响应格式
- 日志记录: 结构化日志输出

### 5. 测试要求
- 为新功能编写单元测试
- 集成测试验证服务通信
- API端点测试脚本

## 关键文件说明

### 核心服务文件
- `go-app/cmd/server/main.go`: Go API服务器主入口
- `python-ai/main.py`: Python AI服务实现
- `python-ai/main_mock.py`: 开发测试用模拟服务

### 配置文件
- `.env.example`: 环境变量模板
- `docker-compose.yml`: 服务编排配置
- `go-app/go.mod`: Go模块定义

### 测试文件
- `go-app/test_ai.sh`: AI服务测试脚本
- `go-app/test_all_routes.sh`: API路由测试
- `test.html`: 前端测试页面

## 开发流程

### 新功能开发
1. 创建功能分支
2. 实现核心逻辑
3. 添加测试用例
4. 更新文档
5. 提交代码

### 问题排查
1. 检查服务状态和日志
2. 验证环境配置
3. 测试服务间通信
4. 查看相关文档

## 注意事项
- 不要硬编码API密钥
- 确保服务启动顺序正确
- 定期更新依赖包
- 保持文档同步更新
- 使用版本控制管理代码

## 参考文档
- `docs/开发问题总结与最佳实践.md`: 详细问题解决方案
- `docs/城堡蓝图.md`: 项目架构设计
- `docs/元合约v6.0.md`: API接口定义 