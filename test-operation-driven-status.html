<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ“ä½œé©±åŠ¨çŠ¶æ€ç®¡ç†æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-active {
            background-color: #e6f7e1;
            color: #2e7d32;
            border: 1px solid #81c784;
        }
        .status-suspended {
            background-color: #fff3e0;
            color: #f57c00;
            border: 1px solid #ffb74d;
        }
        .status-planned {
            background-color: #e3f2fd;
            color: #1976d2;
            border: 1px solid #64b5f6;
        }
        .action-button {
            padding: 6px 12px;
            margin: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #f5f5f5;
            cursor: pointer;
            font-size: 12px;
        }
        .action-button:hover {
            background: #e0e0e0;
        }
        .success {
            color: #2e7d32;
            font-weight: 500;
        }
        .error {
            color: #d32f2f;
            font-weight: 500;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .test-passed {
            background: #e8f5e8;
            border: 1px solid #4caf50;
        }
        .test-failed {
            background: #ffeaea;
            border: 1px solid #f44336;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ“ä½œé©±åŠ¨çŠ¶æ€ç®¡ç†æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ é‡æ„å®ŒæˆçŠ¶æ€æ£€æŸ¥</h2>
        <div>
            <h3>âœ… å·²å®Œæˆçš„é‡æ„é¡¹ç›®ï¼š</h3>
            <ul>
                <li>âœ… åç«¯APIé‡æ„ - ç§»é™¤æ‰‹åŠ¨statusè®¾ç½®</li>
                <li>âœ… åç«¯APIé‡æ„ - ç»Ÿä¸€suspend/activateç«¯ç‚¹</li>
                <li>âœ… åˆ é™¤å¤æ‚çŠ¶æ€é€‰æ‹©å™¨ - ç§»é™¤FiveStateStatusSelector.tsx</li>
                <li>âœ… åˆ›å»ºç®€åŒ–çš„StatusBadgeç»„ä»¶</li>
                <li>âœ… åˆ›å»ºæ“ä½œé©±åŠ¨çš„OrganizationActionsç»„ä»¶</li>
                <li>âœ… ç±»å‹å®šä¹‰ç»Ÿä¸€ - æ›´æ–°TypeScriptç±»å‹å®šä¹‰</li>
                <li>âœ… APIå®¢æˆ·ç«¯æ›´æ–° - æ›´æ–°å‰ç«¯APIè°ƒç”¨é€»è¾‘</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ APIç«¯ç‚¹æµ‹è¯•</h2>
        <div id="api-tests">
            <h3>æµ‹è¯•ç»„ç»‡: 1000015 (æµ‹è¯•æ“ä½œé©±åŠ¨çŠ¶æ€ç®¡ç†)</h3>
            
            <div>
                <h4>å½“å‰çŠ¶æ€:</h4>
                <span id="current-status" class="status-badge status-active">ACTIVE</span>
            </div>
            
            <div>
                <h4>å¯ç”¨æ“ä½œ:</h4>
                <button class="action-button" onclick="testSuspend()">åœç”¨ç»„ç»‡</button>
                <button class="action-button" onclick="testReactivate()">é‡æ–°å¯ç”¨</button>
                <button class="action-button" onclick="checkStatus()">æ£€æŸ¥çŠ¶æ€</button>
            </div>
            
            <div id="test-results"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ çŠ¶æ€æ˜ å°„éªŒè¯</h2>
        <div>
            <h3>æ–°çš„ä¸‰çŠ¶æ€ç³»ç»Ÿ:</h3>
            <div>
                <span class="status-badge status-active">ACTIVE (å¯ç”¨)</span> - ç»„ç»‡æ­£å¸¸è¿è¡Œ
            </div>
            <div>
                <span class="status-badge status-suspended">SUSPENDED (åœç”¨)</span> - ç»„ç»‡æš‚åœè¿è¡Œï¼Œå¯æ¢å¤
            </div>
            <div>
                <span class="status-badge status-planned">PLANNED (è®¡åˆ’ä¸­)</span> - ç»„ç»‡å°šæœªå¯ç”¨
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š é‡æ„æ•ˆæœéªŒè¯</h2>
        <div id="refactor-summary">
            <h3>é‡æ„å‰åå¯¹æ¯”:</h3>
            <ul>
                <li><strong>çŠ¶æ€ç®¡ç†æ–¹å¼</strong>: æ‰‹åŠ¨è®¾ç½®çŠ¶æ€ â†’ æ“ä½œé©±åŠ¨çŠ¶æ€è‡ªåŠ¨å˜æ›´</li>
                <li><strong>çŠ¶æ€å®šä¹‰</strong>: ACTIVE/INACTIVE/PLANNED â†’ ACTIVE/SUSPENDED/PLANNED</li>
                <li><strong>çŠ¶æ€å˜æ›´æ“ä½œ</strong>: ç›´æ¥ä¿®æ”¹statuså­—æ®µ â†’ è°ƒç”¨ä¸“é—¨çš„suspend/activateç«¯ç‚¹</li>
                <li><strong>å‰ç«¯ç»„ä»¶</strong>: å¤æ‚çš„äº”çŠ¶æ€é€‰æ‹©å™¨ â†’ ç®€æ´çš„çŠ¶æ€å¾½ç« å’Œæ“ä½œæŒ‰é’®</li>
                <li><strong>ä¸šåŠ¡è¯­ä¹‰</strong>: æŠ€æœ¯å¯¼å‘ â†’ ä¸šåŠ¡å¯¼å‘ (åœç”¨ç±»ä¼¼å‘˜å·¥ç¦»èŒï¼Œé‡å¯ç±»ä¼¼é‡æ–°å…¥èŒ)</li>
            </ul>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:9090/api/v1';
        const TENANT_ID = '3b99930c-4dc6-4cc9-8e4d-7d960a931cb9';
        const TEST_ORG_CODE = '1000015';

        function addTestResult(message, success = true) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'test-passed' : 'test-failed'}`;
            resultDiv.innerHTML = `
                <strong>${success ? 'âœ…' : 'âŒ'}</strong> 
                ${message} 
                <small>(${new Date().toLocaleTimeString()})</small>
            `;
            resultsDiv.appendChild(resultDiv);
        }

        async function apiRequest(endpoint, method = 'GET', body = null) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Tenant-ID': TENANT_ID
                    },
                    body: body ? JSON.stringify(body) : null
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || `HTTP ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('APIè¯·æ±‚å¤±è´¥:', error);
                throw error;
            }
        }

        async function testSuspend() {
            try {
                addTestResult('æ­£åœ¨æµ‹è¯•åœç”¨æ“ä½œ...', true);
                const result = await apiRequest(`/organization-units/${TEST_ORG_CODE}/suspend`, 'POST', {
                    reason: 'æµ‹è¯•é¡µé¢ - åœç”¨æ“ä½œéªŒè¯'
                });
                
                addTestResult(`åœç”¨æ“ä½œæˆåŠŸ: ${result.name} â†’ ${result.status}`, true);
                updateStatusBadge(result.status);
            } catch (error) {
                addTestResult(`åœç”¨æ“ä½œå¤±è´¥: ${error.message}`, false);
            }
        }

        async function testReactivate() {
            try {
                addTestResult('æ­£åœ¨æµ‹è¯•é‡æ–°å¯ç”¨æ“ä½œ...', true);
                const result = await apiRequest(`/organization-units/${TEST_ORG_CODE}/activate`, 'POST', {
                    reason: 'æµ‹è¯•é¡µé¢ - é‡æ–°å¯ç”¨æ“ä½œéªŒè¯'
                });
                
                addTestResult(`é‡æ–°å¯ç”¨æ“ä½œæˆåŠŸ: ${result.name} â†’ ${result.status}`, true);
                updateStatusBadge(result.status);
            } catch (error) {
                addTestResult(`é‡æ–°å¯ç”¨æ“ä½œå¤±è´¥: ${error.message}`, false);
            }
        }

        async function checkStatus() {
            try {
                // ä½¿ç”¨GraphQLæŸ¥è¯¢æœåŠ¡æ£€æŸ¥çŠ¶æ€
                const graphqlQuery = {
                    query: `
                        query GetOrganization($code: String!) {
                            organization(code: $code) {
                                code
                                name
                                status
                                updated_at
                            }
                        }
                    `,
                    variables: { code: TEST_ORG_CODE }
                };

                const response = await fetch('http://localhost:8090/graphql', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(graphqlQuery)
                });

                const result = await response.json();
                if (result.data && result.data.organization) {
                    const org = result.data.organization;
                    addTestResult(`çŠ¶æ€æŸ¥è¯¢æˆåŠŸ: ${org.name} å½“å‰çŠ¶æ€ä¸º ${org.status}`, true);
                    updateStatusBadge(org.status);
                } else {
                    addTestResult('çŠ¶æ€æŸ¥è¯¢å¤±è´¥: ç»„ç»‡ä¸å­˜åœ¨', false);
                }
            } catch (error) {
                addTestResult(`çŠ¶æ€æŸ¥è¯¢å¤±è´¥: ${error.message}`, false);
            }
        }

        function updateStatusBadge(status) {
            const badge = document.getElementById('current-status');
            badge.textContent = status;
            badge.className = 'status-badge';
            
            switch (status) {
                case 'ACTIVE':
                    badge.classList.add('status-active');
                    break;
                case 'SUSPENDED':
                    badge.classList.add('status-suspended');
                    break;
                case 'PLANNED':
                    badge.classList.add('status-planned');
                    break;
                default:
                    badge.classList.add('status-active');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        window.addEventListener('load', () => {
            addTestResult('æ“ä½œé©±åŠ¨çŠ¶æ€ç®¡ç†æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', true);
            setTimeout(checkStatus, 1000);
        });
    </script>
</body>
</html>
