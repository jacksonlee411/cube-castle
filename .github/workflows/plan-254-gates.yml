name: plan-254-gates

on:
  pull_request:
    paths:
      - 'docs/development-plans/254-frontend-endpoint-and-proxy-consolidation.md'
      - 'frontend/vite.config.ts'
      - 'frontend/playwright.config.ts'
      - 'frontend/src/shared/config/**'
      - 'frontend/package.json'
      - 'scripts/quality/architecture-validator.js'
      - 'docker-compose.e2e.yml'
      - 'AGENTS.md'
  push:
    branches: [ main, master, develop ]
    paths:
      - 'docs/development-plans/254-frontend-endpoint-and-proxy-consolidation.md'
      - 'frontend/vite.config.ts'
      - 'frontend/playwright.config.ts'
      - 'frontend/src/shared/config/**'
      - 'frontend/package.json'
      - 'scripts/quality/architecture-validator.js'
      - 'docker-compose.e2e.yml'
      - 'AGENTS.md'
  workflow_dispatch: {}

jobs:
  gate:
    name: Plan 254 Gate – ubuntu
    # TODO-TEMPORARY(2025-11-22): 简化 runner 矩阵为单一 ubuntu-latest，待工作流稳定后恢复 self-hosted 并行矩阵
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Preflight
        run: |
          echo "Plan 254 preflight OK on $(uname -a)"
          node -v || true
          npm -v || true
          echo "TODO-TEMPORARY(2025-11-22): 将完整步骤分阶段恢复；本次提交仅验证 job 可正常创建"
